
      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 1


    1             /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB
    2             /COPYRIGHT 1975
    3             /DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
    4             /
    5             /THIS SECTION DEFINES THE HARDWARE CONFIGURATION ON WHICH INDIVIDUAL
    6             /EDUSYSTEM 50 MONITORS ARE TO RUN.
    7             /FOR EACH STATEMENT, THE COMMENT INDICATES THE POSSIBLE RESPONSES.
    8             
    9       0002  CPU=    2       /1 IF CPU IS PDP-8; 0 IF CPU IS PDP-8/I;
   10                             /2 IF CPU IS PDP-8/E
   11             
   12       0070  CORMEM= 70      /HIGHEST DATA FIELD SELECT. FOR 12K SYSTEM,
   13                             /RESPOND 20, FOR 16K SYSTEM, RESPOND 30, ETC. (70 MAX)
   14             
   15       0000  PHONES= 0       /1 IF DC08 INCLUDES 689AG;
   16                             /0 IF IT DOES NOT OR IF TTY INTERFACING IS OTHER THAN DC08
   17             
   18       0000  EAE=    0       /20 IF PROCESSOR INCLUDES EAE; 0 IF IT DOES NOT
   19             
   20       0000  RF08=   0       /40 IF SYSTEM DISC IS DF32; 0 IF SYSTEM DISK IS RF08
   21             
   22       0000  RS08=   0       /NUMBER OF DISCS ON THE SYSTEM, WHETHER DF/DS OR RF/RS.
   23                             /RESPOND WITH 1, 2, 3, OR 4.
   24             
   25       0001  RKSYS=  1       /1 IF SYSTEM USES RK05 DRIVE 0 AS SYSTEM / SWAP
   26             
   27       0001  PUNCH=  1       /1 IF SYSTEM INCLUDES PUNCH; 0 IF IT DOES NOT
   28             
   29       0001  TC01=   1       /1 IF SYSTEM INCLUDES DECTAPE(S); 0 IF IT DOES NOT
   30             
   31       0000  RK05=   0       /NUMBER OF RK05 CARTRIDGE DISK DRIVES ON THE SYSTEM; 0 TO 4
   32             
   33       0000  CDR=    0       /1 IF SYSTEM INCLUDES CARD READER; 0 IF IT DOES NOT
   34             
   35       0000  LPT=    0       /1 IF SYSTEM INCLUDES LINE PRINTER; 0 IF NO LINE PRINTER
   36             
   37             DECIMAL /MONITOR CAPACITY FOR THIS SYSTEM
   38             
   39       0024  JOBMAX= 20      /NUMBER OF SIMULTANEOUS USERS (20 MAXIMUM)
   40             
   41             /THE FOLLOWING ENTRIES DEFINE THE NUMBER OF TERMINALS
   42             /ATTACHED TO THE SYSTEM, AND ALSO THE METHOD OF INTERFACING
   43             
   44       0001  CONTTY= 1       /WE ALWAYS HAVE A CONSOLE (K00)
   45             
   46       0000  DC08A=  0       /NUMBER OF TERMINALS INTERFACED VIA DC08A (PDP-8/I ONLY, 19 MAX.)
   47             
   48       0000  DC08LO= 0       /LOWEST HARDWARE LINE NUMBER UTILIZED ON DC08A; USUALLY 0
   49             
   50       0000  PT08=   0       /NUMBER OF TERMINALS INTERFACED VIA PT08 (PDP-8 & PDP-8/I ONLY)
   51             
   52       0010  KL8=    8       /NUMBER OF ADDITIONAL TERMINALS INTERFACED VIA KL8 (PDP-8/E ONLY, 19 MAX.)

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 2


   53             
   54             /PARAMETERS VERSION 8.24 (01-JANUARY-75)
   55             /
   56             /
   57             /
   58             /
   59             /COPYRIGHT (C) 1975
   60             /DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
   61             /
   62             /
   63             /THIS SOFTWARE IS FURNISHED UNDER A LICENSE FOR USE ONLY
   64             /ON A SINGLE COMPUTER SYSTEM AND MAY BE COPIED ONLY WITH
   65             /THE  INCLUSION  OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS
   66             /SOFTWARE, OR ANY OTHER COPIES THEREOF,  MAY NOT BE PRO-
   67             /VIDED OR OTHERWISE  MADE AVAILABLE TO ANY  OTHER PERSON
   68             /EXCEPT FOR USE ON SUCH SYSTEM  AND TO ONE WHO AGREES TO
   69             /THESE  LICENSE  TERMS.  TITLE TO AND  OWNERSHIP  OF THE
   70             /SOFTWARE SHALL REMAIN IN DEC.
   71             /
   72             /THE  INFORMATION IN THIS  DOCUMENT IS SUBJECT TO CHANGE
   73             /WITHOUT NOTICE AND SHOULD  NOT BE  CONSTRUED  AS A COM-
   74             /MITMENT BY DIGITAL EQUIPMENT CORPORATION.
   75             /
   76             /DEC   ASSUMES   NO   RESPONSIBILITY   FOR  THE  USE  OR
   77             /RELIABILITY  OF  ITS SOFTWARE ON EQUIPMENT WHICH IS NOT
   78             /SUPPLIED BY DEC.

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 3


   79             
   80             OCTAL
   81       0000  PLT=0
   82             IFNZRO CPU < IFNZRO DC08A <ILLEGAL CONFIGURATION>>
   83             IFNZRO 24-JOBMAX&4000 <ILLEGAL CONFIGURATION>
   84             IFNZRO 23-KL8-PT08&4000 <ILLEGAL CONFIGURATION>
   85             IFNZRO 24-DC08A&4000 <ILLEGAL CONFIGURATION>
   86       0000  IFZERO DC08A <D689=0>
   87             IFNZRO DC08A < IFNZRO PHONES <D689=4>
   88                     IFZERO PHONES <D689=0>>
   89       0010  NULINE=DC08A+PT08+KL8           /EVERY TERMINAL EXCEPT THE CONSOLE
   90       0005  SWDEX=5                         /DISK TRACK OF THE FIRST USER SWAP TRACK
   91       0005  STOMIN=5                        /MINIMUM # FREE STORAGE BLOCK FOR NEWJOB
   92             IFZERO RKSYS <
   93             IFZERO RF08-40 <
   94             IFZERO RS08-1 <DSKSIZ=10>
   95             IFZERO RS08-2 <DSKSIZ=20>
   96             IFZERO RS08-3 <DSKSIZ=30>
   97             IFZERO RS08-4 <DSKSIZ=40>
   98             DSKEXT=DSKSIZ-1>
   99             IFZERO RF08 <DSKSIZ=RS08^100    /# 4K DISC TRACKS
  100             DSKEXT=RS08^100+77> >
  101       0400  IFNZRO RKSYS<DSKSIZ=400         /MAX 4K DISK TRACKS SUPPORTED BY FILESYSTEM
  102       0477  DSKEXT=477>                     /NO IDEA WHAT THIS IS FOR AND IT'S NOT USED ANYWHERE...
  103             
  104       0144  CLOCKR=144                      /MILLISECONDS PER TICK
  105       1130  TICMIN=1130                     /600 TICKS PER MINUTE
  106       0322  INCLK2=0322                     /INITIAL CLOCK
  107       7400  INCLK1=7400
  108       0012  TICSPS=12                       /NUMBER OF SYSTEM TICKS PER SECOND
  109       0010  INIDEX=10                       /INIT DISC EXTENSION
  110       0030  TS8DEX=30                       /FIELD 0 DISC EXTENSION*2^3
  111       0000  ERPDEX=0                        /ERP DISC EXTENSION*4
  112       0000  ERPWC=0                         /ERP WORD COUNT
  113       0004  FIPDEX=4                        /FIP DISC EXTENSION*4
  114       0000  FIPWC=0                         /FIP WORD COUNT
  115       0000  SIDEX=ERPDEX                    /SI DISC EXTENSION*4
  116       0000  SIWC=ERPWC                      /SI WORD COUNT
  117       0002  LIBACT=2                        /LIBRARY ACCOUNT #
  118       4000  BRKINI=4000                     /INITIAL USER BREAK MASK
  119             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 4


  120             
  121             /IOT DEFINITIONS
  122             
  123             IFNZRO DC08A <                  /DC08A,DL8I IOTS
  124             TTIL=6401                       /INCREMENT LINE REGISTER
  125             TTI=6402                        /TELETYPE INPUT COMMAND
  126             TTO=6404                        /TELETYPE OUTPUT COMMAND
  127             TTCL=6411                       /CLEAR LINE REGISTER
  128             TTLL=6412                       /LOAD LINE REGISTER, CLEAR AC
  129             TTRL=6414                       /READ LINE REGISTER
  130             T1SKP=6421                      /SKIP ON CLOCK FLAG
  131             T1OFF=6422                      /TURN CLOCK OFF
  132             T1ON=6424                       /TURN CLOCK ON
  133             TTIR=6461                       /INCREMENT THE R REG.
  134             TTCR=6471                       /CLEAR THE R REG.
  135             TTLR=6472 >                     /LOAD THE R REG.
  136             /EXTENDED MEMORY
  137             
  138       6201  CDF=6201                        /CHANGE TO DATA FIELD 0
  139       6202  CIF=6202                        /CHANGE TO INSTRUCTION FIELD 0
  140       6204  CINT=6204                       /CLEAR USER IOT
  141             
  142       6214  RDF=6214                        /READ DATA FIELD
  143       6224  RIF=6224                        /READ INSTRUCTION FIELD
  144       6234  RIB=6234                        /READ INTERRUPT BUFFER
  145       6244  RMF=6244                        /RESTORE MEMORY FIELD
  146       6254  SINT=6254                       /SKIP ON USER IOT
  147       6264  CUF=6264                        /USER FLAG OFF
  148       6274  SUF=6274                        /USER FLAG ON
  149             
  150             
  151             /EAE
  152       7405  MUY=7405                        /MULTIPLY
  153       7407  DVI=7407                        /DIVIDE
  154       7411  NMI=7411                        /NORMALIZE
  155       7413  SHL=7413                        /SHIFT ARITHMETIC LEFT
  156       7415  ASR=7415                        /ARITHMETIC SHIFT RIGHT
  157       7417  LSR=7417                        /LOGICAL SHIFT RIGHT
  158       7421  MQL=7421                        /LOAD MQ
  159       7403  SCL=7403                        /STEP COUNTER LOAD FROM MEMORY
  160       7441  SCA=7441                        /STEP COUNTER TO AC
  161       7501  MQA=7501                        /MQ TO AC
  162             
  163             IFZERO CPU-2 <
  164             
  165       7451  DPSZ=7451                       /MODE B ONLY - SKIP IF AC&MQ ARE CLEAR
  166       7447  SWBA=7447                       /CHANGE MODE TO A
  167       7431  SWAB=7431                       /CHANGE MODE TO B (ALSO DOES MQL)
  168       7403  ACS=7403                        /AC(7:11) TO SC; AC CLEARED
  169       6006  SGT=6006                        /SKIP ON GT FLAG
  170                     >
  171             
  172             
  173             
  174             /LINE PRINTER IOTS
  175       6661  LSF=6661                        /SKIP ON CHAR FLAG SET
  176       6662  LCF=6662                        /CLEAR CHAR FLAG

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 5


  177       6663  LSRP=6663                       /SKIP ON NOT READY OR ON ERROR
  178       6664  LLC=6664                        /TRANSMIT CHAR TO PRINTER
  179       6665  LSP=6665                        /SET PROGRAM INTERRUPT; LP08/LE8
  180       6666  LPC=6666                        /TRANSMIT CHAR &CLEAR FLAG
  181       6667  LCP=6667                        /CLEAR PROGRAM INTERRUPT
  182       6665  LIE=6665                        /AC11 TO INTERRUPT ENABLE; LS08/LS8E
  183             
  184             /CTY
  185             
  186       6044  TPC=6044                        /LOAD TELEPRINTER AND PRINT
  187             
  188             /DISC (DF32)
  189             
  190       6601  DCMA=6601                       /CLEAR
  191       6603  DMAR=6603                       /READ
  192       6605  DMAW=6605                       /WRITE
  193       6611  DCEA=6611                       /CLEAR DISC EXTENDED ADDRESS
  194       6615  DEAL=6615                       /LOAD EXTENDED ADDRESS
  195       6621  DFSE=6621                       /SKIP ON ERROR
  196       6622  DFSC=6622                       /SKIP ON COMPLETION
  197       6616  DEAC=6616                       /READ EXTENDED ADDRESSES
  198             
  199             /DISC (RF08)
  200             
  201       6612  DSAC=6612
  202       6614  DORS=6614
  203       6615  DIML=6615
  204       6616  DIMA=6616
  205       6641  DCXA=6641
  206       6643  DXAL=6643
  207             
  208             /CARD READER IOT'S
  209       6631  RCSF=6631
  210       6632  RCRA=6632
  211       6634  RCRB=6634
  212       6635  RCNO=6635                       /8E ONLY
  213       6636  RCRC=6636                       /8E ONLY
  214       6637  RCNI=6637                       /8E ONLY
  215       6671  RCSD=6671
  216       6672  RCSE=6672
  217       6674  RCRD=6674
  218       6675  RCSI=6675                       /8E ONLY
  219       6677  RCTF=6677                       /8E ONLY
  220             
  221             /RK05 IOT'S
  222             
  223             IFZERO PHONES<
  224       6741  DSKP=   6741
  225       6742  DCLR=   6742
  226       6743  DLAG=   6743
  227       6744  DLCA=   6744
  228       6745  DRST=   6745
  229       6746  DLDC=   6746
  230       6747  DMAINT= 6747 >
  231             IFNZRO PHONES <
  232             DSKP=   6751
  233             DCLR=   6752

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 6


  234             DLAG=   6753
  235             DLCA=   6754
  236             DRST=   6755
  237             DLDC=   6756
  238             DMAINT= 6757 >
  239             
  240             /DECTAPE
  241             
  242       6761  DTRA=6761
  243       6762  DTCA=6762
  244       6764  DTXA=6764
  245       6771  DTSF=6771
  246       6772  DTRB=6772
  247       6774  DTLB=6774
  248             
  249             
  250             IFZERO CPU <
  251             /KW8I           REAL TIME CLOCK
  252             
  253             CECI=6137                       /CLEAR AND ENABLE CLOCK AND INTERRUPT
  254             CSCF=6133                       /SKIP AND CLEAR FLAG IF FLAG
  255             >
  256             IFZERO CPU-1 <
  257             CECI=6315                       /CLOCK ENABLE
  258             CSCF=6301                       /SKIP ON CLOCK FLAG
  259             CCF=6302                        /CLEAR CLOCK FLAG, CLEAR ENABLE AND CLEAR BUFFER
  260             CLB=6304 >                      /LOAD BUFFER FROM AC
  261             
  262             IFZERO CPU-2 <
  263       6131  CECI=6131                       /CLOCK ENABLE
  264       6133  CSCF=6133                       /SKIP AND CLEAR FLAG IF FLAG
  265             
  266             /POWER FAIL IOT
  267             
  268       6102  SPL=6102                        /SKIP IF POWER LOW
  269             
  270             / 8/E PROCESSOR IOT
  271       6003  SRQ=6003                        /SKIP ON INTERRUPT REQUEST
  272       6004  GTF=6004                        /LINK TO AC0, GT FLAG TO AC1
  273       6005  RTF=6005                        /AC0 TO LINK, AC1 TO GT FLAG
  274       6007  CAF=6007 >                      /CLEAR ALL FLAGS
  275             
  276             IFZERO CPU-4 <
  277             CLLE=6135                       /AC11 TO INTERRUPT ENABLE FOR CLOCK
  278             CLCL=6136                       /CLEAR CLOCK FLAG
  279             CLSK=6137                       /SKIP ON CLOCK FLAG
  280             SPL=6102                        /SKIP POWER LOW
  281             CAL=6133 >                      /CLEAR AC LOW FLAG
  282             
  283                     IFNZRO DC08A <
  284             
  285             /689AG
  286             SRF=6701                        /SKIP IF RING FLAG
  287             SCF=6711                        /SKIP IF CARRIER FLAG
  288             DFCRF=6742                      /CLEAR RING FLAG
  289             CTG=6721                        /CLEAR GROUP COUNTER
  290             RRS=6702                        /READ RING STATUS

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 7


  291             ITG=6731                        /INCREMENT GROUP COUNTER
  292             STR=6722                        /SET TERMINAL READY
  293             EDF=6704                        /ENABLE DATAPHONE FEATURES
  294             DDF=6714                        /DISABLE DATAPHONE FEATURES
  295             CTR=6724                        /CLEAR TERMINAL FLAG
  296             CCF=6741                        /CLEAR CARRIER FLAG
  297             RCS=6712                        /READ CARRIER STATUS
  298                     >

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 8


  299             
  300             
  301             /FIP IOTS (IN ABBREVIATED FORM)
  302             
  303       0006  SEGS=0006                       /RETURN NUMBER OF FREE SEGMENTS ON DISK
  304       0040  ASD=0040                        /ASSIGN
  305       0042  REL=0042                        /RELEASE
  306       0200  REN=0200                        /RENAME
  307       0201  OPEN=0201                       /OPEN
  308       0202  CLOS=0202                       /CLOSE
  309       6603  RFILE=6603                      /READ FILE
  310       0204  PROT=0204                       /PROTECT
  311       6605  WFILE=6605                      /WRITE FILE
  312       0210  CRF=0210                        /CREATE
  313       0211  EXT=0211                        /EXTEND
  314       0212  RED=0212                        /REDUCE
  315       6613  FINF=6613                       /FILE INFORMATION
  316       0214  LIN=0214                        /LOGIN
  317       0215  LOUT=0215                       /LOGOUT
  318       6616  WHO=6616                        /WHO
  319             /DEVICE DATA BLOCK
  320             
  321       0000  DDBSTS=0                        /WORD 1,  STATUS AND UNIT NUMBER
  322       2000          DXON=2000               /XOFF SENT FLAG
  323       1000          DSI=1000                /DESTINATION IS S.I. FLAG
  324       0400          DFULL=400               /KEYBOARD BUFFER IS FULL
  325       0200          DUPL=200                /CONSOLE IN DUPLEX MODE
  326       0100          SICOM=100               /COMMAND WAITING
  327       0040          DECHO=40                /CAUSE SI TO RE-ECHO CURRENT INPUT BUFFER
  328             
  329                                             /DEVICE UNIT NUMBER IS IN BITS 6-11
  330             
  331       0001  DDBJN=1                         /WORD 2, JOB NUMBER IN 7-11
  332       0002  DDBBRK=2                        /BREAK MASK
  333       0003  DDBTIM=3                        /TIME THAT DEVICE WAS ASSIGNED
  334       0004  DDBINP=4                        /BUFFER FILL POINTER
  335       0005  DDBINC=5                        /BUFFER TOTAL COUNT
  336       0006  DDBOUC=6                        /BUFFER EMPTY COUNT
  337       0007  DDBOUP=7                        /BUFFER EMPTY POINTER

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 9


  338             
  339             /JOB DATA AREA
  340             
  341       0000  JOBSTS=0                        /STATUS
  342                                             /STR0
  343       4000          JSRUN=4000              /RUN BIT
  344       2000          JSEREN=2000             /USER ERROR ENABLE
  345       1000          JCOMBD=1000             /LAST TIME THE JOB RAN AS COMPUTE BOUND
  346       0400          JSPEEK=400              /ALLOW "PEEK" AND "LOGOUT" IOT'S
  347       0200          JSACC=200               /JOB LOGGED IN UNDER PRIVILEGED ACCOUNT (1,2 OR 3)
  348       0100          JSIOT=100               /NON-RESIDENT IOT
  349       0040          JSIOTC=40               /COPY IOT RESULT TO USER
  350       0020          JSEXON=20               /EXECUTE ONLY
  351       0010          JSINER=10               /INHIBIT ERROR REPORT FROM SI. (UNTIL NEXT COMMAND)
  352                                             /BITS 9-11 ARE SYSTEM ERROR CODE
  353       0001          UUOERF=1                /IOT ERROR
  354       0002          SWPRER=2                /SWAP READ ERROR
  355       0003          SWPWER=3                /SWAP WRITE ERROR
  356       0005          DSKERR=5                /DISC ERROR
  357       0006          HUNGDV=6                /HUNG DEVICE
  358             
  359                                             /STR1
  360       4000          JSTIME=4000             /TIME IS UP
  361       2000          JSF0=2000               /FILE 0 NOT BUSY
  362       1000          JSF1=1000               /FILE 1 IS NOT BUSY
  363       0400          JSF2=400                /FILE 2 IS NOT BUSY
  364       0200          JSF3=200                /FILE 3 IS NOT BUSY
  365       0100          JSDEL=100               /KEYBOARD DELIMITER SEEN
  366       0040          JSLPT=40                /LINE PRINTER BUFFER IN USE BUT NOT FULL
  367       0020          JSTEL=20                /TELEPRINTER OUTPUT BUFFER IN USE BUT NOT FULL
  368       0010          JSPTR=10                /CHARACTERS IN READER BUFFER
  369       0004          JSPTP=4                 /PUNCH BUFFER IN USE BUT IS NOT FULL
  370       0002          JSERR=2                 /SYSTEM ERROR DETECTED
  371       0001          JSWAIT=1                /JOB NOT IN WAIT STATE
  372             
  373             
  374       0002  JOBSTB=2                        /DEVICE STATUS REGISTER (FOR RK05 DECTAPE AND CARD READER)
  375       0003  JOBWMK=3                        /WAIT MASK
  376       0005  JOBSRA=5                        /JOB RESTART ADDRESS
  377       0006  JOBERR=6                        /JOB ERROR RESTART ADDRESS
  378       0007  JOBLNK=7                        /IOT LINKAGE
  379       0010  JOBSWR=10                       /SWITCH REGISTER
  380       0011  JOBREG=11                       /PC LINK AC
  381       0014  JOBEAE=14                       /MQ MODE GT SC
  382       0016  JOBACC=16                       /ACCOUNT NUMBER
  383       0017  JOBF0=17                        /POINTER TO FILE 0 CONTROL
  384       0020  JOBF1=20                        /POINTER TO FILE 1 CONTROL
  385       0021  JOBF2=21                        /POINTER TO FILE 2 CONTROL
  386       0022  JOBF3=22                        /POINTER TO FILE 3 CONTROL
  387       0023  JOBRTM=23                       /LOW ORDER RUN TIME
  388       0024  JOBRTH=24                       /HI ORDER RUN TIME

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 10


  389             
  390             /FILE CONTROL BLOCK - POINTED TO BY JOBFX, X=0,1,2,3
  391             
  392       0000  FILWPT=0                        /POINTER TO FILE RETRIEVAL WINDOW
  393       0001  FILSCT=1                        /SEGMENT NUMBER OF FIRST WINDOW ENTRY
  394       0002  FILPRO=2                        /FILE PROTECTION - BIT 9
  395       0003  FILPAR=3                        /POINTER TO RFILE OR WFILE PARAMETER BLOCK
  396       0004  FILDA=4                         /DISC ADDRESS OF RFILE OR WFILE
  397       0006  FILWC=6                         /-WORD COUNT OF RFILE OR WFILE
  398       0007  FILRES=7                        /POINTER TO FILPIF IN USER AREA
  399             
  400             /FILE RETRIEVAL WINDOW
  401             /WORD 0:        UFD LINK TO NEXT GROUP OF 7 SEGMENT POINTERS
  402             /WORDS 1-7:     SEVEN SEGMENT ADDRESSES
  403             
  404             /RFILE OR WFILE PARAMETER BLOCK - POINTED AT BY FILPAR
  405             
  406       0000  FILPFN=0                        /FUNCTION; 0603 OR 0605
  407       0001  FILPDX=1                        /DISC EXTENSION
  408       0002  FILPIF=2                        /INTERNAL FILE # (BITS 10-11) AND FIELD # (BITS 7-9)
  409       0003  FILPWC=3                        /-WORD COUNT FOR THIS TRANSFER
  410       0004  FILPCA=4                        /CORE ADDRESS FOR THIS TRANSFER
  411       0005  FILPDA=5                        /DISC ADDRESS
  412       0006  FILPRA=6                        /EXEC RETURN ADDRESS FOR THIS TRANSFER
  413       0007  FILPCT=7                        /POINTER TO FILE CONTROL BLOCK
  414             
  415             
  416             /CORE TABLE CONTROL FLAGS
  417             
  418       4000  SWAP=4000                       /SWAP REQUEST
  419       2000  LOCK=2000                       /LOCK IN CORE
  420       1000  NOTRUN=1000                     /HAS NOT BEEN SCHEDULED TO RUN
  421       0400  FIP=400                         /FILE PHANTOM
  422       0200  SI=200                          /SYSTEM INTERPRETER
  423       0140  NOHOLD=140                      /INHIBIT "NOTRUN" STATUS AFTER FOUR CONSECUTIVE FILE TRANSFERS
  424       0037  CJOB=37                         /BITS 7-11 CONTAIN THE JOB #
  425             
  426             
  427             
  428             /FIP TABLE DEFINITIONS
  429             
  430       0530  SATSIZ=530
  431       6000  JTABLE=6000
  432       6025  ENTABL=JTABLE+JOBMAX+1
  433       6265  UTABLE=ENTABL+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX
  434       6525  RTABLE=UTABLE+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX
  435             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 11


  436             
  437             /TABLES
  438       7001  CORTBL=7001                     /CORE ASSIGNMENT TABLE
  439       7010  L2QTB=CORTBL+7
  440       0000  IFZERO DC08A    <DCSIZE=0>
  441             IFNZRO DC08A    <DCSIZE=400>    /SIZE OF FIELD 1 DC08A CODE PLUS 689AG CODE
  442             
  443       0200  OUTREG=200                      /ACTIVE OUTPUT REGISTERS (TTY'S, LPT & PTP)
  444       0213  SKPTBL=OUTREG+NULINE+3          /START OF IOT SKIP TABLE
  445       0236  SKPTP=SKPTBL+NULINE+NULINE+3    /POSITION OF PUNCH SKIP IN SKIP TABLE
  446       0241  RINGIN=SKPTP+3                  /KEYBOARD INPUT RING BUFFER
  447       0400  ENDBUF=OUTREG+200               /END OF KEYBOARD INPUT BUFFER
  448       0057  INPUTS=ENDBUF-RINGIN%2          /NUMBER OF POSSIBLE ENTRIES IN THE KEYBOARD RING BUFFER
  449             
  450       6211  DATFLD=CDF 10                   /MONITOR DATA FIELD SELECT
  451             
  452             IFZERO EAE-20   <MQREG=1>
  453       0001  IFZERO EAE      <IFNZRO CPU&7776 <MQREG=1>
  454                              IFZERO CPU&7776 <MQREG=0>>
  455             IFNZRO OUTREG&1 <YOU GOOFED>
  456             /SUPER CRITICAL LOCATIONS
  457             /THESE LOCATIONS ARE USED TO LINK TS8, TS8II, FIP, SI AND INIT.
  458             
  459             /IT MAY BE NECESSARY TO ADJUST THEM ACCORDINGLY
  460             
  461             /DEFINED IN TS8:
  462             
  463       2573  WSCHED=2573                     /ADDRESS FOR WAIT
  464       0401  GETJTB=401                      /GETJTA
  465       1317  CORSRC=1317                     /SEARCH CORE TABLE
  466       5171  OVERLA=5171                     /FILE STUFF
  467       0574  READFI=574                      /MORE FILE STUFF
  468       0132  CONDBA=132                      /DEVTBL POINTER USED BY "PRINT" ETC.
  469       0611  RETB=611                        /RETURN A BLOCK TO FREE CORE
  470       1405  GETB=1405                       /GET A BLOCK OF FREE CORE
  471       1447  GETDB0=1447                     /GET A DDB
  472       0051  CLK1=51                         /LOW ORDER DAYTIME CLOCK
  473       0050  CLK2=50                         /HIGH ORDER DAYTIME CLOCK
  474       0166  DATE=166                        /12 BIT DATE WORD
  475       0031  TTCHAR=31                       /SAVE REG. FOR CONSOLE CHARACTERS
  476       3201  KBD00=3201                      /PROCESS KEYBOARD INPUT
  477       1205  PRINT0=1205                     /TYPE OUT A CHARACTER
  478       0562  OVRLA1=562                      /MORE FILE STUFF
  479       0605  RUNFI=605                       /SI FILE TRANSFER INITIALIZER
  480       0103  L2SF=103                        /LEVEL 2 SAVED MODE AND FIELD
  481       6572  SICLR=6572                      /SI CLEAR LINKED BUFFER
  482       2421  TIMSI=2421                      /TIMER FOR SI "COMWAT"
  483       1702  SIWAIT=1702                     /NUMBER OF SI COMMANDS BEING WAITED ON
  484       2423  TIMFIP=2423                     /TIMER FOR FIPLOCK
  485       2724  FIPLOK=2724                     /CORTBL STATUS CHECK FOR FORCE OUT
  486       0322  CLKINI=322                      /CONVERT HARDWARE CLOCK TO SYSTEM-TICKS (100MS)
  487       1602  BLT0=1602                       /BLOCK TRANSFER FROM CORE TO CORE
  488       3213  KBDSQ=3213                      /ADDRESS OF JMS TO ^S/^Q CODE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 12


  489             
  490             
  491             /DEFINED IN TS8II:
  492             
  493       0175  F1TCNT=175                      /SI DDB CHARACTER COUNT
  494       0176  F1ECNT=176                      /SI DDB EMPTY COUNT
  495       0177  F1BUF=177                       /SI DDB EMPTY BLOCK POINTER
  496       0020  DTJOB=20                        /JOB OWNING THE DECTAPE CONTROLLER
  497       0054  RKJOB=54                        /JOB OWNING RK05 CONTROLLER
  498       1175  DTSI=1175                       /SI TERMINATE A DECTAPE ON TIMER
  499       2200  DATA1=2200+DCSIZE
  500       3020  DEVTBL=DATA1+140+460            /TODO: MOVE 460 TO CONSTANT FOR RKSYS
  501       3042  DEVTBE=DEVTBL+NULINE+NULINE+2
  502       3064  JOBTBL=DEVTBE+22
  503       3111  CLKTBL=JOBTBL+JOBMAX+1
  504       3136  TTYTBL=CLKTBL+JOBMAX+1
  505       3163  PRGTBL=TTYTBL+JOBMAX+1
  506       3250  DSUTBL=PRGTBL+JOBMAX+JOBMAX+JOBMAX-7
  507       7300  RKBLK=7300                      /FIXED BLOCK FOR RK05 FILESYSTEM TRANSFERS
  508       7720  FIPBLK=7720                     /FIXED BLOCK FOR FIP IO
  509       7730  WINBAS=7730                     /ADDRESS OF THE BASIC WINDOW
  510       2420  OUTDIF=-OUTREG^2+DEVTBL         /FOR LINKING BETWEEN OUTREG AND DEVTBL
  511       0164  F1OFFJ=164                      /FOR OFF /ON COMMANDS USED BY SI
  512             IFNZRO DEVTBL&1 <YOU GOOFED>
  513             
  514             /DEFINED IN SI
  515             
  516       7270  DTSIDT=7270                     /RETURNED FROM STOPPING A DECTAPE ON TIMER
  517       7600  VERBRK=7600                     /START OF INSTALLATION DEFINED LOGIN MESSAGE
  518             /TS8 VERSION 8.24 (01-JANUARY-75)
  519             /
  520             /
  521             /
  522             /
  523             /COPYRIGHT (C) 1975
  524             /DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
  525             /
  526             /
  527             /THIS SOFTWARE IS FURNISHED UNDER A LICENSE FOR USE ONLY
  528             /ON A SINGLE COMPUTER SYSTEM AND MAY BE COPIED ONLY WITH
  529             /THE    INCLUSION       OF      THE     ABOVE   COPYRIGHT NOTICE.       THIS
  530             /SOFTWARE, OR ANY OTHER COPIES THEREOF, MAY NOT BE PRO-
  531             /VIDED OR OTHERWISE     MADE AVAILABLE TO ANY   OTHER PERSON
  532             /EXCEPT FOR USE ON SUCH SYSTEM  AND TO ONE WHO AGREES TO
  533             /THESE  LICENSE TERMS.  TITLE TO AND    OWNERSHIP       OF THE
  534             /SOFTWARE SHALL REMAIN IN DEC.
  535             /
  536             /THE    INFORMATION IN THIS     DOCUMENT IS SUBJECT TO CHANGE
  537             /WITHOUT NOTICE AND SHOULD      NOT BE  CONSTRUED       AS A COM-
  538             /MITMENT BY DIGITAL EQUIPMENT CORPORATION.
  539             /
  540             /DEC    ASSUMES NO      RESPONSIBILITY  FOR     THE     USE     OR
  541             /RELIABILITY    OF      ITS SOFTWARE ON EQUIPMENT WHICH IS NOT
  542             /SUPPLIED BY DEC.

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 13


  543             
  544       0030          VERNUM=30
  545             /PAGE 0
  546             FIELD 3                         /LOAD THIS INTO TRACK 3 ON DISK
  547             
  548       0001  *1
  549 30001 5402          JMP I   .+1
  550             
  551 30002 0200  C0200,  200
  552 30003 0000  WS0,    0                       /WORKING STORAGE FOR MAIN FLOW
  553 30004 0000  WS1,    0
  554 30005 0000  JOBSWA, 0
  555             
  556             
  557       0010  *10
  558 30010 0000  ACX10,  0                       /FOR INTERRUPT SERVICE
  559 30011 0240  ACX11,  RINGIN-1                /INPUT RING BUFFER POINTER (LEVEL 1)
  560 30012 0000  DSPAR,  0                       /DISK HANDLER
  561 30013 7007  L2Q,    L2QTB-1                 /LEVEL 2 QUEUE
  562 30014 7007  L2QE,   L2QTB-1                 /LEVEL 2 EMPTY POINTER
  563 30015 0000  AXS1,   0                       /MISCELLANEOUS LEVEL 2 AUTO-INDEX
  564 30016 0000  AXS2,   0                       /       "
  565 30017 3256  DSKPTR, DSUTBL+6                /DISK REQUEST QUEUE POINTER
  566             
  567             
  568       0020  SIDATA=20                       /SYSTEM INTERPRETER DATA
  569       0020  *SIDATA
  570             
  571 30020 3020  COMPTR, DEVTBL                  /POINTER TO LAST DEVTBL ENTRY SCANNED
  572 30021 0000  SIBUF,  0                       /BUFFER STATE
  573 30022 0000  SICNT,  0
  574 30023 0000  COMDSP, 0                       /FIP RETURN DISPATCH
  575 30024 0000  SIFLG,  0                       /COMMAND FLAGS
  576 30025 0000  SICHAR, 0                       /SAVE LAST CHAR FROM COMMAND SCAN
  577 30026 0000  SIREG,  0                       /USER AC, LINK, PC
  578 30027 0000          0
  579 30030 0000          0
  580 30031 0000  TTCHAR, 0                       /TTY CHARACTER
  581             
  582       0032  CONSTANTS=SIDATA+12
  583       0032  *CONSTANTS
  584 30032 0002  C0002,  2
  585 30033 0003  C0003,  3
  586 30034 0004  C0004,  4
  587 30035 0007  C0007,  7
  588 30036 0037  C0037,  37
  589 30037 0100  C0100,  100
  590 30040 1000  C1000,  1000
  591 30041 7770  C7770,  7770
  592             
  593       0043  JOBCON=CONSTANTS+11             /JOB CONTROL
  594       0043  *JOBCON
  595             
  596 30043 0000  JOBTIM, 0                       /NUMBER OF TICKS RUN
  597 30044 3064  JOBTBA, JOBTBL                  /JOB TABLE ADDRESS
  598             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 14


  599             
  600       0046  FRSTOR=JOBCON+3
  601       0046  *FRSTOR
  602             
  603 30046 0000  FREE,   0                       /POINTER TO HEAD OF FREE STORAGE
  604 30047 0000  FRECNT, 0                       /# FREE BLOCKS AVAILABLE
  605             
  606             
  607       0050  TIMDAT=FRSTOR+2                 /CLOCK AND DATE
  608       0050  *TIMDAT
  609             
  610             /CLOCK
  611 30050 0000  CLK2,   0
  612 30051 0000  CLK1,   0
  613             
  614             
  615       0052  SCHDAT=TIMDAT+2
  616       0052  *SCHDAT                         /SCHEDULING DATA
  617             
  618 30052 0000  COMCNT, 0                       /NUMBER OF COMMANDS AWAITING EXECUTION
  619 30053 0000  SQREQ,  0                       /SWAP REQUEST FLAG
  620 30054 0000  FINISH, 0                       /+(I)-(O) FIELD OF JOB BEING SWAPPED
  621 30055 0000  FIT,    0                       /JOB # TO BE SWAPPED IN
  622 30056 0000  FORCE,  0                       /FIELD TO BE SWAPPED OUT
  623             
  624       0060  DATEND=60                       /END OF FIELD 0 PAGE 0 DATA
  625             
  626             
  627             
  628       0155  FIPDAT=155                      /DATA REFERENCED BY FIP
  629       0155  *FIPDAT
  630             
  631 30155 0000  FIPJOB, 0                       /JOB NOW (OR SOON TO BE) RUNNING FIP
  632 30156 0400  C0400,  400
  633       0156  SEGSIZ=C0400                    /# WORDS PER SEGMENT
  634       0160  *160
  635 30160 0000  JOB,    0                       /# OF CURRENT JOB
  636 30161 0161  JOBDAT, .                       /ADDRESS OF CURRENT JOB DATA LIST. MUST RESIDE IN DATA FIELD.
  637             C7000,
  638 30162 7000  CORTBA, CORTBL-1                /CORE ALLOCATION TABLE
  639 30163 3020  DEVTBA, DEVTBL                  /DEVICE TABLE
  640 30164 3250  DSUTBA, DSUTBL                  /USER DISC REQUEST QUEUE
  641 30165 7777  DSBUSY, -1                      /DISC BUSY COUNT
  642             
  643             /THE DATE IS KEPT AS A 12 BIT NUMBER IN THE FORMAT
  644             /DATE=((YEAR-1974)*12+(MONTH-1))*31+DAY-1
  645             
  646 30166 0000  DATE,   0
  647             
  648             
  649       0400  FISUBL=400
  650             
  651 30167 1602  BLTA,   BLT0                    /BLOCK TRANSFER
  652       4567  BLT=JMS I       BLTA
  653 30170 1317  CORSRA, CORSRC
  654       4570  CORE=JMS I CORSRA

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 15


  655             
  656 30171 1405  GETBA,  GETB
  657       4571  GETBLK=JMS I GETBA
  658 30172 1447  GETDBA, GETDB0                  /GET A DATA BLOCK
  659       4572  GETDDB=JMS I GETDBA
  660 30173 1205  PRINTA, PRINT0                  /TYPE OUT A CHARACTER
  661       4573  PRINT=JMS I PRINTA
  662 30174 0401  GETJT0, GETJTB                  /GET JOB DATA TABLE ADDRESS
  663       4574  GETJTA=JMS I    GETJT0
  664 30175 0437  GIRSCA, GIRSC                   /STORE CHARACTER IN BUFFER
  665       4575  STORE=JMS I     GIRSCA
  666 30176 0611  RETBA,  RETB                    /RETURN BLOCK TO FREE STORAGE
  667       4576  RETBLK=JMS I    RETBA
  668 30177 2573  WAITA,  WSCHED
  669       5577  WAIT=JMP I WAITA

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 16


  670             
  671             /SUBROUTINE DISPATCHES
  672             
  673       0060  SUBDSP=DATEND
  674       0060  *SUBDSP
  675             
  676       4460  IOR=JMS I .
  677 30060 7360          IOR0                    /INCLUSIVE OR
  678       5461  UUOEXT=JMP I .
  679 30061 7217          UUOEX1                  /UUO EXIT
  680 30062 1753  FIUSER, DSUSER                  /QUEUE FILE REQUEST IN DSUBTL
  681       4463  ERROR=JMS I .
  682 30063 1710          SYSERR                  /SYSTEM ERROR
  683       4464  TTYUSE=JMS I .
  684 30064 6061          TTYSRC                  /FIND USER TTY
  685       5465  SCHED=JMP I .
  686 30065 2465  SCHEDA, SCHEDI                  /SCHEDULE NEXT JOB NOW CORE RESIDENT
  687       5466  RSCHED=JMP I .
  688 30066 2437  RSCHEA, SCHED0                  /FIND NEXT JOB TO BE RUN
  689       5467  EXIT=JMP I .
  690 30067 1513  EXITA,  L2EXIT                  /LEAVE LEVEL 2
  691       5470  REDO=JMP I .
  692 30070 2570          REDO0                   /REPEAT IOT LATER WHEN (HOPEFULLY) IT CAN BE COMPLETED
  693       4471  KEY=JMS I .
  694 30071 3201          KBD00                   /PROCESS KEYBOARD INPUT INTO A USER'S INPUT BUFFER
  695       4472  SAVJOB=JMS I .
  696 30072 3107          SAVJO0                  /SAVE THE STATUS OF THE CURRENT JOB
  697       4473  RESJOB=JMS I .
  698 30073 6116          RESJO0                  /RESTORE THE PREVIOUSLY SAVED STATUS
  699       5474  START=JMP I .                   /START USER JOB
  700 30074 0670          SUJ
  701       4475  DSGO=JMS I .
  702 30075 7710          DSGO0                   /START DISK REQUEST
  703       4476  GETJTW=JMS I .
  704 30076 4570          GETJW0                  /GET CONTENT OF JOB STATUS WORD (CURRENT JOB)
  705       4477  GETJTI=JMS I .
  706 30077 6623          GETJI0                  /GET CONTENT OF JOB STATUS WORD (ANY JOB)
  707       5500  DISMIS=JMP I .
  708 30100 0323          DISMI0                  /DISMISS INTERRUPTS
  709       4501  RUNABL=JMS I .
  710 30101 1637          RUNTST                  /TEST IF SPECIFIED JOB IS RUNNABLE
  711             
  712 30102 5715  SETFLG, PTSTAR
  713             
  714       0103  L2CON=SUBDSP+23                 /LEVEL 2 (EXEC) CONTROL
  715       0103  *L2CON
  716             
  717 30103 0100  L2SF,   100                     /RELOCATION AND MODE
  718 30104 5200  L2SV0,  NULJOB                  /SAVED PC
  719 30105 0000  L2SVLK, 0                       /SAVED LINK
  720 30106 0000  L2SA,   0                       /SAVED ACCUMULATOR
  721             
  722       4507  FETCH=JMS I .
  723 30107 6457          TOF                     /RETRIEVE A CHARACTER FROM A LINKED FREE CORE BLOCK
  724 30110 7777  CLOCK,  -1                      /NUMBER OF SYSTEM TICKS PENDING ON LEVEL 2 (MINUS 1)
  725 30111 0000  DEAD,   0                       /CORTBL-1 OF JOB THAT SHOULD BE PUSHED OUT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 17


  726             
  727 30112 0000  SCHNEW, 0                       /-1 TO ALLOW FULL TIME SLICES
  728 30113 0010  C0010,  10
  729             IFNZRO  DC08A <
  730             D6FLAG, -1                      /ALLOW 689 ANSWER ONLY ONE TIME IN L2Q
  731             D6ANSR, ANSWER >
  732             
  733             
  734             /ROOM FOR PATCHES!!
  735 30114 0000  RKSWSE, 0                       /RK05 SECTOR FOR SWAPPING
  736 30115 0000  RKADR,  0                       /RK05 CORE ADDRESS FOR SWAPPING
  737 30116 0241  DSWATA,        DSWAIT
  738             
  739       0132  *CONDBA
  740 30132 0000          0                       /POINTER TO DEVTBL POSITION CURRENTLY UNDER CONSIDERATION
  741 30133 0000  CONDDB, 0                       /ADDRESS OF DDB UNDER CONSIDERATION
  742 30134 7400  SEGLMK, 7400                    /-WRDSEG
  743       0134  C7400=SEGLMK
  744 30135 0047  BASWIN, -WINBAS-1
  745       0161  CJOBDA= JOBDAT
  746 30136 0006  C0006,  6
  747 30137 0070  C0070,  70
  748             SEGSM1,                         /WRDSEG-1
  749 30140 0377  C0377,  377
  750 30141 0005  C0005,  5
  751 30142 0600  C0600,  600
  752 30143 3777  C3777,  3777
  753 30144 6203  C6203,  6203
  754             QUANTM,
  755 30145 7776  C7776,  7776
  756 30146 0177  C0177,  177
  757 30147 0000  CURJOB, 0                       /NUMBER OF JOB INTERRUPTED BY FILE TRANSFER
  758       0150  *150
  759       4150  UDF=JMS .                       /SELECT FIELD OF CURRENT JOB
  760 30150 0000  WS2,    0
  761 30151 0000  UUDF,   0                       /DATA FIELD SELECT FOR FIELD OF CURRENT JOB
  762 30152 5550          JMP I   .-2
  763 30153 0000  INTRC,  0                       /TRACK # TO BE SWAPPED IN (DF32 0X00) (RF08 000X)
  764 30154 0000  OUTTRC, 0                       /TRACK # TO BE SWAPPED OUT
  765       0042  *42
  766 30042 7002  FANCOR, CORTBL+1                /FIELD OF PHANTOM  I.E. FIELD 2
  767       0057  *57
  768 30057 0000  BONUS,  0                       /JOB # JUST BROKEN OUT OF I/O WAIT
  769       0157  *157
  770             IFZERO RKSYS <
  771             SWPIOA, SWPIO
  772             >
  773             IFNZRO RKSYS <
  774 30157 7600  SWPIOA, SWPIR
  775             >
  776             
  777       0045  *45
  778 30045 3005  SWPREA, SWPRET
  779             
  780             /FIELD 0 PAGE DIRECTORY
  781       4000  IOTS=4000
  782       5400  DISC=IOTS+1400                  /DISC CONTROL

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 18


  783             
  784       0200          *200
  785             
  786             /PRIORITY LEVEL 0 (HIGHEST PRIORITY)
  787             /KEEPS TRACK OF REAL TIME
  788             /ALWAYS ENTERED BY CLOCK FLAG
  789             /DISMISSES TO LEVEL 1 IF INTERRUPT WAS NOT FROM LEVEL 1
  790             /OTHERWISE, DISMISSES TO INTERRUPTED LOCATION.
  791             
  792             INT,
  793             IFZERO CPU-2 <
  794 30200 6102          SPL                     /POWER FAILURE?
  795 30201 5204          JMP     INTX0           /NO
  796 30202 5603          JMP I   .+1             /YES, HURRY UP AND SERVICE IT
  797 30203 3600          POWINT
  798             INTX0,  >
  799             IFZERO CPU-4 <
  800                     SPL                     /POWER LOW
  801                     SKP                     /NO
  802                     JMP     .-2             /WAIT FOR POWER
  803                     CAL >                   /CLEAR POWER LOW CONDITION
  804 30204 6254          SINT                    /USER IOT? (HAS TO BE CHECKED FIRST!!!)
  805 30205 5212          IFZERO DC08A    <JMP INT0       >
  806                     IFNZRO DC08A    <SKP    >/DC08?
  807 30206 5611          JMP I   UUOA            /YES, GO SAVE LEVEL 2 STUFF
  808                     IFNZRO DC08A    <
  809                     T1SKP                   /CLOCK?
  810                     JMP     INT0            /NO, KEEP LOOKING
  811                     ISZ     CLKCNT          /YES, IS A SYSTEM TICK UP YET?
  812                     JMP I   T8DISA          /NO, RUN DC08 INTERRUPT SERVICE
  813                     DCA     CLKIT           /SAVE AC AT INTERRUPT
  814                     TAD     L2TIMA          /SCHEDULE L2TIME ON L2QUE
  815                     ISZ     CLOCK           /BUMP NUMBER OF TICKS TO COUNT AT LEVEL 2
  816                     CLA SKP                 /ALREADY SCHEDULED
  817                     DCA I   L2Q
  818                     TAD     CLKINI          /RESET TIMER FOR NEXT TICK
  819                     DCA     CLKCNT
  820                     TAD     CLKIT           /GET AC AT INTERRUPT
  821                     JMP I   T8DISA          /RUN DC08 SERVICE
  822             T8DISA, T8DIS>

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 19


  823             
  824             /INTERRUPTS OTHER THAN 680 (LEVEL 1)
  825             /DISMISSES TO LEVEL 2 IF NOT FROM LEVEL 1 OR 2.
  826             
  827 30207 0000  INTAC,  0                       /AC AT LEVEL 1
  828 30210 0000  INTLK,  0                       /LINK AT LEVEL 1
  829 30211 2171  UUOA,   UUO0
  830             
  831             
  832             
  833 30212 3207  INT0,   DCA     INTAC           /SAVE AC AND LINK
  834 30213 7010          RAR
  835 30214 3210          DCA     INTLK
  836             
  837                     IFZERO DC08A <
  838 30215 6133  IFNZRO CPU-4 <CSCF>             /SKIP AND CLEAR FLAG IF FLAG
  839             IFZERO CPU-4 <CLSK>             /SKIP IF CLOCK FLAG
  840 30216 5227          JMP     DTINT
  841             IFZERO CPU-4 <CLCL>             /CLEAR CLOCK FLAG
  842                             IFZERO CPU-1 <
  843                             CLA CMA         /KW08
  844                             CCF CLB         /CLEAR FLAG AND LOAD BUFFER
  845                             CECI    >       /ENABLE
  846             
  847 30217 2304          ISZ     CLKCNT          /IT WAS CLOCK - WAS IT A SYSTEM TICK
  848 30220 5274          JMP     DISMI1          /NO - NOTHING TO DO THEN
  849 30221 1322          TAD     CLKINI          /YES - SET FOR NEXT SYSTEM TICK
  850 30222 3304          DCA     CLKCNT
  851 30223 2110          ISZ     CLOCK
  852 30224 5274          JMP     DISMI1
  853 30225 1302          TAD     L2TIMA          /SCHEDULE A SYSTEM TICK ON LEVEL 2
  854 30226 5323          JMP     DISMI0  >
  855             
  856             
  857             
  858 30227 4243  DTINT,  JMS     DTCHK
  859 30230 5500          DISMIS
  860             IFNZRO D689 <
  861                     SRF
  862                     JMP     D6CF
  863                     DFCRF                   /CLEAR THE RING FLAG
  864                     ISZ     D6FLAG          /HAVE WE GOTTEN MORE THAN ONE FLAG?
  865                     DISMIS                  /YES! DON'T OVERFLOW L2Q
  866                     TAD     D6ANSR
  867                     DISMIS                  /SCHEDULE PHONE ANSWERING ON L2Q
  868             D6CF,   SCF
  869                     JMP     RFINT
  870                     CCF                     /A CARRIER HAS CHANGED
  871                     TAD     DFM4
  872                     DCA I   TIM68A          /TAKE A LOOK AT IT IN FOUR SECONDS
  873                     DISMIS
  874             DFM4,   -4
  875             TIM68A, TIM689  >

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 20


  876             
  877             RFINT,
  878             IFZERO RKSYS <
  879             IFZERO RF08-40  <DFSE           /DF32 DISK ERROR?
  880                     JMP I   DSWAIT          /YES
  881                     DFSC                    /DF32 DISK COMPLETION FLAG?
  882                     JMP I   INT2            /NOPE
  883                             >
  884             IFZERO RF08 <DFSC DFSE          /RF08 DISK?
  885                     JMP I   INT2            /NO
  886                     DFSE >                  /RF08 ERROR?
  887                     ISZ     DSWAIT          /NO ERROR - TRANSFER OK >
  888             IFNZRO RKSYS <
  889 30231 6741          DSKP                    /DONE/ERROR?   
  890 30232 5642          JMP I   INT2            /NEGATORY
  891 30233 6745          DRST                    /GET RK05 STATUS
  892 30234 7104          CLL RAL                 /MASK OFF TRANSFER DONE FLAG
  893 30235 7450          SNA                     /ANY ERRORS?
  894 30236 2241          ISZ     DSWAIT          /NOPE - TRANSFER OK     
  895                     >
  896 30237 7200          CLA 
  897 30240 5641          JMP I   DSWAIT
  898 30241 0000  DSWAIT, 0                       /SET BY DISK SERVICE
  899             INT2,
  900             IFNZRO CDR <INTCDR>             /CONTINUE IN THE INTERRUPT CHAIN
  901 30242 7410  IFZERO CDR <RINT>
  902 30243 0000  DTCHK,  0
  903             IFNZRO CDR <RCSF        >       /CARD READER?
  904 30244 5252  IFZERO CDR <JMP .+6     >
  905 30245 5252          JMP     .+5
  906 30246 6212          CIF DATFLD-1
  907 30247 6201          CDF
  908 30250 5651          JMP I   .+1
  909 30251 1721          CDL11
  910             IFNZRO RK05 <   DSKP    >       /RK05?
  911 30252 5257  IFZERO RK05 <   JMP     .+5     >
  912 30253 5257          JMP     .+4
  913 30254 6213          CIF DATFLD
  914 30255 5656          JMP I   .+1
  915 30256 2000          RKL11
  916 30257 6771  IFNZRO TC01 <DTSF       >       /DECTAPE?
  917             IFZERO TC01 <JMP        .+11    >
  918 30260 5270          JMP     .+10
  919 30261 6761          DTRA
  920 30262 0034          AND     C0004
  921 30263 7650          SNA CLA
  922 30264 5270          JMP     .+4
  923 30265 6213          CIF DATFLD
  924 30266 5667          JMP I   .+1
  925 30267 0601          DTL11
  926 30270 2243          ISZ     DTCHK
  927 30271 5643  F1RTN,  JMP I   DTCHK           /THESE 3 DEVICES RETURN HERE FROM FIELD 1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 21


  928             
  929 30272 1303  INT7,   TAD     CLKIT
  930 30273 3413          DCA I   L2Q             /QUEUE REQUEST
  931 30274 1210  DISMI1, TAD     INTLK           /RESTORE LINK AND AC
  932 30275 7104          CLL RAL
  933 30276 1207          TAD     INTAC
  934 30277 6244  DISMI2, RMF                     /RESTORE IF, DF, & MODE
  935 30300 6001          ION
  936 30301 5400          JMP I   0               /BACK TO INTERRUPTED PROGRAM
  937             
  938 30302 2365  L2TIMA, L2TIME
  939             REST0,
  940 30303 0000  CLKIT,  0                       /TEMPORARY FOR AC
  941 30304 7775  CLKCNT, -3                      /WILL INITIALIZE ITSELF TO THE CORRECT VALUE
  942             
  943       0322  *322
  944 30322 0000  CLKINI, 0                       /SET BY INIT TO CAUSE 1 SYSTEM TICK TO = 100 M.S.
  945             /DISMIS ROUTINE
  946             /ENTERED FROM INTERRUPT HANDLER TO ENTER LEVEL 2 FROM LEVEL 1
  947             /AC = ADDRESS OF LEVEL 2 SERVICE ROUTINE
  948             /       OR 0 IF NO LEVEL 2 SERVICE REQUIRED
  949             
  950             DISMI0,
  951 30323 6201  C6201,  CDF
  952 30324 7450          SNA                     /DISMISS INTERRUPTS?
  953 30325 5274          JMP     DISMI1          /NO - BACK TO WHATEVER WAS GOING ON BEFORE
  954 30326 3303          DCA     CLKIT           /SAVE DISPATCH
  955 30327 6234          RIB                     /MODE BIT = 100
  956 30330 0037          AND     C0100
  957 30331 7650          SNA CLA                 /FROM USER MODE?
  958 30332 5272          JMP     INT7            /NO - QUEUE REQUEST UNTIL LATER
  959 30333 1207          TAD     INTAC           /MOVE THE AC TO LEVEL 2
  960 30334 3106          DCA     L2SA
  961 30335 1210          TAD     INTLK           /MOVE LINK TO LEVEL 2
  962 30336 3105          DCA     L2SVLK
  963 30337 1000          TAD     0               /MOVE PC TO LEVEL 2
  964 30340 3104          DCA     L2SV0
  965 30341 6234          RIB
  966 30342 3103          DCA     L2SF            /FIELDS AND MODE TO LEVEL 2
  967 30343 6001          ION                     /DISMISS TO EXEC MODE, FIELD 0, LEVEL 2
  968 30344 5703          JMP I   CLKIT
  969             
  970             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 22


  971             
  972             /RESTORE INTERRUPTED STATE
  973             
  974 30345 3303  RESTOR, DCA     REST0           /POINTER TO SAVED INFO
  975 30346 1703          TAD I   REST0           /SAVED FIELDS AND STATE
  976 30347 0137          AND     C0070           /GET INSTRUCTION FIELD
  977 30350 1144          TAD     C6203
  978 30351 3375          DCA     RCIF            /CIF FOR PROPER FIELD
  979 30352 1703          TAD I   REST0
  980 30353 7106          CLL RTL
  981 30354 7004          RAL
  982 30355 0137          AND     C0070           /CDF FOR RETURN
  983 30356 1323          TAD     C6201           /NOT NECESSARILLY EQUAL TO INSTRUCTION FIELD
  984 30357 3376          DCA     RCDF
  985 30360 1703          TAD I   REST0
  986 30361 0037          AND     C0100           /USER PROGRAM, FIP OR SI?
  987 30362 7640          SZA CLA
  988 30363 6274          SUF                     /USER MODE; SET USER FLAG
  989 30364 2303          ISZ     REST0
  990 30365 1703          TAD I   REST0           /PC
  991 30366 3000          DCA     0
  992 30367 2303          ISZ     REST0
  993 30370 1703          TAD I   REST0           /LINK
  994 30371 7104          CLL RAL
  995 30372 2303          ISZ     REST0
  996 30373 7200          CLA
  997 30374 1703          TAD I   REST0           /AC
  998 30375 0000  RCIF,   0
  999 30376 0000  RCDF,   0
 1000 30377 6001          ION
 1001 30400 5400          JMP I   0               /BACK TO INTERRUPTED PROGRAM

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 23


 1002             
 1003             /RETURN ADDRESS OF LINKED TABLE ENTRY
 1004             /CALL   TAD TABLE ENTRY ADDRESS
 1005             /       GETJTA
 1006             /       ENTRY NAME (NUMBER)
 1007             /       RETURN
 1008             
 1009 30401 0000  GETJTB, 0
 1010 30402 3234          DCA     GETJT1          /SAVE JOBTABLE ADDRESS
 1011 30403 1601          TAD I   GETJTB          /ENTRY #
 1012 30404 3235          DCA     GETJT2
 1013 30405 6214          RDF                     /FIELD CALLED FROM
 1014 30406 1144          TAD     C6203
 1015 30407 3231          DCA     GETJT3          /SO WE CAN GET BACK
 1016 30410 6211          DATFLD                  /CHANGE TO DATA FIELD
 1017 30411 3633          DCA I   GETJTZ          /CLEAR FLD 1 LOC. 0
 1018 30412 1634  GETJ1,  TAD I   GETJT1          /GET JOBTBL ENTRY
 1019 30413 7100          CLL                     /TO LET CALLER KNOW IT DOESN'T EXIST
 1020 30414 7450          SNA                     /LINK 0?
 1021 30415 5230          JMP     GETJ3           /YES - RETURN 0
 1022 30416 3234          DCA     GETJT1          /NO, JOB DATA ADDRESS
 1023 30417 1236          TAD     GETJM7
 1024 30420 1235          TAD     GETJT2          /ARE WE IN PROPER BLOCK?
 1025 30421 7510          SPA                     /ENTRY<7?
 1026 30422 5225          JMP     .+3             /YES
 1027 30423 3235          DCA     GETJT2          /NO, LINK TO NEXT
 1028 30424 5212          JMP     GETJ1           /AND TRY AGAIN
 1029 30425 7321          STL CLA IAC             /SET LINK TO LET CALLER KNOW WE WERE SUCCESSFUL
 1030 30426 1235          TAD     GETJT2          /INDEX INTO BLOCK
 1031 30427 1234          TAD     GETJT1          /START OF BLOCK
 1032 30430 2201  GETJ3,  ISZ     GETJTB          /SKIP CALLING ARGUMENT
 1033             GIRSB,
 1034 30431 0000  GETJT3, 0                       /BACK TO CALLING FIELD
 1035 30432 5601          JMP I   GETJTB
 1036 30433 0000  GETJTZ, 0                       /POINTER TO LOC. 0 OF FIELD 1 (NOT FOR TEMPORARY STORAGE)
 1037             
 1038             GIRSCT,                         /POINTER TO ITEM COUNT
 1039 30434 0000  GETJT1, 0
 1040             GIRST,
 1041 30435 0000  GETJT2, 0
 1042 30436 7771  GETJM7, -7

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 24


 1043             
 1044             /STORE CHARACTER
 1045             /CALL WITH ADDRESS OF DDB IN AC, CHARACTER IN TTCHAR
 1046             /       STORE
 1047             /       ADDRESS OF ROUTINE TO CHECK BUFFER SIZE
 1048             /       WON'T FIT
 1049             /       OK
 1050       0004  EMPTY=WS1
 1051       0034  DBINPA=C0004
 1052             
 1053 30437 0000  GIRSC,  0
 1054 30440 1034          TAD     DBINPA
 1055 30441 3231          DCA     GIRSB           /POINTS TO ADDRESS OF BUFFER
 1056 30442 1631          TAD I   GIRSB
 1057 30443 7450          SNA                     /IS BUFFER SET UP? (I.E. IS FILL POINTER NON ZERO?)
 1058 30444 5336          JMP     GIRSC8          /NO - GO GET A BUFFER
 1059 30445 3234          DCA     GIRSCT          /POINTER TO FILL COUNT
 1060 30446 2634          ISZ I   GIRSCT          /ANY ROOM LEFT?
 1061 30447 5277          JMP     GIRSC1          /YES
 1062 30450 6201          CDF
 1063 30451 1637          TAD I   GIRSC           /GET ADDRESS OF SIZE SUBROUTINE
 1064 30452 6211          DATFLD
 1065 30453 3235          DCA     GIRST
 1066 30454 1231          TAD     GIRSB
 1067 30455 7001          IAC                     /POINT TO CHARACTER COUNT
 1068 30456 4635          JMS I   GIRST           /GO CHECK BUFFER SIZE
 1069 30457 5355          JMP     GIRSC0          /BUFFER ALREADY FULL - NO ROOM FOR THIS ENTRY
 1070 30460 7346  GIRS11, CLL CLA CMA RTL         /IS THERE ENOUGH (I.E. 3 BLOCKS) FREE CORE LEFT?
 1071 30461 1047          TAD     FRECNT
 1072 30462 7750          SPA SNA CLA
 1073 30463 5355          JMP     GIRSC0          /NO - DON'T GIVE HIM ANOTHER BUFFER NOW
 1074 30464 1234          TAD     GIRSCT          /OK - GET A BUFFER
 1075 30465 6201          CDF
 1076 30466 4571          GETBLK                  /NO, LINK NEW BUFFER
 1077 30467 5355          JMP     GIRSC0          /NONE AVAILABLE
 1078 30470 6211          DATFLD
 1079 30471 1634          TAD I   GIRSCT          /POINTER TO HEAD OF NEW BUFFER
 1080 30472 3631          DCA I   GIRSB           /BUFFERS NOW CHAINED TOGETHER
 1081 30473 1631  GIRSC7, TAD I   GIRSB
 1082 30474 3234          DCA     GIRSCT          /POINT TO NEW FILL COUNT
 1083 30475 1361          TAD     GIRSIZ          /INITIALIZE CHAR COUNT TO -12
 1084 30476 3634          DCA I   GIRSCT          /AND SAVE IN NEW BLOCK
 1085 30477 1634  GIRSC1, TAD I   GIRSCT          /ARE WE DOING LAST THREE CHARACTERS IN BLOCK?
 1086 30500 1033          TAD     C0003
 1087 30501 7500          SMA
 1088 30502 7124          STL RAL                 /YES SO MULT. BY 2 THEN ADD 1
 1089 30503 7510          SPA                     /PACK?
 1090 30504 7161          STL CIA                 /NO - GET ADDRESS WITHIN BUFFER
 1091 30505 1631          TAD I   GIRSB           /START OF BUFFER
 1092 30506 3234          DCA     GIRSCT          /ADDRESS TO STORE CHARACTER
 1093 30507 1031          TAD     TTCHAR
 1094 30510 7420          SNL                     /PACK?
 1095 30511 5321          JMP     GIRSC4          /YES
 1096 30512 0140          AND     C0377

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 25


 1097             
 1098 30513 3634  GIRSC5, DCA I   GIRSCT          /STORE CHARACTER
 1099 30514 2231          ISZ     GIRSB           /POINT TO CHARACTER COUNT
 1100 30515 2631          ISZ I   GIRSB           /COUNT THIS ENTRY
 1101 30516 2237          ISZ     GIRSC           /INDICATE SUCCESS
 1102 30517 2237  GIRSC3, ISZ     GIRSC           /TO SKIP PAST ARG.
 1103 30520 5637          JMP I   GIRSC
 1104 30521 7006  GIRSC4, RTL                     /SHIFT BITS TO LEFT
 1105 30522 7006          RTL
 1106 30523 0134          AND     C7400
 1107 30524 1634          TAD I   GIRSCT          /AND SAVE IN CURRENT LOCATION IN BUFFER
 1108 30525 3634          DCA I   GIRSCT
 1109 30526 2234          ISZ     GIRSCT          /NEXT LOCATION IN BUFFER
 1110 30527 1031          TAD     TTCHAR          /GET LOW 4 BITS FROM CHARACTER
 1111 30530 7012          RTR
 1112 30531 7012          RTR
 1113 30532 7010          RAR
 1114 30533 0134          AND     C7400           /AND COMBINE WITH PREVIOUS CHARACTER
 1115 30534 1634          TAD I   GIRSCT          /SAVE THE WHOLE MESS
 1116 30535 5313          JMP     GIRSC5          /AND AWAY
 1117             
 1118 30536 6201  GIRSC8, CDF                     /ATTACH A BUFFER TO FILL POINTER
 1119 30537 1231          TAD     GIRSB           /LINK ADDRESS
 1120 30540 4571          GETBLK
 1121 30541 5317          JMP     GIRSC3          /CAN'T GET ONE - TOO BAD
 1122 30542 6211          DATFLD                  /OK - SET UP POINTERS
 1123 30543 7126          STL RTL                 / 2 PLUS
 1124 30544 1231          TAD     GIRSB           /ADDRESS OF FILL POINTER
 1125 30545 3004          DCA     EMPTY           / = ADDRESS OF EMPTY COUNT
 1126 30546 7240          STA
 1127 30547 1361          TAD     GIRSIZ          /-13 TO THE EMPTY COUNT
 1128 30550 3404          DCA I   EMPTY
 1129 30551 2004          ISZ     EMPTY           /NOW INITIALIZE THE EMPTY POINTER
 1130 30552 1631          TAD I   GIRSB           /SET EMPTY POINTER EQUAL TO FILL POINTER
 1131 30553 3404          DCA I   EMPTY           /SINCE IT'S THE ONLY BUFFER
 1132 30554 5273          JMP     GIRSC7
 1133 30555 6211  GIRSC0, DATFLD                  /COULDN'T SQUEEZE CHARACTER IN
 1134 30556 7240          STA                     /BUT WE ALREADY BUMPED FILL COUNT
 1135 30557 3634          DCA I   GIRSCT          /INDICATE CURRENT BLOCK IS STILL FULL
 1136 30560 5317          JMP     GIRSC3          /AND EXIT WITHOUT SKIPPING
 1137             
 1138 30561 7766  GIRSIZ, -12                     /10 (DECIMAL) CHARACTERS/BLOCK
 1139             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 26


 1140             
 1141 30562 4462  OVRLA1, JMS I   FIUSER
 1142 30563 5577          WAIT
 1143             
 1144 30564 0000  REMJOB, 0
 1145 30565 1112          TAD     SCHNEW          /GET NEW JOB MASK
 1146 30566 0160          AND     JOB             /AND THE CURRENT JOB
 1147 30567 3147          DCA     CURJOB          /IF THERE'S A JOB; REMEMBER HIM/HER
 1148 30570 4472          SAVJOB                  /SAVE HIS/HER STATE
 1149 30571 7240          STA
 1150 30572 3112          DCA     SCHNEW          /SET MASK FOR FULL SLICE
 1151 30573 5764          JMP I   REMJOB
 1152             
 1153 30574 1026  READFI, TAD     SIREG           /FIND RESIDENT FIELD FOR THIS JOB
 1154 30575 3003  FILCON, DCA     WS0
 1155 30576 4364          JMS     REMJOB          /BUMP OFF THE PRESENT USER - BUT MAYBE REMEMBER WHO HE IS
 1156 30577 1003          TAD     WS0
 1157 30600 4570          CORE
 1158 30601 0037          CJOB                    /ANY FIELD WITH THIS JOB IN IT IS OK
 1159 30602 7402          HLT                     /IF IT'S NOT THERE IT'S DOOMS DAY FOR ALL
 1160 30603 3103          DCA     L2SF            /RESTORE FOR THIS JOB
 1161 30604 1003          TAD     WS0
 1162 30605 4473  RUNFI,  RESJOB                  /RESTORE LEVEL TWO FOR THIS JOB
 1163 30606 4476          GETJTW                  /GET ADDRESS OF FILE PARAMETER BLOCK
 1164 30607 0007          JOBLNK
 1165 30610 5645          JMP I   SIFILA          /AND OFF TO THE FILE HANDLER

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 27


 1166             
 1167             /RETURN BLOCK TO FREE LIST
 1168             /CALL   TAD BLOCK ADDRESS
 1169             /       RETBLK
 1170             /       RETURN WITH LINK IN AC
 1171             
 1172 30611 0000  RETB,   0
 1173 30612 3347          DCA     RETB1           /SAVE BLOCK ADDRESS
 1174 30613 6214          RDF
 1175 30614 1144          TAD     C6203
 1176 30615 3242          DCA     RETF            /FOR RETURNING TO CALLER
 1177 30616 1347          TAD     RETB1
 1178 30617 7100          CLL
 1179 30620 1244          TAD     RETEND          /SEE IF IT'S FIP'S BLOCK OR A FILL COUNT FOR A LINKED BUFFER
 1180 30621 7630          SZL CLA
 1181 30622 5242          JMP     RETF            /IT IS - DON'T RELEASE IT
 1182 30623 1347          TAD     RETB1
 1183 30624 7450          SNA
 1184 30625 7402          HLT                     /SHOULD NEVER RETURN 0000
 1185 30626 0035          AND     C0007
 1186 30627 7440          SZA
 1187 30630 7402          HLT                     /SHOULD ALWAYS BE XXX0
 1188 30631 6211          DATFLD
 1189 30632 1747          TAD I   RETB1           /NOW GET THE LINK, IF ANY
 1190 30633 3346          DCA     RETBL           /SAVE IT
 1191 30634 1046          TAD     FREE            /GET OLD START OF FREE LIST
 1192 30635 3747          DCA I   RETB1           /PUT IT IN LINK
 1193 30636 1347          TAD     RETB1           /PUT ADDRESS OF THIS BLOCK
 1194 30637 3046          DCA     FREE            /AS START OF FREE LIST
 1195 30640 2047          ISZ     FRECNT          /INCREMENT FREE
 1196 30641 1346          TAD     RETBL
 1197 30642 0000  RETF,   0                       /RETURN WITH LINK
 1198 30643 5611          JMP I   RETB
 1199             
 1200 30644 0060  RETEND, -FIPBLK
 1201             
 1202             
 1203 30645 4521  SIFILA, SIFILE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 28


 1204             
 1205 30646 0040  SJCOPY, JSIOTC
 1206             
 1207       0035  SUJERR= C0007
 1208             /RESTART USER JOB AT RESTART ADDRESS
 1209             
 1210 30647 7041  GIR90,  CIA                     /NEGATE THE JOB NUMBER
 1211 30650 1160          TAD     JOB             /IS THE JOB CURRENTLY RUNNING?
 1212 30651 7640          SZA CLA
 1213 30652 5260          JMP     GIR91           /NO
 1214 30653 1403          TAD I   WS0
 1215 30654 3104          DCA     L2SV0           /SET PC=RESTART ADDRESS
 1216 30655 3105          DCA     L2SVLK          /SET LINK=0
 1217 30656 3106          DCA     L2SA            /SET AC=0
 1218 30657 5666          JMP I   GIR0A           /LEAVE
 1219 30660 1403  GIR91,  TAD I   WS0
 1220 30661 3405          DCA I   JOBSWA          /SET PC=RESTART ADD
 1221 30662 2005          ISZ     JOBSWA
 1222 30663 7240          STA
 1223 30664 3405          DCA I   JOBSWA          /SET LINK=-1 SO WE'LL REMEMBER TO CLEAR HIS'HER LINK & AC LATER
 1224 30665 5666          JMP I   GIR0A
 1225 30666 3246  GIR0A,  KBD01
 1226 30667 6777  CNOTR,  -NOTRUN-1
 1227             
 1228             /START USER JOB
 1229             
 1230 30670 1103  SUJ,    TAD     L2SF            /CLEAR NOTRUN FLAG SO JOB CAN BE SWAPPED
 1231 30671 0035          AND     C0007           /GET CORTBL INDEX
 1232 30672 1162          TAD     CORTBA
 1233 30673 3345          DCA     SUJSRC          /POINTS TO ENTRY IN CORTBL FOR THIS JOB
 1234 30674 1745          TAD I   SUJSRC          /GET CORTBL ENTRY
 1235 30675 0267          AND     CNOTR           /CLEAR NOT RUN BIT
 1236 30676 3745          DCA I   SUJSRC          /SAVE ENTRY
 1237 30677 1160          TAD     JOB             /IS IT A PHANTOM?
 1238 30700 0142          AND     C0600
 1239 30701 7640  SUJ2,   SZA CLA
 1240 30702 5467          EXIT                    /YES - WE'RE ALL SET
 1241 30703 4476  SUJ5,   GETJTW                  /NO, IOT RESULTS TO USER?
 1242 30704 0000          JOBSTS
 1243 30705 0246          AND     SJCOPY          /IOTC BIT IN STR0
 1244 30706 6211          DATFLD
 1245 30707 7450          SNA
 1246 30710 5357          JMP     SUJ4            /NO - WAS THERE A SYSTEM ERROR?
 1247 30711 7040          CMA                     /CLEAR THE BIT
 1248 30712 0405          AND I   JOBSWA          /JSIOTC:=0
 1249 30713 3405          DCA I   JOBSWA          /SAVE NEW STR0
 1250 30714 6201          CDF                     /GET # ARGUMENTS TO RETURN
 1251 30715 4476          GETJTW
 1252 30716 0007          JOBLNK
 1253 30717 3345          DCA     SUJSRC          /POINTS TO WORD1 OF PARAMETER BLOCK
 1254 30720 6211          DATFLD
 1255 30721 1745          TAD I   SUJSRC          /IOT IN QUESTION
 1256 30722 6201          CDF
 1257 30723 7010          RAR                     /SAVE "WHO FINF" INDICATOR IN LINK
 1258 30724 0034          AND     C0004
 1259 30725 7650          SNA CLA                 /WAS BIT 8 ON?
 1260 30726 5355          JMP     SUJ3            /NO - MUST HAVE BEEN AN RFILE OR WFILE WINDOW TURN

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 29


 1261 30727 7064          CML CMA RAL
 1262 30730 7106          CLL RTL                 /CA=-3 FOR "WHO";  AC=-7 FOR "FINF"
 1263 30731 3350          DCA     SUJCNT          /SAVE COUNT
 1264 30732 1345          TAD     SUJSRC          /RETURN PARAMETER BLOCK
 1265 30733 4576          RETBLK
 1266 30734 7200          CLA
 1267 30735 2345          ISZ     SUJSRC          /POINTS TO WORD 2 OF BLOCK
 1268 30736 1151          TAD     UUDF            /TRANSFER RESULTS TO USER'S FIELD
 1269 30737 3346          DCA     SUJDFS          /...SET FIELD IN BLT CALL
 1270 30740 1106          TAD     L2SA            /POINTS TO USER'S PARAMETERS
 1271 30741 3347          DCA     SUJDES          /SAVE FOR BLT
 1272 30742 3106          DCA     L2SA            /CLEAR HIS/HER AC
 1273 30743 4567          BLT                     /MOVE RESULTS TO USER
 1274 30744 6211          DATFLD                  /FROM FIELD 1
 1275 30745 0000  SUJSRC, 0                       /SOURCE ADDRESS
 1276             RETBL,
 1277 30746 0000  SUJDFS, 0                       /TO USER FIELD
 1278             RETB1,
 1279 30747 0000  SUJDES, 0                       /AT THIS ADDRESS
 1280 30750 0000  SUJCNT, 0                       /-WORD COUNT
 1281 30751 1160          TAD     JOB
 1282 30752 4501          RUNABL                  /IS HE STILL RUNNABLE?
 1283 30753 5577          WAIT                    /NO - JUST NEEDED TO PASS THE INFO TO HIM/HER
 1284 30754 5303          JMP     SUJ5
 1285             
 1286 30755 1345  SUJ3,   TAD     SUJSRC          /UFILE RETURN
 1287 30756 5645          JMP I   SIFILA
 1288             
 1289 30757 2005  SUJ4,   ISZ     JOBSWA          /POINT AT STR1
 1290 30760 1405          TAD I   JOBSWA
 1291 30761 7132          STL RTR                 /PLACE SYSTEM ERROR PENDING BIT IN LINK
 1292 30762 7420          SNL                     /IS THERE AN ERROR?
 1293 30763 5301          JMP     SUJ2            /NO; GO CLEAR AC AND EXIT
 1294             /ROUTINE TO START USER JOB AT ERROR ADDRESS
 1295             /DOES A JMS TO ERROR ADDRESS
 1296             /USER PC AT TIME OF ERROR TO ADDRESS; JMP TO ADD+1
 1297 30764 7106          CLL RTL                 /CLEAR THE ERROR PENDING BIT
 1298 30765 3405          DCA I   JOBSWA          /TO AVOID A SECOND JMS TO HIS ERROR ROUTINE
 1299 30766 1005          TAD     JOBSWA
 1300 30767 1141          TAD     C0005
 1301 30770 3005          DCA     JOBSWA          /POINTS TO ERROR RESTART ADD
 1302 30771 1405          TAD I   JOBSWA          /ERROR ADDRESS
 1303 30772 3003          DCA     WS0
 1304 30773 1104          TAD     L2SV0           /OLD PC
 1305 30774 4150          UDF                     /GET USER'S FIELD
 1306 30775 3403          DCA I   WS0             /SAVE OLD PC
 1307 30776 7001          IAC
 1308 30777 1003          TAD     WS0             /ERROR ADDRESS + 1
 1309 31000 3104          DCA     L2SV0           /NEW PC
 1310 31001 5467          EXIT
 1311             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 30


 1312             
 1313             /PAPER TAPE READER SERVICE FOR TSS/8
 1314             
 1315 31002 4741  UPTR,   JMS I   PTRCHK          /DOES HE OWN DEVICE?
 1316 31003 3042  PTRDEV, DEVTBE                  /POINTS TO READER ENTRY IN DEVTBL
 1317 31004 1346          TAD     URCBI           /CHECK FOR "RCB"
 1318 31005 1003          TAD     UUOCAL
 1319 31006 7650          SNA CLA
 1320 31007 5240          JMP     URCB            /IT IS!
 1321 31010 4742          JMS I   PTRIOT          /ANALYZE IOT
 1322 31011 5232          JMP     URRS            /READ A STRING
 1323 31012 0010  PTRFL,  JSPTR                   /READER FLAG
 1324 31013 5631          JMP I   PTRSKP          /WE ALWAYS SKIP
 1325 31014 7620          SNL CLA                 /RRB?
 1326 31015 5461          UUOEXT                  /NO - MUST HAVE BEEN RFC - SO WHAT!
 1327 31016 3003          DCA     WS0             /SET READER'S BREAK MASK TO 0
 1328 31017 6211          DATFLD
 1329 31020 1603          TAD I   PTRDEV          /ADDRESS OF DDB
 1330 31021 4507          FETCH                   /FETCH A CHARACTER FROM READER BUFFER
 1331 31022 5244          JMP     PSTWT0          /NONE AVAILABLE - START READER
 1332 31023 3227          DCA     PTRCH           /SAVE FOR NEXT RRB
 1333 31024 6201          CDF
 1334 31025 1352          TAD     PTRACA          /POINTS TO L2SA
 1335 31026 4460          IOR                     /OR CHARACTER INTO L2SA
 1336 31027 0000  PTRCH,  0
 1337 31030 5461          UUOEXT                  /EXIT TO USER
 1338 31031 7215  PTRSKP, UUOEX2
 1339             
 1340 31032 6211  URRS,   DATFLD
 1341 31033 1603          TAD I   PTRDEV          /GET DDB ADDRESS
 1342 31034 3133          DCA     CONDDB
 1343 31035 4743          JMS I   PSTRIN          /TRANSFER STRING TO USER
 1344 31036 5244          JMP     PSTWT0          /INSUFFICIENT NUMBER OF CHARACTERS IN BUFFER
 1345 31037 5461          UUOEXT
 1346             
 1347 31040 6211  URCB,   DATFLD
 1348 31041 1603          TAD I   PTRDEV          /CLEAR THE ENTIRE READER BUFFER
 1349 31042 4747          JMS I   PTRCLR
 1350 31043 5461          UUOEXT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 31


 1351             
 1352 31044 7240  PSTWT0, STA
 1353 31045 3332  L2PTR1, DCA     PTRSET          /REMEMBER WHY WE ARE HERE
 1354 31046 6203          CDF CIF                 /SELECT F0 AND INHIBIT INTERRUPTS
 1355 31047 1744          TAD I   PTRTIM          /IS THE READER BUSY?
 1356 31050 7650          SNA CLA
 1357 31051 6014          RFC                     /START THE READER
 1358 31052 7344          CLL STA RAL             /AC=-2
 1359 31053 3744          DCA I   PTRTIM          /SET READER TIMER
 1360 31054 3745          DCA I   RCNTA           /NO LIMIT UNTIL IT'S READ AT LEAST ONE BLOCK WORTH
 1361 31055 2332          ISZ     PTRSET          /FROM UUO OR LEVEL 2?
 1362 31056 5467          EXIT                    /LEVEL 2 - FINISHED
 1363 31057 7240          STA
 1364 31060 1104          TAD     L2SV0           /BACK UP HIS PC FOR A REDO
 1365 31061 3104          DCA     L2SV0
 1366 31062 1212          TAD     PTRFL
 1367 31063 5461          UUOEXT                  /NOW WAIT FOR THE READER
 1368             
 1369 31064 0000  PTRSIZ, 0
 1370 31065 3332          DCA     PTRSET          /SAVE POINTER TO CHARACTER COUNT
 1371 31066 2264          ISZ     PTRSIZ          /WE ALWAYS SUCCEED
 1372 31067 6203          CDF CIF                 /NO INTERRUPTS WHILE WE CHECK THE READER'S STATUS
 1373 31070 1744          TAD I   PTRTIM
 1374 31071 7700          SMA CLA                 /IS IT STILL RUNNING?
 1375 31072 5310          JMP     PTRSI2          /NO - JUST MAKE SURE THE FLAG IS SET
 1376 31073 1047          TAD     FRECNT          /HOW'S THE SUPPLY OF FREE CORE?
 1377 31074 1041          TAD     C7770
 1378 31075 7740          SMA SZA CLA
 1379 31076 1350          TAD     PTRFUL          /MINUS NUMBER ALLOWED
 1380 31077 6211          DATFLD
 1381 31100 1732          TAD I   PTRSET          /PLUS CURRENT CHARACTER COUNT
 1382 31101 6201          CDF
 1383 31102 7500          SMA
 1384 31103 7240          STA                     /SHUT DOWN THE READER AFTER THE NEXT CHARACTER
 1385 31104 3745          DCA I   RCNTA
 1386 31105 1745          TAD I   RCNTA
 1387 31106 1037          TAD     C0100
 1388 31107 7700          SMA CLA
 1389 31110 4332  PTRSI2, JMS     PTRSET          /SET THE READER FLAG IN STR1
 1390 31111 5664          JMP I   PTRSIZ
 1391             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 32


 1392             
 1393 31112 4332  L2PTR,  JMS     PTRSET          /WAKE HIM/HER UP - HE'S HUNG
 1394 31113 1603          TAD I   PTRDEV          /DDB?
 1395 31114 7450          SNA
 1396 31115 5467          EXIT                    /NO
 1397 31116 3016          DCA     AXS2            /YES - SAVE IT, WE'LL NEED THE JOB # FROM IT
 1398 31117 1016          TAD     AXS2
 1399 31120 1034          TAD     C0004
 1400 31121 3003          DCA     WS0
 1401 31122 1403          TAD I   WS0             /IS IT EMPTY?
 1402 31123 7640          SZA CLA
 1403 31124 5467          EXIT                    /NO - SO IT ISN'T OFFICIALLY HUNG YET
 1404 31125 1416          TAD I   AXS2            /JOB OWNING PTR
 1405 31126 6201          CDF
 1406 31127 4463          ERROR                   /REPORT THE HUNG READER TO HIM/HER
 1407 31130 0006          HUNGDV
 1408 31131 5467          EXIT
 1409             
 1410 31132 0000  PTRSET, 0
 1411 31133 6211          DATFLD
 1412 31134 1203          TAD     PTRDEV          /READER'S POSITION IN DEVTBL
 1413 31135 3132          DCA     CONDBA
 1414 31136 1212          TAD     PTRFL
 1415 31137 4502          JMS I   SETFLG          /SET JSPTR IN STR1
 1416 31140 5732          JMP I   PTRSET
 1417             
 1418 31141 2125  PTRCHK, DEVCHK
 1419 31142 5115  PTRIOT, UKT1
 1420 31143 3475  PSTRIN, UKREAD
 1421 31144 2415  PTRTIM, TIMPTR
 1422 31145 7443  RCNTA,  RCNT
 1423 31146 1761  URCBI,  -6017
 1424 31147 6642  PTRCLR, CLRBUF
 1425 31150 7540  PTRFUL, -240

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 33


 1426             
 1427             
 1428             /ROUTINE TO HANDLE EASY DECTAPE STUFF
 1429             /LIKE DTSF AND DTRB
 1430             /DTSF ALWAYS SKIPS
 1431             
 1432 31151 2104  UDTRBS, ISZ     L2SV0           /BUMP HIS PC
 1433 31152 0106  PTRACA, L2SA                    /TRICKY, TRICKY
 1434 31153 4476  UDTRB,  GETJTW                  /GET LAST VALUE OF STATUS B
 1435 31154 0002          JOBSTB
 1436 31155 3106          DCA     L2SA            /GIVE IT TO USER
 1437 31156 5461          UUOEXT
 1438             
 1439 31157 4000  C4000,  4000
 1440 31160 3734  MCSCQ,  -4044                   /COVERS BOTH ^Q AND ^S
 1441             
 1442 31161 0000  CONSQ,  0
 1443 31162 2132          ISZ     CONDBA          /POINT TO OUTPUT SIDE IN DEVTBL
 1444 31163 1031          TAD     TTCHAR
 1445 31164 7112          CLL RTR
 1446 31165 1360          TAD     MCSCQ           /CHECK FOR ^Q AND ^S
 1447 31166 7640          SZA CLA
 1448 31167 5761          JMP I   CONSQ           /NEITHER
 1449 31170 1532          TAD I   CONDBA
 1450 31171 7450          SNA
 1451 31172 5761          JMP I   CONSQ           /DOESN'T HAVE AN OUTPUT DDB - SO ^S/^Q MEANS NOTHING
 1452 31173 3150          DCA     WS2             /ADDRESS OF OUTPUT DDB
 1453 31174 1550          TAD I   WS2
 1454 31175 0143          AND     C3777           /CLEAR THE BIT FIRST
 1455 31176 7420          SNL                     /NOW WHICH WAS IT?
 1456 31177 1357          TAD     C4000           /^S - SET THE BIT TO INHIBIT HIS/HER TTY FROM PRINTING
 1457 31200 3550          DCA I   WS2             /SAVE UPDATED STATUS
 1458 31201 7430          SZL                     /WHICH WAS IT AGAIN?
 1459 31202 4235          JMS     TYPE            /^Q - START HIM/HER TYPING IF HE HAS ANYTHING TO TYPE
 1460 31203 5604          JMP I   .+1             /TAKE SUCCESSFUL EXIT THROUGH "KEY"
 1461 31204 3265          KBDXIT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 34


 1462             
 1463             /MULTI-FIELD ROUTINE TO OUTPUT TO A TTY, PTP, OR LPT
 1464             /CALL:  CONDBA CONTAINS POINTER TO POSITION IN DEVTBL
 1465             /       TTCHAR CONTAINS CHARACTER TO BE OUTPUT
 1466             /       PRINT
 1467             /       NO ROOM IN OUTPUT BUFFER
 1468             /       OK
 1469             
 1470 31205 0000  PRINT0, 0
 1471 31206 6214          RDF
 1472 31207 1144          TAD     C6203
 1473 31210 3225          DCA     PRINTX          /REMEMBER FROM WHENCE WE CAME
 1474 31211 3004          DCA     EMPTY           /CLEAR EMPTY BUFFER INDICATOR
 1475 31212 6211  PRINT1, DATFLD
 1476 31213 1532          TAD I   CONDBA          /GET ADDRESS OF DDB
 1477 31214 7450          SNA
 1478 31215 5227          JMP     PRINT2
 1479 31216 4575          STORE                   /STASH THE CHARACTER IN HIS BUFFER
 1480 31217 1255          OUTSIZ                  /ADDRESS OF SIZE CHECK ROUTINE FOR OUTPUT
 1481 31220 5225          JMP     PRINTX          /WOULDN'T FIT
 1482 31221 2205          ISZ     PRINT0          /OK - SKIP ON RETURN
 1483 31222 1004          TAD     EMPTY           /WAS THE BUFFER EMPTY?
 1484 31223 7640          SZA CLA
 1485 31224 4235          JMS     TYPE            /YES - BETTER START THE HARDWARE
 1486 31225 0000  PRINTX, .-.                     /FIELD SELECT
 1487 31226 5605          JMP I   PRINT0          /AND BACK
 1488 31227 1132  PRINT2, TAD     CONDBA          /NO BUFFER SETUP YET
 1489 31230 6201          CDF
 1490 31231 4571          GETBLK                  /CREATE A PSEUDO DDB
 1491 31232 5225          JMP     PRINTX          /NO BLOCKS AVAILABLE
 1492 31233 5212          JMP     PRINT1
 1493 31234 7566  TTOFLB, TTOFLG
 1494             
 1495             CORSR4,
 1496 31235 0000  TYPE,   0
 1497 31236 1132          TAD     CONDBA          /DEVTBL POINTER
 1498 31237 1314          TAD     OUTOFF          /MINUS DIF.
 1499 31240 7110          CLL RAR                 /DIVIDE BY 2
 1500 31241 3255          DCA     OUTSIZ          / = OUTREG POINTER
 1501 31242 6202          CIF                     /NO INTERRUPTS
 1502 31243 1655          TAD I   OUTSIZ
 1503 31244 0310          AND     C4001
 1504 31245 7640          SZA CLA                 /CHECK SERVICE AND CHARACTER FLAGS
 1505 31246 5635          JMP I   TYPE            /CHARACTER WILL BE TAKEN BY AN INTERRUPT
 1506 31247 7130          STL RAR
 1507 31250 1655          TAD I   OUTSIZ          /SET THE SERVICE FLAG
 1508 31251 3655          DCA I   OUTSIZ
 1509 31252 6201          CDF
 1510 31253 3634          DCA I   TTOFLB          /SCHEDULE LEVEL 2 TO PRINT IT
 1511 31254 5635          JMP I   TYPE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 35


 1512             
 1513             CORSR2,
 1514 31255 0000  OUTSIZ, 0
 1515 31256 3235          DCA     TYPE            /SAVE POINTER TO CHARACTER COUNT
 1516 31257 1635          TAD I   TYPE            /CURRENT COUNT
 1517 31260 7510          SPA                     /DOES IT INCLUDE A FILLER CHARACTER COUNT
 1518 31261 0140          AND     C0377           /YES - DISREGARD IT
 1519 31262 3235          DCA     TYPE            /THE ACTUAL COUNT TO COMPARE WITH
 1520 31263 1225          TAD     PRINTX
 1521 31264 0137          AND     C0070
 1522 31265 7640          SZA CLA
 1523 31266 5306          JMP     OUTSI1          /CALLED FROM SI
 1524 31267 1132          TAD     CONDBA
 1525 31270 7100          CLL
 1526 31271 1313          TAD     LPTSIZ          /ALLOW LINE PRINTER BUFFER TO GOBBLE UP ABOUT 40% OF FREE CORE
 1527 31272 0047          AND     FRECNT
 1528 31273 0156          AND     C0400           /DON'T LOOK AT TOO MUCH FREE CORE
 1529 31274 7450          SNA
 1530 31275 1047          TAD     FRECNT
 1531 31276 7430          SZL
 1532 31277 7106          CLL RTL                 /THE LINE PRINTER GETS 4 TIMES AS MUCH
 1533 31300 7041          CIA
 1534 31301 1235  OUTSI2, TAD     TYPE            /CURRENT COUNT
 1535 31302 1312          TAD     OUTLIM
 1536 31303 7710          SPA CLA
 1537 31304 2255          ISZ     OUTSIZ          /STILL ROOM
 1538 31305 5655          JMP I   OUTSIZ
 1539 31306 1311  OUTSI1, TAD     C7366
 1540 31307 5301          JMP     OUTSI2
 1541             
 1542 31310 4001  C4001,  4001
 1543 31311 7366  C7366,  7366
 1544 31312 0025  OUTLIM, 25
 1545 31313 4733  LPTSIZ, -DEVTBE-3
 1546 31314 5360  OUTOFF, -OUTDIF

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 36


 1547             
 1548             /SEARCH FOR JOB IN CORE
 1549             /CALL   TAD JOB #
 1550             /       JMS CORSRC
 1551             /       MASK
 1552             /       NOT THERE, AC:=0
 1553             /       THERE, SAVE FIELD IN AC
 1554             
 1555             
 1556             /THESE TWO WORDS MUST IMMEDIATELY PRECEDE CORSRC
 1557             /THEY MUST ALSO BE ORIGINED AT CORSRC-2
 1558       1315  *CORSRC-2
 1559             
 1560 31315 0000  CORCNT, 0                       /INIT TO -NUMBER OF USER FIELDS
 1561 31316 0000  CORTBE, 0                       /INIT TO -((END OF CORTBL)+1)
 1562             
 1563 31317 0000  CORSRC, 0                       /ENTER WITH BIT PATTERN TO MATCH
 1564 31320 0717          AND I   CORSRC          /MASK AS SPECIFIED
 1565 31321 7041          CIA
 1566 31322 3235          DCA     CORSR4          /-WHAT WE WANT
 1567 31323 6214          RDF                     /FIGURE OUT WHENCE WE CAME
 1568 31324 1144          TAD     C6203
 1569 31325 3353          DCA     CORSR3          /SO WE CAN RETURN
 1570 31326 1717          TAD I   CORSRC          /GET THE MASK
 1571 31327 3255          DCA     CORSR2          /SAVE IT
 1572 31330 2317          ISZ     CORSRC          /SKIP PAST MASK IN CALL
 1573 31331 6201          CDF
 1574 31332 1315          TAD     CORCNT          /-# ENTRIES TO CHECK
 1575 31333 3015          DCA     AXS1            /USED AS COUNTER
 1576 31334 2374  CORSR1, ISZ     CORTBP          /INCREMENT TABLE POINTER
 1577 31335 1374          TAD     CORTBP          /ARE WE AT END OF TABLE?
 1578 31336 1316          TAD     CORTBE
 1579 31337 7710          SPA CLA
 1580 31340 5344          JMP     CORSR5          /NO
 1581 31341 7126          STL RTL
 1582 31342 1162          TAD     CORTBA          /YES, START ALL OVER AT FIELD 2
 1583 31343 3374          DCA     CORTBP
 1584 31344 1774  CORSR5, TAD I   CORTBP          /GET TABLE ENTRY
 1585 31345 0255          AND     CORSR2          /MASK IT
 1586 31346 1235          TAD     CORSR4          /COMPARE WITH DESIRED ENTRY
 1587 31347 7650          SNA CLA
 1588 31350 5355          JMP     CORSR6          /FOUND IT!
 1589 31351 2015          ISZ     AXS1            /NOT YET
 1590 31352 5334          JMP     CORSR1          /KEEP GOING
 1591 31353 0000  CORSR3, 0                       /RETURN WITH AC=0
 1592 31354 5717          JMP I   CORSRC

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 37


 1593             
 1594 31355 1162  CORSR6, TAD     CORTBA          /WE HAVE IT; GET CORTBL INDEX
 1595 31356 7041          CIA
 1596 31357 1374          TAD     CORTBP
 1597 31360 3015          DCA     AXS1            /FIELD #
 1598 31361 1235          TAD     CORSR4          /WE HAVE TO SET MODE BIT APPROPRIATELY
 1599 31362 7041          CIA                     /RECOMPLEMENT CALLING JOB #
 1600 31363 0142          AND     C0600           /A PHANTOM?
 1601 31364 7650          SNA CLA                 /EXEC MODE?
 1602 31365 1113          TAD     C0010           /NO - SET USER MODE BIT
 1603 31366 1015          TAD     AXS1            /SET UP SAVE FIELD
 1604 31367 7106          CLL RTL                 /SHIFT AND ADD DATA FIELD
 1605 31370 7004          RAL
 1606 31371 1015          TAD     AXS1
 1607 31372 2317          ISZ     CORSRC          /SKIP TO INDICATE SUCCESS
 1608 31373 5353          JMP     CORSR3          /BACK
 1609 31374 7002  CORTBP, CORTBL+1                / "ROUND-ROBIN" POINTER
 1610             
 1611             /WHEN THE USER EXECUTES A "SEA" IOT,
 1612             /WE MUST DO TWO THINGS:
 1613             /       1) SET THE ERROR ENABLE BIT IN STR0
 1614             /       2) SAVE THE USER'S AC IN THE JOB DATA AREA
 1615             /               JSEREN IS SET HERE
 1616             /       WE GO TO USEA1 TO SAVE THE ERROR ADDRESS
 1617             /JSEREN MAY BE CLEARED BY .RUN, START, OR
 1618             /A USER EXECUTING A "CLEAR STATUS" IOT.
 1619             
 1620 31375 6211  USEA,   DATFLD                  /SET JSEREN WHEN USER EXECUTES SEA
 1621 31376 1561          TAD I   CJOBDA          /POINTS TO WORD 0 OF JOB DATA AREA
 1622 31377 7001          IAC                     /POINTS TO STR0
 1623 31400 4460          IOR                     /OR IN JSEREN
 1624 31401 2000          JSEREN
 1625 31402 6201          CDF
 1626 31403 5604          JMP I   .+1
 1627 31404 7271          USEA1                   /GO PICK UP ERROR ADDRESS

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 38


 1628             
 1629             
 1630             /GET A BUFFER FROM FREE LIST
 1631             /CALL   TAD (ADDRESS TO STORE LINK)
 1632             /       GETBLK
 1633             /       NONE AVAILABLE
 1634             /       OK WITH LINK STORED
 1635             
 1636             GETB,
 1637 31405 0000  GETDB2, 0
 1638 31406 3362          DCA     GETBT           /SAVE ADDRESS TO SAVE PTR
 1639 31407 6214          RDF                     /SAVE CALLING FIELD
 1640 31410 1144          TAD     C6203
 1641 31411 3235          DCA     GETB1           /SO WE CAN GET BACK
 1642 31412 6211          DATFLD
 1643 31413 1046          TAD     FREE            /ANY BUFFERS LEFT?
 1644 31414 7450          SNA
 1645 31415 5235          JMP     GETB1           /NONE LEFT
 1646 31416 3762          DCA I   GETBT           /STORE LINK IN ADDRESS SPECIFIED
 1647 31417 7240          STA                     /NOW WE'LL BE GOOD GUYS
 1648 31420 1046          TAD     FREE            /AND PREPARE TO CLEAR THE BUFFER
 1649 31421 3015          DCA     AXS1
 1650 31422 1446          TAD I   FREE            /REMOVE FROM FREE LIST
 1651 31423 3046          DCA     FREE            /SET NEW POINTER TO FREE LIST
 1652 31424 2205          ISZ     GETB            /INDICATES SUCCESS
 1653 31425 7240          STA                     /DECREMENT FREE COUNT
 1654 31426 1047          TAD     FRECNT
 1655 31427 3047          DCA     FRECNT
 1656 31430 1041          TAD     C7770           /8 WORDS TO ZERO
 1657 31431 3362          DCA     GETBT
 1658 31432 3415          DCA I   AXS1
 1659 31433 2362          ISZ     GETBT           /DONE?
 1660 31434 5232          JMP     .-2             /NO
 1661 31435 0000  GETB1,  0                       /RETURN
 1662 31436 5605          JMP I   GETB
 1663             
 1664 31437 1106  USTM,   TAD     L2SA            /GET UNITS OF TIME IN AC
 1665 31440 3362          DCA     USTM1           /SAVE IT
 1666 31441 3106          DCA     L2SA            /ZERO USER'S AC
 1667 31442 1362          TAD     USTM1
 1668 31443 7450          SNA                     /ANY TIME SPECIFIED?
 1669 31444 5461          UUOEXT                  /NO, SO DON'T SLEEP
 1670 31445 5646          JMP I   USTM2           /YES, GO PUT TO SLEEP
 1671 31446 5155  USTM2,  DOUSTM

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 39


 1672             
 1673             /GET A DATA BLOCK
 1674             /CALL   TAD LINK
 1675             /       GETDDB
 1676             /       NONE AVAILABLE
 1677             /       OK
 1678             
 1679             
 1680             GETDB0,
 1681 31447 0000  DEVWT0, 0
 1682 31450 3353          DCA     GETDB1          /ADDRESS OF DDB POINTER (USUALLY IN DEVTBL)
 1683 31451 6214          RDF
 1684 31452 1144          TAD     C6203
 1685 31453 3300          DCA     GETDB5          /SAVE CALLING FIELD SO WE CAN GET OUT
 1686 31454 6201          CDF
 1687 31455 1353          TAD     GETDB1          /GET A BUFFER FROM FREE CORE
 1688 31456 4571          GETBLK
 1689 31457 5300          JMP     GETDB5          /SORRY
 1690 31460 6211          DATFLD
 1691 31461 2247          ISZ     GETDB0          /SUCCESSFUL RETURN
 1692 31462 1753          TAD I   GETDB1
 1693 31463 1033          TAD     C0003
 1694 31464 3353          DCA     GETDB1          /SAVE IT
 1695 31465 1051          TAD     CLK1            /GET LOW ORDER CLOCK
 1696 31466 7006          RTL                     /AND SHIFT BITS 0-2 INTO AC 9-11
 1697 31467 7006          RTL
 1698 31470 0035          AND     C0007           /GET MOST SIGNIFICANT BITS FROM LOW ORDER
 1699 31471 3205          DCA     GETDB2          /SAVE THEM
 1700 31472 1050          TAD     CLK2            /GET HIGH ORDER TIME
 1701 31473 7006          RTL                     /SHIFT LEFT 3 PLACES
 1702 31474 7004          RAL
 1703 31475 0041          AND     C7770           /KEEP BITS 0-8
 1704 31476 1205          TAD     GETDB2          /ADD COMPONENT DERIVED FROM CLK1
 1705 31477 3753          DCA I   GETDB1          /SAVE IN DDB
 1706 31500 0000  GETDB5, 0                       /RETURN
 1707 31501 5647          JMP I   GETDB0
 1708             
 1709             
 1710             
 1711 31502 7773  CTIMER, -5
 1712 31503 2413  TIMCOA, TIMCON
 1713 31504 4603  CONJMS, JMSTIM
 1714 31505 6224  TTIMEB, TTIMER
 1715 31506 1302  L2OUT,  TAD     CTIMER          /AC=-5
 1716 31507 3703          DCA I   TIMCOA          /RESET THE OUTPUT MASTER TIMER
 1717 31510 1304          TAD     CONJMS
 1718 31511 3705          DCA I   TTIMEB          /PLACE THE TIMER "HOOK" IN CONOUT
 1719 31512 3744          DCA I   TTOFLC          /SCHEDULE CONOUT FOR LEVEL 2

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 40


 1720             
 1721             /BEFORE DISMISSING BACK TO USER JOB, IT IS A GOOD IDEA TO CHECK AND SEE IF ANY OTHER
 1722             /LEVEL 2 PROCESSING HAS BEEN SCHEDULED WHILE WE WERE WORKING ON THE LAST REQUEST
 1723             /WE CAN ASCERTAIN IF THIS IS THE CASE BY COMPARING THE L2QUE EMPTY AND
 1724             /FILL POINTERS -- IF THEY ARE EQUAL, THEN WE'RE DONE, AND CAN GO TO L2EX1,
 1725             /WHERE BOTH POINTERS ARE RESET. IF UNEQUAL, WE GET THE NEXT ENTRY POINTED
 1726             /TO BY L2QE, AND DISPATCH TO IT LEAVE LEVEL 2
 1727             
 1728 31513 6201  L2EXIT, CDF
 1729 31514 6002          IOF                     /NO INTERRUPTS WHILE CHECKING L2QUE STATUS
 1730 31515 7200          CLA
 1731 31516 1747          TAD I   L2KEY
 1732 31517 7640          SZA CLA
 1733 31520 5750          JMP I   CONINP          /KEYBOARDS NEED SERVICE - TAKE CARE OF THEM FIRST
 1734 31521 1013  L2EX0,  TAD     L2Q             /ARE FILL AND EMPTY POINTERS EQUAL?
 1735 31522 7041          CIA
 1736 31523 1014          TAD     L2QE            /-FILL PTR + EMPTY PTR
 1737 31524 7650          SNA CLA
 1738 31525 5332          JMP     L2EX1           /YES - WE ARE CAUGHT UP
 1739 31526 1414          TAD I   L2QE            /NO; GET ADDRESS FROM L2QUE
 1740 31527 3005          DCA     JOBSWA
 1741 31530 6001          ION                     /INTERRUPT BACK ON
 1742 31531 5405          JMP I   JOBSWA          /DISPATCH
 1743             
 1744 31532 1346  L2EX1,  TAD     L2QTA
 1745 31533 3014          DCA     L2QE
 1746 31534 1346          TAD     L2QTA
 1747 31535 3013          DCA     L2Q             /RESET FILL POINTER
 1748 31536 1744          TAD I   TTOFLC
 1749 31537 7650          SNA CLA
 1750 31540 5745          JMP I   CONOUA          /PRINTERS NEED SERVICE
 1751 31541 1351          TAD     L2SFA
 1752 31542 5743          JMP I   .+1             /NOW BACK TO WORK
 1753 31543 0345          RESTOR
 1754             
 1755 31544 7566  TTOFLC, TTOFLG
 1756 31545 6213  CONOUA, CONOUT
 1757 31546 7007  L2QTA,  L2QTB-1
 1758 31547 7572  L2KEY,  KEYC
 1759 31550 2006  CONINP, CONIN
 1760 31551 0103  L2SFA,  L2SF
 1761 31552 5364  KBDJOA, DEVJOB

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 41


 1762             
 1763             GETDB1,
 1764             CLST0,
 1765 31553 0000  KBDDLM, 0                       /ROUTINE TO SET DELIMITER FLAG IN STR1
 1766 31554 1133          TAD     CONDDB
 1767 31555 4752          JMS I   KBDJOA          /GET JOB #
 1768 31556 3057          DCA     BONUS           /GIVE HIM/HER HIGHEST SCHEDULER PRIORITY
 1769 31557 1037          TAD     C0100           /JSDEL
 1770 31560 4502          JMS I   SETFLG          /SET HIS/HER DELIMITER BIT
 1771 31561 5753          JMP I   KBDDLM          /AND BACK
 1772             
 1773             GETBT,
 1774             USTM1,
 1775 31562 0000  CLSTR1, 0                       /ROUTINE TO CLEAR BITS IN STR1
 1776 31563 7040          CMA                     /ENTER WITH BITS TO CLEAR IN AC
 1777 31564 3353          DCA     CLST0           /SAVE MASK OF BITS TO SAVE
 1778 31565 6201          CDF
 1779 31566 4476          GETJTW                  /GET CURRENT SETTING OF STR1
 1780 31567 0001          JOBSTS+1
 1781 31570 0353          AND     CLST0           /CLEAR SELECTED BITS
 1782 31571 6211          DATFLD
 1783 31572 3405          DCA I   JOBSWA          /SAVE CLEARED STATUS REGISTER
 1784 31573 5762          JMP I   CLSTR1          /RETURN
 1785             
 1786 31574 1141  URK050, TAD     C0005
 1787 31575 1032  UDTXA0, TAD     C0002
 1788 31576 7110          CLL RAR
 1789 31577 6212          CIF DATFLD-1            /FIELD 1 DTA UUO SERVICE
 1790 31600 5601          JMP I   .+1
 1791 31601 1423          UUDTRK

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 42


 1792             
 1793       1602  *FISUBL+1202
 1794             /BLOCK TRANSFER
 1795             /CALL   BLT
 1796             /       62S1    SELECT SOURCE DATA FIELD
 1797             /       SOURCE
 1798             /       62D1    SELECT DESTINATION DATA FIELD
 1799             /       DESTINATION
 1800             /       -NUMBER WORDS
 1801             /       RETURN
 1802             BLT0,
 1803 31602 0000  RUNTDB, 0
 1804 31603 1602          TAD I   BLT0            /GET SOURCE FIELD SELECT
 1805 31604 3227          DCA     BLT1            /SAVE
 1806 31605 2202          ISZ     BLT0            /POINTS TO SOURCE ADDRESS
 1807 31606 7240          STA
 1808 31607 1602          TAD I   BLT0            /CORE ADDRESS -1 OF SOURCE
 1809 31610 3015          DCA     AXS1            /AUTO INDEX
 1810 31611 2202          ISZ     BLT0            /POINTS TO DESTINATION FIELD SELECT
 1811 31612 1602          TAD I   BLT0            /GET DESTINATION SELECT
 1812 31613 3231          DCA     BLT2            /SAVE
 1813 31614 2202          ISZ     BLT0            /POINTS TO DEST. ADD
 1814 31615 7240          STA
 1815 31616 1602          TAD I   BLT0            /DEST. ADD-1
 1816 31617 3016          DCA     AXS2            /AUTO INDEX
 1817 31620 2202          ISZ     BLT0            /POINTS TO -WORD COUNT
 1818 31621 1602          TAD I   BLT0
 1819 31622 3237          DCA     BLTC            /SAVE
 1820 31623 2202          ISZ     BLT0            /RETURN ADDRESS
 1821 31624 6214          RDF
 1822 31625 1144          TAD     C6203
 1823 31626 3235          DCA     BLTF            /SAVE RETURN FIELD SELECT
 1824 31627 0000  BLT1,   0                       /SELECT SOURCE DATA FIELD
 1825 31630 1415          TAD I   AXS1
 1826 31631 0000  BLT2,   0                       /SELECT DESTINATION DATA FIELD
 1827 31632 3416          DCA I   AXS2
 1828 31633 2237          ISZ     BLTC            /DONE?
 1829 31634 5227          JMP     BLT1            /NO
 1830 31635 0000  BLTF,   0                       /RETURN
 1831 31636 5602          JMP I   BLT0
 1832             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 43


 1833             
 1834             /TEST JOB FOR RUNNABILITY
 1835             /CALL   TAD JOB #
 1836             /       RUNABL
 1837             /       NOT RUNNABLE
 1838             /       RUNNABLE
 1839             
 1840             BLTC,
 1841 31637 0000  RUNTST, 0                       /COME HERE WITH JOB # IN AC
 1842 31640 1044          TAD     JOBTBA          /TO GET JOBTABLE ADDRESS
 1843 31641 4477          GETJTI                  /GET STR0
 1844 31642 0000          JOBSTS
 1845 31643 7500          SMA                     /RUN BIT ON?
 1846 31644 5266          JMP     RUNTS3          /NO
 1847 31645 6211          DATFLD                  /YES, SEE IF IT RAN AS A COMPUTE BOUND JOB LAST TIME
 1848 31646 0040          AND     C1000           /IS BIT 1000 ON SHOWING THAT IT WAS A COMPUTE BOUND JOB?
 1849 31647 7450          SNA                     /SNA
 1850 31650 5255          JMP     RUNTS2          /NO, IT MAY BE READY TO RUN - TEST FURTHER
 1851 31651 7040          CMA                     /LAST TIME IT WAS COMPUTE BOUND, SKIP THIS TURN
 1852 31652 0405          AND I   JOBSWA          /CLEAR THE BIT 1000, SO THAT IT WILL RUN NEXT TIME
 1853 31653 3405          DCA I   JOBSWA
 1854 31654 5264          JMP     RUNTS1          /RETURN BY NOT RUNNABLE EXIT
 1855 31655 2005  RUNTS2, ISZ     JOBSWA          /GET THE ADDRESS OF STR1
 1856 31656 1405          TAD I   JOBSWA
 1857 31657 2005          ISZ     JOBSWA
 1858 31660 2005          ISZ     JOBSWA          /POINT TO WAIT MASK 1
 1859 31661 0405          AND I   JOBSWA          /ANY STR1-MASK1 MATCHES?
 1860 31662 7640          SZA CLA
 1861 31663 2237          ISZ     RUNTST          /YES
 1862 31664 6201  RUNTS1, CDF                     /NO
 1863 31665 5637          JMP I   RUNTST
 1864 31666 0301  RUNTS3, AND     RC0147
 1865 31667 7450          SNA                     /FIP REQUEST STILL PENDING? OR ANY ERRORS SINCE HE STOPPED?
 1866 31670 5637          JMP I   RUNTST          /NONE
 1867 31671 0035          AND     C0007           /IS IT FOR FIP OR SI?
 1868 31672 7650          SNA CLA
 1869 31673 5263          JMP     RUNTS1-1        /FIP - LET HIM FINISH UP SO WE DON'T LOSE A FREE CORE BLOCK
 1870 31674 6211          DATFLD
 1871 31675 7152          CLL CMA RTR
 1872 31676 0405          AND I   JOBSWA          /CLEAR HIS ERROR ENABLE
 1873 31677 3405          DCA I   JOBSWA
 1874 31700 5263          JMP     RUNTS1-1        /ERROR - LET SI REPORT IT NOW
 1875             
 1876 31701 0147  RC0147, JSIOT JSIOTC UUOERF SWPRER SWPWER DSKERR HUNGDV
 1877 31702 0000  SIWAIT, 0
 1878             
 1879             
 1880 31703 1302  L2SI,   TAD     SIWAIT          /NUMBER OF SI COMMANDS IN "WAIT"
 1881 31704 1052          TAD     COMCNT          /PLUS NEW COMMANDS
 1882 31705 3052          DCA     COMCNT          /NOW THEY'RE ALL BACK ON-LINE
 1883 31706 3302          DCA     SIWAIT          /NONE NOW IN WAIT STATE
 1884 31707 5467          EXIT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 44


 1885             
 1886             /SET SYSTEM ERROR CODE
 1887             /CALL   TAD JOB #
 1888             /       JMS SYSERR
 1889             /       ERROR CODE
 1890             /       NORMAL RETURN
 1891             
 1892             
 1893 31710 0000  SYSERR, 0
 1894 31711 0036          AND     C0037           /JOB # ONLY
 1895 31712 7450          SNA                     /IS IT JOB 0?
 1896 31713 5332          JMP     SYSER1-1        /YES, RETURN
 1897 31714 1044          TAD     JOBTBA          /POINTER TO JOBTBL
 1898 31715 4477          GETJTI                  /GET CURRENT VALUE OF STR0
 1899 31716 0000          JOBSTS
 1900 31717 0035          AND     C0007           /EXTRACT ANY ERROR CODE IN THERE
 1901 31720 7640          SZA CLA                 /ANY OLD BITS?
 1902 31721 5333          JMP     SYSER1          /YES; DON'T CONFUSE THE ISSUE
 1903 31722 1710          TAD I   SYSERR          /GET THE ERROR CODE SUPPLIED
 1904 31723 6211          DATFLD
 1905 31724 1405          TAD I   JOBSWA          /ADD IT TO OLD VALUE OF STR0
 1906 31725 3405          DCA I   JOBSWA          /SAVE THE WHOLE MESS
 1907 31726 2005          ISZ     JOBSWA
 1908 31727 1005          TAD     JOBSWA          /POINTS TO STR1
 1909 31730 4460          IOR                     /SET THE "ERROR HAS OCCURRED" BIT IN STR1
 1910 31731 0002          JSERR
 1911 31732 6201          CDF
 1912 31733 2310  SYSER1, ISZ     SYSERR          /SKIP ARGUMENT IN CALL
 1913 31734 5710          JMP I   SYSERR          /RETURN
 1914             /SKIP IF DISK NOT ACTIVE
 1915             /CALL   TAD FIELD #
 1916             /       JMS DSKACT
 1917             /       ACTIVE
 1918             /       NOT ACTIVE
 1919             
 1920             DSUSTA,
 1921 31735 3247  DAUTBL, DSUTBL-1
 1922             
 1923 31736 0000  DSKACT, 0
 1924 31737 7106          CLL RTL                 /FIELD # *4 IS MAJOR INDEX IN DSUTBL
 1925 31740 1335          TAD     DAUTBL          /START OF TABLE -1
 1926 31741 3015          DCA     AXS1            /AUTO INDEX
 1927 31742 6211          DATFLD
 1928 31743 1415          TAD I   AXS1            /FILE 1 BUSY?
 1929 31744 1415          TAD I   AXS1            / "     2       "
 1930 31745 1415          TAD I   AXS1            / "     3       "
 1931 31746 1415          TAD I   AXS1            / "     4       "
 1932 31747 6201          CDF
 1933 31750 7650          SNA CLA                 /IF ANY ONE WAS BUSY, AC.NE.0
 1934 31751 2336          ISZ     DSKACT          /NO ACTIVITY; INDEX RETURN
 1935 31752 5736          JMP I   DSKACT          /AND OFF

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 45


 1936             
 1937             /START USER DISC REQUEST FROM QUEUE
 1938             /IF THIS ROUTINE IS CALLED, THERE HAD
 1939             /BETTER BE SOMETHING IN SQREQ OR DSUTBL
 1940             /FOR IT TO FIND. IT WON'T STOP LOOKING!
 1941             /CALL   JMS DSUSER
 1942             /       RETURN
 1943             
 1944 31753 0000  DSUSER, 0
 1945 31754 1053          TAD     SQREQ           /IS A SWAP REQUESTED?
 1946 31755 7640          SZA CLA
 1947 31756 5372          JMP     DSUSR5          /YES, DO IT FIRST
 1948 31757 6211          DATFLD
 1949 31760 1417  DSUSR4, TAD I   DSKPTR          /GET ENTRY FROM DSUTBL
 1950 31761 7450          SNA                     /IS IT A REQUEST?
 1951 31762 5360          JMP     DSUSR4          /NO - CHECK NEXT POSITION
 1952 31763 7040          CMA
 1953 31764 7450          SNA                     /END OF LIST?
 1954 31765 5374          JMP     DSUSR2          /YES
 1955 31766 7040          CMA                     /REAL REQUEST FLIP IT BACK AGAIN
 1956 31767 6201          CDF
 1957 31770 4475          DSGO                    /YES, START IT UP
 1958 31771 5753          JMP I   DSUSER          /AND BACK
 1959             DSUSR5,
 1960 31772 4557          JMS I   SWPIOA          /START A SWAP DISK I/O
 1961 31773 5753          JMP I   DSUSER          /RETURN BACK
 1962             
 1963             
 1964 31774 1335  DSUSR2, TAD     DSUSTA          /START OF DSU TABLE +7
 1965 31775 1035          TAD     C0007
 1966 31776 3017          DCA     DSKPTR
 1967 31777 5360          JMP     DSUSR4

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 46


 1968             
 1969       2000  *2000
 1970             
 1971             /KEYBOARD SERVICE
 1972             /ENTERED WHENEVER CHARACTER IS RECEIVED. --==-- HIGHEST PRIORITY ON LEVEL 2
 1973             
 1974       1000  BELL=1000
 1975 32000 0000  KLOST,  0       /NUMBER OF CHARACTERS LOST BECAUSE OF OVERFLOW SINCE THE SYSTEM WAS LAST STARTED
 1976 32001 1235  TYPEA,  TYPE
 1977 32002 0241  KEYB,   RINGIN                  /POINTER TO INPUT RING BUFFER
 1978 32003 7721  KEYCNT, -INPUTS
 1979 32004 7572  KEYA,   KEYC
 1980 32005 7721  KEYSIZ, -INPUTS                 /SIZE OF KEYBOARD INPUT RING BUFFER
 1981 32006 3502  CONIN,  DCA I   SETFLG          /CLEAR THE SCHEDULER REQUEST FLAG
 1982 32007 7240  CONIN3, STA
 1983 32010 6201          CDF
 1984 32011 6002          IOF
 1985 32012 1604          TAD I   KEYA
 1986 32013 7500          SMA                     /ARE WE FINISHED?
 1987 32014 5222          JMP     CONIN4          /NO
 1988 32015 6201  CONEXT, CDF
 1989 32016 0502          AND I   SETFLG          /DID WE AROUSE ANYONE?
 1990 32017 7640          SZA CLA
 1991 32020 5466          RSCHED                  /IF NULL JOB IS RUNNING WE MAY TERMINATE IT
 1992 32021 5467          EXIT
 1993             
 1994 32022 3604  CONIN4, DCA I   KEYA            /DECREMENTED COUNT
 1995 32023 1604          TAD I   KEYA            /CHECK FOR OVERFLOW
 1996 32024 1205          TAD     KEYSIZ
 1997 32025 7740          SMA SZA CLA
 1998 32026 5272          JMP     CONIN0          /OVERFLOW - SKIP AROUND TO THE FIRST ENTRY
 1999 32027 6211          DATFLD
 2000 32030 1602          TAD I   KEYB            /GRAB A CHARACTER FROM THE RING BUFFER
 2001 32031 3031          DCA     TTCHAR
 2002 32032 2202          ISZ     KEYB
 2003 32033 6001          ION
 2004 32034 1602          TAD I   KEYB            /LINE NUMBER
 2005 32035 7510          SPA
 2006 32036 5306          JMP     HIPTR           /HIGH SPEED READER
 2007 32037 7104          CLL RAL                 /TIMES 2
 2008 32040 1163          TAD     DEVTBA
 2009 32041 3257          DCA     CONINA          /POSITION IN DEVICE TABLE
 2010 32042 1657          TAD I   CONINA
 2011 32043 7640          SZA CLA
 2012 32044 5255          JMP     CONIN1
 2013 32045 1257          TAD     CONINA          /NO DDB SETUP YET
 2014 32046 6201          CDF
 2015 32047 4571          GETBLK                  /ESTABLISH A PSEUDO DDB FOR THE TIME BEING
 2016 32050 5275          JMP     CONIN2          /NONE AVAILABLE - DON'T BOTHER WITH BELLS
 2017 32051 6211          DATFLD
 2018 32052 1657          TAD I   CONINA
 2019 32053 4460          IOR
 2020 32054 1000          DSI                     /SET NEW CONSOLE IN SI MODE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 47


 2021             
 2022 32055 6201  CONIN1, CDF
 2023 32056 4471          KEY                     /PROCESS THIS CHARACTER
 2024 32057 0000  CONINA, .-.
 2025 32060 7410          SKP                     /NO ROOM - RING BELL
 2026 32061 5275          JMP     CONIN2
 2027 32062 6211          DATFLD
 2028 32063 1532          TAD I   CONDBA          /POINTS TO OUTPUT SIDE
 2029 32064 7450          SNA
 2030 32065 5275          JMP     CONIN2          /NO DDB DON'T BOTHER WITH BELLS
 2031 32066 4460          IOR
 2032 32067 1000          BELL                    /RING-A-DING TOO BAD!!
 2033 32070 4601          JMS I   TYPEA           /REMEMBER WE WANT TO RING HIS/HER CHIME
 2034 32071 5275          JMP     CONIN2
 2035 32072 2200  CONIN0, ISZ     KLOST           /COUNT A LOST CHARACTER
 2036 32073 0241  KEYBA,  RINGIN                  /NOP
 2037 32074 2202          ISZ     KEYB
 2038 32075 2202  CONIN2, ISZ     KEYB
 2039 32076 2203          ISZ     KEYCNT          /END OF RING BUFFER?
 2040 32077 5207          JMP     CONIN3          /NO
 2041 32100 1273          TAD     KEYBA
 2042 32101 3202          DCA     KEYB            /RESET POINTER
 2043 32102 1205          TAD     KEYSIZ
 2044 32103 3203          DCA     KEYCNT          /AND THE COUNT
 2045 32104 5207          JMP     CONIN3
 2046             
 2047 32105 3042  PTRPTR, DEVTBE
 2048 32106 0705  HIPTR,  AND I   PTRPTR          /GET DDB ADDRESS OF PTR
 2049 32107 7450          SNA
 2050 32110 5275          JMP     CONIN2          /OOPS - HE RELEASED IT
 2051 32111 4575          STORE                   /STASH ITS CHARACTER AWAY
 2052 32112 1064          PTRSIZ                  /SIZE CHECK ROUTINE
 2053 32113 7410          SKP
 2054 32114 5275          JMP     CONIN2          /ALL IS WELL
 2055 32115 6201          CDF                     /OOPS! - RAN OUT OF FREE CORE
 2056 32116 6002          IOF
 2057 32117 2604          ISZ I   KEYA            /UN-COUNT THE CHARACTER
 2058 32120 7240          STA
 2059 32121 1202          TAD     KEYB
 2060 32122 3202          DCA     KEYB            /BACK UP THE RING BUFFER POINTER
 2061 32123 5724          JMP I   .+1             /AND BACK TO THE REMAINDER OF L2 SERVICE
 2062 32124 1521          L2EX0                   /JUST PAST THE HI-PRIORITY CHECK POINT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 48


 2063             
 2064             /CHECK DEVICE ASSIGNMENT AND ASSIGN IF AVAILABLE
 2065             /CALLING SEQUENCE:
 2066             /       JMS     DEVCHK
 2067             /       DEVTBL ADDRESS FOR THE DESIRED DEVICE
 2068             /       RETURN - IF OK TO USE
 2069             /                IF NOT OK THE RETURN IS THROUGH "UUOERR"
 2070 32125 0000  DEVCHK, 0
 2071 32126 1725          TAD I   DEVCHK          /GET DEVTBL POINTER
 2072 32127 2325          ISZ     DEVCHK          /INDEX PAST PARAMETER
 2073 32130 3150          DCA     WS2             /DEVTBL ADDRESS
 2074 32131 6214          RDF                     /THE FIELD FROM WHERE WE CAME
 2075 32132 1144          TAD     C6203
 2076 32133 3356          DCA     DEVEXT
 2077 32134 6211          DATFLD
 2078 32135 1550          TAD I   WS2             /DDB ADDRESS
 2079 32136 7440          SZA                     /IN USE?
 2080 32137 5360          JMP     DEVCH1          /YES
 2081 32140 1150          TAD     WS2
 2082 32141 6201          CDF
 2083 32142 4572          GETDDB                  /GET DATA BLOCK
 2084 32143 5470          REDO
 2085 32144 6211          DATFLD
 2086 32145 1550          TAD I   WS2             /ADDRESS OF DDB
 2087 32146 3004          DCA     WS1
 2088 32147 1150          TAD     WS2             /DEVTBE+UNIT#
 2089 32150 1370          TAD     DEVCH0          /-DEVTBE
 2090             
 2091 32151 3404          DCA I   WS1             /SAVE IN WORD 0 OF DDB
 2092 32152 2004          ISZ     WS1             /POINTS TO JOB # IN DDB
 2093 32153 1160          TAD     JOB
 2094 32154 0036          AND     C0037
 2095 32155 3404          DCA I   WS1             /SAVE OWNER JOB
 2096 32156 0000  DEVEXT, 0
 2097 32157 5725          JMP I   DEVCHK          /RETURN
 2098             
 2099 32160 3015  DEVCH1, DCA     AXS1            /NOW POINTS TO WORD 0 OF DDB
 2100 32161 1160          TAD     JOB
 2101 32162 7041          CIA
 2102 32163 1415          TAD I   AXS1            /DOES THIS JOB OWN DEVICE?
 2103 32164 7650          SNA CLA
 2104 32165 5356          JMP     DEVEXT
 2105 32166 5767          JMP I   .+1
 2106 32167 5144          UUOERR
 2107 32170 4736  DEVCH0, -DEVTBE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 49


 2108             
 2109             
 2110             
 2111       0003  UUOCAL=WS0
 2112       0004  UUOADD=WS1
 2113             
 2114             / SAVE MACHINE STATUS WHEN USER EXECUTES IOT
 2115             /WE MUST CHECK USER IOT FLAG BEFORE ANYTHING ELSE, EVEN CLOCK FLAG
 2116             /IF WE DON'T, AND CLOCK INTERRUPTS WITHIN 8 MICROSECONDS AFTER USER
 2117             /EXECUTES IOT, THEN WE WOULD TRIP ON CLOCK FLAG, AND NOT BE ABLE TO
 2118             /FIGURE OUT WHAT IOT THE USER EXECUTED.
 2119             
 2120 32171 3106  UUO0,   DCA     L2SA            /WE MUST HAVE BEEN IN USER MODE WHEN INTERRUPT OCCURRED!
 2121 32172 7010          RAR                     /SAVE LINK
 2122 32173 3105          DCA     L2SVLK
 2123 32174 1000          TAD     0
 2124 32175 3104          DCA     L2SV0           /SAVE PC
 2125 32176 6234          RIB
 2126 32177 3103          DCA     L2SF            /SAVE FIELDS AND MODE
 2127 32200 6204          CINT                    /CLEAR FLAG
 2128 32201 6001          ION
 2129 32202 7240          STA
 2130 32203 1104          TAD     L2SV0           /BACK UP USER PC TO POINT TO IOT IN QUESTION
 2131 32204 3004          DCA     UUOADD
 2132 32205 4150          UDF                     /SELECT USER DATA FIELD
 2133 32206 1404          TAD I   UUOADD          /GET THE IOT THAT CAUSED ENTRY HERE
 2134 32207 3003          DCA     UUOCAL
 2135 32210 6201          CDF
 2136 32211 1302          TAD     UUOTBA          /START SCANNING THE IOT TABLE
 2137 32212 3015          DCA     AXS1
 2138 32213 1003          TAD     UUOCAL
 2139 32214 0041          AND     C7770           /GET DEVICE CODE
 2140 32215 7041          CIA
 2141 32216 3346          DCA     UUOC77          /SAVE-CODE
 2142 32217 4270          JMS     UUOSR           /FIRST SEE IF IT IS MICRO-CODED
 2143 32220 5232          JMP     UUO22
 2144 32221 1015  UUO3,   TAD     AXS1            /YES, NOW COMPUTE ADDRESS OF SERVICE ROUTINE
 2145 32222 1303          TAD     UUOTLL          /OFFSET BETWEEN IOT TABLE AND DISPATCH TABLE
 2146 32223 3346          DCA     UUOC77          /POINTS TO DISPATCH ENTRY
 2147 32224 1746          TAD I   UUOC77          /GET DISPATCH ADDRESS
 2148 32225 3346          DCA     UUOC77          /SAVE IT
 2149 32226 5746          JMP I   UUOC77          /AND JUMP TO IT
 2150 32227 4270  UUO7,   JMS     UUOSR           /CHECK FOR NON-RESIDENT IOTS WHICH RETURN ARGUMENTS
 2151 32230 5461          UUOEXT                  /UNDEFINED
 2152 32231 5251          JMP     UUO8            /FIND # OF ARGUMENTS TO SEND TO FIP

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 50


 2153             
 2154 32232 1003  UUO22,  TAD     UUOCAL          /IS IT AN IOT AT ALL?
 2155 32233 0040          AND     C1000
 2156 32234 7640          SZA CLA
 2157 32235 5701          JMP I   UHALTA          /IT'S A HLT, OSR, OR SOME COMBINATION
 2158 32236 1003          TAD     UUOCAL          /IT'S NOT MICROCODED
 2159 32237 7041          CIA
 2160 32240 3346          DCA     UUOC77          /-IOT CAUSING INTERRUPT
 2161 32241 4270          JMS     UUOSR           /CHECK FOR NON-MICRO-CODED RESIDENT IOTS
 2162 32242 7410          SKP
 2163 32243 5221          JMP     UUO3            /FOUND ONE; NOW GO GET DISPATCH ADDRESS AND AWAY---
 2164 32244 4270          JMS     UUOSR           /SEARCH FOR SHORT NON-RESIDENT IOTS
 2165 32245 5227          JMP     UUO7
 2166 32246 1003  UUO6,   TAD     UUOCAL          /THROW AWAY BITS 0-2 OF IOT
 2167 32247 0140          AND     C0377
 2168 32250 3003          DCA     UUOCAL          /AND SAVE IT
 2169 32251 1015  UUO8,   TAD     AXS1            /NOW FIND NUMBER OF ARGUMENTS
 2170 32252 1303          TAD     UUOTLL          /THIS POINTS TO # IN UUOTBL
 2171 32253 4305          JMS     GETUSP          /GET USER PARAMENTERS
 2172 32254 1161  UFILE4, TAD     CJOBDA          /GET POINTER TO STR0
 2173 32255 4574          GETJTA
 2174 32256 0000          JOBSTS
 2175 32257 6211          DATFLD                  /OR IN "NON-RESIDENT IOT" BIT
 2176 32260 4460          IOR                     /SO FIP WILL RUN IN PLACE OF THIS JOB
 2177 32261 0100          JSIOT
 2178 32262 1155          TAD     FIPJOB          /ANYTHING CURRENTLY SCHEDULED?
 2179 32263 7640          SZA CLA
 2180 32264 5577          WAIT                    /YES - FIP WILL PICK US UP LATER
 2181 32265 1160          TAD     JOB
 2182 32266 3155          DCA     FIPJOB          /SO THE SCHEDULER WILL TAKE US AS SOON AS POSSIBLE
 2183 32267 5577          WAIT                    /AND WAIT FOR FIP
 2184             
 2185 32270 0000  UUOSR,  0                       /SEARCH FOR MATCH
 2186 32271 1415          TAD I   AXS1            /GET ENTRY FROM TABLE
 2187 32272 7450          SNA                     /LAST ENTRY?
 2188 32273 5670          JMP I   UUOSR           /YES, RETURN
 2189 32274 1346          TAD     UUOC77          /NO, CHECK FOR MATCH
 2190 32275 7640          SZA CLA                 /MATCH?
 2191 32276 5271          JMP     .-5             /NO, KEEP GOING
 2192 32277 2270          ISZ     UUOSR           /YES, SKIP
 2193 32300 5670          JMP I   UUOSR           /AND RETURN
 2194             
 2195 32301 4060  UHALTA, UHALT
 2196 32302 7027  UUOTBA, UUOTBL-1
 2197 32303 0071  UUOTLL, UUODTB-UUOTBL

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 51


 2198             
 2199             /THIS ROUTINE COPIES THE PARAMETERS SUPPLIED BY THE
 2200             /USER PROGRAM INTO *BLOCK IN FREE CORE, WHICH IS POINTED
 2201             /TO BY JOBLNK.
 2202             /THE IOT ITSELF IS SAVED IN THE FIRST WORD OF THE PARAMETER BLOCK
 2203             /IF NO ARGUMENTS ARE REQUIRED, JOBLNK CONTAINS THE IOT,
 2204             /RATHER THAN A POINTER TO THE IOT PARAMETER BLOCK.
 2205             /FIP CAN TELL BY EXAMINING BITS 0-3 OF JOBLNK; IF THEY ARE
 2206             /NON-ZERO, JOBLNK IS AN ADDRESS; IF ZERO, JOBLNK IS THE IOT ITSELF.
 2207             /NOW YOU KNOW WHY THE START OF THE FREE CORE LIST MUST ALWAYS BE
 2208             /ON OR AFTER 400 OCTAL IN FIELD ONE?
 2209             
 2210 32304 1736  UUODAC, DSKACT
 2211             
 2212 32305 0000  GETUSP, 0                       /ENTER WITH PTR -# ARGUEMTS TO GET
 2213 32306 3346          DCA     UUOC77          /SAVE IT
 2214 32307 6201          CDF
 2215 32310 1161          TAD     CJOBDA          /OK - NOW GET PTR TO JOBLNK
 2216 32311 4574          GETJTA
 2217 32312 0007          JOBLNK
 2218 32313 3345          DCA     UUOLNK          /AND SAVE IT
 2219 32314 1746          TAD I   UUOC77
 2220 32315 7450          SNA                     /ANY ARGUMENTS?
 2221 32316 5347          JMP     GETUS1          /NO - JUST SAVE IOT IN JOBLNK
 2222 32317 6201          CDF
 2223 32320 3346          DCA     UUOC77          /YES. SAVE # ARGUMENTS
 2224 32321 7344          CLL CLA CMA RAL         /CAN WE GET PARAMETER BLOCKS?
 2225 32322 1047          TAD     FRECNT
 2226 32323 7750          SPA SNA CLA
 2227 32324 5470          REDO                    /NO - TRY LATER
 2228 32325 1345          TAD     UUOLNK          /PUT ADDRESS OF LINKAGE BLOCK IN UUOLNK
 2229 32326 4571          GETBLK                  /GET A FREE BLOCK
 2230 32327 7402          HLT                     /WHAT? "FRECNT" SAID THERE WERE PLENTY!!
 2231 32330 6211          DATFLD
 2232 32331 1745          TAD I   UUOLNK          /GET ADDRESS OF PARAMETER BLOCK
 2233 32332 6201          CDF
 2234 32333 3345          DCA     UUOLNK          /SAVE IT IN BLT CALLING SEQUENCE
 2235 32334 7240          STA                     /GET POINTER TO USER PARAMETERS-1
 2236 32335 1106          TAD     L2SA
 2237 32336 3343          DCA     UUSRC           /SAVE FOR BLT CALL
 2238 32337 1151          TAD     UUDF            /MOVE USER PARAMETERS TO LINKAGE AREA IN DATFLD
 2239 32340 3342          DCA     .+2
 2240 32341 4567          BLT
 2241 32342 0000          0                       /SOURCE FIELD SELECT
 2242 32343 0000  UUSRC,  0                       /SOURCE ADDRESS
 2243 32344 6211          DATFLD                  /DESTINATION FIELD SELECT
 2244 32345 0000  UUOLNK, 0                       /DESTINATION ADDRESS
 2245 32346 0000  UUOC77, 0                       /-#WORDS
 2246 32347 1003  GETUS1, TAD     UUOCAL          /NOW GET IOT
 2247 32350 6211          DATFLD
 2248 32351 3745          DCA I   UUOLNK          /AND SAVE IT IN APPROPRIATE PLACE
 2249 32352 6201          CDF
 2250 32353 5705          JMP I   GETUSP          /RETURN

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 52


 2251             
 2252             /STASH LEVEL 2 REQUESTS FROM FIELD 1
 2253             
 2254             
 2255 32354 0000  QUEUE0, 0
 2256 32355 3413          DCA I   L2Q             /QUEUE REQUEST FROM FIELD 1
 2257 32356 6213          CIF     DATFLD
 2258 32357 5754          JMP I   QUEUE0          /AND BACK
 2259             
 2260             L2689,
 2261             IFNZRO D689 <
 2262                     CIF     DATFLD
 2263                     JMP I   .+1             /TO FIELD 1 689 CARRIER SERVICE
 2264                     DFCARR  >
 2265             IFNZRO DC08A <*2364
 2266             T8OUT,  CLA                     /DC08A CODE CALLED FROM "CONOUT"
 2267                     TAD     T8OBF2          /FIND ACTIVE OUTPUT REGISTER
 2268                     TAD     WS0
 2269                     DCA     UUOSR
 2270                     TAD     TTCHAR          /CHARACTER TO BE OUTPUT
 2271                     CLL RAL
 2272                     TAD     T8STOP
 2273                     DCA I   UUOSR           /STASH IT COMPLETE WITH STOP & START BITS
 2274                     JMP I   .+1
 2275                     CONTLS+1
 2276             T8OBF2, SKPTBL-OUTREG+1
 2277             T8STOP, 3000    >
 2278       2360  IFNZRO CPU&7776 <*2360
 2279 32360 0212  KLEN,   SKPTBL-1
 2280 32361 0212  KDEV,   SKPTBL-1
 2281 32362 7200  TIMER4, CLA
 2282 32363 1361          TAD     KDEV            /END OF LIST; RE-SET THE POINTER
 2283 32364 3360          DCA     KLEN
 2284       32365  L2TIME=.
 2285 32365 2360          ISZ     KLEN            /MAKE SURE THAT THE KL8E'S STAY ENABLED
 2286 32366 6211          DATFLD
 2287 32367 1760          TAD I   KLEN
 2288 32370 6201          CDF
 2289 32371 7500          SMA
 2290 32372 5362          JMP     TIMER4          /END OF LIST, RESET POINTER FOR NEXT TIME
 2291 32373 1034          TAD     C0004           /CONSTRUCT A "KIE"
 2292 32374 3376          DCA     .+2
 2293 32375 7001          IAC
 2294 32376 0000          .-.
 2295 32377 7200          CLA     >

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 53


 2296             
 2297       2400  *2400
 2298             IFZERO CPU&7776 <L2TIME=.>
 2299 32400 2051  L2TIM2, ISZ     CLK1            /UPDATE LOW ORDER DAY CLOCK
 2300 32401 5211          JMP     L2TIM3          /NOTHING UNUSUAL
 2301 32402 2050          ISZ     CLK2            /UPDATE HIGH ORDER TIME. WOW!
 2302 32403 5211          JMP     L2TIM3
 2303 32404 2166          ISZ     DATE            /WOULD YOU BELIEVE IT'S MIDNIGHT!
 2304 32405 1336          TAD     ICLK2           /REINITIALIZE THE CLOCK FOR ANOTHER
 2305 32406 3050          DCA     CLK2            /24 HOURS WORTH OF TICKS
 2306 32407 1335          TAD     ICLK1           /AND BUMP THE DATE ONE
 2307 32410 3051          DCA     CLK1            /(EVERY MONTH HAS 31 DAYS FOR OUR PDP-8)
 2308 32411 6213  L2TIM3, CIF DATFLD              /DECREMENT TIMERS
 2309 32412 4737          JMS I   TIMERA          /ROUTINE TO RUN TIMERS
 2310 32413 7773  TIMCON, -5                      /TIMES OUT EVERY FIVE SECONDS
 2311 32414 1506          L2OUT                   /SCHEDULE "CONOUT-TIMER" SERVICE
 2312 32415 0000  TIMPTR, 0                       /NON-ZERO IF BUSY
 2313 32416 1112          L2PTR                   /WHERE TO GO WHEN READER HANGS
 2314 32417 0000  TIMCDR, 0                       /NON-ZERO IF BUSY
 2315 32420 2544          L2CDR                   /WHERE TO GO IF THE CARD READER HANGS
 2316 32421 0000  TIMSI,  0                       /NON-ZERO WHEN SI IS IN THE WAIT STATE
 2317 32422 1703          L2SI                    /WHERE TO GO WHEN IT TIMES OUT
 2318 32423 0000  TIMFIP, 0                       /NON-ZERO IF "FIPLOCK" IS ON
 2319 32424 5375          L2FIP                   /WHERE TO GO TO TURN "FIPLOCK" OFF
 2320 32425 0000  TIM689, 0                       /NON-ZERO IF ACTIVE
 2321 32426 2360          L2689                   /WHERE TO GO TO CHECK CARRIER STATUS
 2322 32427 2043  TIMER3, ISZ     JOBTIM
 2323 32430 7000          NOP
 2324 32431 6202          CIF                     /INHIBIT INTERRUPTS WHILE WE UN-BUMP THE CLOCK
 2325 32432 7340          CLL STA
 2326 32433 1110          TAD     CLOCK
 2327 32434 3110          DCA     CLOCK
 2328 32435 7430          SZL                     /HAVE WE COUNTED ALL THE SCHEDULED SYSTEM TICKS?
 2329 32436 5200          JMP     L2TIM2          /NO

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 54


 2330             
 2331             /"RSCHED" IS ENTERED AT THIS POINT
 2332             /RSCHED'S FUNCTION IS TO FIND JOBS TO RUN, REGARDLESS
 2333             /OF WHERE THEY MAY CURRENTLY RESIDE. IF THEY ARE IN CORE,
 2334             /GOOD; IF NOT, THE NECESSARY STEPS WILL BE TAKEN TO
 2335             /BRING THEM INTO CORE. IN THE LATTER CASE, WE WILL THEN
 2336             /GO OFF AND FIND SOMETHING TO DO WHILE THE NON-RESIDENT
 2337             /JOB IS MADE RESIDENT.
 2338             
 2339 32437 1160  SCHED0, TAD     JOB             /GET CURRENT JOB
 2340 32440 0142          AND     C0600
 2341 32441 7640          SZA CLA
 2342 32442 5467          EXIT                    /?? - DON'T BUMP OFF A PHANTOM!
 2343 32443 1112          TAD     SCHNEW          /IS THIS SOMETHING THAT CAN BE BUMPED OFF?
 2344 32444 7450          SNA
 2345 32445 5251          JMP     SCHE12          /YES - GET RID OF HIM/HER
 2346 32446 1043          TAD     JOBTIM          /HAS HE USED A FULL TIME SLICE YET?
 2347 32447 7750          SPA SNA CLA
 2348 32450 5467          EXIT                    /NO, GO BACK TO HIM/HER
 2349 32451 6001  SCHE12, ION
 2350 32452 4472          SAVJOB                  /YES. SAVE ITS STATE. SET JOB=0
 2351 32453 7240          STA
 2352 32454 3112          DCA     SCHNEW          /SET FOR FULL TIME SLICES
 2353 32455 1147          TAD     CURJOB          /DID FILE TRANSFER PROCESSING CUT INTO SOMEONE'S TIME SLICE?
 2354 32456 7440          SZA
 2355 32457 5331          JMP     SCHEI6          /YES - START IT BACK UP
 2356 32460 1340          TAD     NXTMAX
 2357 32461 3741          DCA I   NXTJCA          /NUMBER OF JOBS TO CONSIDER
 2358 32462 1053          TAD     SQREQ           /SWAP REQUEST IN PROGRESS?
 2359 32463 7650          SNA CLA                 /IF SO, THERE IS NO POINT IN GOING FURTHER NOW.
 2360 32464 5375          JMP     SCHED1          /NO - PROCEED

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 55


 2361             
 2362             /SCHEDULE NEXT RESIDENT JOB
 2363             /THIS IS THE ENTRY FOR "SCHED"
 2364             /WE ONLY COME HERE IF A SWAP IS IN PROGRESS
 2365             /OR IF WE FIND THE JOB WE REALLY
 2366             /WANT TO RUN IS CURRENTLY INDISPOSED TO RUNNING. SCHED
 2367             /WILL FIND SOME RESIDENT JOB TO RUN. IF NO JOB IS
 2368             /RUNNABLE OR RESIDENT, JOB 0 (THE NULL JOB) IS RUN.
 2369             
 2370 32465 1042  SCHEDI, TAD     FANCOR          /CHECK FOR PHANTOMS FIRST SO
 2371 32466 3003          DCA     WS0             /START AT FIELD 2
 2372 32467 1742          TAD I   SCHMUC          /NUMBER OF USER CORE FIELDS TO CONSIDER
 2373 32470 7104          CLL RAL                 /TIMES 2
 2374 32471 3743          DCA I   NXTCNA          /ON THE SECOND PASS WE MAY PICK UP A COMPUTE-BOUND JOB
 2375 32472 1742          TAD I   SCHMUC          /NUMBER OF FIELDS
 2376 32473 3004          DCA     WS1
 2377 32474 1403  SCHEI3, TAD I   WS0
 2378 32475 0040          AND     C1000           /CHECK FOR "NOTRUN"
 2379 32476 7440          SZA
 2380 32477 5304          JMP     SCHEI4          /WE FOUND ONE
 2381 32500 2003          ISZ     WS0
 2382 32501 2004          ISZ     WS1
 2383 32502 5274          JMP     SCHEI3          /TRY AGAIN
 2384 32503 5734          JMP I   SCHNXT          /LOOK FOR SOMEONE TO RUN ON BORROWED TIME
 2385             
 2386 32504 7040  SCHEI4, CMA
 2387 32505 0403          AND I   WS0             /REMOVE THE "NOTRUN" BIT
 2388 32506 3403          DCA I   WS0
 2389 32507 1403          TAD I   WS0
 2390 32510 0142          AND     C0600           /IS IT A PHANTOM?
 2391 32511 7640          SZA CLA
 2392 32512 5317          JMP     SCHEI5          /YES - THEN IT MUST BE READY TO EXECUTE
 2393 32513 1403          TAD I   WS0
 2394 32514 0036          AND     C0037
 2395 32515 4501          RUNABL                  /IS IT RUNNABLE?
 2396 32516 5300          JMP     SCHEI3+4        /NO
 2397 32517 1403  SCHEI5, TAD I   WS0             /YES - IT MUST BE RUNNABLE
 2398 32520 3003  SCHEI2, DCA     SCHNJN          /IS JOB IN CORE?
 2399 32521 1003          TAD     SCHNJN          /SEARCH CORTBL FOR HIM/HER
 2400 32522 4570          CORE
 2401 32523 6637          SWAP LOCK FIP SI CJOB
 2402 32524 5465          SCHED                   /NOT THERE; HAVE TO SWAP HIM/HER IN LATER
 2403 32525 3103          DCA     L2SF            /YES - SET UP SAVE FIELD
 2404 32526 1003          TAD     SCHNJN          /RESTORE REST OF LEVEL 2 REGISTERS
 2405 32527 4473          RESJOB
 2406 32530 5474          START                   /START JOB
 2407             
 2408 32531 3003  SCHEI6, DCA     SCHNJN          /SAVE JOB NUMBER
 2409 32532 3147          DCA     CURJOB          /CLEAR "REMEMBERED" JOB
 2410 32533 5321          JMP     SCHEI2+1        /NOW GO START HIM/HER BACK UP

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 56


 2411             
 2412 32534 4000  SCHNXT, NXTCO1
 2413 32535 0400  ICLK1,  -INCLK1
 2414 32536 7455  ICLK2,  -INCLK2-1
 2415       0003  SCHNJN=WS0
 2416       0002  SCHSI=C0200
 2417 32537 2200  TIMERA, TIMER0
 2418 32540 7753  NXTMAX, -JOBMAX-1
 2419 32541 4600  NXTJCA, NXTJCT
 2420 32542 1315  SCHMUC, CORCNT
 2421 32543 4072  NXTCNA, NXTCNT
 2422 32544 6211  L2CDR,  DATFLD
 2423 32545 1762          TAD I   UUCDR1
 2424 32546 3015          DCA     AXS1
 2425 32547 1415          TAD I   AXS1
 2426 32550 6201          CDF
 2427 32551 4463          ERROR                   /PASS HUNG DEVICE ERROR TO THE USER
 2428 32552 0006          HUNGDV
 2429 32553 6212  CDL20,  CIF DATFLD-1
 2430 32554 5755          JMP I   .+1
 2431 32555 1705          CDL21
 2432 32556 7001  UUCDR0, IAC
 2433 32557 7001          IAC
 2434 32560 3003          DCA     UUOCAL          /SAVE THE IOT INDICATOR
 2435 32561 4767          JMS I   CDRCHK          /SEE IF IT'S OK FOR HIM/HER TO USE THE CARD READER
 2436 32562 3046  UUCDR1, DEVTBE+4
 2437 32563 1003          TAD     UUOCAL          /ALL IS WELL
 2438 32564 6212          CIF DATFLD-1
 2439 32565 5766          JMP I   .+1             /OFF TO THE CARD READER HANDLER
 2440 32566 1736          UUCDR
 2441 32567 2125  CDRCHK, DEVCHK
 2442 32570 7240  REDO0,  STA                     /IF WE CAN'T FINISH AN IOT FOR LACK OF SYSTEM
 2443 32571 1104          TAD     L2SV0           /FACILITIES, WE BACK UP THE USER'S PC TO POINT
 2444 32572 3104          DCA     L2SV0           /TO THE SAME IOT AND HOPE THAT LATER ON THINGS WILL LOOSEN UP.
 2445 32573 6201  WSCHED, CDF                     /THE USER PROGRAM IS TO GO INTO A WAIT
 2446 32574 5251          JMP     SCHE12

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 57


 2447             
 2448             
 2449             
 2450 32575 1055  SCHED1, TAD     FIT             /SOMETHING LEFT FROM LAST PASS THROUGH SCHEDULER?
 2451 32576 0036          AND     C0037           /JOB ONLY
 2452 32577 7440          SZA
 2453 32600 5211          JMP     SCHED4          /YES
 2454 32601 1052          TAD     COMCNT          /SI REQUESTED?
 2455 32602 7650          SNA CLA
 2456 32603 5206          JMP     SCHED6          /NO
 2457 32604 1002          TAD     SCHSI
 2458 32605 5240          JMP     SCHED8          /YES - SCHEDULE IT
 2459 32606 1155  SCHED6, TAD     FIPJOB          /SOMETHING WAITING FOR FIP?
 2460 32607 7450          SNA
 2461 32610 5216          JMP     SCHE13          /NO SPECIFIC JOB
 2462 32611 3055  SCHED4, DCA     FIT             /SAVE IT
 2463 32612 1055          TAD     FIT
 2464 32613 4501          RUNABL                  /IS IT STILL GOOD?
 2465 32614 7410          SKP                     /NO
 2466 32615 5221          JMP     SCHED5          /YES - CHECK IT OUT
 2467 32616 4670  SCHE13, JMS I   SCHNXA          /GET NEXT RUNNABLE JOB
 2468 32617 3055          DCA     FIT             /SAVE JOB #
 2469 32620 3057          DCA     BONUS           /BONUS JOB ALREADY PICKED UP
 2470 32621 1055  SCHED5, TAD     FIT
 2471 32622 1044          TAD     JOBTBA
 2472 32623 4477          GETJTI                  /GET CONTENTS OF STR0
 2473 32624 0000          JOBSTS
 2474 32625 7006          RTL                     /PUT ERROR ENABLE IN THE LINK
 2475 32626 0156          AND     SCFIP           /NEED FIP?
 2476 32627 7440          SZA
 2477 32630 5237          JMP     SCHED7          /YES; SCHEDULE FIP FOR HIM/HER
 2478 32631 6211          DATFLD
 2479 32632 1405          TAD I   JOBSWA          /GET STR0 AGAIN
 2480 32633 6201          CDF
 2481 32634 0035          AND     C0007           /ANY ERROR BITS ON?
 2482 32635 7660          SZA SNL CLA             /EVEN IF THERE ARE WE'LL LET HIM/HER HANDLE IT IF HE'S ENABLED (LINK=1)
 2483 32636 1002          TAD     SCHSI           /CALL SI TO HANDLE ERROR
 2484 32637 1055  SCHED7, TAD     FIT             /UPDATE "FIT" IF THERE'S A NEED FOR FIP OR SI
 2485 32640 3055  SCHED8, DCA     FIT
 2486 32641 1055          TAD     FIT
 2487 32642 0142  SCHED3, AND     C0600           /IS FIT JOB FIP OR SI?
 2488 32643 7650          SNA CLA
 2489 32644 5374          JMP     SCHE11          /NO
 2490 32645 1442          TAD I   FANCOR          /IS FIP OR SI IN CORE?
 2491 32646 0055          AND     FIT             /IS IT THE PROPER PHANTOM?
 2492 32647 0142          AND     C0600
 2493 32650 7650          SNA CLA
 2494 32651 5272          JMP     SCHE15          /NO - SCHEDULE THEIR SWAP IN
 2495 32652 1442          TAD I   FANCOR          /YES - IS THE PHANTOM IN USE?
 2496 32653 0036          AND     C0037           /JOB #
 2497 32654 7640          SZA CLA
 2498 32655 5261          JMP     SCHED9          /YES - NOT MUCH TO DO NOW
 2499 32656 7332          SCLOCK                  /LOCK PHANTOM FOR THIS JOB
 2500 32657 1055          TAD     FIT             /NO - LOCK PHANTOM FOR THIS USER
 2501 32660 3442          DCA I   FANCOR          /INDICATE THAT THIS FIELD IS NOW LOCKED

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 58


 2502             
 2503 32661 3055  SCHED9, DCA     FIT             /CLEAR FIT
 2504 32662 7326          FANFLD                  /DISK ACTIVITY HERE?
 2505 32663 4671          JMS I   SCDACT
 2506 32664 5216          JMP     SCHE13          /YES - FORGET ABOUT PHANTOM FOR NOW
 2507 32665 1442          TAD I   FANCOR          /NO
 2508 32666 5667          JMP I   .+1             /NOW GO FINISH BOOKKEEPING
 2509 32667 2520          SCHEI2
 2510             
 2511 32670 4603  SCHNXA, NXTJOB
 2512       0156  SCFIP=  C0400                   /FIP
 2513       7332  SCLOCK= CLA CLL CML RTR         /LOCK BIT AC=2000
 2514 32671 1736  SCDACT, DSKACT
 2515       7326  FANFLD= CLA STL RTL             /PHANTOMS ALWAYS RUN IN FIELD 2
 2516             
 2517 32672 1442  SCHE15, TAD I   FANCOR          /FANFLD LOCKED, SWAPPED, OR NOTRUN?
 2518 32673 0162          AND     C7000
 2519 32674 7640          SZA CLA
 2520 32675 5216          JMP     SCHE13          /YES - GO FIND SOMETHING ELSE TO DO NOW
 2521 32676 1442          TAD I   FANCOR          /IS THERE CURRENTLY A USER JOB IN FANFLD?
 2522 32677 0036          AND     C0037           /IS THERE A USER JOB IN FANFLD?
 2523 32700 7640          SZA CLA
 2524 32701 5304          JMP     SCHE16          /YES, FORCE IT OUT
 2525 32702 7326          FANFLD                  /NO; FINISH:=FANFLD
 2526 32703 5327          JMP     SCHE14
 2527             
 2528 32704 1442  SCHE16, TAD I   FANCOR          /IS A PHANTOM IN HERE?
 2529 32705 0142          AND     C0600
 2530 32706 7640          SZA CLA
 2531 32707 5216          JMP     SCHE13          /YES, GO FIND ANOTHER JOB TO RUN
 2532 32710 3111          DCA     DEAD            /DON'T GO LOOKING FOR AN ALTERNATIVE FIELD!
 2533 32711 7326          FANFLD                  /FORCE JOB OUT OF FANFLD
 2534 32712 3056          DCA     FORCE
 2535 32713 5350          JMP     SCHFR1
 2536 32714 4570  SCHE10, CORE                    /FIRST LOOK FOR A FIELD WITH NOTHING IN IT
 2537 32715 7777          SWAP LOCK NOTRUN FIP SI NOHOLD CJOB
 2538 32716 7410          SKP                     /NO SUCH FIELDS
 2539 32717 5326          JMP     SCHE19          /FOUND ONE TO USE
 2540 32720 1111          TAD     DEAD            /ARE THERE ANY OLD DEAD JOBS STILL IN CORE?
 2541 32721 7440          SZA
 2542 32722 5340          JMP     SCHDED          /YES - SEE IF WE CAN GET RID OF IT
 2543 32723 4570  SCHE18, CORE                    /LET'S TRY AGAIN
 2544 32724 7037  FIPLOK, SWAP LOCK NOTRUN CJOB
 2545 32725 5337          JMP     SCNOUT          /NO, SCAN FOR OUTPUT
 2546 32726 0035  SCHE19, AND     C0007           /YES
 2547 32727 3054  SCHE14, DCA     FINISH          /FINISH:=FIELD #
 2548 32730 1054          TAD     FINISH          /SET SWAP BIT IN CORTBL ENTRY
 2549 32731 1162          TAD     CORTBA
 2550 32732 3003          DCA     SUJT2           /POINTS TO CORTBL ENTRY
 2551 32733 7130          STL RAR                 /AC=4000 (SWAP)
 2552 32734 1055          TAD     FIT             /JOB TO SWAP IN
 2553 32735 3403          DCA I   SUJT2           /SAVE IN CORTBL
 2554 32736 5771          JMP I   SCSWAP          /SWAP IN

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 59


 2555             
 2556 32737 1372  SCNOUT, TAD     SCNSVP          /RESTORE CORTBBL POINTER FOR OUTPUT SCANNING
 2557 32740 3773  SCHDED, DCA I   SCNSV1
 2558 32741 4570          CORE                    /SCAN FOR AVAILABLE FIELD
 2559 32742 3600          LOCK+NOTRUN+FIP+SI
 2560 32743 5364          JMP     SCHE17          /ARE WE STUCK?
 2561 32744 0035          AND     C0007
 2562 32745 3056          DCA     FORCE           /FIELD TO SWAP OUT
 2563 32746 1773          TAD I   SCNSV1          /PICK UP POSITION OF POINTER
 2564 32747 3372          DCA     SCNSVP          /SAVE FOR THE NEXT TIME
 2565 32750 1056  SCHFR1, TAD     FORCE           /DISC XFER IN PROGRESS?
 2566 32751 4671          JMS I   SCDACT
 2567 32752 5364          JMP     SCHE17          /SEE IF WE CAN TAKE ONE MORE LOOK AROUND
 2568 32753 1056          TAD     FORCE
 2569 32754 1162          TAD     CORTBA
 2570 32755 3003          DCA     SUJT2           /CORTBL POINTER TO FORCED FIELD
 2571 32756 3111          DCA     DEAD
 2572 32757 1056          TAD     FORCE
 2573 32760 7041          CIA
 2574 32761 3054          DCA     FINISH          /SET FINISH=-FORCE (TO INDICATE SWAP OUT)
 2575 32762 5763          JMP I   .+1             /NOW GO SET UP THE OUTSWAP
 2576 32763 5662          SWPOUT
 2577 32764 1111  SCHE17, TAD     DEAD            /CAN WE LOOK FURTHER?
 2578 32765 7650          SNA CLA
 2579 32766 5465          SCHED                   /NO - WE'RE STUCK
 2580 32767 3111          DCA     DEAD            /YES - GUESS WE GOT BAD ADVICE
 2581 32770 5323          JMP     SCHE18          /GO TAKE ANOTHER LOOK
 2582             
 2583 32771 5670  SCSWAP, SWAPIN
 2584       0003  SUJT2=  WS0
 2585 32772 7002  SCNSVP, CORTBL+1                /VALUE OF CORTBL POINTER AFTER LAST SEARCH
 2586 32773 1374  SCNSV1, CORTBP                  /POINTS TO CORTBL POINTER IN CORE SEARCH ROUTINE
 2587             
 2588             
 2589 32774 1055  SCHE11, TAD     FIT             /IS FIT JOB IN CORE?
 2590 32775 4570          CORE
 2591 32776 6637          SWAP LOCK FIP SI CJOB
 2592 32777 5314          JMP     SCHE10          /NO - HE HAS TO BE SWAPPED IN
 2593 33000 3103          DCA     L2SF            /SAVE FIELD
 2594 33001 1055          TAD     FIT             /RESTORE LEVEL 2 REGISTERS
 2595 33002 4473          RESJOB
 2596 33003 3055          DCA     FIT             /CLEAR FIT
 2597 33004 5474          START                   /START JOB

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 60


 2598             
 2599       0032  SWERER= C0002                   /SWPRER
 2600             
 2601 33005 5223  SWPRET, JMP     SWERR           /ERROR ON SWAP
 2602 33006 1162          TAD     CORTBA          /GET A POINTER TO THIS FIELD'S
 2603 33007 1054          TAD     FINISH          /ENTRY IN CORTBL
 2604 33010 3053          DCA     SQREQ
 2605 33011 1055          TAD     FIT             /JOB SWAPPED IN
 2606 33012 1040          TAD     C1000           /NOT RUN BIT
 2607 33013 3453  SWGOD1, DCA I   SQREQ           /STORE IT IN THE CORTABLE
 2608 33014 3054          DCA     FINISH
 2609 33015 3055          DCA     FIT             /SET ALL CONCERNED WORDS TO ZERO
 2610 33016 3056          DCA     FORCE
 2611 33017 3053          DCA     SQREQ
 2612 33020 4622          JMS I   SWSCON          /SEE IF ANY MORE DISC I/O WAITING TO BE ATTENDED TO
 2613 33021 5466          RSCHED                  /RE SCHEDULE
 2614 33022 5761  SWSCON, DSKCON
 2615             
 2616 33023 1054  SWERR,  TAD     FINISH          /ERROR WHILE SWAPPING OUT OR SWAPPING IN?
 2617 33024 7510          SPA
 2618 33025 7041          CIA                     /DURING SWAP OUT
 2619 33026 1162          TAD     CORTBA
 2620 33027 3053          DCA     SQREQ           /POINTER TO CORTBA FOR THIS FIELD
 2621 33030 1054          TAD     FINISH
 2622 33031 7710          SPA CLA
 2623 33032 5244          JMP     SWER1           /WHILE SWAPPING OUT; CODE=3
 2624 33033 1032          TAD     SWERER          /WHILE SWAPPING IN;  CODE=2
 2625 33034 3242          DCA     SWPER1
 2626 33035 1055          TAD     FIT
 2627 33036 0036  SWER2,  AND     C0037           /GET THE JOB #
 2628 33037 7450          SNA                     /IS IT A PHANTOM?
 2629 33040 5213          JMP     SWGOD1          /YES, SO NO ERROR CODE TO SET
 2630 33041 4463          ERROR                   /NO JOB BEING SWAPPED IN SO HAVE TO SET ERROR CODE
 2631 33042 0000  SWPER1, 0                       /ERROR CODE
 2632 33043 5213          JMP     SWGOD1          /CLEAR ALL THE CONCERNED WORDS BEFORE LEAVING
 2633 33044 1033  SWER1,  TAD     SWER3           /ERROR CODE
 2634 33045 3242          DCA     SWPER1
 2635 33046 1453          TAD I   SQREQ           /JOB BEING SWAPPED OUT
 2636 33047 5236          JMP     SWER2
 2637       0033  SWER3=  C0003
 2638 33050 0564  REMJOA, REMJOB
 2639 33051 4650  SCHFAN, JMS I   REMJOA          /REMEMBER WHO'S RUNNING
 2640 33052 5465          SCHED                   /GO RUN THE PHANTOM

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 61


 2641             
 2642             
 2643             /BOOTSTRAP FOR CRASH RECOVERY, USED TO BRING INIT INTO HIGHEST MEMORY FIELD
 2644             IFZERO RKSYS <
 2645             BOOT,   CDF                     /IN THE (VERY RARE) EVEN THE SYSTEM
 2646                     STA                     /SHOULD CRASH, THIS ROUTINE MAY
 2647                     DCA I   B7751           /BE STARTED AT 4200 OF FIELD 0
 2648                     DCA I   B7750           /WC AND CA
 2649                     TAD     DSKFLD          /HIGHEST FIELD
 2650                     IFZERO RF08     <
 2651                     DIML
 2652                     CLA STL RTL
 2653                     DXAL                    /TRACK 2
 2654                     >
 2655                     IFZERO RF08-40  <
 2656                     DEAL
 2657                     NOP                     /FOR SIZE
 2658                     CLA
 2659                     >
 2660                     DMAR
 2661                     DFSC                    /WAIT
 2662                     JMP     .-1
 2663                     CIF CDF+CORMEM
 2664                     JMP     0               /OFF TO INIT
 2665             B7551,  7551
 2666             B7750,  7750
 2667             >
 2668             
 2669             IFNZRO RKSYS <                  /SEE ABOVE (CHECK LISTING FOR START ADDRESS)
 2670                                             /AND MAKE SURE TO CLEAR AC, IF, DF BEFORE START!
 2671             BOOT,                            
 2672 33053 3303          DCA     CADDR           /RESET CORE ADDRESS, COUNT, AND
 2673 33054 1304          TAD     ICOUNT
 2674 33055 3305          DCA     COUNT
 2675 33056 1301          TAD     IDADDR          /DISK ADDRESS JUST IN CASE WE GET INVOKED
 2676 33057 3302          DCA     DADDR           /MORE THAN ONCE
 2677 33060 1303  BLOOP,  TAD     CADDR
 2678 33061 6744          DLCA
 2679 33062 1306          TAD     DSKFLD          /DOUBLES AS READ COMMAND INTO HIGHEST FIELD
 2680 33063 6746          DLDC
 2681 33064 1302          TAD     DADDR
 2682 33065 6743          DLAG
 2683 33066 6741  BWAIT,  DSKP
 2684 33067 5266          JMP     BWAIT           /WAIT FOR READ TO COMPLETE
 2685 33070 7200          CLA
 2686 33071 1303          TAD     CADDR
 2687 33072 1156          TAD     C0400           /NEXT CORE ADDRESS
 2688 33073 3303          DCA     CADDR
 2689 33074 2302          ISZ     DADDR           /NEXT DISK ADDRESS
 2690 33075 2305          ISZ     COUNT           
 2691 33076 5260          JMP     BLOOP           /NEXT SECTOR
 2692 33077 6273          CIF CDF+CORMEM
 2693 33100 5000          JMP     0               /OFF TO INIT
 2694 33101 0040  IDADDR, 0040    /TRACK 2
 2695 33102 0000  DADDR,  0000    /CURRENT DISK ADDRESS
 2696 33103 0000  CADDR,  0       /CORE ADDRESS
 2697 33104 7762  ICOUNT, -16     /COUNT OF SECTORS TO BE READ

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 62


 2698 33105 0000  COUNT,  0
 2699             >               
 2700             DSKFLD,
 2701                     IFZERO RKSYS <
 2702                     IFZERO RF08     <CORMEM>
 2703                     IFZERO RF08-40  <CORMEM+200> >
 2704 33106 0070          IFNZRO RKSYS <CORMEM>

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 63


 2705             
 2706             /SAVE JOB REGISTERS
 2707             /THIS ROUTINE IS USED TO SAVE THE LEVEL 2 REGISTERS
 2708             /IN THE JOB DATA AREA. AFTER SAVING THIS
 2709             /INFORMATION, JOB IS SET TO 0 TO INDICATE
 2710             /THAT NULJOB IS RUNNING
 2711             /CALL   SAVJOB
 2712             /       RETURN
 2713             
 2714 33107 0000  SAVJO0, 0
 2715 33110 1160          TAD     JOB             /IS NULJOB RUNNING ALREADY?
 2716 33111 7450          SNA
 2717 33112 5707          JMP I   SAVJO0          /YES - NOTHING TO SAVE
 2718 33113 0142          AND     C0600
 2719 33114 7640          SZA CLA                 /IS A PHANTOM RUNNING?
 2720 33115 5335          JMP     SAVJO3          /YES
 2721 33116 1161          TAD     CJOBDA          /MOVE LEVEL TWO REGISTERS TO JOB DATA AREA
 2722 33117 4574          GETJTA
 2723 33120 0011          JOBREG
 2724 33121 3326          DCA     .+5
 2725 33122 4567          BLT                     /MOVE PC, LINK, AC TO JOB DATA AREA
 2726 33123 6201          CDF                     /FROM FIELD 0
 2727 33124 0104          L2SV0
 2728 33125 6211          DATFLD
 2729 33126 0000          0
 2730 33127 7775          -3
 2731             IFNZRO MQREG <
 2732 33130 4476          GETJTW                  /IF THERE'S AN MQ AND MAYBE AN EAE, SAVE THEM TOO
 2733 33131 0014          JOBEAE
 2734             IFNZRO CPU-1 <
 2735 33132 7721          CLA MQA MQL     >       /LOAD AC FROM MQ, CLEAR MQ
 2736             IFZERO CPU-1 <
 2737                     CLA MQA         >       /LOAD AC FROM MQ
 2738 33133 6211          DATFLD
 2739 33134 3405          DCA I   JOBSWA  >       /SAVE IN JOB MQ
 2740             IFNZRO EAE <
 2741                     ISZ     JOBSWA          /GET POINTER TO JOB SC
 2742             IFNZRO CPU-2 <
 2743                     SCA                     /GET SC
 2744                     DCA I   JOBSWA  >       /AND SAVE IT
 2745             IFZERO CPU-2 <
 2746                     SCA                     /GET SC
 2747                     CLL RTL                 /MAKE ROOM FOR MODE AND GT
 2748                     DCA I   JOBSWA          /SAVE SC
 2749                     DPSZ                    /SKIPS IF MODE B
 2750                     ISZ I   JOBSWA          /INCR IF MODE A
 2751                     SGT                     /CHECK GT FLAG
 2752                     ISZ I   JOBSWA          /INCR, IF GT=0 OR IF MODE A
 2753                     > >                     /IF MODE=A THERE MAY BE JUNK IN THE AC AT THIS POINT BUT
 2754                                             /BITS 7-11 ARE GUARANTEED CLEAR
 2755             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 64


 2756             
 2757             
 2758 33135 1160  SAVJO3, TAD     JOB             /DO WE HAVE A JOB #?
 2759 33136 0036          AND     C0037
 2760 33137 7650          SNA CLA
 2761 33140 5367          JMP     SAVJO2          /NOT YET
 2762 33141 7201          CLA IAC                 /CORRECT THE CLOCK SINCE IT'S ALWAYS ONE BEHIND
 2763 33142 1110          TAD     CLOCK           /ADD IN ANY TIME HE HASN'T BEEN CHARGED FOR YET
 2764 33143 1043          TAD     JOBTIM          /TO THE NUMBER OF TICKS HE HAS ACCUMULATED
 2765 33144 3043          DCA     JOBTIM          /NOW IT'S OK TO PUT HIM/HER AWAY
 2766 33145 6201          CDF                     /GET POINTER TO LOW ORDER RUNTIME
 2767 33146 4476          GETJTW
 2768 33147 0023          JOBRTM
 2769 33150 7100          CLL
 2770 33151 1043          TAD     JOBTIM          /# TICKS HE USED
 2771 33152 6211          DATFLD
 2772 33153 3405          DCA I   JOBSWA          /SAVE THE NEW CUMULATIVE TIME
 2773 33154 2005          ISZ     JOBSWA
 2774 33155 7430          SZL                     /OVERFLOW INTO HIGH ORDER?
 2775 33156 2405          ISZ I   JOBSWA          /BUMP IT; WOULD NEED 16777216 TICKS FOR THIS TO SKIP!!
 2776 33157 1112          TAD     SCHNEW          /WAS THIS JOB TO HAVE A FULL SLICE?
 2777 33160 1043          TAD     JOBTIM          /ANY PART OF HIS/HER TIME SLICE STILL LEFT?
 2778 33161 7750          SPA SNA CLA
 2779 33162 5367          JMP     SAVJO2          /YES, SO THIS JOB IS NOT A COMPUTE BOUND JOB AT THIS STAGE
 2780 33163 1561          TAD I   CJOBDA
 2781 33164 7001          IAC                     /STR0
 2782 33165 4460          IOR                     /MAKE HIM/HER COMPUTE BOUND
 2783 33166 1000          JCOMBD
 2784 33167 3160  SAVJO2, DCA     JOB             /SIMULATE NULJOB
 2785 33170 6211          DATFLD
 2786 33171 3561          DCA I   CJOBDA          /CLEAR POINTER TO CURRENT JOB DATA AREA
 2787 33172 6201          CDF
 2788 33173 5707          JMP I   SAVJO0          /AND EXIT
 2789             
 2790 33174 6667  RUNULL, SCHNUL
 2791             DEBUG,                          /RESTART FOR DEBUGGING
 2792             IFZERO DC08A    <
 2793                     IFZERO CPU-1    <       /SET PDP-8 CLOCK COUNT
 2794                     STA
 2795                     CCF CLB >
 2796 33175 6131  IFNZRO CPU-4 <CECI>
 2797             IFZERO CPU-4 <IAC
 2798                     CLLE
 2799                     CLA>>
 2800             IFNZRO DC08A    < T1ON >        /TURN ON DC08 CLOCK
 2801             IFZERO D689-4   < EDF >         /REENABLE DATA PHONES
 2802 33176 3112          DCA     SCHNEW          /ENABLE SCHEDULER TO BUMP NULL JOB
 2803 33177 5774          JMP I   RUNULL

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 65


 2804             
 2805       3200  *3200
 2806             
 2807             /PROCESS KEYBOARD INPUT CHARACTERS (MAY BE PSEUDO-INPUT)
 2808             
 2809             /MULTI-FIELD ROUTINE
 2810             /CALL:  CHARACTER IN "TTCHAR"
 2811             /       JMS     KBD
 2812             /       DEVTBL POINTER
 2813             /       RETURN; NO ROOM - CHARACTER NOT STORED
 2814             /       RETURN; CHARACTER STORED
 2815             /
 2816       0150  KBDCNT=WS2
 2817 33200 7566  KBDSIB, -212                    /DO NOT MOVE FROM BEGINNING OF A PAGE - SEE "DUPSI"
 2818             IFNZRO KBDSIB&177 <YOU GOOFED>
 2819             
 2820 33201 0000  KBD00,  0
 2821 33202 1601          TAD I   KBD00           /GET DEVTBL POINTER
 2822 33203 3132          DCA     CONDBA
 2823 33204 6214          RDF
 2824 33205 1144          TAD     C6203
 2825 33206 3266          DCA     KBDNSX          /REMEMBER FROM WHENCE WE CAME
 2826 33207 2201          ISZ     KBD00
 2827 33210 6211          DATFLD
 2828 33211 1532          TAD I   CONDBA          /GET DDB ADDRESS
 2829 33212 3133          DCA     CONDDB
 2830 33213 4746  KBDSQ,  JMS I   KBDCON          /CHECK ^S/^Q; (ISZ CONDBA IF FEATURE DISABLED)
 2831 33214 1533          TAD I   CONDDB          /YES - GET DDB STATUS
 2832 33215 0037          AND     C0100
 2833 33216 7640          SZA CLA                 /"SICOM" SET?
 2834 33217 5266          JMP     KBDNSX          /YES - EXIT
 2835 33220 1031          TAD     TTCHAR          /CHECK FOR ^B, ^C
 2836 33221 1350          TAD     KBDMCB
 2837 33222 7110          CLL RAR
 2838 33223 7640          SZA CLA                 /IS IT ^B OR ^C?
 2839 33224 5301          JMP     KBD05           /NOTHING SPECIAL ABOUT THIS ONE
 2840 33225 1133          TAD     CONDDB
 2841 33226 4751          JMS I   KBDCLB          /CLEAR HIS/HER INPUT BUFFER
 2842 33227 1031          TAD     TTCHAR
 2843 33230 7010          RAR
 2844 33231 7620          SNL CLA                 /WAS IT ^B OR ^C?
 2845 33232 4752          JMS I   KBDCHK          /WAS ^B TYPED IN USER MODE?
 2846 33233 5270          JMP     KBD04           /CLEAR OUTPUT
 2847 33234 1533          TAD I   CONDDB
 2848 33235 1040          TAD     C1000           /PUT THIS TTY IN SI MODE
 2849 33236 3533          DCA I   CONDDB

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 66


 2850             
 2851 33237 1264  KBD02,  TAD     KBDUPA
 2852 33240 3031          DCA     TTCHAR          /CHANGE TO ^
 2853 33241 6201          CDF
 2854 33242 4573          PRINT                   /STASH "^" IN HIS/HER OUTPUT BUFFER
 2855 33243 0302          "B                      /WE DON'T CARE IF "PRINT" FAILS
 2856 33244 1243          TAD     .-1
 2857 33245 3031          DCA     TTCHAR          /CHANGE TO B
 2858 33246 7352  KBD01,  CLL STA RTR
 2859 33247 7012          RTR
 2860 33250 6211          DATFLD
 2861 33251 0533          AND I   CONDDB          /CLEAR "FULL" STATUS
 2862 33252 3533          DCA I   CONDDB
 2863 33253 1533  KBD03,  TAD I   CONDDB          /GET DDB STATUS BITS
 2864 33254 0334          AND     DUPSI
 2865 33255 2133          ISZ     CONDDB
 2866 33256 7640          SZA CLA                 /DUPLEX OR SI MODE?
 2867 33257 1533          TAD I   CONDDB
 2868 33260 7650          SNA CLA                 /AND LOGGED IN?
 2869 33261 5265          JMP     KBDXIT          /NO - SO DON'T ECHO
 2870 33262 6201          CDF
 2871 33263 4573          PRINT                   /STASH (TTCHAR) IN HIS/HER OUTPUT BUFFER
 2872 33264 0336  KBDUPA, "^                      /WE DON'T CARE IF "PRINT" FAILS
 2873 33265 2201  KBDXIT, ISZ     KBD00           /SHOW SUCCESS
 2874 33266 0000  KBDNSX, .-.                     /BACK TO THE CALLING FIELD
 2875 33267 5601          JMP I   KBD00
 2876 33270 1532  KBD04,  TAD I   CONDBA
 2877 33271 4751          JMS I   KBDCLB          /CLEAR THE OUTPUT BUFFER
 2878 33272 1031          TAD     TTCHAR
 2879 33273 7010          RAR
 2880 33274 7620          SNL CLA                 /WAS IT ^B OR, OR ^C?
 2881 33275 5237          JMP     KBD02           /IT WAS ^B
 2882 33276 4752          JMS I   KBDCHK          /USER MODE?
 2883 33277 5376          JMP     KBDSSI          /NO, GO TO SI FOR DOT OR ^B
 2884 33300 5732          JMP I   KBDCCA          /YES, GO DO ^C BUSINESS
 2885 33301 1041  KBD05,  TAD     C7770           /IS THERE PLENTY OF FREE CORE?
 2886 33302 1047          TAD     FRECNT
 2887 33303 7710          SPA CLA
 2888 33304 5266          JMP     KBDNSX          /NO
 2889 33305 4752          JMS I   KBDCHK          /WHICH MODE?
 2890 33306 4733          JMS I   KBDLRA          /SI - CHECK FOR LINE-FEED AND RUBOUT
 2891 33307 1533          TAD I   CONDDB
 2892 33310 0156          AND     C0400           /"FULL" FLAG SET?
 2893 33311 7640          SZA CLA
 2894 33312 5266          JMP     KBDNSX          /YES - EXIT
 2895 33313 1133          TAD     CONDDB
 2896 33314 4575          STORE                   /STASH (TTCHAR) IN HIS/HER INPUT BUFFER
 2897 33315 6011          KBD06                   /FOR SIZE CHECK
 2898 33316 5266          JMP     KBDNSX          /STORE FAILED; BUFFER ALREADY FULL
 2899 33317 4752          JMS I   KBDCHK          /WHICH MODE?
 2900 33320 5334          JMP     KBD08           /SI
 2901 33321 7126          STL RTL                 /AC=2
 2902 33322 1133          TAD     CONDDB          /POINT TO BREAK MASK
 2903 33323 3150          DCA     KBDCNT
 2904 33324 1550          TAD I   KBDCNT          /GET THE BREAK MASK
 2905 33325 4747          JMS I   BRKTSA          /IS IT A BREAK CHARACTER?
 2906 33326 4731          JMS I   KBDBRK          /GO SET DEL BIT IN STR1 AND PUT HIS/HER JOB NUMBER IN BONUS

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 67


 2907 33327 6211          DATFLD
 2908 33330 5253          JMP     KBD03           /SEE IF WE SHOULD ECHO

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 68


 2909             
 2910 33331 1553  KBDBRK, KBDDLM
 2911 33332 5621  KBDCCA, GIR9
 2912 33333 3566  KBDLRA, KBDLRB
 2913             DUPSI,
 2914 33334 1200  KBD08,  TAD     KBDSIB          /USED AS CONSTANT (MASK) SEE "KBD03+1"
 2915 33335 1031          TAD     TTCHAR
 2916 33336 0376          AND     KBDSIM
 2917 33337 7640          SZA CLA                 /IS THIS A BREAK FOR SI?
 2918 33340 5253          JMP     KBD03           /NO
 2919 33341 2052  KBD11,  ISZ     COMCNT          /TO SCHEDULE "SI"
 2920 33342 1533          TAD I   CONDDB
 2921 33343 1037          TAD     C0100           /SET "SICOM"
 2922 33344 3533          DCA I   CONDDB          /SAVE NEW KEYBOARD STATUS
 2923 33345 5265          JMP     KBDXIT          /EXIT WITHOUT ECHOING THE DELIMITING CHARACTER
 2924             
 2925 33346 1161  KBDCON, CONSQ
 2926 33347 3537  BRKTSA, BRKTST
 2927 33350 7576  KBDMCB, -"B+100                 /-^B
 2928 33351 6642  KBDCLB, CLRBUF
 2929 33352 6000  KBDCHK, KBDMOD
 2930 33353 1133  KBD09,  TAD     CONDDB
 2931 33354 1141          TAD     C0005
 2932 33355 3150          DCA     KBDCNT          /POINTS TO CHARACTER COUNT IN DDB
 2933 33356 1550          TAD I   KBDCNT
 2934 33357 7041          CIA
 2935 33360 3150          DCA     KBDCNT          /NUMBER OF CHARACTERS TO SPIN THROUGH THE BUFFER
 2936 33361 3003          DCA     WS0             /FAKE HIS/HER BREAK MASK TO ZERO
 2937 33362 1133  KBD10,  TAD     CONDDB
 2938 33363 4507          FETCH                   /FETCH A CHARACTER
 2939 33364 5376          JMP     KBDSSI          /BUFFER EMPTY
 2940 33365 3031          DCA     TTCHAR          /SAVE IT
 2941 33366 2150          ISZ     KBDCNT          /RUB THIS ONE?
 2942 33367 7410          SKP
 2943 33370 5253          JMP     KBD03           /YES - PRINT IT
 2944 33371 1133          TAD     CONDDB
 2945 33372 4575          STORE                   /NO - PUT IT BACK
 2946 33373 6045          ALLOK                   /NO LIMIT
 2947 33374 0040  KB0040, DECHO                   /NOP            /CAN'T FAIL
 2948 33375 5362          JMP     KBD10
 2949             
 2950             KBDSIM, /THE FOLLOWING INSTRUCTION IS USED AS A CONSTANT
 2951 33376 1374  KBDSSI, TAD     KB0040          /SET "DECHO"; SCHEDULE SI TO PRINT CURRENT LINE
 2952 33377 5341          JMP     KBD11           /PRECEDED BY EITHER "." OR "^B"
 2953             
 2954             IFNZRO KB0040&177-174 <CHANGE KBDSIM>

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 69


 2955             
 2956       3400  *3400
 2957             
 2958             /KEYBOARD IOTS
 2959             
 2960             /SEE IF THE USER IS GOING TO EXECUTE A "JMP .-1" AFTER A NON-SKIPPING "KSF"
 2961             
 2962 33400 1004  JMPTST, TAD     UUOADD          /ADDRESS OF THE "KSF"
 2963 33401 0146          AND     C0177           /JUST THE PAGE ADDRESS BITS
 2964 33402 1255          TAD     C5200           /MAKE UP THE REQUIRED "JMP" INSTRUCTION
 2965 33403 7041          CIA
 2966 33404 4150          UDF                     /SELECTS USER'S FIELD
 2967 33405 1504          TAD I   L2SV0           /USER'S INSTRUCTION
 2968 33406 6211          DATFLD
 2969 33407 7450          SNA
 2970 33410 5217          JMP     JMPTS1          /WE CAUGHT HIM/HER!
 2971 33411 1002          TAD     C0200           /MAYBE IT'S A PAGE 0 "JMP"
 2972 33412 7640          SZA CLA
 2973 33413 5220          JMP     JMPTS0          /NO - MUST BE SOMETHING ELSE - LET HIM/HER CONTINUE
 2974 33414 1355          TAD     CC7600          /WILL WE BE ON PAGE 0?
 2975 33415 0004          AND     UUOADD
 2976 33416 7650          SNA CLA
 2977 33417 1254  JMPTS1, TAD     UKEYFL          /PUT HIM/HER TO SLEEP - SO HE DOESN'T WASTE OUR TIME
 2978 33420 3273  JMPTS0, DCA     UKEYC           /SAVE WAIT CCONDITION
 2979 33421 7132          STL RTR
 2980 33422 0533          AND I   CONDDB
 2981 33423 7650          SNA CLA                 /NEED XON?
 2982 33424 5237          JMP     JMPTS2          /NO
 2983 33425 1250          TAD     UKXON
 2984 33426 3031          DCA     TTCHAR
 2985 33427 2132          ISZ     CONDBA          /POINT TO OUTPUT SIDE
 2986 33430 6201          CDF
 2987 33431 4573          PRINT                   /SEND XON
 2988 33432 5577          WAIT                    /DIDN'T FIT - TRY AGAIN LATER
 2989 33433 7352          CLL STA RTR
 2990 33434 6211          DATFLD
 2991 33435 0533          AND I   CONDDB          /CLEAR XOFF BIT
 2992 33436 3533          DCA I   CONDDB
 2993 33437 1273  JMPTS2, TAD     UKEYC           /WAIT FOR FLAG; EXCEPT KSF WITHOUT JMP .-1
 2994 33440 5461          UUOEXT
 2995             
 2996             IFNZRO JMPTST&4177 <YOU GOOFED>
 2997 33441 0106  UKL2SA, L2SA
 2998 33442 5031  UKEY0A, UKT0
 2999 33443 5115  UKEY1A, UKT1
 3000             
 3001 33444 7240  UKWAIT, STA                     /BACK UP HIS/HER PC
 3002 33445 1104          TAD     L2SV0
 3003 33446 3104          DCA     L2SV0
 3004 33447 5217          JMP     JMPTS1          /SEE IF XON SHOULD BE SENT
 3005             
 3006 33450 0221  UKXON,  221

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 70


 3007             
 3008 33451 4642  UKEY,   JMS I   UKEY0A          /MAKE SURE HE'S NOT IN SI MODE
 3009 33452 4643          JMS I   UKEY1A          /WHAT DOES HE WANT TO DO?
 3010 33453 5327          JMP     UKEYRS          /READ STRING
 3011 33454 0102  UKEYFL, JSDEL JSERR             /DELIMITER FLAG OR ERROR FLAG
 3012 33455 5200  C5200,  JMP     JMPTST          /MAKE SURE HE'S NOT HANGING ON "JMP .-1"
 3013 33456 7010          RAR
 3014 33457 7710          SPA CLA
 3015 33460 3106          DCA     L2SA            /KCC - CLEAR AC
 3016 33461 7620          SNL CLA                 /IS KRB OR KRS REQUESTED?
 3017 33462 5461          UUOEXT                  /NO - ALL DONE
 3018 33463 6211          DATFLD
 3019 33464 1133          TAD     CONDDB
 3020 33465 4507          FETCH                   /GET A CHARACTER FROM THE BUFFER
 3021 33466 5244          JMP     UKWAIT          /NONE AVAILABLE
 3022 33467 3273          DCA     UKEYC           /SAVE CHARACTER
 3023 33470 1241          TAD     UKL2SA          /OR INTO USER'S AC
 3024 33471 6201          CDF
 3025 33472 4460          IOR                     /IT WOULD PROBABLY BE ADEQUATE TO JAM IT INTO HIS/HER AC
 3026 33473 0000  UKEYC,  0
 3027 33474 5461          UUOEXT                  /AND BACK TO USER
 3028             
 3029 33475 0000  UKREAD, 0
 3030 33476 3003          DCA     WS0             /SAVE THE BREAK MASK
 3031 33477 1106          TAD     L2SA            /POINTS TO PARAMETERS IN USER AREA
 3032 33500 7001          IAC
 3033 33501 3004          DCA     WS1             /ADDR OF USER BUFFER POINTER
 3034 33502 4150          UDF
 3035 33503 1404          TAD I   WS1             /USER BUFFER ADDRESS
 3036 33504 3016          DCA     AXS2
 3037 33505 6211  UKEYR1, DATFLD
 3038 33506 1133          TAD     CONDDB
 3039 33507 4507          FETCH                   /GET A CHARACTER
 3040 33510 5675          JMP I   UKREAD          /THEY'RE FRESH OUT
 3041 33511 4150          UDF                     /SELECT USER FIELD
 3042 33512 3031          DCA     TTCHAR
 3043 33513 1031          TAD     TTCHAR
 3044 33514 3416          DCA I   AXS2
 3045 33515 2404          ISZ I   WS1             /UPDATE USER POINTER
 3046 33516 7401  MRUB,   -377                    /NOP
 3047 33517 1003          TAD     WS0             /IS IT A DELIMITER?
 3048 33520 2506          ISZ I   L2SA            /DONE?
 3049 33521 4337          JMS     BRKTST
 3050 33522 7610          CLA SKP                 /WE'RE FINISHED
 3051 33523 5305          JMP     UKEYR1          /BACK FOR MORE
 3052 33524 3106          DCA     L2SA            /CLEAR AC
 3053 33525 2275          ISZ     UKREAD          /SKIP ON RETURN
 3054 33526 5675          JMP I   UKREAD

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 71


 3055             
 3056             /READ INPUT STRING
 3057             
 3058 33527 6211  UKEYRS, DATFLD
 3059 33530 7126          STL RTL
 3060 33531 1133          TAD     CONDDB          /ADDRESS OF DDB
 3061 33532 3003          DCA     WS0             /POINTS TO BREAK MASK
 3062 33533 1403          TAD I   WS0             /GET BREAK MASK
 3063 33534 4275          JMS     UKREAD          /READ STRING
 3064 33535 5244          JMP     UKWAIT          /WAIT FOR HIM/HER TO TYPE SOME MORE
 3065 33536 5461          UUOEXT
 3066             
 3067 33537 0000  BRKTST, 0
 3068 33540 6201          CDF
 3069 33541 7550          SPA SNA
 3070 33542 5360          JMP     BRKTS2
 3071 33543 3003          DCA     WS0             /SAVE THE BREAK MASK
 3072 33544 1363          TAD     BRKTBA          /ADDRESS OF BREAK TABLE
 3073 33545 3015          DCA     AXS1
 3074 33546 1031          TAD     TTCHAR          /CHARACTER TO COMPARE WITH TABLE
 3075 33547 2015  BRKTS1, ISZ     AXS1            /SKIP OVER MASK
 3076 33550 1415          TAD I   AXS1            /-HIGH END OF RANGE
 3077 33551 7100          CLL
 3078 33552 1415          TAD I   AXS1            /+NUMBER OF CHARACTERS IN THIS RANGE
 3079 33553 7420          SNL
 3080 33554 5347          JMP     BRKTS1          /NOT IN THIS GROUP
 3081 33555 7600  CC7600, CLA 400                 /WE FOUND IT
 3082 33556 1415          TAD I   AXS1            /GET THE MASK
 3083 33557 0003          AND     WS0             /COMPARE IT WITH OUR MASK
 3084 33560 7650  BRKTS2, SNA CLA                 /IS IT A BREAK CHARACTER?
 3085 33561 2337          ISZ     BRKTST          /NO
 3086 33562 5737          JMP I   BRKTST
 3087 33563 4335  BRKTBA, BRKTBL-2
 3088             
 3089 33564 0165  MLF,    377-212
 3090 33565 3353  KBD09A, KBD09
 3091             
 3092 33566 0000  KBDLRB, 0
 3093 33567 1316          TAD     MRUB
 3094 33570 1031          TAD     TTCHAR
 3095 33571 7450          SNA
 3096 33572 5765          JMP I   KBD09A          /RUBOUT
 3097 33573 1364          TAD     MLF
 3098 33574 7640          SZA CLA
 3099 33575 5766          JMP I   KBDLRB          /NORMAL CHARACTER
 3100 33576 5777          JMP I   .+1             /LINE-FEED
 3101 33577 3376          KBDSSI

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 72


 3102             
 3103       3600  *3600
 3104             
 3105             IFZERO CPU-2 <                  /TEMPORARY POWER FAIL HANDLER FOR 8/E
 3106 33600 7200  POWINT, CLA
 3107 33601 3000          DCA     0               /CLEAR LOCATION 0 SO WE'LL FALL THROUGH IT
 3108             
 3109 33602 1205          TAD     POW2            /CLOBBER LOCATION 2 (C0200) SO WE'LL COME TO "POWST"
 3110                                             /WHEN THE JUICE RETURNS
 3111             
 3112 33603 3002          DCA     2
 3113 33604 7402          HLT                     /POWER FAILURE; WILL START AT POWST WHEN POWER COMES UP
 3114             
 3115 33605 3606  POW2,   POWST
 3116             
 3117 33606 3004  POWST,  DCA     WS1
 3118 33607 2003          ISZ     WS0             /WE DELAY ABOUT A MINUTE TO MAKE SURE
 3119 33610 5207          JMP     .-1             /THE DISK IS UP TO SPEED
 3120 33611 2004          ISZ     WS1
 3121 33612 5207          JMP     .-3
 3122 33613 5614          JMP I   .+1             /NOW GO CALL INIT
 3123 33614 3053          BOOT
 3124             
 3125 33615 6006  USGT,   SGT                     /SKIP ON PDP-8/E GREATER THAN FLAG (EAE)
 3126 33616 5461          UUOEXT
 3127 33617 5620          JMP I   .+1             /CAUSE SKIP ON RETURN
 3128 33620 7215          UUOEX2
 3129             >
 3130             IFNZRO CPU&7776 <
 3131 33621 6006  UGTF,   SGT                     /PDP-8/E "GET FLAGS" SIMULATOR
 3132 33622 7410          SKP
 3133 33623 7132          STL RTR                 /POSITION OF GT FLAG
 3134 33624 1105          TAD     L2SVLK          /AND GIVE HIM/HER THE LINK
 3135 33625 3106          DCA     L2SA
 3136 33626 5461          UUOEXT
 3137             
 3138 33627 7333  URTF,   CLA STL IAC RTR         /AC=6000
 3139 33630 0106          AND     L2SA            /SAVE ONLY LINK AND GT BITS OF HIS/HER AC
 3140 33631 6005          RTF                     /RESTORE AS REQUESTED
 3141 33632 7210          CLA RAR                 /FETCH NEW LINK
 3142 33633 3105          DCA     L2SVLK          /SAVE FOR THE USER
 3143 33634 5461          UUOEXT
 3144             >
 3145             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 73


 3146             
 3147             IFNZRO DC08A <
 3148             DC08B=  DC08A+4%5
 3149             T8FITH, -DC08B
 3150             T8TTIA, T8TTI
 3151             T8LC,   -1
 3152             T8SF,   0
 3153             T8SV0,  0
 3154             T8SVLK, 0
 3155             T8SA,   0
 3156             T8FLG,  0
 3157             T8CNT0, -1                      /SO IT WILL INITIALIZE ITSELF THE FIRST TIME IT'S USED
 3158             T8CNT1, 0
 3159             T8CNT2, 0
 3160             T8N5,   -5
 3161             T8OBA,  SKPTBL+PT08+KL8+2
 3162             T8OBF,  0
 3163             T8NLN,  -DC08A
 3164             T8LINE, DC08LO-SKPTBL-PT08-KL8-2
 3165             RESTA,  RESTOR
 3166             T8SFA,  T8SF
 3167             T8BF2,  OUTREG-SKPTBL-1
 3168             T8TMP,  0
 3169             T83000, 3000
 3170             TTOFLD, TTOFLG
 3171             T8RTN,  DISMI2
 3172             T8DIS,  T1ON                    /RE-ENABLE THE CLOCK
 3173                     ISZ     T8LC
 3174                     JMP I   T8RTN           /ALREADY SERVICING DC08
 3175                     DCA     T8SA            /SAVE AC
 3176                     RAR
 3177                     DCA     T8SVLK          /AND LINK
 3178                     TAD     0
 3179                     DCA     T8SV0           /AND PC
 3180                     RIB
 3181                     DCA     T8SF            /FIELD & MODE
 3182                     DCA     T8FLG           /CLEAR DC08A LEVEL 2 SERVICE FLAG
 3183             T8IN,   TAD     T8FITH
 3184                     TTCR TTLR               /LIMIT INPUT TO 1/5 OF THE LINES
 3185                     DCA     T8CNT2          /SAVE ALSO AS THE OUTPUT LINE COUNT
 3186                     ION
 3187                     CIF DATFLD
 3188                     JMP I   T8TTIA          /TAKE A PASS THROUGH THE TTI STRING

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 74


 3189             
 3190             /RETURNS HERE AFTER SERVICING INPUT SIDE (TTI'S)
 3191             T8OUT1, ISZ     T8CNT0          /BUMP DIVIDE BY 5 COUNTER
 3192                     JMP     T8OUT2          /CONTINUE CURRENT PASS
 3193                     TAD     T8N5
 3194                     DCA     T8CNT0          /RESET MAJOR COUNTER
 3195                     TAD     T8OBA
 3196                     DCA     T8OBF           /RESET OUTPUT BUFFER POINTER
 3197                     TAD     T8NLN
 3198                     DCA     T8CNT1          /RESET TOTAL NUMBER OF LINES COUNTER
 3199             T8OUT2, TAD     T8CNT1
 3200                     SMA CLA                 /ANYTHING LEFT THIS PASS?
 3201                     JMP     T8EXT           /NO
 3202                     TAD     T8LINE          /LINE NUMBER TO START AT
 3203                     TAD     T8OBF           /COMPUTED FROM CURRENT BUFFER POSITION
 3204                     TTCL TTLL               /LOAD IT INTO THE DC08A
 3205                     CLA
 3206             T8OUT3, TAD I   T8OBF           /BITS TO BE OUTPUT
 3207                     SZA
 3208                     JMP     T8OUT5          /MUST BE SOMETHING THERE
 3209                     TTIL                    /NOTHING - JUST BUMP THE LINE NUMBER
 3210             T8OUT4, ISZ     T8OBF           /BUMP THE BUFFER POINTER
 3211                     ISZ     T8CNT1          /AND THE TOTAL LINE COUNT
 3212                     SKP
 3213                     JMP     T8EXT           /FINISHED
 3214                     ISZ     T8CNT2          /CURRENT PASS COCUNT
 3215                     JMP     T8OUT3          /ONTO THE NEXT LINE
 3216             T8EXT,  IOF
 3217                     STL STA                 /DECREMENT THE INTERRUPT COUNT
 3218                     TAD     T8LC
 3219                     DCA     T8LC
 3220                     SNL                     /ALL ACCOUNTED FOR?
 3221                     JMP     T8IN            /NO - MAKE ANOTHER ROUND
 3222                     TAD     T8FLG           /DOES THE DC08 REQUIRE LEVEL 2
 3223                     TAD     L2Q             /OR SOMETHING ELSE?
 3224                     CIA
 3225                     TAD     L2QE
 3226                     AND     T8SF            /ALLOW "L2EXIT" ONLY IF FROM USER MODE
 3227                     AND     C0100
 3228                     SZA CLA                 /HOW SHOULD WE EXIT?
 3229                     JMP     T8EXIT          /VIA L2EXIT
 3230                     TAD     T8SFA           /BACK TO WHERE WE CAME FROM
 3231                     CDF
 3232                     JMP I   RESTA

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 75


 3233             
 3234             /MOVE THE ACTIVE REGISTERS OVER TO LEVEL 2
 3235             T8EXIT, TAD     T8SVLK          /THE LINK
 3236                     DCA     L2SVLK
 3237                     TAD     T8SA            /THE AC
 3238                     DCA     L2SA
 3239                     TAD     T8SV0           /THE PC
 3240                     DCA     L2SV0
 3241                     TAD     T8SF            /FIELDS & MODE
 3242                     DCA     L2SF
 3243                     EXIT
 3244             T8OUT5, TTO TTIL                /OUTPUT A BIT
 3245                     SZA
 3246                     JMP     T8OUT8          /SAVE THE REMAINING BITS FOR NEXT TIME
 3247             T8OUT6, TAD     T8OBF           /OUR POSITION
 3248                     TAD     T8BF2           /MINUS THE OFFSET
 3249                     DCA     T8TMP           /SECOND BUFFER
 3250                     TAD I   T8TMP
 3251                     RAR
 3252                     SNL                     /ANYTHING WAITING?
 3253                     JMP     T8OUT7          /NO
 3254                     AND     C0377
 3255                     CLL RAL
 3256                     TAD     T83000          /NOW THE STOP BITS & START BIT ARE IN PLACE
 3257                     DCA I   T8OBF           /SAVE IT TO BE OUTPUT NEXT TIME
 3258                     STL IAC RTR
 3259                     DCA I   T8TMP           /SET BOTH HARDWARE BUSY AND SERVICE FLAGS
 3260                     CDF
 3261                     DCA I   TTOFLD          /SET "CONOUT" FLAG
 3262                     DATFLD
 3263                     ISZ     T8FLG           /SCHEDULE LEVEL 2 FOR US
 3264                     JMP     T8OUT4
 3265             T8OUT7, STL CLA RAR
 3266                     AND I   T8TMP
 3267                     DCA I   T8TMP           /CLEAR EVERYTHING EXCEPT SERVICE FLAG
 3268             T8OUT8, DCA I   T8OBF
 3269                     JMP     T8OUT4
 3270             
 3271             T8IN1,  0
 3272                     IOF
 3273                     DCA I   ACX11           /STASH IT IN THE RING BUFFER
 3274                     TTRL
 3275                     TAD     T8BASE          /MAKE DC08A LINE NUMBER = KXX
 3276                     JMS I   T8INPA          /FINISH HOUSE-CLEANING
 3277                     ISZ     T8FLG           /SCHEDULE LEVEL 2
 3278                     CIF DATFLD
 3279                     JMP I   T8IN1           /BACK TO FIELD 1
 3280             T8BASE, PT08+KL8-DC08LO+1
 3281             T8INPA, ACINT9
 3282             >/END OF FIELD 0 DC08A CODE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 76


 3283             
 3284       4000  *4000
 3285             
 3286             /       THIS WILL RUN A "ROUND ROBIN" OF CORE RESIDENT JOBS
 3287             
 3288 34000 3112  NXTCO1, DCA     SCHNEW          /ANY JOB STARTED FROM HERE MAY BE THROWN OFF
 3289 34001 2272  NXTCOR, ISZ     NXTCNT          /HAVE WE CHECK ALL ENTRIES?
 3290 34002 1272          TAD     NXTCNT
 3291 34003 7740          SMA SZA CLA
 3292 34004 5651          JMP I   NXTNUL          /YES; NOTHING RUNNABLE EXCEPT NULL JOB
 3293 34005 2253  NXTCO2, ISZ     NXTCOP          /BUMP CORTBL POINTER
 3294 34006 1253          TAD     NXTCOP          /ARE WE PAST THE END OF THE TABLE?
 3295 34007 1654          TAD I   NXTEND
 3296 34010 7640          SZA CLA                 /?
 3297 34011 5214          JMP     .+3             /NOT YET
 3298 34012 1042          TAD     FANCOR          /YES, START AT THE BEGINNING AGAIN
 3299 34013 3253          DCA     NXTCOP          /ALL SET
 3300 34014 1653          TAD I   NXTCOP          /GET CORTBL ENTRY
 3301 34015 7450          SNA                     /IS THERE ANYTHING IN THERE?
 3302 34016 5247          JMP     NXTCO4          /NO; CLEAR DEAD JOB POINTER (A FREE FIELD IS BETTER)
 3303 34017 0256          AND     C6600           /IS IT BEING SWAPPED, LOCKED, OR A PHANTOM?
 3304 34020 7640          SZA CLA
 3305 34021 5201          JMP     NXTCOR          /YES - SO IT'S NOT A USEFULL FIELD NOW
 3306 34022 1653          TAD I   NXTCOP
 3307 34023 0036          AND     C0037
 3308 34024 4501          RUNABL
 3309 34025 5241          JMP     NXTCO3          /NOT RUNNABLE
 3310 34026 1653          TAD I   NXTCOP          /TRY TO RUN THIS ONE
 3311 34027 0036          AND     C0037           /GET JOBTBL INDEX
 3312 34030 1044          TAD     JOBTBA          /GET POINTER TO JOB DATA
 3313 34031 4477          GETJTI                  /GET VALUE OF STR0
 3314 34032 0000          JOBSTS
 3315 34033 0255          AND     C0107           /DOES HE WANT TO RUN FIP OR SI FOR ERROR?
 3316 34034 7640          SZA CLA
 3317 34035 5201          JMP     NXTCOR          /HAVE TO WAIT 'TIL LATER
 3318 34036 1653          TAD I   NXTCOP
 3319 34037 5640          JMP I   .+1             /GO RUN THIS ONE
 3320 34040 2520          SCHEI2
 3321 34041 7240  NXTCO3, STA
 3322 34042 1253          TAD     NXTCOP          /POINTER-1 OF DEAD JOB
 3323 34043 3111          DCA     DEAD            /SAVE IT
 3324 34044 1253          TAD     NXTCOP
 3325 34045 1040          TAD     NXTFLD          /FIELD INDEX ONLY
 3326 34046 4652          JMS I   NXTDSK          /IS THERE DISK ACTIVITY IN THIS FIELD?
 3327 34047 3111  NXTCO4, DCA     DEAD            /YES; SO HE'S NOT REALLY DEAD-WOOD THEN
 3328 34050 5201          JMP     NXTCOR          /KEEPLOOKING
 3329 34051 6667  NXTNUL, SCHNUL
 3330       0040  NXTFLD= C1000                   /-CORTBL+1
 3331 34052 1736  NXTDSK, DSKACT
 3332 34053 7002  NXTCOP, CORTBL+1                /ROUND ROBIN CORTBL POINTER
 3333 34054 1316  NXTEND, CORTBE                  /END OR CORTBL
 3334 34055 0107  C0107,  107
 3335 34056 6600  C6600,  SWAP+LOCK+FIP+SI

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 77


 3336             
 3337 34057 0106  UHALSA, L2SA
 3338 34060 1003  UHALT,  TAD     UUOCAL          /IS IT AN OSR?
 3339 34061 0034          AND     C0004
 3340 34062 7650          SNA CLA                 /OSR?
 3341 34063 5273          JMP     UHALT1          /NO
 3342 34064 6201          CDF
 3343 34065 4476          GETJTW                  /YES, GET CURRENT VALUE OF SWITCHES
 3344 34066 0010          JOBSWR
 3345 34067 3272          DCA     UHALT2          /OR IT INTO AC
 3346 34070 1257          TAD     UHALSA          /WHICH IS RIDICULOUS, SINCE OSR
 3347 34071 4460          IOR                     /IS UNIVERSALLY CODED AS LAS, AND
 3348             NXTCNT,
 3349 34072 0000  UHALT2, 0                       /A SIMPLE "DCA L2SA" WOULD DO
 3350 34073 1003  UHALT1, TAD     UUOCAL          /NOW SEE IF IT WAS MICROCODED
 3351 34074 0032          AND     C0002           /HALT?
 3352 34075 7650          SNA CLA
 3353 34076 5461          UUOEXT
 3354 34077 4752          JMS I   USBCSI          /LOCATE HIS/HER DDB AND SEE IF HE'S IN SI MODE
 3355 34100 1047          TAD     FRECNT          /USER HAS EXECUTED HLT
 3356 34101 1041          TAD     C7770
 3357 34102 7750          SPA SNA CLA             /IF WE'RE SHORT ON FREE CORE, TRY LATER
 3358 34103 5470          REDO
 3359 34104 4476          GETJTW                  /CLEAR HIS/HER RUN BIT
 3360 34105 0000          JOBSTS
 3361 34106 0143          AND     C3777           /CLEAR JSRUN
 3362 34107 6211          DATFLD
 3363 34110 3405          DCA I   JOBSWA
 3364 34111 1132          TAD     CONDBA          /CONDBA WAS SET UP BY THE JMS TO UKT0
 3365 34112 4314          JMS     UHLTMS          /NOW TYPE ^BS FOR HIM/HER
 3366 34113 5577          WAIT
 3367             
 3368 34114 0000  UHLTMS, 0
 3369 34115 3327          DCA     UHLTM1          /SET DEVTBL POINTER
 3370 34116 6214          RDF
 3371 34117 1335          TAD     UHMES           /EITHER TYPE ^BS OR ^BS;K
 3372 34120 3016          DCA     AXS2
 3373 34121 6201          CDF
 3374 34122 1416  UHLTM0, TAD I   AXS2            /GET A CHARACTER
 3375 34123 7550          SPA SNA
 3376 34124 5332          JMP     UHLTM2          /END OF TEXT
 3377 34125 3031          DCA     TTCHAR          /SAVE IT
 3378 34126 4471          KEY                     /RUN IT INTO HIS/HER INPUT BUFFER
 3379 34127 0000  UHLTM1, .-.
 3380 34130 7000          NOP
 3381 34131 5322          JMP     UHLTM0          /GET ANOTHER ONE
 3382 34132 7640  UHLTM2, SZA CLA                 /WHERE DID WE COME FROM?
 3383 34133 6213          CIF DATFLD              /BACK TO 689 SERVICE
 3384 34134 5714          JMP I   UHLTMS
 3385             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 78


 3386             
 3387 34135 4135  UHMES,  .
 3388 34136 0202          "B-100
 3389 34137 0323          "S
 3390 34140 0273          ";
 3391 34141 0313          "K
 3392 34142 0215          215
 3393 34143 7377  C7377,  7377
 3394 34144 6642  USBCLR, CLRBUF
 3395 34145 1562  USBFLG, CLSTR1
 3396 34146 0202          "B-100
 3397 34147 0323          "S
 3398 34150 0213          213
 3399 34151 0000          0
 3400 34152 5031  USBCSI, UKT0
 3401             
 3402             /SELECTIVE BUFFER CLEAR
 3403 34153 4752  USBC,   JMS I   USBCSI          /CHECK FOR SI MODE
 3404 34154 6211          DATFLD
 3405 34155 1106          TAD     L2SA
 3406 34156 7104          CLL RAL
 3407 34157 7700          SMA CLA                 /CLEAR INPUT BUFFER?
 3408 34160 5370          JMP     USBC3           /NO
 3409 34161 1133          TAD     CONDDB          /INPUT DDB ADDRESS
 3410 34162 4744          JMS I   USBCLR          /CLEAR INPUT BUFFER
 3411 34163 1037          TAD     C0100
 3412 34164 4745          JMS I   USBFLG          /CLEAR FLAG
 3413 34165 1533          TAD I   CONDDB
 3414 34166 0343          AND     C7377           /CLEAR FULL BIT
 3415 34167 3533          DCA I   CONDDB
 3416 34170 1106  USBC3,  TAD     L2SA            /WHAT IS REQUESTED?
 3417 34171 7700          SMA CLA                 /CLEAR OUTPUT BUFFER?
 3418 34172 5376          JMP     USBC4           /NO
 3419 34173 2132          ISZ     CONDBA          /POINT TO OUTPUT SIDE
 3420 34174 1532          TAD I   CONDBA
 3421 34175 4744          JMS I   USBCLR          /CLEAR OUTPUT BUFFER
 3422 34176 3106  USBC4,  DCA     L2SA            /CLEAR HIS/HER AC
 3423 34177 5461          UUOEXT
 3424             
 3425             
 3426             
 3427             
 3428             
 3429             
 3430             
 3431       4200  *4200
 3432             
 3433             /STANDARD BOOTSTRAP AND RESTART ADDRESSES
 3434             
 3435 34200 5602          JMP I   .+2             /INIT BOOTSTRAP
 3436 34201 5603          JMP I   .+2             /RESTART ADDRESS
 3437 34202 3053          BOOT
 3438 34203 3175          DEBUG

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 79


 3439             
 3440 34204 0000  FILERC, 0                       /ROUTINE TO RECOVER FROM DISK ERRORS
 3441 34205 0000  FILUSA, 0                       /AND SET ERROR CODES FOR USER
 3442 34206 0000  FILEWC, 0                       /ERROR CODES ARE:
 3443       0150  FILER1= WS2                     /       1       PARITY
 3444                                             /       2       END OF FILE
 3445                                             /       3       FILE NOT OPEN
 3446                                             /       4       PROTECTION VIOLATION
 3447 34207 7577  FJSF3,  -JSF3-1
 3448       0034  FILECA= C0004                   /FILPCA
 3449       0035  FILECT= C0007                   /FILPCT
 3450       0032  FILEIF= C0002                   /FILPIF
 3451 34210 6000  C6000,  6000
 3452 34211 0000  FILERR, 0
 3453 34212 3204          DCA     FILERC          /ERROR CODE
 3454 34213 7344          CLL CLA CMA RAL         /AC:=-2
 3455 34214 1204          TAD     FILERC          /ERROR CODE - .GT.2?
 3456 34215 7750          SPA SNA CLA             /PROTECTED OR NOT OPEN?
 3457 34216 5234          JMP     FILER2          /NO
 3458 34217 4476          GETJTW                  /GET ADDRESS OF PARAMETER BLOCK
 3459 34220 0007          JOBLNK
 3460 34221 4576          RETBLK                  /RETURN IT TO FREE CORE
 3461 34222 7200          CLA
 3462 34223 1106          TAD     L2SA            /GET POINTER TO PARAMETERS IN USER AREA
 3463 34224 1266          TAD     F0005
 3464 34225 3211          DCA     FILERR          /POINTS TO SIXTH USER PARAMETER (ERROR CODE)
 3465 34226 1204          TAD     FILERC          /GET ERROR
 3466 34227 4150          UDF                     /SELECT USER FIELD
 3467 34230 3611          DCA I   FILERR          /PASS ERROR TO USER
 3468 34231 6201          CDF
 3469 34232 3106          DCA     L2SA            /CLEAR HIS/HER AC
 3470 34233 5461          UUOEXT                  /AND BACK TO HIM/HER
 3471             
 3472 34234 1611  FILER2, TAD I   FILERR          /END OF FILE OR PARITY ERROR...
 3473 34235 1032          TAD     FILEIF          /GET ADDRESS OF FILE PARAMETER BLOCK
 3474 34236 3324          DCA     FILER5          /POINTS TO WORD 3 OF BLOCK
 3475 34237 6211          DATFLD
 3476 34240 1724          TAD I   FILER5          /WAS FILE CALL ORIGINATED BY SI?
 3477 34241 0210          AND     C6000           /BITS 0-1 WILL BE SET IF SO...
 3478 34242 7650          SNA CLA
 3479 34243 5272          JMP     FILER4          /NO - IT CAME FROM USER PROGRAM
 3480 34244 1724          TAD I   FILER5          /YES - GET FIELD # FOR TRANSFER
 3481 34245 7012          RTR
 3482 34246 0035          AND     C0007           /MASK OUT FILE # BITS
 3483 34247 1162          TAD     CORTBA          /INDEX INTO CORTBL
 3484 34250 3205          DCA     FILUSA          /SAVE POINTER TO CORTBL ENTRY FOR THIS TRANSFER
 3485 34251 6201          CDF
 3486 34252 1605          TAD I   FILUSA          /GET CORTBL ENTRY
 3487 34253 0036          AND     C0037           /EXTRACT JOB #
 3488 34254 3205          DCA     FILUSA          /SAVE JOB #
 3489 34255 7144          CLL CMA RAL             /AC=-2
 3490 34256 1204          TAD     FILERC          /IS IT AN END OF FILE?
 3491 34257 7650          SNA CLA
 3492 34260 5267          JMP     FILER3          /YES; WE'RE ALMOST DONE THEN
 3493 34261 1204          TAD     FILERC          /NO - WAS THERE ANY ERROR AT ALL?
 3494 34262 7650          SNA CLA
 3495 34263 5267          JMP     FILER3          /NO

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 80


 3496 34264 1205          TAD     FILUSA          /PARITY ERROR - SET SYSTEM ERROR CODE IN STR0
 3497 34265 4463          ERROR
 3498 34266 0005  F0005,  DSKERR
 3499 34267 2211  FILER3, ISZ     FILERR          /INDEX PAST CALLING ARGUMENT
 3500 34270 6201          CDF
 3501 34271 5611          JMP I   FILERR          /AND BACK
 3502             
 3503             
 3504             
 3505 34272 1724  FILER4, TAD I   FILER5          /UPDATE USER CONTROL TO INDICATE ERROR CODE
 3506 34273 7004          RAL                     /SHIFT FIELD # INTO BITS 6-8
 3507 34274 0137          AND     C0070           /SAVE IT
 3508 34275 1335          TAD     FILCDF          /GENERATE "UDF"
 3509 34276 3324          DCA     FILER5          /USER FIELD SELECT
 3510 34277 6201          CDF
 3511 34300 1611          TAD I   FILERR          /PARAMETER BLOCK ADDRESS
 3512 34301 3206          DCA     FILEWC          /SAVE IT
 3513 34302 1206          TAD     FILEWC
 3514 34303 6211          DATFLD
 3515 34304 1034          TAD     FILECA
 3516 34305 3150          DCA     FILER1          /POINTS TO CORE ADDRESS IN PARAMETER BLOCK
 3517 34306 1550          TAD I   FILER1          /GET CORE ADDRESS
 3518 34307 3150          DCA     FILER1          /SAVE IT
 3519 34310 1206          TAD     FILEWC          /START OF PARAMETERS
 3520 34311 1035          TAD     FILECT          /+7
 3521 34312 3205          DCA     FILUSA          /POINTS TO PTR TO FILE CONTROL
 3522 34313 1605          TAD I   FILUSA          /GET ADDRESS OF FILE CONTROL
 3523 34314 1136          TAD     C0006           /POINTS TO WORD COUNT IN FILE CONTROL
 3524 34315 3206          DCA     FILEWC          /SAVE IT
 3525 34316 1206          TAD     FILEWC
 3526 34317 7001          IAC
 3527 34320 3205          DCA     FILUSA          /POINTS TO POINTER TO USER PARAMETERS
 3528 34321 1605          TAD I   FILUSA          /GET POINTER TO USER ARGUMENTS
 3529 34322 3205          DCA     FILUSA          /SAVE
 3530 34323 1606          TAD I   FILEWC          /GET WORD COUNT TO GO FROM CONTROL BLOCK
 3531 34324 0000  FILER5, 0                       /SELECT USER FIELD
 3532 34325 3605          DCA I   FILUSA          /SAVE IN USER AREA
 3533 34326 2205          ISZ     FILUSA          /POINTS TO WORD 4 OF USER ARGUMENTS
 3534 34327 1150          TAD     FILER1          /GET LATEST CORE XFER ADDRESS
 3535 34330 3605          DCA I   FILUSA          /SAVE FOR USER
 3536 34331 2205          ISZ     FILUSA
 3537 34332 2205          ISZ     FILUSA          /POINTS TO WORD 6 (ERROR WORD)
 3538 34333 1204          TAD     FILERC          /GET ERROR CODE
 3539 34334 3605          DCA I   FILUSA          /PASS ON TO USER
 3540 34335 6201  FILCDF, CDF
 3541 34336 5267          JMP     FILER3          /AND BACK

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 81


 3542             
 3543 34337 7445  BRKTBL, -"Z-1                   /LETTERS
 3544 34340 0032          "Z-"A+1
 3545 34341 2000          2000
 3546             
 3547 34342 0007          "A-"9-1                 /NUMBERS
 3548 34343 0012          "9-"0+1
 3549 34344 1000          1000
 3550             
 3551 34345 0046          "0-211-1                /HORIZONTAL TAB
 3552 34346 0001          211-211+1
 3553 34347 0400          0400
 3554             
 3555 34350 7773          211-215-1               /LF, VT, FF, CR
 3556 34351 0004          215-212+1
 3557 34352 0200          0200
 3558             
 3559 34353 7716          212-";-1                /! @ # DOLLAR % & ' ( ) * + , - . / : ;
 3560 34354 0033          ";-"!+1
 3561 34355 0100          0100
 3562             
 3563 34356 0000          "!-240-1                /SPACE
 3564 34357 0001          240-240+1
 3565 34360 0040          0040
 3566             
 3567 34361 7737          240-"@-1                /< = > ? @
 3568 34362 0005          "@-"<+1
 3569 34363 0020          0020
 3570             
 3571 34364 7734          "<-"_-1                 /[ \ ] _
 3572 34365 0005          "_-"[+1
 3573 34366 0010          0010
 3574             
 3575 34367 7733          "[-377-1                /RUBOUT
 3576 34370 0001          377-377+1
 3577 34371 0004          0004
 3578             
 3579 34372 0000          377-376-1               /ALTMODE
 3580 34373 0002          376-375+1
 3581 34374 0002          0002
 3582             
 3583 34375 7775          375-377-1               /EVERYTHING ELSE
 3584 34376 0400          377-0+1
 3585 34377 0001          0001

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 82


 3586             
 3587       4400  *4400
 3588             
 3589             /RFILE AND WFILE IOTS
 3590             
 3591 34400 1352  UFILE,  TAD     UFILWA          /NO, GET USER PARAMETERS
 3592 34401 4754          JMS I   UFPARM          /AND MOVE TO PARAMETER BLOCK
 3593 34402 1755          TAD I   UFLNKA          /ADDRESS OF PARAMETER BLOCK
 3594 34403 1032          TAD     UFIPIF
 3595 34404 3003          DCA     UFPARA          /POINTS TO WORD 3 OF BLBOCK
 3596 34405 6211          DATFLD
 3597 34406 1403          TAD I   UFPARA          /CLEAR ALL BUT FILE # IN BLOCK
 3598 34407 0033          AND     C0003
 3599 34410 3403          DCA I   UFPARA          /SAVE IT
 3600 34411 1106          TAD     L2SA            /ADDRESS OF USER PARAMETERS
 3601 34412 1032          TAD     UFIPWC          /+2
 3602 34413 3341          DCA     UFILE1          /POINTS TO WORD COUNT IN USER AREA
 3603 34414 1403          TAD I   UFPARA          /FILE #
 3604 34415 6201  SIFIL1, CDF
 3605 34416 1353          TAD     UFJF0           /RELATIVE ADDRESS OF FILE 0 POINTER
 3606 34417 3221          DCA     UFJOBF          /RELATIVE ADDR OF FILE POINTER FOR THIS FILE
 3607 34420 4476          GETJTW
 3608 34421 0000  UFJOBF, 0                       /POINTER TO FILE CONTROL INFO
 3609 34422 7450          SNA
 3610 34423 5335          JMP     UFILER+1        /FILE NOT OPEN
 3611 34424 3221          DCA     UFJOBF          /SAVE POINTER TO FILE CONTROL
 3612 34425 6211          DATFLD
 3613 34426 1403          TAD I   UFPARA          /FILE #
 3614 34427 4762          JMS I   UFIGJF          /GENERATE CORRESPONDING FILE BIT IN STR1
 3615 34430 3004          DCA     UFIJSF          /FILE STATUS FLAG
 3616 34431 1103          TAD     L2SF            /USER'S FIELD #
 3617 34432 0035          AND     C0007
 3618 34433 7106          CLL RTL                 /*4
 3619 34434 3005          DCA     JOBSWA          /SAVE
 3620 34435 1403          TAD I   UFPARA          /GET FILE # + ORIGINATING STATUS INFO
 3621 34436 0351          AND     C7743           /CLEAR FIELD #
 3622 34437 1005          TAD     JOBSWA          /SET FIELD #
 3623 34440 3403          DCA I   UFPARA          /SAVE IN PARAMETERS
 3624 34441 1221          TAD     UFJOBF          /SAVE GLOBAL PARAMETERS
 3625 34442 7001          IAC                     /POINTS TO WORD 2 OF CONTROL BLOCK
 3626 34443 3015          DCA     AXS1            /CONTROL INDEX
 3627 34444 7346          CLL CLA CMA RTL         /AC:=-3
 3628 34445 1003          TAD     UFPARA
 3629 34446 3016          DCA     AXS2            /PARAMETER INDEX POINTS TO START OF PARAMETERS-1
 3630 34447 1416          TAD I   AXS2            /WRITE AND PROTECTED?
 3631 34450 0415          AND I   AXS1
 3632 34451 0034          AND     C0004           /CHECK ONLY FOR WRITE PROTECT
 3633 34452 7640          SZA CLA
 3634 34453 5334          JMP     UFILER          /YES - ERROR
 3635 34454 1016          TAD     AXS2            /NO, SET FILPAR = START OF PARAMETER BLOCK
 3636 34455 3415          DCA I   AXS1
 3637 34456 1416          TAD I   AXS2            /DISC EXTENSION FROM PARAMETERS
 3638 34457 3415          DCA I   AXS1            /TO CONTROL BLOCK
 3639 34460 2016          ISZ     AXS2            /SKIP FIELD
 3640 34461 1416          TAD I   AXS2            /SAVE WC
 3641 34462 3005          DCA     JOBSWA
 3642 34463 2016          ISZ     AXS2            /SKIP CORE ADDRESS FOR NOW

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 83


 3643 34464 1416          TAD I   AXS2            /DISC ADDRESS
 3644 34465 3415          DCA I   AXS1            /TO CONTROL BLOCK
 3645 34466 1360          TAD     UFIRET          /RETURN ADDRESS
 3646 34467 3416          DCA I   AXS2            /TO PARAMETER BLOCK
 3647 34470 1221          TAD     UFJOBF          /POINTER TO FILE CONTROL
 3648 34471 3416          DCA I   AXS2            /TO PARAMETER BLOCK
 3649 34472 1005          TAD     JOBSWA          /WORD COUNT
 3650 34473 3415          DCA I   AXS1            /TO CONTROL BLOCK
 3651 34474 1341          TAD     UFILE1          /POINTS TO WC IN USER AREA
 3652 34475 7450          SNA                     /IS THIS AN SI REQUEST?
 3653 34476 5301          JMP     .+3             /YES
 3654 34477 3415          DCA I   AXS1            /NO, SAVE POINTER TO WC IN CONTROL BLOCK
 3655 34500 3106          DCA     L2SA            /CLEAR USER AC
 3656 34501 1221          TAD     UFJOBF          /POINTER TO CONTROL BLOCK
 3657 34502 1033          TAD     UFPAR2          /+3
 3658 34503 3311          DCA     UFILPA          /POINTS TO POINTER IN CONTROL BLOCK POINTING TO PARAM. BLOCK
 3659 34504 1221          TAD     UFJOBF          /POINTS TO FILE CONTROL
 3660 34505 4757          JMS I   UFILIX          /GET SEGMENT INDEX
 3661 34506 5764          JMP I   UFIL4A          /NOT IN CORE - DO A WINDOW TURN
 3662 34507 5330          JMP     UFILE2          /NON-EXISTENT DISC ADDRESS
 3663 34510 4761          JMS I   UFICTB          /OK, SET UP TRANSFER BLOCK - POINTER TO SEGMENT # IN AC
 3664 34511 0000  UFILPA, 0                       /POINTER TO FILPAR
 3665 34512 1711          TAD I   UFILPA          /ADDRESS OF PARAMETERS
 3666 34513 4763          JMS I   UFIQUE          /QUEUE THE REQUEST IN DSUTBL
 3667 34514 2165          ISZ     DSBUSY          /DISC BUSY?
 3668 34515 7410          SKP                     /YES
 3669 34516 4462          JMS I   FIUSER          /NO, START TRANSFER
 3670 34517 1004          TAD     UFIJSF          /CLEAR FILE STATUS BIT
 3671 34520 5461          UUOEXT                  /EXIT
 3672             
 3673 34521 6211  SIFILE, DATFLD                  /HANDLE SI FILE TRANSFERS
 3674 34522 1032          TAD     UFIPIF
 3675 34523 3003          DCA     UFPARA          /POINTS TO FILE # IN PARAMETERS
 3676 34524 3341          DCA     UFILE1
 3677 34525 1403          TAD I   UFPARA          /GET FILE #
 3678 34526 0033          AND     C0003           /ONLY FILE #
 3679 34527 5215          JMP     SIFIL1          /REST IS SAME AS USER PROGRAMS

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 84


 3680             
 3681 34530 4476  UFILE2, GETJTW                  /NON-EXISTENT DISK ADDRESS
 3682 34531 0007          JOBLNK                  /GET ADDRESS OF PARAMETERS
 3683 34532 3341          DCA     UFILE1          /SAVE IT
 3684 34533 5336          JMP     .+3
 3685 34534 7001  UFILER, IAC                     /PROTECTED
 3686 34535 7001          IAC                     /NOT OPEN
 3687 34536 1032          TAD     C0002           /EOF
 3688 34537 6201          CDF
 3689 34540 4756          JMS I   UFERR           /FILE ERROR ROUTINE
 3690 34541 0000  UFILE1, 0                       /POINTS TO PARAMETER BLOCK
 3691 34542 1341          TAD     UFILE1
 3692 34543 4576          RETBLK                  /RETURN PARA BLK
 3693 34544 7200          CLA
 3694 34545 1147          TAD     CURJOB          /DID WE BUMP SOMEONE ELSE OFF?
 3695 34546 7640          SZA CLA
 3696 34547 5577          WAIT                    /YES - GO BACK TO HIM/HER
 3697 34550 5461          UUOEXT                  /NO - BACK TO THIS USER
 3698             
 3699       0003  UFPARA= WS0                     /ADDR OF USER PARAMETERS
 3700       0004  UFIJSF= WS1                     /FILE STATUS FLAG
 3701 34551 7743  C7743,  7743
 3702 34552 7176  UFILWA, UFILCT
 3703 34553 0017  UFJF0,  JOBF0
 3704       0033  UFPAR2= C0003                   /FILPAR
 3705       0032  UFIPIF= C0002                   /FILPIF
 3706       0032  UFIPWC= C0002                   /FILPWC
 3707             
 3708 34554 2305  UFPARM, GETUSP
 3709 34555 2345  UFLNKA, UUOLNK
 3710 34556 4211  UFERR,  FILERR
 3711 34557 5201  UFILIX, FILIX
 3712 34560 5400  UFIRET, DSURET
 3713 34561 4631  UFICTB, FILCTB
 3714 34562 5600  UFIGJF, GETJFX
 3715 34563 6714  UFIQUE, DSQUE
 3716 34564 2254  UFIL4A, UFILE4
 3717             
 3718 34565 6212  RKL20,  CIF DATFLD-1
 3719 34566 5767          JMP I   .+1
 3720 34567 1623          RKL21

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 85


 3721             
 3722             /RETURN CONTENT OF JOB STATUS FOR CURRENT JOB
 3723             /CALL
 3724             /       GETJTW
 3725             /       RELATIVE ADDRESS OF WORD
 3726             /       RETURN (CONTENTS IN AC, ABSOLUTE ADD IN JOBSWA)
 3727             
 3728 34570 0000  GETJW0, 0
 3729 34571 1770          TAD I   GETJW0          /GET RELATIVE ADDRESS
 3730 34572 3375          DCA     .+3             /SAVE IT
 3731 34573 1161          TAD     CJOBDA          /POINTER TO CURRENT JOB STATUS
 3732 34574 4477          GETJTI                  /GETCONTENTS
 3733 34575 0000          0
 3734 34576 2370          ISZ     GETJW0          /INDEX RETURN
 3735 34577 5770          JMP I   GETJW0
 3736             
 3737             
 3738             
 3739       4600  *4600
 3740             
 3741             /RETURN NUMBER OF NEXT RUNNABLE JOB IN AC
 3742             /CALL   JMS NXTJOB
 3743             /       RETURN WITH JOB # IN AC
 3744             
 3745             FILCDA,
 3746 34600 0000  NXTJCT, 0
 3747 34601 0000  NXTJBN, 0                       /NEXT JOB #
 3748 34602 7754  NXTJMM, -JOBMAX
 3749             
 3750             FILCT2,
 3751 34603 0000  NXTJOB, 0
 3752 34604 3055          DCA     FIT             /CLEAR FIT
 3753 34605 1057          TAD     BONUS           /IS THERE ANY JOB BROKEN OUT OF KEYBOARD WAIT?
 3754 34606 4501          RUNABL                  /IS IT RUNNABLE?
 3755 34607 5212          JMP     NXTJ1           /NO, GET THE NEXT JOB
 3756 34610 1057          TAD     BONUS           /THIS JOB
 3757 34611 5603          JMP I   NXTJOB
 3758 34612 2200  NXTJ1,  ISZ     NXTJCT          /HAVE WE TRIED ALL JOBS?
 3759 34613 7410          SKP                     /NO, KEEP GOING
 3760 34614 5465          SCHED                   /TRY FOR A RESIDENT JOB
 3761 34615 1201          TAD     NXTJBN          /IS IT TIME TO WRAP AROUND TO JOB 1?
 3762 34616 1202          TAD     NXTJMM
 3763 34617 7650          SNA CLA
 3764 34620 3201          DCA     NXTJBN          /YES
 3765 34621 2201          ISZ     NXTJBN          /INCREMENT NUMBER OF JOB UNDER CONSIDERATION
 3766 34622 1201  NXTJ2,  TAD     NXTJBN          /IS THE JOB RUNNABLE?
 3767 34623 4501          RUNABL
 3768 34624 5212          JMP     NXTJ1           /NO, CONTINUE JOB TABLE ROUND ROBIN
 3769 34625 1201          TAD     NXTJBN          /YES, RETURN WITH JOB NO. IN AC
 3770 34626 5603          JMP I   NXTJOB

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 86


 3771             
 3772             /CONSTRUCT TRANSFER BLOCK
 3773             /CALL   TAD SEGMENT WINDOW POINTER
 3774             /       JMS FILCTB
 3775             /       POINTER TO FILPAR
 3776             
 3777       0034  FILCPD= C0004                   /FILPDA-FILPDX
 3778       0145  FILCWC= C7776                   /FILPWC-FILPDA
 3779       0005  FILCSW= JOBSWA                  /POINTER TO SEGMENT WINDOW
 3780       0150  FILCPA= WS2                     /POINTER TO FILPAR & FILDA
 3781 34627 0000  FILCWA, 0
 3782 34630 0000  FILCPX, 0                       /POINTER TO FILPDX, FILPDA & FILPWC
 3783             
 3784 34631 0000  FILCTB, 0
 3785 34632 3005          DCA     FILCSW          /SAVE POINTER TO SEGMENT IN WINDOW
 3786 34633 1631          TAD I   FILCTB
 3787 34634 3150          DCA     FILCPA          /ADDRESS OF POINTER TO PARAMETER BLOCK
 3788 34635 2231          ISZ     FILCTB          /SKIP ARGUMENT IN CALL
 3789 34636 6211          DATFLD
 3790 34637 1550          TAD I   FILCPA          /GET ADDRESS OF PARAMETERS
 3791 34640 7001          IAC                     /POINTS TO WORD 2 OF PARAMETERS
 3792 34641 3230          DCA     FILCPX
 3793 34642 2150          ISZ     FILCPA          /POINTS TO DISK EXTENSION IN CONTROL BLOCK
 3794 34643 7240          CLA CMA
 3795 34644 1405          TAD I   FILCSW          /GET SEGMENT #
 3796 34645 7110          CLL RAR
 3797 34646 7012          RTR
 3798 34647 7012          RTR                     /MULTIPLY BY 400 SEG SIZE
 3799 34650 3203          DCA     FILCT2          /SAVE "PRODUCT"
 3800 34651 1203          TAD     FILCT2
 3801 34652 7004          RAL
 3802 34653 0140          AND     SEGSM1          /THROW OUT CONTRIBUTION FROM HI ORDER BITS OF EXTENSION
 3803 34654 1363          TAD     FIBAS1          /START OF LOGICAL FILE AREA
 3804 34655 7106          CLL RTL
 3805 34656 3630          DCA I   FILCPX          /SAVE IN DISK EXTENSION IN PARAMETER BLOCK
 3806 34657 1203          TAD     FILCT2          /NOW GET LOW ORDER ADDRESS
 3807 34660 0134          AND     SEGLMK
 3808 34661 3203          DCA     FILCT2          /AND SAVE IT
 3809 34662 1230          TAD     FILCPX          /SET DISC ADDRESS
 3810 34663 1034          TAD     FILCPD
 3811 34664 3230          DCA     FILCPX          /POINTS TO LOW ORDER ADDRESS IN PAR. BLOCK
 3812 34665 1150          TAD     FILCPA
 3813 34666 7001          IAC
 3814 34667 3200          DCA     FILCDA          /POINTS TO LOW ORDER ADDRESS IN CONTROL BLOCK
 3815 34670 1600          TAD I   FILCDA          /GET WORD ADDRESS SUPPLIED BY USER
 3816 34671 0140          AND     SEGSM1          /(WORD IN SEGMENT)
 3817 34672 1203          TAD     FILCT2          /+ WORD ADDRESS FROM SEGMENT ARITHMETIC
 3818 34673 3630          DCA I   FILCPX          /SAVE IT IN PARAMETER BLOCK
 3819 34674 1230          TAD     FILCPX          /SET WORD COUNT
 3820 34675 1145          TAD     FILCWC
 3821 34676 3230          DCA     FILCPX          /POINTS TO WORD COUNT IN PARAMETER BLOCK
 3822 34677 3630          DCA I   FILCPX          /NOTHING TRANSFERRED YET
 3823 34700 1200          TAD     FILCDA
 3824 34701 7001          IAC
 3825 34702 3227          DCA     FILCWA          /POINTS TO WORD COUNT IN CONTROL BLOCK

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 87


 3826             
 3827 34703 1140  FILCT1, TAD     SEGSM1          /SEGS12-1
 3828 34704 0600          AND I   FILCDA          /LOW ORDER ADDRESS IN CONTROL BLOCK
 3829 34705 3203          DCA     FILCT2          /DISC ADDRESS MOD SEGS!Z
 3830 34706 1627          TAD I   FILCWA          /GET -WC FROM CONTROL BLOCK
 3831 34707 7141          CLL CIA                 /+WC
 3832 34710 1203          TAD     FILCT2          /IF WE DO ENTIRE WC WILL WE GO INTO NEXT
 3833 34711 0134          AND     SEGLMK          /  SEGMENT?
 3834 34712 7650          SNA CLA
 3835 34713 7430          SZL
 3836 34714 5317          JMP     FILCT3
 3837 34715 1627          TAD I   FILCWA          /NO
 3838 34716 5321          JMP     .+3
 3839 34717 1134  FILCT3, TAD     SEGLMK          /SUBTRACT SEGS12 FROM WC, SO WE STAY IN SAME SEGMENT
 3840 34720 1203          TAD     FILCT2
 3841 34721 3203          DCA     FILCT2          /WORD COUNT FOR TRANSFER
 3842 34722 1203          TAD     FILCT2          /UPDATE WORD COUNT IN PARAMETER BLOCK
 3843 34723 1630          TAD I   FILCPX          /OLD VALUE
 3844 34724 3630          DCA I   FILCPX          /NEW VALUE
 3845 34725 1203          TAD     FILCT2          /UPDATE WORD COUNT IN FILE CONTROL BLOCK
 3846 34726 7041          CIA                     /+WC
 3847 34727 1627          TAD I   FILCWA          /OLD -WC
 3848 34730 3627          DCA I   FILCWA          /NEW -WC
 3849 34731 1627          TAD I   FILCWA          /ARE WE DONE?
 3850 34732 7650          SNA CLA
 3851 34733 5631          JMP I   FILCTB          /YES
 3852 34734 1203          TAD     FILCT2          /INCREMENT DISC ADDRESS
 3853 34735 7141          CLL CIA                 /+WC
 3854 34736 1600          TAD I   FILCDA          /OLD DISC ADDRESS
 3855 34737 3600          DCA I   FILCDA          /NEW DISC ADDRESS
 3856 34740 7430          SZL                     /OVERFLOW?
 3857 34741 2550          ISZ I   FILCPA          /YES - INDEX DISC EXTENSION
 3858 34742 1405          TAD I   FILCSW          /GET CURRENT SEGMENT #
 3859 34743 7140          CLL CMA                 /-(SEGMENT # +1)
 3860 34744 3203          DCA     FILCT2          /SAVE IT
 3861 34745 2005          ISZ     FILCSW          /POINTS TO NEXT SEGMENT IN WINDOW
 3862 34746 1005          TAD     FILCSW          /ARE WE STILL IN THE WINDOW?
 3863 34747 0035          AND     C0007
 3864 34750 7640          SZA CLA                 /NEXT POINTER IN CORE?
 3865 34751 5356          JMP     FILCT4          /YES, SEE IF NEXT SEGMENT IS CONTIGUOUS
 3866 34752 1135          TAD     BASWIN          /NO, IS IT BASIC?
 3867 34753 1005          TAD     FILCSW          /COMPARE THE WINDOW ADDRESS WITH BASIC WINDOW ADDRESS
 3868 34754 7620          SNL CLA
 3869 34755 5631          JMP I   FILCTB          /NO, RETURN
 3870 34756 1405  FILCT4, TAD I   FILCSW          /GET THE NEXT SEGMENT
 3871 34757 1203          TAD     FILCT2          /CONTIGUOUS SEGMENTS?
 3872 34760 7650          SNA CLA
 3873 34761 5303          JMP     FILCT1          /YES - CONTINUE THE TRANSFER
 3874 34762 5631          JMP I   FILCTB          /RETURN
 3875 34763 0031  FIBAS1, SWDEX+JOBMAX

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 88


 3876             
 3877             /TAKE CARE OF DUPLEX AND UNDUPLEX IOT'S
 3878             
 3879 34764 1002  UDUP,   TAD     C0200           /DUPLEX BIT IN DDB WORD 1
 3880 34765 3003  UUND,   DCA     WS0             /WS0 CONTAINS BIT TO ADD FOR BOTH IOT'S
 3881 34766 1160          TAD     JOB
 3882 34767 4464          TTYUSE                  /FIND INPUT DDB
 3883 34770 3004          DCA     WS1             /ADDRESS OF DDB
 3884 34771 6211          DATFLD
 3885 34772 1404          TAD I   WS1             /WORD ONE OF DDB
 3886 34773 0377          AND     C7577           /CLEAR DUPLEX BIT
 3887 34774 1003          TAD     WS0             /SET IT AS CALLED FOR
 3888 34775 3404          DCA I   WS1
 3889 34776 5461          UUOEXT
 3890             
 3891 34777 7577  C7577,  7577

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 89


 3892             
 3893       5000  *5000
 3894             
 3895             /TELEPRINTER IOT'S
 3896             
 3897       0003  UTELC=  WS0
 3898             
 3899             
 3900 35000 4231  UTEL,   JMS     UKT0            /FIND THE CONSOLE # ATTACHED TO JOB
 3901 35001 2132          ISZ     CONDBA          /POINT TO OUTPUT SIDE
 3902 35002 1230  UULPT,  TAD     UJSTEL          /TTY FLAG
 3903 35003 3206  UUPTP,  DCA     UOUTFL          /SAVE THE DEVICE'S FLAG
 3904 35004 4315          JMS     UKT1            /WHAT IS REQUESTED BY USER?
 3905 35005 5251          JMP     UTELS           /SEND A STRING (6XX0)
 3906 35006 0020  UOUTFL, JSTEL                   /DEVICE FLAG POSITION IN STR1
 3907 35007 5677          JMP I   UTELS1          /UNCONDITIONAL SKIP ON USER "TSF, PSF, OR LSF"
 3908 35010 7650          SNA CLA                 /6XX4 OR 6XX2
 3909 35011 5461          UUOEXT                  /6XX2 - IF WE CLEAR FLAGS WE MAY DIE
 3910 35012 1106          TAD     L2SA            /6XX4
 3911 35013 3031          DCA     TTCHAR
 3912 35014 4573          PRINT                   /OUTPUT THE CHARACTER
 3913 35015 7410          SKP                     /NO ROOM - REDO LATER
 3914 35016 5461          UUOEXT                  /OK - ALL DONE
 3915 35017 7240          STA                     /BACK UP HIS/HER PC
 3916 35020 1104          TAD     L2SV0
 3917 35021 3104          DCA     L2SV0
 3918 35022 5226          JMP     UTELS6
 3919 35023 3106  UTELS5, DCA     L2SA            /CLEAR USER'S AC
 3920 35024 1231          TAD     UKT0            /KEEP HIM/HER RUNNING IF WE WERE ABLE TO ACCEPT ANY CHARACTERS
 3921 35025 7650          SNA CLA
 3922 35026 1206  UTELS6, TAD     UOUTFL          /MAKE HIM/HER WAIT FOR DEVICE FLAG
 3923 35027 5461          UUOEXT                  /AND AWAY
 3924 35030 0020  UJSTEL, JSTEL
 3925             
 3926 35031 0000  UKT0,   0
 3927 35032 1160          TAD     JOB
 3928 35033 4464          TTYUSE                  /GET ADDR OF INPUT DDB
 3929 35034 3133          DCA     CONDDB          /SAVE IT
 3930 35035 6211          DATFLD                  /GET CONTENTS OF FIRST WORD OF DDB
 3931 35036 1533          TAD I   CONDDB          /UNIT # + FLAGS IN AC
 3932 35037 6201          CDF
 3933 35040 0040          AND     C1000
 3934 35041 7650          SNA CLA                 /CONSOLE IN SI MODE?
 3935 35042 5631          JMP I   UKT0            /NO - OK TO CONTINUE
 3936 35043 4476          GETJTW
 3937 35044 0003          JOBWMK
 3938 35045 7200          CLA
 3939 35046 6211          DATFLD
 3940 35047 3405          DCA I   JOBSWA          /CLEAR HIS/HER WAIT MASK TO HANG HIM/HER UP
 3941 35050 5470          REDO                    /SI WILL WAKE HIM/HER UP TO TRY AGAIN LATER

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 90


 3942             
 3943       0034  UJSPTP= C0004
 3944             / "SEND-A-STRING"
 3945             
 3946             
 3947 35051 4150  UTELS,  UDF                     /SELECT USER'S FIELD
 3948 35052 1506          TAD I   L2SA
 3949 35053 7650          SNA CLA
 3950 35054 5275          JMP     UTELS4          /USER'S W.C. IS ZERO - SO SEND NOTHING
 3951 35055 3231          DCA     UKT0
 3952 35056 1106          TAD     L2SA
 3953 35057 7001          IAC
 3954 35060 3003          DCA     UTELC           /POINTS TO ADDRESS OF STRING IN USER AREA
 3955 35061 1403          TAD I   UTELC           /GET ADDRESS-1 OF STRING
 3956 35062 3016          DCA     AXS2            /SAVE POINTER TO STRING
 3957 35063 1416  UTELS3, TAD I   AXS2            /GET CHARACTER FROM USER
 3958 35064 6201          CDF
 3959 35065 3031          DCA     TTCHAR
 3960 35066 4573          PRINT                   /OUTPUT THE CHARACTER
 3961 35067 5223          JMP     UTELS5          /BUFFER FULL
 3962 35070 4150          UDF
 3963 35071 2403          ISZ I   UTELC           /BUMP ADDRESS IN USER AREA
 3964 35072 2231          ISZ     UKT0            /DOESN'T MATTER THAT WE MAY SKIP THIS
 3965 35073 2506          ISZ I   L2SA            /BUMP USER'S WORD COUNT
 3966 35074 5263          JMP     UTELS3          /KEEP GOING
 3967 35075 3106  UTELS4, DCA     L2SA            /ALL DONE --- CLEAR USER AC
 3968 35076 5677          JMP I   UTELS1          /EXIT AND SKIP
 3969 35077 7215  UTELS1, UUOEX2
 3970             
 3971             /LINE PRINTER UUO'S
 3972             
 3973 35100 4714  ULPT,   JMS I   UPTLPA
 3974 35101 3045          DEVTBE+3                /LINE PRINTER POSITION IN DEVTBL
 3975 35102 1301          TAD     .-1
 3976 35103 3132          DCA     CONDBA          /IT'S OK TO USE THE PRINTER
 3977 35104 1230          TAD     UJSTEL          /LPT FLAG (20+20=40)
 3978 35105 5202          JMP     UULPT
 3979             
 3980             /PAPER TAPE PUNCH UUO'S
 3981             
 3982 35106 4714  UPTP,   JMS I   UPTLPA          /OK TO USE PUNCH?
 3983 35107 3043          DEVTBE+1                /PUNCH'S POSITION IN THE DEVTBL
 3984 35110 1307          TAD     .-1
 3985 35111 3132          DCA     CONDBA          /PASS ON THE PUNCH'S POSITION
 3986 35112 1034          TAD     UJSPTP          /PUNCH FLAG
 3987 35113 5203          JMP     UUPTP
 3988 35114 2125  UPTLPA, DEVCHK

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 91


 3989             
 3990             /ROUTINE TO ANALYZE IOT'S
 3991             /CALLING SEQUENCE:
 3992             /       IOT IN UUOCAL
 3993             /       JMS UKT1
 3994             /       RETURN FOR STRING IOT
 3995             /       FLAG TO CHECK IN STR1
 3996             /       RETURN FOR NON-SKIPPING FLAG TESTS
 3997             /       RETURN FOR EVENT TIMES 2 AND 4 (AC=BIT 9 OF IOT; LINK=BIT 10)
 3998             /       ILLEGAL MICRO-CODING RESULTS IN "NOP"
 3999             /       SKIPPING FLAG RESULTS IN INCREMENT OF USER PC
 4000 35115 0000  UKT1,   0
 4001 35116 1003          TAD     UUOCAL
 4002 35117 0035          AND     C0007
 4003 35120 7450          SNA                     /STRING?
 4004 35121 5715          JMP I   UKT1            /YES
 4005 35122 2315          ISZ     UKT1
 4006 35123 7110          CLL RAR                 /NO
 4007 35124 7420          SNL                     /SKIP TEST?
 4008 35125 5340          JMP     UKT12           /NO
 4009 35126 7640          SZA CLA                 /YES - ANYTHING ELSE?
 4010 35127 5461          UUOEXT                  /YES - BAD MICRO-CODING
 4011 35130 4476          GETJTW                  /GET HIS/HER STR1
 4012 35131 0001          JOBSTS+1
 4013 35132 0715          AND I   UKT1            /FLAG TO CHECK
 4014 35133 7112          CLL RTR                 /IGNORE THE ERROR FLAG
 4015 35134 2315          ISZ     UKT1            /INDEX PAST ARGUMENT
 4016 35135 7650          SNA CLA                 /FLAG SET?
 4017 35136 5715          JMP I   UKT1            /NO - DON'T SKIP
 4018 35137 5677          JMP I   UTELS1          /YES - SKIP ON EXIT
 4019 35140 2315  UKT12,  ISZ     UKT1
 4020 35141 2315          ISZ     UKT1
 4021 35142 7110          CLL RAR
 4022 35143 5715          JMP I   UKT1            /INDEX RETURN

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 92


 4023             
 4024 35144 6201  UUOERR, CDF                     /SET "ILLEGAL IOT" ERROR CODE
 4025 35145 1160          TAD     JOB
 4026 35146 4463          ERROR
 4027 35147 0001          UUOERF                  /CODE=1
 4028 35150 5577  USYN,   WAIT                    /AND BACK TO THE SCHEDULER
 4029             
 4030       0003  USTMT1= WS0
 4031 35151 1160  SLEEP,  TAD     JOB
 4032 35152 7650          SNA CLA                 /PROBABLE TROUBLE DUE TO EAE
 4033 35153 5467          EXIT
 4034 35154 1032          TAD     C0002
 4035 35155 7041  DOUSTM, CIA                     /NEGATE
 4036 35156 3367          DCA     DOSTM1          /SAVE - # UNITS OF TIME
 4037 35157 1160          TAD     JOB             /SET CLKTBBL ENTRY FOR THIS JOB
 4038 35160 1370          TAD     CLKTBA
 4039 35161 3003          DCA     USTMT1          /POINTS TO THIS JOB'S ENTRY
 4040 35162 1367          TAD     DOSTM1
 4041 35163 6211          DATFLD
 4042 35164 3403          DCA I   USTMT1          /SET TABLE ENTRY
 4043 35165 7130          STL RAR                 /SET AC=JSTIME
 4044 35166 5461          UUOEXT                  /EXIT AND WAIT
 4045 35167 0000  DOSTM1, 0
 4046 35170 3111  CLKTBA, CLKTBL                  /JOB TIMER TABLE ADDRESS
 4047             
 4048       5171  *5171
 4049 35171 7410  OVERLA, SKP                     /ERROR
 4050 35172 5777          JMP I   OVER1A          /OK, FINISH UP
 4051 35173 1442          TAD I   FANCOR          /GET NUMBER OF JOB IN TROUBLE
 4052 35174 4463          ERROR                   /PASS ERROR TO USER
 4053 35175 0005          DSKERR
 4054 35176 5777          JMP I   OVER1A          /NOW FINISH UP
 4055 35177 5565  OVER1A, OVERL1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 93


 4056             
 4057             /NULL JOB IS THE ONLY INSTRUCTION IN FIELD 0 WHICH
 4058             /IS EXECUTED IN USER MODE.
 4059             /IT IS RUN WHENEVER THERE IS NOTHING ELSE
 4060             /TO DO, OR NOTHING ELSE THAT CAN BE DONE.
 4061             /
 4062             /WHEN DEBUGGING THE MONITOR, IT IS POSSIBLE
 4063             /TO STOP (VIA THE PDP-8 OPERATOR CONSOLE) THE MONITOR
 4064             /TO ENTER XDDT. THIS MAY ONLY BE DONE
 4065             /WHEN THE SYSTEM IS IN NULJOB. IF THE
 4066             /SYSTEM IS STOPPED WHEN NOT IN NULJOB, IT MAY
 4067             /BE RESTARTED BY HITTING "CONTINUE," AND THEN
 4068             /STOPPED AGAIN. KEEP TRYING - EVENTUALLY YOU'LL CATCH IT.
 4069             /DO NOT STOP THE SYSTEM (AND EXPECT TO GET AWAY WITH IT)
 4070             /IF ANY I/O IS IN PROGRESS.
 4071             
 4072             /IF THE SYSTEM IS STOPPED IN NULJOB, IT MAY BE
 4073             /RESTARTED AT LOCATION 4201 IN FIELD 0.
 4074             
 4075             
 4076             
 4077 35200 5200  NULJOB, JMP     .               /IT'S A BIGGY, ISN'T IT?

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 94


 4078             
 4079             
 4080             /RETURN FILE WINDOW INDEX
 4081             /CALL   TAD POINTER TO FILE CONTROL
 4082             /       JMS FILIX
 4083             /       SEGMENT ADDRESS NOT IN WINDOW
 4084             /       NON-EXISTENT FILE ADDRESS
 4085             /       OK RETURN WITH ADDRESS OF SEGMENT POINTER
 4086             
 4087       0034  FILIDA= C0004                   /FILDA
 4088             
 4089 35201 0000  FILIX,  0
 4090 35202 3277          DCA     FILICN          /SAVE POINTER TO FILE CONTROL
 4091 35203 1277          TAD     FILICN
 4092 35204 1034          TAD     FILIDA          /4
 4093 35205 6211          DATFLD
 4094 35206 3362          DCA     FILSP2          /POINTS TO FILE EXTENSION IN CONTROL BLOCK
 4095 35207 1762          TAD I   FILSP2          /FILE EXTENSION
 4096 35210 0146          AND     C0177           /LIMIT FILE SIZE TO 1777777 (?!?)
 4097 35211 3361          DCA     FILSP1          /HIGH ORDER COMPONENT OF SEG #
 4098 35212 2362          ISZ     FILSP2          /POINTS TO LOW ARDER ADD
 4099 35213 1762          TAD I   FILSP2          /LOW ORDER ADDRESS
 4100 35214 0134          AND     SEGLMK          /GET RID OF ADDRESS IN SEGMENT
 4101 35215 7104          CLL RAL
 4102 35216 1361          TAD     FILSP1          /HIGH ORDER PART
 4103 35217 7006          RTL                     /"DIVIDE" BY 400 SEG SIZE
 4104 35220 7006          RTL
 4105 35221 7041          CIA                     /-(SEGMENT# -1)
 4106 35222 3276          DCA     FILISN
 4107 35223 1277          TAD     FILICN
 4108 35224 7001          IAC
 4109 35225 3364          DCA     FILICA          /POINTS TO SEGMENT # INDEX IN WINDOW
 4110 35226 1677          TAD I   FILICN          /POINT TO WINDOW
 4111 35227 3277          DCA     FILICN
 4112 35230 1677          TAD I   FILICN          /GET WORD 1 OF WINDOW
 4113 35231 0035          AND     C0007           /VALID WINDOW?
 4114 35232 7440          SZA
 4115 35233 5252          JMP     FILIX5          /NO, IT IS A BASIC WINDOW
 4116 35234 1764          TAD I   FILICA          /YES
 4117 35235 1276          TAD     FILISN
 4118 35236 7540          SMA SZA                 /FILSCT-SN>0?
 4119 35237 5247          JMP     FILIX2          /YES, SEGMENT POINTER NOT IN CORE
 4120 35240 1136          TAD     C0006           /FILSCT+6-SN<0?
 4121 35241 7500          SMA
 4122 35242 5263          JMP     FILIX1
 4123 35243 7200          CLA                     /YES, SEGMENT POINTER NOT IN CORE
 4124 35244 1677          TAD I   FILICN          /ANY MORE SEGMENTS?
 4125 35245 7650          SNA CLA
 4126 35246 2201          ISZ     FILIX           /NO, NON-EXISTENT FILE ADDRESS
 4127 35247 7200  FILIX2, CLA
 4128 35250 6201  FILIX3, CDF
 4129 35251 5601          JMP I   FILIX           /RETURN

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 95


 4130             
 4131 35252 0136  FILIX5, AND     C0006           /IS IT BASIC OR INVALID WINDOW?
 4132 35253 7650          SNA CLA
 4133 35254 5250          JMP     FILIX3          /INVALID WINDOW
 4134 35255 1276          TAD     FILISN          /GET -(SEG # -1)
 4135 35256 1135          TAD     BASWIN
 4136 35257 7041          CIA                     /AC=SEG # -1
 4137 35260 7510          SPA
 4138 35261 5266          JMP     FILIX4
 4139 35262 5246          JMP     FILIX2-1        /BASIC BUT NON-EXISTENT
 4140 35263 7041  FILIX1, CIA
 4141 35264 1035          TAD     C0007           /WINDOW INDEX
 4142 35265 1277          TAD     FILICN          /START OF WINDOW
 4143 35266 3364  FILIX4, DCA     FILICA          /POINTS TO SEGMENT #
 4144 35267 2201          ISZ     FILIX           /SEGMENT ADDRESS IN CORE - EXIT
 4145 35270 1764          TAD I   FILICA          /GET SEGMENT # FOR THIS FILE ADDRESS
 4146 35271 7650          SNA CLA
 4147 35272 5250          JMP     FILIX3          /ZERO SEGMENT NUMBER IS NOT A SEGMENT!
 4148 35273 1364          TAD     FILICA          /EXIT WITH POINTER TO THIS SEGMENT IN AC
 4149 35274 2201          ISZ     FILIX
 4150 35275 5250          JMP     FILIX3
 4151             
 4152 35276 0000  FILISN, 0
 4153 35277 0000  FILICN, 0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 96


 4154             
 4155             /RETURN USER RUN TIME
 4156             /USER CALLS WITH ADDRESS OF THREE WORD BLOCK
 4157             /WORD 1 CONTAINS THE JOB #
 4158             /THE HI AND LO ORDER RUN TIMES ARE RETURNED IN WORDS 2 AND 3
 4159             
 4160 35300 4150  UURT,   UDF                     /USER FIELD
 4161 35301 1506          TAD I   L2SA            /JOB #
 4162 35302 4715          JMS I   JOBCHB          /SEE IF IT'S A VALID JOB
 4163 35303 5310          JMP     UURT0           /IT WASN'T
 4164 35304 1044          TAD     JOBTBA
 4165 35305 4477          GETJTI                  /LOW ORDER RUNTIME
 4166 35306 0023          JOBRTM
 4167 35307 2005          ISZ     JOBSWA
 4168 35310 3363  UURT0,  DCA     UCOP2
 4169 35311 6211          DATFLD
 4170 35312 1405          TAD I   JOBSWA
 4171 35313 3362          DCA     UCOP1
 4172 35314 5346          JMP     UCOPY2-2        /COPY IN USER AREA
 4173 35315 7330  JOBCHB, JOBCHK
 4174             
 4175             
 4176             /RETURN THE TIME OF DAY IN SYSTEM TICKS SINCE MIDNIGHT.
 4177             /USER CALLS WITH ADDRESS OF TWO WORD BLOCK IN AC.
 4178             /HI AND LOW ORDER PARTS RETURNED IN WORDS 1 AND 2.
 4179             
 4180 35316 1051  UTOD,   TAD     CLK1            /-TIME TILL MIDNIGHT
 4181 35317 7100          CLL
 4182 35320 1327          TAD     INKLK1          /TIME AT MIDNIGHT
 4183 35321 3363          DCA     UCOP2           /LOW ORDER TIME NOW
 4184 35322 7004          RAL
 4185 35323 1050          TAD     CLK2            /-TIME TILL MIDNIGHT
 4186 35324 1330          TAD     INKLK2          /TIME AT MIDNIGHT
 4187 35325 3362          DCA     UCOP1           /TIME NOW (HIGH ORDER)
 4188 35326 5350          JMP     UCOPY2          /COPY IN USER AREA
 4189             
 4190 35327 7400  INKLK1, INCLK1
 4191 35330 0322  INKLK2, INCLK2
 4192             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 97


 4193             
 4194             /RETURN THE USER'S STATUS REGISTERS
 4195             /CALLED WITH ADDRESS OF THREE WORD BLOCK IN AC
 4196             
 4197 35331 4476  UCKS,   GETJTW
 4198 35332 0000          JOBSTS
 4199 35333 3361          DCA     UCOP0           /STATUS 0
 4200 35334 6211          DATFLD
 4201 35335 2005          ISZ     JOBSWA
 4202 35336 1405          TAD I   JOBSWA          /STATUS 1
 4203 35337 3362          DCA     UCOP1
 4204 35340 2005          ISZ     JOBSWA
 4205 35341 1405          TAD I   JOBSWA
 4206 35342 3363          DCA     UCOP2           /STATUS 2
 4207 35343 4150          UDF                     /SELECT USER FIELD
 4208 35344 1361          TAD     UCOP0
 4209 35345 3506          DCA I   L2SA
 4210 35346 2106          ISZ     L2SA            /BUMP POINTER
 4211 35347 7000          NOP
 4212 35350 4150  UCOPY2, UDF                     /FOR LATER ENTRIES
 4213 35351 1362          TAD     UCOP1           /SECOND WORD
 4214 35352 3506          DCA I   L2SA
 4215 35353 2106          ISZ     L2SA
 4216 35354 7000          NOP
 4217 35355 1363          TAD     UCOP2           /THIRD WORD
 4218 35356 3506          DCA I   L2SA
 4219 35357 3106          DCA     L2SA            /CLEAR USER AC
 4220 35360 5461          UUOEXT
 4221             
 4222             DEVJO0,
 4223             UCOP0,
 4224 35361 0000  FILSP1, 0
 4225             
 4226             UCOP1,
 4227 35362 0000  FILSP2, 0
 4228             
 4229 35363 0000  UCOP2,  0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 98


 4230             
 4231             /ROUTINE TO EXTRACT JOB NUMBER FROM DDB
 4232             /CALL
 4233             /       TAD (DDB ADDRESS)
 4234             /       JMS DEVJOB
 4235             /       RETURN WITH JOB # IN AC
 4236             
 4237             FILICA,
 4238 35364 0000  DEVJOB, 0
 4239 35365 7001          IAC
 4240 35366 3361          DCA     DEVJO0          /POINTS TO WORD 1 OF DDB
 4241 35367 6211          DATFLD
 4242 35370 1761          TAD I   DEVJO0          /GET WORD 1
 4243 35371 0036          AND     C0037           /IGNORE JUNK
 4244 35372 5764          JMP I   DEVJOB          /RETURN
 4245 35373 7037  C7037,  SWAP LOCK NOTRUN CJOB
 4246 35374 2724  FIPLOA, FIPLOK
 4247 35375 1373  L2FIP,  TAD     C7037           /OK - ALLOW FIP TO BE OVER-WRITTEN BY USER JOBS AGAIN
 4248 35376 3774          DCA I   FIPLOA
 4249 35377 5467          EXIT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 99


 4250             
 4251             
 4252             /WE ENTER THIS ROUTINE AT LEVEL 2
 4253             /AFTER COMPLETING A DISK TRANSFER
 4254             /IF A FILE TRANSFER IS INVOLVED, WE CONTINUE
 4255             /WITH IT
 4256             /IF OVERLAY, WE GO TO OVERLAY CONTROL
 4257             /IF OVERLAY IS COMPLETED WE FORCE THE SCHEDULER TO RUN THE PHANTOM
 4258             
 4259       0003  DSURT1= WS0
 4260       0004  DSURT2= WS1
 4261             
 4262       0034  DSURDA= C0004                   /FILDA
 4263             
 4264       0003  DSUET1= WS0
 4265             
 4266             
 4267 35400 7001  DSURET, IAC                     /ERROR IN DISK TRANSFER
 4268 35401 3337          DCA     DSKCOD          /SAVE ERROR CODE
 4269 35402 1017          TAD     DSKPTR          /POINTS TO REQUEST CURRENTLY RUNNING
 4270 35403 1334          TAD     DSUMTB          /FIND RELATIVE INDEX IN TABLE
 4271 35404 7112          CLL RTR                 /DIVIDE BY FOUR
 4272 35405 0035          AND     C0007           /SAVE FIELD
 4273 35406 1162          TAD     CORTBA          /INDEX INTO CORTBL
 4274 35407 3332          DCA     DSUCOR
 4275 35410 1732          TAD I   DSUCOR          /GET CORTBL ENTRY
 4276 35411 0036          AND     C0037           /EXTRACT JOB #
 4277 35412 1044          TAD     JOBTBA          /POINTS TO JOBTBL
 4278 35413 3354          DCA     DSUJTE          /SAVE JOBTBL ADDRESS
 4279 35414 1354          TAD     DSUJTE
 4280 35415 4574          GETJTA                  /GET ADDRESS OF STR0
 4281 35416 0000          JOBSTS
 4282 35417 3353          DCA     DSUJST          /SAVE IT
 4283 35420 1337          TAD     DSKCOD          /IS THERE AN ERROR?
 4284 35421 7440          SZA
 4285 35422 5263          JMP     DSURER          /YES - JMP OUT OF THE ROUTINE AS QUICKLY AS POSSIBLE
 4286 35423 4355          JMS     DSUPAR          /PARAMETER BLOCK ADDRESS
 4287 35424 1034          TAD     DSURDA
 4288 35425 3003          DCA     DSURT1          /POINTS TO WORD 5 OF PARAMETERS
 4289 35426 1715          TAD I   DSURPA          /ADDRESS OF PARAMETERS
 4290 35427 7001          IAC
 4291 35430 3004          DCA     DSURT2          /POINTS TO DISK EXTENSION IN PARAMETERS
 4292 35431 6211          DATFLD
 4293 35432 1403          TAD I   DSURT1          /DISC EXTENSION FROM CONTROL...
 4294 35433 3404          DCA I   DSURT2          /       ... TO PARAMETERS
 4295 35434 1004          TAD     DSURT2
 4296 35435 1034          TAD     C0004
 4297 35436 3004          DCA     DSURT2          /POINTS TO DISC ADDRESS IN PARAMETERS
 4298 35437 2003          ISZ     DSURT1          /POINTS TO DISC ADDRESS IN FILE CONTROL
 4299 35440 1403          TAD I   DSURT1          /DISC ADDRESS FROM CONTROL...
 4300 35441 3404          DCA I   DSURT2          /       ...TO PARAMETERS
 4301 35442 2003          ISZ     DSURT1          /POINTS TO WORD COUNT IN FILE CONTROL
 4302 35443 7144          CLL CMA RAL
 4303 35444 1004          TAD     DSURT2
 4304 35445 3004          DCA     DSURT2          /POINTS TO WORD COUNT IN PARAMETERS
 4305 35446 1404          TAD I   DSURT2          /SAVE TEMPORARILY -WC FROM PARAMETERS
 4306 35447 7041          CIA

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 100


 4307 35450 3337          DCA     DSKCOD
 4308 35451 1403          TAD I   DSURT1          /MOVE WC FROM FILE CONTROL...
 4309 35452 3404          DCA I   DSURT2          /       ...TO PARAMETERS
 4310 35453 2004          ISZ     DSURT2          /POINTS TO CORE ADD IN PARAM.
 4311 35454 1337          TAD     DSKCOD          /UPDATE CORE ADD BY COUNT TRANSFERRED
 4312 35455 1404          TAD I   DSURT2
 4313 35456 3404          DCA I   DSURT2          /SAVE NEW AADD
 4314 35457 1403          TAD I   DSURT1          /GET WORD COUNT FROM CONTROL
 4315 35460 6201          CDF
 4316 35461 7640  C7640,  SZA CLA                 /ARE WE DONE?
 4317 35462 5317          JMP     DSURE2          /NO
 4318 35463 3337  DSURER, DCA     DSKCOD          /SAVE ERROR STATUS IF IT IS AN ERROR
 4319 35464 1715          TAD I   DSURPA          /GET ADDRESS OF PARAMETER BLOCK
 4320 35465 3270          DCA     .+3             /FOR CALL TO FILERR
 4321 35466 1337          TAD     DSKCOD          /ERROR CODE
 4322 35467 4716          JMS I   DSUFEA          /HANDLE ERROR
 4323 35470 0000          0
 4324 35471 7100          CLL
 4325 35472 1732          TAD I   DSUCOR
 4326 35473 1261          TAD     C7640           /SET "NOTRUN" IF NOT INHIBITED
 4327 35474 0333          AND     DSHOLD          /SAVE "NOTRUN," "NOHOLD," & AND JOB
 4328 35475 7420          SNL                     /ANY MORE BONUSES DUE?
 4329 35476 3732          DCA I   DSUCOR          /YES - SET "NOTRUN" SO HE WON'T BE SWAPPED OUT BEFORE BEING RUN AGAIN
 4330 35477 3355  DSURE1, DCA     DSFLAG
 4331 35500 2353          ISZ     DSUJST          /SET INACTIVE FLAG IN STR1
 4332 35501 1017          TAD     DSKPTR          /FIGURE OUT WHICH INTERNAL FILE #
 4333 35502 1334          TAD     DSUMTB
 4334 35503 4735          JMS I   DGETJX
 4335 35504 6211          DATFLD
 4336 35505 1753          TAD I   DSUJST          /NOW SET FILE READY & DUMMY WAIT BIT
 4337 35506 3753          DCA I   DSUJST          /SAVE STR1
 4338 35507 4340          JMS     DSURE4
 4339 35510 2355          ISZ     DSFLAG          /THIS TRANSFER COMPLETE?
 4340 35511 5466          RSCHED                  /YES - BUMP OOFF THE NULL JOB IF POSSIBLE
 4341 35512 1732          TAD I   DSUCOR
 4342 35513 5714          JMP I   .+1             /GO SET UP FOR THE NEXT PART OF THIS TRANSFER
 4343 35514 0575          FILCON
 4344 35515 7756  DSURPA, DSPARM
 4345 35516 4211  DSUFEA, FILERR

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 101


 4346             
 4347             /MOVE SEGMENT WINDOW
 4348             
 4349 35517 1354  DSURE2, TAD     DSUJTE          /SET JOBLNK
 4350 35520 4574          GETJTA
 4351 35521 0007          JOBLNK
 4352 35522 3337          DCA     DSKCOD          /SAVE POINTER TO JOBLNK
 4353 35523 1715          TAD I   DSURPA          /GET ADDRESS OF PARAMETER BLOCK
 4354 35524 6211          DATFLD
 4355 35525 3737          DCA I   DSKCOD          /AND SAVE IN JOBLNK
 4356 35526 6201          CDF
 4357 35527 3715          DCA I   DSURPA          /CLEAR DSPARM
 4358 35530 7240          STA                     /-1 TO SET TRANSFER INCOMPLETE FLAG
 4359 35531 5277          JMP     DSURE1
 4360             
 4361 35532 0000  DSUCOR, 0
 4362 35533 1177  DSHOLD, NOTRUN NOHOLD CJOB
 4363 35534 4530  DSUMTB, -DSUTBL
 4364 35535 5600  DGETJX, GETJFX
 4365 35536 5761  DSKCT,  DSKCON
 4366 35537 0000  DSKCOD, 0
 4367             
 4368             
 4369 35540 0000  DSURE4, 0
 4370 35541 1017          TAD     DSKPTR          /CURRENT REQUEST POINTER
 4371 35542 3003          DCA     DSUET1
 4372 35543 6211          DATFLD
 4373 35544 3403          DCA I   DSUET1          /CLEAR THIS REQUEST
 4374 35545 6201          CDF
 4375 35546 1715          TAD I   DSURPA          /RETURN PARAMETER BLOCK IF FINISHED
 4376 35547 7440          SZA
 4377 35550 4576          RETBLK                  /OK - RETURN IT
 4378 35551 4736          JMS I   DSKCT           /DECREMENT BUSY - START ANY TRANSFER THAT'S WAITING
 4379 35552 5740          JMP I   DSURE4

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 102


 4380             
 4381 35553 0000  DSUJST, 0                       /POINTER TO JOB STATUS
 4382 35554 0000  DSUJTE, 0                       /JOB TABLE ENTRY
 4383             
 4384             DSFLAG,
 4385 35555 0000  DSUPAR, 0                       /GET PARAMETER BLOCK ADDRESS
 4386 35556 1715          TAD I   DSURPA          /GET ADDRESS
 4387 35557 1035          TAD     C0007           /GET POINTER TO LAST WORD IN BLOCK
 4388 35560 3003          DCA     DSUET1
 4389 35561 6211          DATFLD
 4390 35562 1403          TAD I   DSUET1          /GET ADDRESS OF FILE CONTROL
 4391 35563 6201          CDF
 4392 35564 5755          JMP I   DSUPAR          /EXIT
 4393             
 4394 35565 4355  OVERL1, JMS     DSUPAR          /GET ADDRESS OF FILE CONTROL, & CLEAR DSFLAG
 4395 35566 7440          SZA
 4396 35567 5374          JMP     OVE2
 4397 35570 1442          TAD I   FANCOR
 4398 35571 1040          TAD     C1000           /NOT RUN YET
 4399 35572 3442          DCA I   FANCOR
 4400 35573 1377          TAD     SCHPHA
 4401 35574 3355  OVE2,   DCA     DSFLAG          /DISPATCH ADDRESS
 4402 35575 4340          JMS     DSURE4
 4403 35576 5755          JMP I   DSFLAG
 4404             
 4405 35577 3051  SCHPHA, SCHFAN
 4406             
 4407             /GET JSFX
 4408             /CALL   TAD FILE #
 4409             /       JMS GETJFX
 4410             /       RETURN WITH JSFX IN AC
 4411 35600 0000  GETJFX, 0
 4412 35601 0033          AND     C0003           /FILE # ONLY
 4413 35602 7040          CMA
 4414 35603 3370          DCA     TRAC            /-SHIFT COUNT
 4415 35604 7130          STL RAR
 4416 35605 7010          RAR
 4417 35606 2370          ISZ     TRAC            /DONE?
 4418 35607 5205          JMP     .-2
 4419 35610 5600          JMP I   GETJFX          /YES, EXIT WITH BIT SET IN AC
 4420             
 4421 35611 1156  USIZE,  TAD     SEGSIZ          /RETURN SEGMENT SIZE IN AC
 4422 35612 5217          JMP     UUAC
 4423 35613 1160  UUSE,   TAD     JOB             /RETURN JOB # IN AC
 4424 35614 5217          JMP     UUAC
 4425 35615 0012          TICSPS                  /# TICKS PER SECOND
 4426 35616 1215  URCR,   TAD     .-1             /RETURN CLOCK RATE
 4427 35617 3106  UUAC,   DCA     L2SA
 4428 35620 5461          UUOEXT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 103


 4429             
 4430             /ROUTINE TO RECOGNIZE AND REPLY TO ^C
 4431             
 4432 35621 1133  GIR9,   TAD     CONDDB
 4433 35622 4732          JMS I   PTJOB           /GET HIS/HER JOB NUMBER FROM THE DDB
 4434 35623 6201          CDF
 4435 35624 1044          TAD     JOBTBA
 4436 35625 3004          DCA     WS1
 4437 35626 1004          TAD     WS1             /POINTS TO JOB DATA AREA
 4438 35627 4477          GETJTI
 4439 35630 0001          JOBSTS+1                /GET STR1
 4440 35631 0261          AND     GIRFCL          /CLEAR TIMER, AND DELIMITER FLAGS & JSWAIT
 4441 35632 6211          DATFLD
 4442 35633 3405          DCA I   JOBSWA
 4443 35634 7126          STL RTL
 4444 35635 1005          TAD     JOBSWA
 4445 35636 3003          DCA     WS0             /POINTS AT WAIT MASK 1
 4446 35637 1403          TAD I   WS0             /ARE WE WAITING FOR A FILE TRANSFER?
 4447 35640 0260          AND     GIRFIL
 4448 35641 2003          ISZ     WS0             /POINTS AT WAIT 2
 4449 35642 1403          TAD I   WS0             /OR - WAITING FOR DECTAPE, RK05, OR CARDREADER?
 4450 35643 7650          SNA CLA
 4451 35644 2405          ISZ I   JOBSWA          /NO - SET DUMMY WAIT BIT
 4452 35645 2003          ISZ     WS0             /POINT TO RESTART ADDRESS
 4453 35646 6201          CDF
 4454 35647 1004          TAD     WS1             /GET POIONTER TO JOBREG
 4455 35650 4477          GETJTI
 4456 35651 0011          JOBREG
 4457 35652 7200          CLA
 4458 35653 1133          TAD     CONDDB          /GET JOB NUMBER
 4459 35654 4732          JMS I   PTJOB           /AC=JOB; DATA FIELD=1
 4460 35655 5656          JMP I   .+1
 4461 35656 0647          GIR90                   /OFF TO PART TWO
 4462             
 4463 35657 6642  GIRCBF, CLRBUF
 4464 35660 3600  GIRFIL, JSF0+JSF1+JSF2+JSF3
 4465 35661 3676  GIRFCL, -JSTIME-JSDEL-JSWAIT-1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 104


 4466             
 4467       0034  SWBASE= C0004                   /SWAP TRACK OF JOB 1 (SWDEX-1)
 4468             
 4469             
 4470             
 4471             
 4472             /ROUTINE TO SET UP SWAP
 4473             /CORTBL POINTER TO FIELD TO SWAPPED OUT IN WS0
 4474             /FINISH= +FIELD # FOR SWAP IN; FINISH= -FIELD # FOR SWAP OUT
 4475             /FIT=JOB TO BE SWAPPED IN OR PHANTOM TO BE BROUGHT IN
 4476             /FORCE=FIELD TO BE SWAPPED OUT
 4477             /ENTER AT SWAPIN FOR SWAP IN
 4478             /ENTER AT SWPOUT FOR SWAP OUT
 4479             
 4480             
 4481 35662 1003  SWPOUT, TAD     WS0             /OR SWAP BIT INTO CORTBL
 4482 35663 4460          IOR
 4483 35664 4000          SWAP
 4484 35665 1403          TAD I   WS0             /JOBS ARE THE ONLY ONES TO BE SWAPPED OUT
 4485 35666 4370          JMS     TRAC            /GET THE TRACK # FOR THIS JOB
 4486 35667 3154          DCA     OUTTRC          /SAVE IT
 4487 35670 1054  SWAPIN, TAD     FINISH          /FINISH HAS FIELD # FOR SWAP ACTIVITY + OR -
 4488 35671 7510          SPA
 4489 35672 7041          CIA                     /GET THE ABSOLUTE VALUE
 4490 35673 7106          CLL RTL
 4491 35674 7004          RAL                     /IN POSITION 00X0
 4492 35675 3053          DCA     SQREQ           /SAVE IT FOR SETTING UP DISC I/O
 4493 35676 1055          TAD     FIT             /IS A PHANTOM NEEDED?
 4494 35677 0142          AND     C0600
 4495 35700 7450          SNA
 4496 35701 5312          JMP     SWAP1           /NO JOB IS TO BROUGHT IN
 4497 35702 0156          AND     C0400           /IS FIP NEEDED?
 4498 35703 7640          SZA CLA
 4499                     IFZERO RKSYS <
 4500                     IFZERO RF08-40 <TAD C0100>/YES, DF32 NEEDS TRACK IN POSITION 0X00
 4501                     IFZERO RF08 <IAC >      /YES, RF08 NEEDS TRACK IN POSITION 000X >
 4502 35704 1777@         IFNZRO RKSYS < TAD C0020> /YES, RK05 NEEDS TRACK IN BITS 0-7
 4503                     
 4504 35705 3153  SWAP3,  DCA     INTRC
 4505 35706 2165          ISZ     DSBUSY          /IS ANY DISC ACTIVITY GOING ON?
 4506 35707 5465          SCHED                   /YES, SO FIND A RESIDENT JOB
 4507 35710 4557          JMS I   SWPIOA          /NO, START THE SWAP I/O
 4508 35711 5465          SCHED                   /FIND A RESIDENT JOB IN THE MEANTIME
 4509 35712 1055  SWAP1,  TAD     FIT             /GET THE JOB # TO BE SWAPPED IN
 4510 35713 4370          JMS     TRAC            /GET ITS TRACK #
 4511 35714 5305          JMP     SWAP3

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 105


 4512             
 4513             
 4514             /ROUTINE TO SET FLAG IN USER STATUS REG AND EXIT
 4515             /CALLING SEQUENCE:
 4516             /       CONDBA POINTS TO POSITION IN DEVTBL
 4517             /       TAD     (FLAGS TO SET)
 4518             /       JMS     PTSTAR
 4519             /       RETURN
 4520             
 4521 35715 0000  PTSTAR, 0
 4522 35716 3330          DCA     PTFLAG          /SAVE FLAGS TO SET
 4523 35717 1532          TAD I   CONDBA
 4524 35720 4732          JMS I   PTJOB           /GET JOB # FROM DDB
 4525 35721 7450          SNA
 4526 35722 5715          JMP I   PTSTAR
 4527 35723 1044          TAD     JOBTBA          /START OF JOB TABLE
 4528 35724 3370          DCA     TRAC
 4529 35725 7126          STL RTL
 4530 35726 1770          TAD I   TRAC            /ADDRESS OF STR1
 4531 35727 4460          IOR                     /OR IN FLAGS
 4532 35730 0000  PTFLAG, 0
 4533 35731 5715          JMP I   PTSTAR
 4534 35732 5364  PTJOB,  DEVJOB
 4535             
 4536             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 106


 4537             
 4538             /DECTAPE HANDLER CODE
 4539             /FOR DISK TRANSFERS TO OR FROM USER SWAP AREA
 4540             /ALSO FOR ALL LEVEL 2 COMPLETION
 4541             
 4542 35733 0000  DTDSF0, 0                       /MAY RETURN UP TO 4 TIMES - EACH +1 FROM THE LAST
 4543 35734 3760          DCA I   DTDQUE          /PUT THE DECTAPE'S DISK REQUEST IN THE QUEUE
 4544 35735 6201          CDF
 4545 35736 2165          ISZ     DSBUSY          /DISK ALREADY BUSY?
 4546 35737 7410          SKP
 4547 35740 4462          JMS I   FIUSER          /NO, START IT
 4548 35741 6213  DTDXF0, CIF DATFLD
 4549 35742 5733          JMP I   DTDSF0          /BACK TO DECTAPE HANDLER
 4550 35743 6213  DTL20,  CIF DATFLD              /LEVEL 2 DISPATCHER
 4551 35744 5757          JMP I   DTLEV2
 4552 35745 4463  DTDEF0, ERROR                   /DECTAPE DISK ERROR
 4553 35746 0002          SWPRER
 4554 35747 2333  DTDCF0, ISZ     DTDSF0          /INCR. RETURN
 4555 35750 5341          JMP     DTDXF0
 4556 35751 2333  DTDSK,  ISZ     DTDSF0          /DISK ERROR - SKIP ON RETURN
 4557 35752 6211          DATFLD
 4558 35753 3760          DCA I   DTDQUE          /REMOVE REQUEST FROM QUEUE
 4559 35754 6201          CDF
 4560 35755 4361          JMS     DSKCON          /START ANYTHING ELSE THAT'S WAITING
 4561 35756 5347          JMP     DTDCF0
 4562 35757 1004  DTLEV2, DTL21                   /POINTER TO DECTAPE LEVEL 2 COMPLETION ENTRY
 4563 35760 3257  DTDQUE, DSUTBL+7                /POSITION FOR FIELD 1 REQUESTS
 4564             
 4565 35761 0000  DSKCON, 0
 4566 35762 7340          STA CLL                 /REDUCE COUNT FOR DSBUSY
 4567 35763 1165          TAD     DSBUSY
 4568 35764 3165          DCA     DSBUSY
 4569 35765 7430          SZL                     /IS THERE ANYTHING ELSE TO RUN?
 4570 35766 4462          JMS I   FIUSER          /YES -- START NEXT TRANSFER
 4571 35767 5761          JMP I   DSKCON
 4572             
 4573 35770 0000  TRAC,   0
 4574 35771 0036          AND     C0037           /JUST GET THE JOB #
 4575 35772 1034          TAD     SWBASE          /TRACK # WHERE SWAP AREA BEGINS -1 TO TAKE CARE OF JOB 1
 4576                     IFZERO RKSYS <
 4577                     IFZERO RF08-40< CLL RTL;RTL;RTL >/TRACK # IN POSITION 0X00 FOR DF32
 4578                     >
 4579                     IFNZRO RKSYS <
 4580 35773 7106          CLL RTL; RTL            /TRACK # IN POSITION 000|XXX|XX0|000
      35774 7006
 4581                                             /FOR RK8E (HEAD + 4 BITS OF CYL)
 4582                     >
 4583 35775 5770          JMP I   TRAC            /RETURN

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 107


 4584             
      35777 6614
 4585       6000  *6000
 4586             
 4587 36000 0000  KBDMOD, 0
 4588 36001 1533          TAD I   CONDDB
 4589 36002 0040          AND     C1000
 4590 36003 7650          SNA CLA                 /USER MODE?
 4591 36004 2200          ISZ     KBDMOD          /YES; CAUSE SKIP ON EXIT
 4592 36005 5600          JMP I   KBDMOD
 4593             
 4594       3000  XOFF=   3000
 4595 36006 7650  KBDFUL, -130
 4596 36007 7710  KBDOFF, -70
 4597 36010 1553  OFFBRK, KBDDLM
 4598             
 4599 36011 0000  KBD06,  0                       /SIZE CHECK FOR KEYBOARD INPUT
 4600 36012 3200          DCA     KBDMOD          /SAVE POINTER TO CHARACTER COUNT
 4601 36013 1600          TAD I   KBDMOD
 4602 36014 1206          TAD     KBDFUL
 4603 36015 7700          SMA CLA                 /BUFFER FULL?
 4604 36016 5240          JMP     KBD07           /YES
 4605 36017 2211          ISZ     KBD06           /SKIP ON RETURN - OK TO GIVE ANOTHER BLOCK
 4606 36020 1600          TAD I   KBDMOD
 4607 36021 1207          TAD     KBDOFF          /TIME FOR XOFF?
 4608 36022 7710          SPA CLA
 4609 36023 5611          JMP I   KBD06           /NO
 4610 36024 1533          TAD I   CONDDB          /GET DDB FLAGS
 4611 36025 7006          RTL
 4612 36026 7530          SZL SPA                 /SHOULD "XOFF" BE SENT?
 4613 36027 5611          JMP I   KBD06           /NO - EITHER IT HAS ALREADY BEEN SENT OR HE'S IN SI MODE
 4614 36030 7132          STL RTR                 /YES - REMEMBER TO SEND "XON" LATER
 4615 36031 3533          DCA I   CONDDB
 4616 36032 1532          TAD I   CONDBA          /POINT TO WORD 2 OF OUTPUT SIDE
 4617 36033 4460          IOR
 4618 36034 3000          XOFF                    /SCHEDULE XOFF TO BE SENT
 4619 36035 4644          JMS I   TYPEC
 4620 36036 4610          JMS I   OFFBRK          /SET KEYBOARD FLAG
 4621 36037 5611          JMP I   KBD06
 4622 36040 1156  KBD07,  TAD     C0400
 4623 36041 1533          TAD I   CONDDB          /SET BUFFER FULL BIT
 4624 36042 3533          DCA I   CONDDB
 4625 36043 5611          JMP I   KBD06           /EXIT - NO SKIP
 4626 36044 1235  TYPEC,  TYPE
 4627             
 4628 36045 0000  ALLOK,  0
 4629 36046 2245          ISZ     ALLOK           /WE DON'T CARE HOW BIG THE BUFFER IS
 4630 36047 3200          DCA     KBDMOD
 4631 36050 1600          TAD I   KBDMOD          /THE COUNT
 4632 36051 1206          TAD     KBDFUL          /THE LIMIT
 4633 36052 7740          SMA SZA CLA
 4634 36053 5645          JMP I   ALLOK           /TOO MANY - DON'T CLEAR "FULL STATUS"
 4635 36054 1533          TAD I   CONDDB
 4636 36055 0260          AND     CC7377
 4637 36056 3533          DCA I   CONDDB
 4638 36057 5645          JMP I   ALLOK
 4639 36060 7377  CC7377, 7377

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 108


 4640             
 4641             
 4642             /SEARCH FOR TTY
 4643             /CALL   TAD JOB #
 4644             /       TTYUSE
 4645             /       RETURN WITH DDB ADDR IN AC, 0 IF NOT FOUND
 4646 36061 0000  TTYSRC, 0
 4647 36062 0036          AND     C0037           /GET JOB #
 4648 36063 1275          TAD     TTYTBA          /START OF TTY TABLE
 4649 36064 3132          DCA     CONDBA
 4650 36065 6211          DATFLD
 4651 36066 1532          TAD I   CONDBA          /GET UNIT # FROM TABLE
 4652 36067 7104          CLL RAL                 /POSITION IN DEVTBL
 4653 36070 1163          TAD     DEVTBA          /POINTER TO DEVTBL
 4654 36071 3132          DCA     CONDBA
 4655 36072 1532          TAD I   CONDBA          /DDB ADDRESS
 4656 36073 6201          CDF
 4657 36074 5661          JMP I   TTYSRC
 4658 36075 3136  TTYTBA, TTYTBL
 4659             
 4660 36076 7330  JOBCHA, JOBCHK
 4661 36077 1106  UCON,   TAD     L2SA            /PICK UP JOB NO.
 4662 36100 4676          JMS I   JOBCHA          /SEE IF IT'S A VALID JOB
 4663 36101 5310          JMP     UCON0           /IT WASN'T
 4664 36102 4464          TTYUSE                  /GET DDB ADDRESS
 4665 36103 3003          DCA     WS0
 4666 36104 6211          DATFLD
 4667 36105 1403          TAD I   WS0             /GET WORD 1 OF DDB
 4668 36106 0036          AND     C0037           /ISOLATE CONSOLE NO.
 4669 36107 7410          SKP
 4670 36110 7240  UCON0,  STA                     /RETURN A -1
 4671 36111 3106          DCA     L2SA            /STASH IT IN HIS/HER AC
 4672 36112 5461          UUOEXT
 4673             /DATE
 4674 36113 1166  UDATE,  TAD     DATE
 4675 36114 5311          JMP     UCON0+1         /RETURN DATE IN AC

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 109


 4676             
 4677             /RESTORE JOB REGISTERS
 4678             /CALL   TAD JOB #
 4679             /       RESJOB
 4680             /       RETURN
 4681             
 4682 36115 0637  RESCOR, FIP SI CJOB
 4683             
 4684 36116 0000  RESJO0, 0
 4685 36117 0315          AND     RESCOR          /CLEAR CORE STATUS BITS
 4686 36120 3160          DCA     JOB             /AND SAVE IN JOB
 4687 36121 1160          TAD     JOB
 4688 36122 0036          AND     C0037
 4689 36123 1044          TAD     JOBTBA
 4690 36124 3352          DCA     RESJO1          /JOBTBL POINTER FOR THIS JOB
 4691 36125 6211          DATFLD
 4692 36126 1752          TAD I   RESJO1          /GET ADDRESS OF JOB DATA AREA
 4693 36127 3561          DCA I   CJOBDA          /AND SAVE IN FIELD 1
 4694 36130 6201          CDF
 4695 36131 1110          TAD     CLOCK           /SUBTRACT THE CLOCKS STILL PENDING ON LEVEL 2
 4696 36132 7040          CMA
 4697 36133 3043          DCA     JOBTIM          /THE NET RESULT IS ZERO TICKS WHEN WE ACTUALLY START HIM/HER
 4698 36134 3104          DCA     L2SV0           /SET PC=0 IN ANTICIPATION OF PHANTOMS
 4699 36135 1160          TAD     JOB             /IS IT A PHANTOM?
 4700 36136 0142          AND     C0600
 4701 36137 7640          SZA CLA
 4702 36140 5716          JMP I   RESJO0          /YES; WE'RE RESTORED!
 4703             
 4704             /
 4705             / NOW RESTORE THE EAE REGISTERS IF THEY EXIST
 4706             /
 4707             
 4708             IFZERO EAE-20 <
 4709                     IFZERO CPU-2 <          /PDP-8E
 4710                     GETJTW                  /PICK UP SC (AC5:9), THE MODE + GT FLAG IN AC10 + 11
 4711                     JOBEAE+1                /IF AC10-11=00 THEN MODE=B GT=1
 4712                     CMA                     /IF AC10-11=01 THEN MODE=B GT=0
 4713                                             /IF AC10-11=10 THEN MODE=A GT IS ALWAYS 0 IN MODE A
 4714                     SWAB                    /SWITCH TO MODE B AND LOAD THE MQ
 4715                     MQA LSR                 /SHIFT INTO THE GT FLAG (SETS TEMPORARILY IF WE WANT MODE A)
 4716                     1                       /MQ IS ALSO COPIED BACK INTO THE AC
 4717                     CMA RAR                 /POSITION THE SC FOR LOADING AND PUT THE MODE INTO THE LINK
 4718                     ACS                     /AC LOADS SC, AC IS CLEARED
 4719                     SZL                     /WHICH MODE?
 4720                     SWBA                    /"A," SO SWITCH MODES AND CLEAR THE GT FLAG
 4721                     >
 4722             IFNZRO CPU-1 <                  /SORRY - THE PDP-8 CAN'T RESTORE ITS STEP COUNTER
 4723                     IFNZRO CPU-2 <          / PDP-8/I AND PDP-12
 4724                     GETJTW                  /PICK UP SC
 4725                     JOBEAE+1
 4726                     CMA                     /COMPLEMENT AND STORE FOR
 4727                     DCA     .+2             /  OLD-STYLE EAE
 4728                     SCL                     /LOAD SC
 4729                     0       >>>

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 110


 4730             
 4731             IFZERO MQREG-1 <
 4732 36141 4476          GETJTW                  /RESTORE MQ
 4733 36142 0014          JOBEAE
 4734 36143 7421          MQL >
 4735             
 4736 36144 1352          TAD     RESJO1
 4737 36145 4574          GETJTA                  /GEET ADDRESS OF PC IN JOB DATA AREA
 4738 36146 0011          JOBREG                  /MOVE PC, LINK, AC TO LEVEL 2 REGISTERS
 4739 36147 3352          DCA     RESJO1
 4740 36150 4567          BLT
 4741 36151 6211          DATFLD
 4742 36152 0000  RESJO1, 0
 4743 36153 6201  UDFCDF, CDF
 4744 36154 0104          L2SV0
 4745 36155 7775          -3
 4746 36156 1103          TAD     L2SF
 4747 36157 0137          AND     C0070
 4748 36160 1353          TAD     UDFCDF
 4749 36161 3151          DCA     UUDF            /SET UP IN CASE OF USER INTERRUPT
 4750 36162 2105          ISZ     L2SVLK          /DID HE JUST TYPE CONTROL C?
 4751 36163 5716          JMP I   RESJO0          /ALL RESTORED
 4752 36164 3106          DCA     L2SA            /YES - MAKE SURE HIS/HER AC AND LINK ARE CLEARED
 4753 36165 5716          JMP I   RESJO0
 4754             
 4755             IFNZRO DC08A <
 4756             ANSWER, CIF     DATFLD-1        /DISPATCH TO FIELD 1 TO ANSWER PHONE
 4757                     JMP I   .+1
 4758                     DFRING                  >/END D689
 4759             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 111


 4760             
 4761       6200  *6200
 4762             
 4763             /SERVICE ALL AC TRANSFER OUTPUT DEVICES (TELEPRINTERS, PAPER TAPE PUNCH, AND LINE PRINTER)
 4764             
 4765             /IF FILLER CHARACTERS ARE NEEDED, THE NEXT 3 WORDS MUST BE PATCHED ACCORDING TO YOUR NEEDS
 4766                             /THE VALUE OF DEVTBL IS ASSEMBLED HERE FOR YOUR CALCULATING CONVENIENCE
 4767 36200 3020  FILHI,  DEVTBL  /-(DEVTBL+2*(KXX+1)) WHERE KXX IS THE HIGHEST LINE REQUIRING FILLER CHARACTERS
 4768 36201 0000  FILLO,  0       /2 TIMES NUMBER OF LINES REQUIRING FILLER CHARACTERS
 4769 36202 0000  FILLC,  0       /-(ASCII CHAR.) TO LOOK FOR - 7 BITS ONLY (CR=7763; LF=7766)
 4770             
 4771 36203 6413  TTIMEA, TTIME
 4772       4603  JMSTIM= JMS I TTIMEA
 4773 36204 7765  CONCNT, -NULINE-3
 4774             IFNZRO DC08A <IFNZRO .&177-5 <YOU GOOFED>
 4775                     T8OUT>                  /PASS OUTPUT CHARACTER TO DC08A
 4776       6206          *6206
 4777 36206 2420  DEVOUT, OUTDIF
 4778       0002  CONREG= C0200
 4779 36207 0237  CONDEV, SKPTP+1
 4780 36210 7566  TTOFLA, TTOFLG
 4781 36211 0040  CONLPF, JSLPT
 4782 36212 0014  C0014,  14
 4783             IFNZRO OUTREG-200       <YOU GOOFED>
 4784             
 4785 36213 3502  CONOUT, DCA I   SETFLG          /CLEAR SCHEDULER FLAG
 4786 36214 6001          ION
 4787 36215 2610          ISZ I   TTOFLA          /SHOW THAT OUTPUT IS BEING SERVICED
 4788 36216 6211          DATFLD
 4789 36217 1002          TAD     CONREG
 4790 36220 3003          DCA     WS0             /OUTPUT REGISTER TABLE POINTER FOR OUTPUT SCAN
 4791 36221 1204          TAD     CONCNT
 4792 36222 3004          DCA     WS1             /NUMBER OF LINES TO CHECK + PUNCH & LINE PRINTER
 4793 36223 1403  CONOU0, TAD I   WS0
 4794 36224 7710  TTIMER, SPA CLA                 /DOES THIS DEVICE HAVE A REQUEST?
 4795 36225 5240          JMP     CONOU2          /YES
 4796 36226 2003  CONOU1, ISZ     WS0             /BUMP POINTER
 4797 36227 2004          ISZ     WS1             /AND THE COUNT
 4798 36230 5223          JMP     CONOU0
 4799 36231 1246          TAD     CONSKP          /RESTOORE THE NORMAL INSTRUCTION
 4800 36232 3224          DCA     TTIMER
 4801 36233 7240          STA
 4802 36234 6663          LSRP                    /LP08 OR LE8 ERROR?
 4803 36235 6665          LIE                     /OK - TURN ON INTERRUPT ENABLE
 4804 36236 5637          JMP I   .+1
 4805 36237 2015          CONEXT
 4806             
 4807 36240 4355  CONOU2, JMS     CONGET          /FIND HIS/HER DDB
 4808 36241 3133          DCA     CONDDB
 4809 36242 1533          TAD I   CONDDB          /GET OUTPUT STATUS
 4810 36243 7510          SPA
 4811 36244 5365          JMP     CONOU9          /HE HAS TYPED ^S
 4812 36245 7006          RTL
 4813 36246 7710  CONSKP, SPA CLA
 4814 36247 5333          JMP     CONJAM          /SPECIAL CHARACTERS
 4815 36250 1133  CONOU3, TAD     CONDDB
 4816 36251 4507          FETCH                   /GET A CHARACTER

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 112


 4817 36252 5365          JMP     CONOU9          /BUFFER EMPTY
 4818 36253 3031  CONOU4, DCA     TTCHAR
 4819 36254 1031          TAD     TTCHAR          /CHECK FOR CARRIAGE RETURN (FOR SERIAL LA30'S @ 300 BAUD)
 4820 36255 0146          AND     C0177           /LET'S KEEP DAWNWOOD JUNIOR HIGH HAPPY
 4821 36256 1202          TAD     FILLC
 4822 36257 7640          SZA CLA
 4823 36260 5275          JMP     CONOU5          /NORMAL CHARACTER
 4824 36261 1132          TAD     CONDBA
 4825 36262 1200          TAD     FILHI           /HI LINE LIMIT FOR FILLERS
 4826 36263 7100          CLL
 4827 36264 1201          TAD     FILLO           /LO LINE LIMIT FOR FILLERS
 4828 36265 7620          SNL CLA
 4829 36266 5275          JMP     CONOU5          /NO FILLERS FOR THIS LINE
 4830 36267 1133          TAD     CONDDB
 4831 36270 1141          TAD     C0005
 4832 36271 3150          DCA     WS2             /POINTER TO DDB CHARACTER COUNT
 4833 36272 7130          STL RAR
 4834 36273 1550          TAD I   WS2             /INDICATE THE NEED FOR FILLERS
 4835 36274 3550          DCA I   WS2
 4836 36275 6002  CONOU5, IOF
 4837 36276 1403          TAD I   WS0             /WHAT'S THE HARDWARE DOING?
 4838 36277 7006          RTL
 4839 36300 7620          SNL CLA                 /HARDWARE BUSY FLAG IN THE LINK
 4840 36301 5307          JMP     CONOU6          /NOTHING - SEND TO IT
 4841 36302 1031          TAD     TTCHAR
 4842 36303 7004          RAL                     /SET THE CHARACTER READY FLAG
 4843 36304 6001  CONOU8, ION
 4844 36305 3403          DCA I   WS0             /NEW LINE STATUS
 4845 36306 5226          JMP     CONOU1          /CHECK NEXT LINE
 4846 36307 1004  CONOU6, TAD     WS1
 4847 36310 7001          IAC
 4848 36311 7440          SZA                     /LINE PRINTER?
 4849 36312 5342          JMP     CONOU7          /NO - EITHER TTY OR PTP
 4850 36313 6665          LIE                     /DISABLE LS08/LS8E INTERRUPTS
 4851 36314 6667          LCP                     /DISABLE LP08/LE8 INTERRUPTS
 4852 36315 6001          ION
 4853 36316 1211          TAD     CONLPF
 4854 36317 4502          JMS I   SETFLG          /SET THE LINE PRINTER FLAG FOR THE USER
 4855 36320 1031          TAD     TTCHAR
 4856 36321 5327          JMP     CONLP2
 4857 36322 1133  CONLP1, TAD     CONDDB
 4858 36323 4507          FETCH                   /NO - GET ANOTHER CHARARCTER FOR THE LINE PRINTER
 4859 36324 5365          JMP     CONOU9          /LINE PRINTER BUFFER IS EMPTY
 4860 36325 6661          LSF                     /IS IT READY FOR THE NEXT CHARACTER ALREADY?
 4861 36326 5253          JMP     CONOU4          /NO - JUST TUCK THIS ONE AWAY FOR AN INTERRUPT TO TAKE
 4862 36327 6666  CONLP2, LPC
 4863 36330 7332          STL CLA RTR
 4864 36331 3403          DCA I   WS0             /REMEMBER THE HHARDWARE IS BUSY
 4865 36332 5322          JMP     CONLP1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 113


 4866             
 4867 36333 1533  CONJAM, TAD I   CONDDB
 4868 36334 0036          AND     C0037           /REMOVE THE JAM REQUEST
 4869 36335 3533          DCA I   CONDDB
 4870 36336 1035          TAD     C0007           /BELL?
 4871 36337 7430          SZL
 4872 36340 1212          TAD     C0014           /NO - "XOFF"
 4873 36341 5253          JMP     CONOU4
 4874             
 4875 36342 1207  CONOU7, TAD     CONDEV
 4876 36343 3350          DCA     CONTLS
 4877 36344 1750          TAD I   CONTLS
 4878 36345 1141          TAD     C0005           /CONSTRUCT TLS, PLS, OR "JMP T8OUT"
 4879 36346 3350          DCA     CONTLS
 4880 36347 1031          TAD     TTCHAR
 4881 36350 0000  CONTLS, .-.                     /TLS, PLS, OR "JMP T8OUT"
 4882 36351 7332          STL CLA RTR             /AC=2000
 4883 36352 6001          ION
 4884 36353 3403          DCA I   WS0
 4885 36354 5250          JMP     CONOU3          /GET ANOTHER CHARACTER
 4886             
 4887 36355 0000  CONGET, 0
 4888 36356 1003          TAD     WS0
 4889 36357 7124          STL RAL                 /TIMES 2 PLUS 1
 4890 36360 1206          TAD     DEVOUT
 4891 36361 3132          DCA     CONDBA          /DEVTBL POINTER
 4892 36362 1532          TAD I   CONDBA          /IS THERE A DDB FOR THIS DEVICE?
 4893 36363 7440          SZA
 4894 36364 5755          JMP I   CONGET
 4895 36365 7350  CONOU9, CLL STA RAR
 4896 36366 6202          CIF                     /NO INTERRUPTS
 4897 36367 0403          AND I   WS0
 4898 36370 3403          DCA I   WS0             /CLEAR THE REQUEST FLAG
 4899 36371 1532          TAD I   CONDBA          /DOES HE EXIST?
 4900 36372 7450          SNA
 4901 36373 5226          JMP     CONOU1          /NO - SO WE'RE FINISHED
 4902 36374 3015          DCA     AXS1
 4903 36375 1415          TAD I   AXS1            /JOB
 4904 36376 7640          SZA CLA
 4905 36377 5226          JMP     CONOU1          /STILL DEFINED
 4906 36400 3532          DCA I   CONDBA          /CLEAR HIM/HER FROM DEVTBL
 4907 36401 1133          TAD     CONDDB          /TIME TO RELEASE THE DDB
 4908 36402 6201          CDF
 4909 36403 4576          RETBLK
 4910 36404 6211          DATFLD
 4911 36405 7240          STA
 4912 36406 1015  TTIME2, TAD     AXS1            /ADDRESS OF DDB
 4913 36407 4651          JMS I   CONCLR          /FLUSH OUT BUFFER
 4914 36410 3403          DCA I   WS0
 4915 36411 5612          JMP I   .+1
 4916 36412 6240          CONOU2

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 114


 4917             
 4918             TOFA1,
 4919 36413 0000  TTIME,  0
 4920 36414 0040          AND     C1000
 4921 36415 7740  C7740,  SZA SMA CLA             /SMA HERE TO MAKE CONSTANT
 4922 36416 5227          JMP     TTIME1          /OOPS!
 4923 36417 6202          CIF                     /NO INTERRUPTS
 4924 36420 1403          TAD I   WS0
 4925 36421 7540          SZA SMA                 /REQUEST OR INACTIVE?
 4926 36422 1040          TAD     C1000           /NO - SET TIMER BIT
 4927 36423 7500          SMA                     /HOW SHALL WE EXIT?
 4928 36424 2213          ISZ     TTIME           /SKIP - HE'S CURRENTLY ACTIVE
 4929 36425 3403          DCA I   WS0             /SAVE UPDATED STATUS
 4930 36426 5613          JMP I   TTIME           /AND AWAY
 4931 36427 4646  TTIME1, JMS I   CONGEA          /HUNG - FIND HIS/HER DDB
 4932 36430 3015          DCA     AXS1
 4933 36431 4647          JMS I   CONSEA          /WAKE HIM/HER UP
 4934 36432 7126          STL RTL
 4935 36433 1004          TAD     WS1
 4936 36434 7710          SPA CLA                 /WHICH DEVICE IS IT?
 4937 36435 5206          JMP     TTIME2          /TELEPRINTER
 4938 36436 1415          TAD I   AXS1            /JOB OWNING DEVICE
 4939 36437 7450          SNA
 4940 36440 5205          JMP     TTIME2-1        /NO JOB, HUNG -- LET'S GET RID OF HIS/HER BUFFER!!
 4941 36441 6201          CDF
 4942 36442 4463          ERROR                   /PASS THE ERROR TO HIM/HER
 4943 36443 0006          HUNGDV
 4944 36444 6211          DATFLD
 4945 36445 5650          JMP I   CONO1A          /TRY AGAIN NOW
 4946             
 4947 36446 6355  CONGEA, CONGET
 4948 36447 6701  CONSEA, CONSET
 4949 36450 6226  CONO1A, CONOU1
 4950 36451 6642  CONCLR, CLRBUF
 4951             
 4952             TOFT1,
 4953 36452 0000  TOFSET, 0                       /ONLY CALLED BY "TOF
 4954 36453 1257          TAD     TOF
 4955 36454 7710          SPA CLA                 /CALLED FROM INPUT OR OUTPUT HANDLER?
 4956 36455 4647          JMS I   CONSEA          /SET OUTPUT FLAGS
 4957 36456 5652          JMP I   TOFSET

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 115


 4958             
 4959             /RETRIEVE A CHARACTER FROM LINKED BUFFER
 4960             /CALL:  DDB ADDRESS IN AC
 4961             /       JMS     TOF
 4962             /       RETURN BUFFER EMPTY
 4963             /       RETURN CHARACTER IN AC
 4964             
 4965 36457 0000  TOF,    0
 4966 36460 1141          TAD     C0005           /INDEX TO COUNT
 4967 36461 3213          DCA     TOFA1
 4968 36462 1613          TAD I   TOFA1
 4969 36463 7450          SNA
 4970 36464 5657          JMP I   TOF             /ALREADY EMPTY
 4971 36465 2257          ISZ     TOF             /SHOW SUCCESS
 4972 36466 7510          SPA
 4973 36467 5344          JMP     TOF3            /GENERATE A FILLER
 4974 36470 1215          TAD     C7740
 4975 36471 7450          SNA
 4976 36472 4252          JMS     TOFSET          /TIME TO SET STR1 BIT
 4977 36473 1036          TAD     C0037           /AC NOW = COUNT -1
 4978 36474 7450          SNA
 4979 36475 5347          JMP     TOF4            /THIS WILL BE THE LAST CHARACTER
 4980 36476 3613  TOF0,   DCA I   TOFA1
 4981 36477 2213          ISZ     TOFA1           /POINT TO EMPTY COUNT
 4982 36500 2613          ISZ I   TOFA1           /ANY LEFT IN THIS BLOCK?
 4983 36501 5314          JMP     TOF1            /MUST BE
 4984 36502 1370          TAD     TC7766
 4985 36503 3613          DCA I   TOFA1           /RESET THE EMPTY COUNT
 4986 36504 2213          ISZ     TOFA1           /EMPTY BLOCK
 4987 36505 1613          TAD I   TOFA1
 4988 36506 6201          CDF
 4989 36507 4576          RETBLK                  /RETURN THE EMPTY BLOCK
 4990 36510 6211          DATFLD
 4991 36511 3613          DCA I   TOFA1           /LINK TO NEXT BLOCK
 4992 36512 1370          TAD     TC7766
 4993 36513 5316          JMP     TOF1+2
 4994 36514 1613  TOF1,   TAD I   TOFA1           /GET THE COUNT TO DETERMINE POSITION WITHIN THE BLOCK
 4995 36515 2213          ISZ     TOFA1           /POINT TO EMPTY BLOCK
 4996 36516 1033          TAD     C0003
 4997 36517 7500          SMA                     /UNPACK?
 4998 36520 7124          STL RAL                 /YES (MULT BY 2 THEN ADD 1) FUDGE POSITION
 4999 36521 7510          SPA                     /UNPACK?
 5000 36522 7161          STL CIA                 /NO - MAKE OFFSET POSITIVE - SET LINK TO INDICATE NO UNPACKING NEEDED
 5001 36523 1613          TAD I   TOFA1           /ADD OFFSET TO EMPTY BLOCK POINTER
 5002 36524 3213          DCA     TOFA1
 5003 36525 1613          TAD I   TOFA1           /GET CHARACTER; OR AT LEAST PART OF IT
 5004 36526 7430          SZL                     /UNPACK?
 5005 36527 5342          JMP     TOF2            /NO
 5006 36530 0134          AND     C7400           /SAVE PERTINENT BITS
 5007 36531 3252          DCA     TOFT1
 5008 36532 2213          ISZ     TOFA1
 5009 36533 1613          TAD I   TOFA1           /GET THE OTHER HALF OF THE CHARACTER
 5010 36534 0134          AND     C7400           /THROW AWAY THE JUNK
 5011 36535 7112          CLL RTR                 /START MOVING IT INTO PLACE
 5012 36536 7012          RTR
 5013 36537 1252          TAD     TOFT1           /GET THE M.S. BITS
 5014 36540 7012          RTR

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 116


 5015 36541 7012          RTR                     /THAT SHOULD DO IT
 5016 36542 0140  TOF2,   AND     C0377           /CLEAR ANY JUNK LEFT OVER
 5017 36543 5657          JMP I   TOF             /AND AWAY
 5018 36544 1156  TOF3,   TAD     C0400           /INCR. FILLER COUNT
 5019 36545 3613          DCA I   TOFA1
 5020 36546 5657          JMP I   TOF             /EXIT WITH FILLER (NULL) CHARACTER
 5021 36547 4252  TOF4,   JMS     TOFSET          /SET THE STR1 BIT FOR THIS DEVICE
 5022 36550 7240          STA
 5023 36551 1213          TAD     TOFA1
 5024 36552 3252          DCA     TOFT1           /POINTS TO FILL BLOCK POINTER
 5025 36553 1652          TAD I   TOFT1
 5026 36554 6201          CDF
 5027 36555 4576          RETBLK                  /RETURN THE LAST BLOCK OF THE BUFFER
 5028 36556 6211          DATFLD
 5029 36557 0257          AND     TOF
 5030 36560 7700          SMA CLA                 /CALLED FROM INPUT OR OUTPUT HANDLER?
 5031 36561 1003          TAD     WS0             /INPUT - CHECK FOR NON-ZERO BREAK-MASK
 5032 36562 7650          SNA CLA
 5033 36563 5366          JMP     TOF5            /NO "JSDEL" TO CLEAR
 5034 36564 1037          TAD     C0100
 5035 36565 4771          JMS I   TOFCLR          /CLEAR JSDEL - THIS IS THE LAST CHARACTER
 5036 36566 3652  TOF5,   DCA I   TOFT1           /CLEAR FILL POINTER SO WE KNOW WE'RE EMPTY
 5037 36567 5276          JMP     TOF0
 5038             
 5039 36570 7766  TC7766, 7766
 5040 36571 1562  TOFCLR, CLSTR1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 117


 5041             
 5042             /ROUTINE TO ALLOW SI & FIP TO CLEAR BUFFERS BY WAY OF FIELD 0 ROUTINE
 5043 36572 0000  SICLR,  0
 5044 36573 4651          JMS I   CONCLR
 5045 36574 6223          CIF CDF 20              /BACK TO FIELD 2
 5046 36575 5772          JMP I   SICLR
 5047             
 5048             /CLEAR STATUS
 5049 36576 4476  UCLS,   GETJTW                  /ADDRESS OF STR0 TO JOBSWA
 5050 36577 0000          JOBSTS
 5051 36600 7346          CLA CLL CMA RTL         /-3 IN AC
 5052 36601 3003          DCA     WS0
 5053 36602 1222          TAD     C2407           /DON'T LET HIM/HER MESS UP STR0
 5054 36603 7410          SKP
 5055 36604 7240  Y1,     STA                     /LET HIM/HER ANYTHING IN STR1 AND D.S.R.
 5056 36605 4150          UDF                     /UP TO USER FIELD
 5057 36606 0506          AND I   L2SA            /GET BITS TO CLEAR
 5058 36607 7040          CMA
 5059 36610 6211          DATFLD
 5060 36611 0405          AND I   JOBSWA          /CLEAR THEM
 5061 36612 3405          DCA I   JOBSWA          /SAVE NEW VALUE
 5062 36613 2106          ISZ     L2SA            /BUMP POINTER
 5063 36614 0020  C0020,  20                      /NOP
 5064 36615 2005          ISZ     JOBSWA          /BUMP POINTER
 5065 36616 2003          ISZ     WS0             /COUNT, 3 STATUS WORDS TO CLEAR
 5066 36617 5204          JMP     Y1
 5067 36620 3106          DCA     L2SA            /CLEAR HIS/HER AC
 5068 36621 5461          UUOEXT
 5069 36622 2407  C2407,  JSEREN JSPEEK UUOERF SWPRER SWPWER DSKERR HUNGDV
 5070             
 5071             
 5072             /RETURN CONTENT OF STATUS WORD IN AC
 5073             /CALL   TAD POINTER TO JOB STATUS ADDRESS
 5074             /       GETJTI
 5075             /       RELATIVE ADDR OF WORD
 5076             /       RETURN (ADDRESS OF WORD IN JOBSWA)
 5077             
 5078             CLR0,
 5079 36623 0000  GETJI0, 0
 5080 36624 6201          CDF
 5081 36625 3005          DCA     JOBSWA          /SAVE POINTER TO JOB STATUS
 5082 36626 1623          TAD I   GETJI0          /GET POSITION IN LIST
 5083 36627 3232          DCA     .+3             /SAVE IT
 5084 36630 1005          TAD     JOBSWA          /NOW GET ADDRESS OF THIS ENTRY
 5085 36631 4574          GETJTA
 5086 36632 0000          0
 5087 36633 3005          DCA     JOBSWA          /SAVE IT
 5088 36634 6211          DATFLD
 5089 36635 7430          SZL                     /IF LINK=0 THERE'S NOTHING TO GET
 5090 36636 1405          TAD I   JOBSWA          /GET CONTENTS OF THAT ADDRESS
 5091 36637 6201          CDF
 5092 36640 2223          ISZ     GETJI0          /INDEX RETURN
 5093 36641 5623          JMP I   GETJI0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 118


 5094             
 5095             /RETURN ALL BLOCKS OF LINKED BUFFER TO FREE CORE (EXCEPT DDB)
 5096             /CLEAR ENTRIES IN DDB SO WE KNOW IT'S EMPTY
 5097 36642 0000  CLRBUF, 0
 5098 36643 7450          SNA
 5099 36644 5642          JMP I   CLRBUF          /OOPS!
 5100 36645 1034          TAD     C0004           /POINT TO WORD 4 (FILL POINTER
 5101 36646 3223          DCA     CLR0
 5102 36647 1623          TAD I   CLR0
 5103 36650 7650          SNA CLA
 5104 36651 5642          JMP I   CLRBUF          /BUFFER ALREADY EMPTY
 5105 36652 3623          DCA I   CLR0            /CLEAR FILL POINTER
 5106 36653 2223          ISZ     CLR0
 5107 36654 3623          DCA I   CLR0            /CLEAR CHARACTER COUNT
 5108 36655 2223          ISZ     CLR0
 5109 36656 2223          ISZ     CLR0
 5110 36657 1623          TAD I   CLR0            /EMPTY BLOCK POINTER
 5111 36660 6201          CDF
 5112 36661 4576          RETBLK                  /RETURN A BLOCK TO FREE CORE
 5113 36662 7440          SZA
 5114 36663 5261          JMP     .-2             /DELETE ANOTHER BLOCK
 5115 36664 6211          DATFLD
 5116 36665 3623          DCA I   CLR0            /CLEAR THE EMPTY BLOCK POINTER
 5117 36666 5642          JMP I   CLRBUF
 5118             
 5119             
 5120             
 5121             
 5122             
 5123 36667 1037  SCHNUL, TAD     C0100           /RUN NULL JOB IN USER MODE
 5124 36670 3103          DCA     L2SF            /FIELD 0; USER MODE
 5125 36671 1300          TAD     SCHNJA
 5126 36672 3104          DCA     L2SV0
 5127 36673 2277          ISZ     NULAC           /BUMP NULL JOB'S AC
 5128 36674 1277          TAD     NULAC
 5129 36675 3106          DCA     L2SA            /RESTORE IT
 5130 36676 5467          EXIT                    /OFF TO NULL JOB
 5131             
 5132 36677 0000  NULAC,  0
 5133 36700 5200  SCHNJA, NULJOB

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 119


 5134             
 5135             /ROUTINE TO SET EITHER JSTEL, JSLPT, OR JSPTP IN STR1
 5136             
 5137 36701 0000  CONSET, 0
 5138 36702 7326          CLA STL RTL
 5139 36703 1004          TAD     WS1             /FROM POSITION IN OUTREG DETERMINE DEVICE FLAG POSITION
 5140 36704 7450          SNA
 5141 36705 5311          JMP     .+4             /IT'S THE PUNCH
 5142 36706 7700          SMA CLA                 /SKIP IF TELEPRINTER
 5143 36707 1214          TAD     C0020           /IT'S THE LINE PRINTER
 5144 36710 1375          TAD     CC0014
 5145 36711 1034          TAD     C0004
 5146 36712 4502          JMS I   SETFLG          /SET THE APPROPRIATE BIT IN STR1
 5147 36713 5701          JMP I   CONSET
 5148             
 5149             /QUEUE DISC REQUEST
 5150             /CALL   TAD ADDRESS OF TRANSFER BLOCK
 5151             /       JMS DSQUE
 5152             /       RETURN
 5153             
 5154       0032  DSQFLD= C0002                   /FILPIF
 5155             
 5156 36714 0000  DSQUE,  0
 5157 36715 3332          DCA     DSQUE1          /SAVE ADDRESS OF PARAMETER BLOCK
 5158 36716 1332          TAD     DSQUE1          /NOW GET POINTER TO WORD WITH FIELD & FILE DATA
 5159 36717 1032          TAD     DSQFLD
 5160 36720 3370          DCA     DSQUE2          /SAVE POINTER
 5161 36721 6211          DATFLD
 5162 36722 1770          TAD I   DSQUE2          /GET FIELD # (BITS 7-9) AND FILE # (BITS 10-11)
 5163 36723 0036          AND     C0037           /USE THIS VALUE AS DSUTBL INDEX
 5164 36724 1164          TAD     DSUTBA
 5165 36725 3370          DCA     DSQUE2          /SAVE POINTER TO DSUTBL
 5166 36726 1332          TAD     DSQUE1          /GET PARAMETER ADDRESS
 5167 36727 3770          DCA I   DSQUE2          /SAVE IN DSUTBL
 5168 36730 6201  UPEEK3, CDF                     /AND EXIT
 5169 36731 5714          JMP I   DSQUE
 5170             
 5171             /SUBROUTINE TO CHECK FOR PRIVILEGE CONDITION FOR USER DOING UUO
 5172             /PRIVILEGE BITS ARE SET EITHER BY THE ACCOUNT NUMBER BEING LESS THAN
 5173             /FOUR (FIP) OR BY A REQUEST TO RUN A LIBRARY PROGRAM USING R, KJOB,
 5174             /SYSTAT, OR LOGOUT. THE LATTER BIT IS SET BY SI, AND CLEARED EVERY
 5175             /TIME THAT SI IS ENTERED.
 5176             
 5177             DSQUE1,
 5178 36732 0000  PRIV,   0
 5179 36733 4476          GETJTW
 5180 36734 0000          JOBSTS                  /GET STR0
 5181 36735 0142          AND     C0600           /IS EITHER PRIVILEGE BIT SET?
 5182 36736 7640          SZA CLA
 5183 36737 5732          JMP I   PRIV            /YES, OK
 5184 36740 5741          JMP I   .+1             /NO, ERROR; INVALID IOT
 5185 36741 5144          UUOERR

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 120


 5186             
 5187             /LOGOUT IS A PRIVILEGED IOT, UNLESS THE AC=0
 5188             
 5189 36742 1106  ULOGO,  TAD     L2SA            /IS AC=0?
 5190 36743 7640          SZA CLA
 5191 36744 4332          JMS     PRIV            /NO - CHECK FOR PRIVILEGE
 5192 36745 2015          ISZ     AXS1            /FUDGE SO AXS1 WILL LEAD TO A 0
 5193 36746 5747          JMP I   .+1             /NOW JUMP DIRECTLY TO THE NON-RESIDENT
 5194 36747 2246          UUO6                    /UUO CODE
 5195             
 5196             /PEEK IS A PRIVILEGED IOT
 5197 36750 4332  UPEEK,  JMS     PRIV            /MAKE SURE A PRIVILEGE BIT IS SET
 5198 36751 7240          STA                     /BACK UP HIS/HER AC
 5199 36752 1106          TAD     L2SA
 5200 36753 3015          DCA     AXS1            /BECAUSE OF AUTO-INDEX
 5201 36754 4150          UDF
 5202 36755 1415          TAD I   AXS1            /GET CORE-FIELD
 5203 36756 0113          AND     C0010           /LET HIM/HER SEE FIELDS 0,1
 5204                                             /COULD PROBABLY LET HIM/HER SEE MORE, BUT HAVE
 5205                                             /TO WORRY ABOUT NON-EXISTENT CORE.
 5206 36757 1330          TAD     UPEEK3          /MAKE A CDF
 5207 36760 3370          DCA     UPEEK1
 5208 36761 7240          STA
 5209 36762 1415          TAD I   AXS1            /BEGINNING MONITOR ADDRESS-1
 5210 36763 3016          DCA     AXS2
 5211 36764 1415          TAD I   AXS1            /BEGINNING USER ADDRESS
 5212 36765 3003          DCA     WS0
 5213 36766 1415          TAD I   AXS1            /MINUS HOW MANY WORDS
 5214 36767 3106          DCA     L2SA
 5215             DSQUE2,
 5216 36770 0000  UPEEK1, .-.                     /CDF TO MONITOR FIELD
 5217 36771 1416          TAD I   AXS2            /GET WORD
 5218 36772 4150          UDF                     /USER DATA FIELD
 5219 36773 3403          DCA I   WS0             /GET RID OF WORD
 5220 36774 2003          ISZ     WS0
 5221 36775 0014  CC0014, 14                      /NOP
 5222 36776 2106          ISZ     L2SA            /THROUGH?
 5223 36777 5370          JMP     UPEEK1          /NO
 5224 37000 5461          UUOEXT                  /YES -- AND HIS/HER AC=0!!
 5225             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 121


 5226             
 5227       7001          *CORTBL
 5228 37001 2000          LOCK                    /DATFLD
 5229 37002 2000          LOCK                    /FIELD 2
 5230 37003 2000          LOCK                    /FIELD 3
 5231 37004 2000          LOCK                    /FIELD 4
 5232 37005 2000          LOCK                    /FIELD 5
 5233 37006 2000          LOCK                    /FIELD 6
 5234 37007 2000          LOCK                    /FIELD 7
 5235             
 5236             /THE ABOVE ARE UNLOCKED BY INIT AS A FUNCTION OF # USER FIELDS
 5237             
 5238             
 5239       7010          *L2QTB
 5240 37010 0000  ZBLOCK  20                      /LEVEL 2 QUEUE
      37011 0000
      37012 0000
      37013 0000
      37014 0000
      37015 0000
      37016 0000
      37017 0000
      37020 0000
      37021 0000
      37022 0000
      37023 0000
      37024 0000
      37025 0000
      37026 0000
      37027 0000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 122


 5241             
 5242             /COMBINED RESIDENT IOTS
 5243 37030 6040  UUOTBL, 6040                    /TELEPRINTER
 5244 37031 6660          6660                    /LPT
 5245 37032 6030          6030                    /KEYBOARD
 5246 37033 6010          6010                    /READER
 5247 37034 6020          6020                    /PUNCH
 5248 37035 6500          6500                    /RESERVED FOR FUTURE USE
 5249 37036 0000          0
 5250             
 5251             /UNCOMBINED RESIDENT IOTS
 5252             
 5253 37037 6603          6603                    /RFILE
 5254 37040 6605          6605                    /WFILE
 5255 37041 6200          6200                    /CKS - CHECK STATUS
 5256 37042 6405          6405                    /CLS - CLEAR STATUS
 5257 37043 6400          6400                    /KSB - SET KEYBOARD BREAK
 5258 37044 6401          6401                    /SBC - SELECTIVE BUFFER CLEAR
 5259 37045 6402          6402                    /DUP - DUPLEX TELETYPE CONSOLE
 5260 37046 6403          6403                    /UND - UNDUPLEX TTY
 5261 37047 6411          6411                    /URT - USER RUN TIME
 5262 37050 6412          6412                    /TOD - TIME OF DAY
 5263 37051 6413          6413                    /RCR - RETURN CLOCK RATE
 5264 37052 6414          6414                    /DATE
 5265 37053 6415          6415                    /SYN - QUANTUM SYNCHRONIZATION
 5266 37054 6416          6416                    /STM - SET TIMER
 5267 37055 6417          6417                    /SRA - SET RESTART ADDRESS
 5268 37056 6617          6617                    /ACT - RETURN ACCOUNT NUMBER
 5269 37057 6420          6420                    /TSS - SKIP ON TSS/8
 5270 37060 6421          6421                    /USE - USER
 5271 37061 6422          6422                    /CON - USER CONSOLE
 5272 37062 6423          6423                    /PEEK - LOOK IN MONITOR CORE
 5273 37063 6430          6430                    /SSW - SET SWITCH REGISTER
 5274 37064 6431          6431                    /SEA - SET ERROR ADDRESS
 5275 37065 6614          6614                    /SIZE
 5276 37066 6004          6004                    /GTF - GET FLAGS ( LINK AND GT ONLY )
 5277 37067 6005          6005                    /RTF - RESTORE FLAGS (LINK AND GT ONLY)
 5278 37070 6006          6006                    /SGT - SKIP ON EAE GT FLAG
 5279 37071 6764          6764                    /DTXA - DECTAPE READ OR WRITE
 5280 37072 6771          6771                    /DTSF - DECTAPE SKIP
 5281 37073 6772          6772                    /RDS - READ DEVICE STATUS REGISTER (DT, RK, & CDR)
 5282 37074 6773          6773                    /DTSF RDS - MICROCODED
 5283 37075 6743          6743                    /DLAG - RK05 READ OR WRITE
 5284 37076 6632          6632                    /RCRA - READ CARD ALPHA
 5285 37077 6634          6634                    /RCRB - READ CARD BINARY
 5286 37100 6636          6636                    /RCRC - READ CARD COMPRESSED
 5287 37101 6615          6615                    /LOGOUT - MUST BE LAST IN GROUP, SEE ULOGO FOR DETAILS
 5288 37102 0000          0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 123


 5289             
 5290             /NON-RESIDENT IOTS
 5291             
 5292             
 5293 37103 6440          6440                    /ASD - ASSIGN DEVICE
 5294 37104 6442          6442                    /REL - RELEASE DEVICE
 5295             
 5296 37105 6601          6601                    /OPEN - OPEN FILE
 5297 37106 6602          6602                    /CLOS - CLOSE FILE
 5298 37107 6600          6600                    /REN - RENAME FILE
 5299 37110 6604          6604                    /PROT - PROTECT FILE
 5300             
 5301 37111 6610          6610                    /CRF - CREATE FILE
 5302 37112 6611          6611                    /EXT - EXTEND FILE
 5303 37113 6612          6612                    /RED - REDUCE FILE
 5304 37114 6406          6406                    /SEGS - RETURN NUMBER OF FREE DISK SEGMENTS
 5305 37115 0000          0
 5306             
 5307             /LONG NON-RESIDENT IOTS
 5308             
 5309 37116 6613          6613                    /FINF
 5310 37117 6616          6616                    /WHO
 5311 37120 0000          0
 5312             
 5313             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 124


 5314             
 5315             /MICRO-CODED RESIDENT IOT DISPATCH
 5316             
 5317 37121 5000  UUODTB, UTEL                    /TELEPRINTER
 5318             IFNZRO LPT <ULPT>               /LINE PRINTER
 5319 37122 5144  IFZERO LPT <UUOERR>
 5320 37123 3451          UKEY                    /KEYBOARD
 5321 37124 1002          UPTR                    /READER
 5322 37125 5106  IFNZRO PUNCH <UPTP>             /PUNCH
 5323             IFZERO PUNCH <UUOERR>
 5324 37126 5144          UUOERR                  /RESERVED FOR FUTURE USE
 5325 37127 0000          0
 5326             
 5327             
 5328             /NON-MICRO-CODED RESIDENT IOT DISPATCH
 5329             
 5330 37130 4400          UFILE
 5331 37131 4400          UFILE
 5332 37132 5331          UCKS
 5333 37133 6576          UCLS
 5334 37134 7256          UKSB
 5335 37135 4153          USBC
 5336 37136 4764          UDUP
 5337 37137 4765          UUND
 5338 37140 5300          UURT
 5339 37141 5316          UTOD
 5340 37142 5616          URCR
 5341 37143 6113          UDATE
 5342 37144 5150          USYN
 5343 37145 1437          USTM
 5344 37146 7272          USRA
 5345 37147 7320          UACC
 5346 37150 7213          UTSS
 5347 37151 5613          UUSE
 5348 37152 6077          UCON
 5349 37153 6750          UPEEK
 5350 37154 7270          USSW
 5351 37155 1375          USEA
 5352 37156 5611          USIZE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 125


 5353             
 5354 37157 3621  IFNZRO CPU&7776 <UGTF
 5355 37160 3627          URTF>
 5356             IFZERO CPU&7776 <UUOERR
 5357                     UUOERR>
 5358 37161 3615  IFZERO CPU-2 <USGT>
 5359             IFNZRO CPU-2 <UUOERR>
 5360 37162 1575  IFNZRO TC01 <UDTXA0>
 5361             IFZERO TC01 <UUOERR>
 5362 37163 7215          UUOEX2
 5363 37164 1153          UDTRB
 5364 37165 1151          UDTRBS
 5365             IFNZRO RK05 <URK050>
 5366 37166 5144  IFZERO RK05 <UUOERR>
 5367             IFNZRO CDR <
 5368                     UUCDR0+2
 5369                     UUCDR0+1
 5370             IFNZRO CPU&7776 <UUCDR0>
 5371             IFZERO CPU&7776 <UUOERR>>
 5372 37167 5144  IFZERO CDR <UUOERR
 5373 37170 5144          UUOERR
 5374 37171 5144          UUOERR>
 5375 37172 6742          ULOGO                   /LOGOUT - MUST BE FOLLOWED BY A 0
 5376                                             /SEE ULOGO FOR DETAILS
 5377 37173 0000          0
 5378             
 5379             /-# ARGUMENTS FOR NON-RESIDENT IOTS
 5380             
 5381 37174 0000          0                       /ASD
 5382 37175 0000          0                       /REL
 5383 37176 7772  UFILCT, -6                      /OPEN
 5384 37177 0000          0                       /CLOS
 5385 37200 7772          -6                      /REN
 5386 37201 0000          0                       /PROT
 5387 37202 7774          -4                      /CRF
 5388 37203 7774          -4                      /EXT
 5389 37204 7774          -4                      /RED
 5390 37205 0000          0                       /SEGS
 5391 37206 0000          0
 5392 37207 7776          -2                      /FINF
 5393 37210 7776          -2                      /WHO
 5394 37211 0000          0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 126


 5395             
 5396             
 5397 37212 0030          VERNUM
 5398 37213 1212  UTSS,   TAD     .-1             /SKIP ON TSS/8
 5399 37214 3106          DCA     L2SA            /AND RETURN VERSION # IN AC
 5400 37215 2104  UUOEX2, ISZ     L2SV0           /POSITIVE FLAG TEST EXIT
 5401 37216 7000          NOP
 5402             
 5403             /ENTRY FOR UUOEXT
 5404             /SETS UP WAIT MASK 1 IF THERE ARE ANY WAIT CONDITIONS FOR STR1
 5405             /IF THERE IS NOTHING TO WAIT FOR, WE EXIT BACK TO THE USER
 5406             
 5407             
 5408 37217 7450  UUOEX1, SNA
 5409 37220 5235          JMP     UUOEX3          /NO WAIT CONDITIONS
 5410 37221 6201          CDF
 5411 37222 3003          DCA     WS0             /SAVE BITS TO CLEAR
 5412 37223 4476          GETJTW                  /SET UP WAIT MASK
 5413 37224 0003          JOBWMK
 5414 37225 7201          CLA IAC
 5415 37226 1003          TAD     WS0             /WAIT ON THIS FLAG+JSWAIT
 5416 37227 6211          DATFLD
 5417 37230 3405          DCA I   JOBSWA          /SET WAIT MASK 1
 5418 37231 1405          TAD I   JOBSWA
 5419 37232 4634          JMS I   CLEAR1          /CLEAR SAME BITS IN STR1
 5420 37233 5577          WAIT
 5421 37234 1562  CLEAR1, CLSTR1
 5422             
 5423 37235 6211  UUOEX3, DATFLD
 5424 37236 1561          TAD I   JOBDAT
 5425 37237 7001          IAC
 5426 37240 3005          DCA     JOBSWA          /POINTS TO STR0
 5427 37241 1405          TAD I   JOBSWA
 5428 37242 7700          SMA CLA                 /STILL RUNNABLE?
 5429 37243 5577          WAIT                    /NO
 5430 37244 2005          ISZ     JOBSWA
 5431 37245 7344          CLL STA RAL             /AC=7776
 5432 37246 0405          AND I   JOBSWA
 5433 37247 7001          IAC                     /MAKE SURE JSWAIT IS SET
 5434 37250 3405          DCA I   JOBSWA
 5435 37251 2005          ISZ     JOBSWA
 5436 37252 2005          ISZ     JOBSWA          /POINT TO WAIT MASK
 5437 37253 7001          IAC
 5438 37254 3405          DCA I   JOBSWA          /FORCE DUMMY WAIT BIT ONLY
 5439 37255 5467          EXIT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 127


 5440             
 5441             /SET SWITCH REGISTER, RESTART ADD, ERROR ADD, OR KEYBOARD BREAK
 5442             
 5443       0032  UKSBRK= C0002                   /DDBBRK
 5444             
 5445 37256 1160  UKSB,   TAD     JOB
 5446 37257 4464          TTYUSE                  /FIND USER INPUT TTY DDB
 5447 37260 1032          TAD     UKSBRK
 5448 37261 3005          DCA     JOBSWA          /POINTS TO BREAK MASK IN DDB
 5449 37262 1106          TAD     L2SA            /USER AC
 5450 37263 6211          DATFLD
 5451 37264 7440          SZA
 5452 37265 5301          JMP     UKSB1           /HE HAS NEW MASK -- GO PICK IT UP
 5453 37266 1405          TAD I   JOBSWA          /HE WANTS TO READ OLD MASK
 5454 37267 5302          JMP     UKSB1+1         /GIVE IT TO HIM/HER
 5455 37270 1032  USSW,   TAD     C0002           /SET AC=2
 5456 37271 7001  USEA1,  IAC                     /AC=AC+1
 5457 37272 1141  USRA,   TAD     C0005           /AC=AC+5
 5458 37273 3275          DCA     .+2             /SAVE RELATIVE ADDRESS
 5459 37274 4476          GETJTW                  /GET POINTER
 5460 37275 0000          0                       /POSITION IN LIST
 5461 37276 7200          CLA                     /WE ONLY WANTED POINTER
 5462 37277 1106          TAD     L2SA            /GET CONTENTS OF USER AC
 5463 37300 6211          DATFLD
 5464 37301 3405  UKSB1,  DCA I   JOBSWA          /SAVE IN JOB DATA AREA
 5465 37302 3106          DCA     L2SA
 5466 37303 5461          UUOEXT                  /AND AWAY
 5467             
 5468             
 5469 37304 7410  RINTA,  RINT
 5470 37305 2417  CDTIMA, TIMCDR
 5471 37306 6671  INTCDR, RCSD
 5472 37307 5704          JMP I   RINTA           /CONTINUE IN INTERRUPT SKIP CHAIN
 5473 37310 6674          RCRD                    /CLEAR CARD DONE FLAG
 5474 37311 1705          TAD I   CDTIMA
 5475 37312 7650          SNA CLA                 /WERE WE EXPECTING AN INTERRUPT?
 5476 37313 5500          DISMIS                  /NO
 5477 37314 3705          DCA I   CDTIMA          /NO MORE INTERRUPTS ALLOWED - WE FINISHED THIS CARD
 5478 37315 1317          TAD     .+2
 5479 37316 5500          DISMIS                  /SCHEDULE LEVEL 2
 5480 37317 2553          CDL20
 5481             /ACCOUNT NUMBER
 5482 37320 1106  UACC,   TAD     L2SA
 5483 37321 4330          JMS     JOBCHK          /SEE IF IT'S A VALID JOB
 5484 37322 5326          JMP     UACC0           /IT WASN'T - RETURN A ZERO
 5485 37323 1044          TAD     JOBTBA
 5486 37324 4477          GETJTI                  /GET THE ACCOUNT NUMBER OF THE JOB
 5487 37325 0016          JOBACC
 5488 37326 3106  UACC0,  DCA     L2SA            /RETURN IT TO HIM/HER
 5489 37327 5461          UUOEXT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 128


 5490             
 5491             IOR1,
 5492 37330 0000  JOBCHK, 0
 5493 37331 7450          SNA                     /SPECIFIC JOB?
 5494 37332 1160          TAD     JOB             /NO - HIS/HER OWN JOB
 5495 37333 3004          DCA     WS1
 5496 37334 1004          TAD     WS1
 5497 37335 7100          CLL
 5498 37336 1352          TAD     JOBS            /IS IT REALLY A JOB?
 5499 37337 7620          SNL CLA
 5500 37340 1004          TAD     WS1
 5501 37341 1044          TAD     JOBTBA
 5502 37342 3005          DCA     JOBSWA
 5503 37343 6211          DATFLD
 5504 37344 1405          TAD I   JOBSWA          /IS THERE REALLY A JOB?
 5505 37345 7650          SNA CLA
 5506 37346 5730          JMP I   JOBCHK          /NO - RETURN WITHOUT SKIP
 5507 37347 2330          ISZ     JOBCHK
 5508 37350 1004          TAD     WS1             /JOB NUMBER REQUESTED
 5509 37351 5730          JMP I   JOBCHK
 5510 37352 7753  JOBS,   -JOBMAX-1
 5511             
 5512 37353 0000  DTRKHG, 0
 5513 37354 4463          ERROR                   /DECTAPE OR RK05 IS HUNG
 5514 37355 0006          HUNGDV                  /REPORT IT TO THE USER
 5515 37356 6213          CIF DATFLD                      /BACK TO FIELD 1
 5516 37357 5753          JMP I   DTRKHG
 5517             /INCLUSIVE OR
 5518             /CALL   TAD ADDRESS OF WORD TO SET
 5519             /       IOR
 5520             /       BITS TO SET
 5521             /       RETURN
 5522             
 5523 37360 0000  IOR0,   0
 5524 37361 3330          DCA     IOR1            /SAVE ADDRESS TO SET
 5525 37362 6214          RDF                     /FIELD TO SET IT IN
 5526 37363 1365          TAD     .+2             /COMPUTE FIELD SELECT - FOR THAT FIELD
 5527 37364 3367          DCA     IOR2            /SAVE IT
 5528 37365 6201          CDF
 5529 37366 1760          TAD I   IOR0            /GET BITS TO SET
 5530 37367 0000  IOR2,   0                       /SET FIELD AGAIN
 5531 37370 3367          DCA     IOR2            /SAVE THEM
 5532 37371 1367          TAD     IOR2
 5533 37372 7040          CMA
 5534 37373 0730          AND I   IOR1            /CLEAR THE BITS IF ALREADY SET
 5535 37374 1367          TAD     IOR2            /NOW SET THEM
 5536 37375 3730          DCA I   IOR1            /SAVE NEW VALUE
 5537 37376 2360          ISZ     IOR0            /SKIP ARGUMENT IN CALL
 5538 37377 5760          JMP I   IOR0            /RETURN
 5539             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 129


 5540             
 5541       7400  *7400
 5542             IFNZRO DC08A <
 5543             JMPDC8= JMP I .                 /SKIP OVER DC08A VECTORS
 5544                     .+3
 5545             DC8REG= JMP .                   /SKIP OVER DC08A ACTIVE REGISTERS
 5546                     IAC
 5547                     ISZ     ACFLG           /SWITCH TO OUTPUT SIDE
 5548                     TAD     DCCNT
 5549                     TAD     ACX10
 5550                     DCA     ACX10           /SKIP OVER THE DC08A ENTRIES IN THE TABLE
 5551                     JMP     ACINT1          /BACK TO WORK
 5552             DCCNT,  DC08A-1 >
 5553       7410  *7410
 5554             
 5555 37410 3365  RINT,   DCA     SRVFLG          /CLEAR LEVEL 2 REQUEST FLAG
 5556 37411 6211          DATFLD
 5557 37412 6011          RSF
 5558 37413 5244          JMP     ACINT
 5559 37414 6012          RRB                     /GET CHARACTER FROM THE READER
 5560 37415 3411          DCA I   ACX11           /PUT IT IN THE RING BUFFER
 5561 37416 6201          CDF
 5562 37417 2243          ISZ     RCNT            /ENOUGH??
 5563 37420 5225          JMP     RINT1           /NO - SEE IF THERE'S STILL ROOM IN THE RING BUFFER
 5564 37421 3642  RINT0,  DCA I   RTIM
 5565 37422 6211          DATFLD
 5566 37423 7040          CMA
 5567 37424 5351          JMP     ACINT8          /READER IS LINE # 7777
 5568 37425 1372  RINT1,  TAD     KEYC            /IS THERE ENOUGH ROOM LEFT IN THE RING-BUFFER?
 5569 37426 1240          TAD     RLIM
 5570 37427 7700          SMA CLA
 5571 37430 5234          JMP     RINT2
 5572 37431 6014          RFC                     /KEEP THE READER GOING
 5573 37432 7144          CLL CMA RAL             /SET TIMER FOR 2 MORE SECONDS
 5574 37433 5221          JMP     RINT0
 5575 37434 1241  RINT2,  TAD     RL2A
 5576 37435 3413          DCA I   L2Q             /SCHEDULE THE READER TO BE RESTARTED AFTER THE BUFFER HAS BEEN EMPTIED
 5577 37436 2365          ISZ     SRVFLG          /REMEMBER WE WANT LEVEL 2
 5578 37437 5221          JMP     RINT0
 5579             
 5580 37440 7767  RLIM,   -NULINE-1
 5581 37441 1045  RL2A,   L2PTR1
 5582 37442 2415  RTIM,   TIMPTR
 5583 37443 0000  RCNT,   0
 5584             
 5585       2340  OUTIOT= ISZ ACFLG
 5586       5333  ENDIOT= JMP ACINT6

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 130


 5587             
 5588 37444 7344  ACINT,  CLL STA RAL             /AC=-2
 5589 37445 3340          DCA     ACFLG           /START BY CHECKING FOR INPUT
 5590 37446 1375          TAD     ACTBLA          /ADDRESS OF THE SKIP IOT'S
 5591 37447 3010          DCA     ACX10
 5592 37450 7126          STL RTL
 5593 37451 1373  ACINT0, TAD     HIPRO
 5594 37452 3323          DCA     HICNT           /SHORT LOOP COUNT TO PROTECT HI-PRIORITY DEVICES
 5595 37453 6211          DATFLD
 5596 37454 2323  ACINT1, ISZ     HICNT
 5597 37455 5264          JMP     ACINT2-2
 5598 37456 4774          JMS I   HIPRIA          /GO CHECK RK, DT, & CDR
 5599 37457 7450          SNA                     /ANYTHING REQUESTED?
 5600 37460 5251          JMP     ACINT0          /NO
 5601 37461 3413          DCA I   L2Q             /QUEUE THEIR REQUEST FOR THEM
 5602 37462 2365          ISZ     SRVFLG          /REMEMBER IT
 5603 37463 5251          JMP     ACINT0          /RE-INITIALIZE THE COUNT
 5604 37464 1410          TAD I   ACX10
 5605 37465 3266          DCA     ACINT2
 5606 37466 0000  ACINT2, .-.                     /DEVICE SKIP
 5607 37467 5254          JMP     ACINT1          /NOT THIS ONE
 5608 37470 1266          TAD     ACINT2
 5609 37471 1141          TAD     C0005           /GENERATE READ OR SEND IOT
 5610 37472 2340          ISZ     ACFLG
 5611 37473 5337          JMP     ACINT7          /MUST BE A KEYBOARD
 5612 37474 3304          DCA     ACINT3          /SAVE THE TLS, PLS, OR LPC
 5613 37475 1010          TAD     ACX10
 5614 37476 1376          TAD     ACOUT           /DETERMINE THE LINE NUMBER
 5615 37477 3340          DCA     ACFLG           /THIS LINE'S OUTPUT REGISTER
 5616 37500 1740          TAD I   ACFLG
 5617 37501 7010          RAR
 5618 37502 7420          SNL
 5619 37503 5320          JMP     ACINT5          /NOTHING WAITING TO GO
 5620 37504 0000  ACINT3, .-.
 5621 37505 7321          CLA STL IAC
 5622 37506 7012          RTR
 5623 37507 3740          DCA I   ACFLG           /HARDWARE BUSY AND REQUEST FLAGS SET
 5624 37510 3366          DCA     TTOFLG          /SCHEDULE LEVEL 2
 5625 37511 1013  ACINT4, TAD     L2Q             /POSITION OF FILL POINTER
 5626 37512 1377          TAD     L2QBOT          /MINUS L2QTB-1
 5627 37513 7041          CIA
 5628 37514 1365          TAD     SRVFLG          /DON'T COUNT THE ONES WE JUST PUT IN
 5629 37515 7650          SNA CLA                 /SHOULD WE SCHEDULE LEVEL 2?
 5630 37516 1067          TAD     EXITA           /YES
 5631 37517 5500          DISMIS

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 131


 5632             
 5633 37520 7201  ACINT5, CLA IAC
 5634 37521 1266          TAD     ACINT2
 5635 37522 3323          DCA     .+1
 5636 37523 0000  HICNT,  .-.                     /TCF, PCF, OR LCF
 5637 37524 7330          STL CLA RAR             /AC=4000
 5638 37525 0740          AND I   ACFLG
 5639 37526 3740          DCA I   ACFLG           /NO MORE INTERRUPTS EXPECTED FROM THIS LINE
 5640 37527 1365  ACEXIT, TAD     SRVFLG          /ANY REQUESTS?
 5641 37530 7640          SZA CLA
 5642 37531 5311          JMP     ACINT4          /YES - MAKE SURE THEY'RE SCHEDULED
 5643 37532 5500          DISMIS                  /NOTHING SPECIAL
 5644             
 5645 37533 6663  ACINT6, LSRP                    /LP08/LE8 ERROR?
 5646 37534 5327          JMP     ACEXIT          /NO, MUST BE AN UNDEFINED INTERRUPT
 5647 37535 6667          LCP                     /CLEAR INTERRUPT ENABLE
 5648 37536 5327          JMP     ACEXIT
 5649             
 5650 37537 3340  ACINT7, DCA     ACFLG           /SAVE THE KRB IOT
 5651 37540 0000  ACFLG,  .-.
 5652 37541 7450          SNA
 5653 37542 5327          JMP     ACEXIT          /THROW AWAY NULL CHARACTERS
 5654 37543 0146          AND     C0177
 5655 37544 1002          TAD     C0200           /FORCE ON THE "PARITY" BIT
 5656 37545 3411          DCA I   ACX11           /STASH IT IN THE RING BUFFER
 5657 37546 1375          TAD     ACTBLA
 5658 37547 7040          CMA
 5659 37550 1010          TAD     ACX10           /LINE NUMBER CAUSING INTERRUPT
 5660 37551 4353  ACINT8, JMS     ACINT9          /STASH LINE NUMBER & UPDATE POINTERS ETC.
 5661 37552 5311          JMP     ACINT4          /SCHEDULE LEVEL 2 IF WE WERE IN USER MODE
 5662 37553 0000  ACINT9, 0
 5663 37554 3411          DCA I   ACX11           /STASH AWAY THE LINE NUMBER
 5664 37555 2372          ISZ     KEYC            /COUNT THE ENTRY
 5665 37556 2370          ISZ     ACCNT           /END OF RING BUFFER
 5666 37557 5753          JMP I   ACINT9          /NO
 5667 37560 1367          TAD     ACRING
 5668 37561 3011          DCA     ACX11           /YES - RESET POINTER
 5669 37562 1371          TAD     ACSIZE
 5670 37563 3370          DCA     ACCNT           /AND THE COUNT
 5671 37564 5753          JMP I   ACINT9
 5672             
 5673 37565 0000  SRVFLG, 0
 5674 37566 0001  TTOFLG, 1                       /NON-ZERO WHEN SERVICE IS NOT REQUIRED
 5675 37567 0240  ACRING, RINGIN-1
 5676 37570 7721  ACCNT,  -INPUTS
 5677 37571 7721  ACSIZE, -INPUTS
 5678 37572 0000  KEYC,   0
 5679             HIPRO,
 5680             IFNZRO CPU-2 < -4 >
 5681 37573 7772  IFZERO CPU-2 < -6 >
 5682 37574 0243  HIPRIA, DTCHK
 5683 37575 0212  ACTBLA, SKPTBL-1
 5684 37576 7753  ACOUT,  OUTREG-SKPTBL-NULINE-2
 5685 37577 0771  L2QBOT, -L2QTB+1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 132


 5686             
 5687       7600  *7600
 5688             /SYSTEM DISK HANDLERS FOR TSS/8
 5689             /       SWPIO - HANDLES ALL SWAPS (ONLY SWAPS)
 5690             /       DSGO0 - HANDLES ALL OTHER TRANSFERS INCLUDING OVERLAYS
 5691             
 5692             IFNZRO RKSYS <
 5693 37600 0000  SWPIR,  0
 5694 37601 7200          CLA
 5695 37602 3114          DCA     RKSWSE          /RESET RK05 SWAP SECTOR COUNT
 5696 37603 3115          DCA     RKADR           /AND ADDRESS
 5697 37604 4206          JMS     SWPIO
 5698 37605 5600          JMP I   SWPIR >
 5699 37606 0000  SWPIO,  0                       /
 5700 37607 7346          CLA CLL CMA RTL         /=3 IN AC
 5701 37610 3364          DCA     DSERRI          /# OF TRIES
 5702 37611 4213          JMS     SWPIT           /START THE SWAP
 5703 37612 5606          JMP I   SWPIO           /RETURN
 5704 37613 0000  SWPIT,  0
 5705 37614 1242          TAD     SWPA            /RETURN ADDRESS FOR INTERRUPT CHAIN
 5706 37615 3516          DCA I   DSWATA          /SAVE IT
 5707             IFZERO RKSYS <
 5708             IFZERO RF08     <
 5709                     TAD     SQREQ           /FIELD TO BE SWAPPED OUT
 5710                     TAD     C0500           /INTERRUPT ON ERROR AND ON COMPLETION
 5711                     DIML    >
 5712                     DCA     DSWC            /WORD COUNT
 5713                     CMA
 5714                     DCA     DSMA            /CORE ADDRESS
 5715                     TAD     FINISH          /IN OR OUT?
 5716                     SMA CLA
 5717                     JMP     SWPIN           /IN
 5718                     TAD     OUTTRC          /GET THE TRACK # TO BE SWAPPED OUT
 5719             IFZERO RF08-40  <
 5720                     TAD     SQREQ           /FIELD TO BE SWAPPED OUT
 5721                     DEAL
 5722                     CLA     >
 5723             IFZERO RF08     <
 5724                     DXAL    >
 5725                     DMAW >
 5726             IFNZRO RKSYS <
 5727 37616 6742          DCLR                    / (DCLS, AC = 0)
 5728 37617 1115          TAD     RKADR
 5729 37620 6744          DLCA                    / SET CORE ADDRESS 
 5730 37621 1054          TAD     FINISH          / IN OR OUT?
 5731 37622 7700          SMA CLA
 5732 37623 5233          JMP     SWPIN           / IN
 5733                     
 5734 37624 1053          TAD     SQREQ           / GET FIELD TO BE SWAPPED OUT
 5735 37625 1362          TAD     C4400           / WRITE SECTOR, INTERRUPT
 5736 37626 6746          DLDC                    / LOAD COMMAND REGISTER:
 5737                                             / FIELD IS IN BITS 6-8; 
 5738                                             / INTERRUPTS ENABLED ON TRANSFER COMPLETE
 5739                                             / OF A 256-WORD WRITE TO DRIVE ZERO.
 5740 37627 1154          TAD     OUTTRC          / GET THE TRACK # TO WRITE TO
 5741 37630 1114          TAD     RKSWSE          / ADD SECTOR
 5742 37631 6743          DLAG                    / LOAD ADDRESS, GO

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 133


 5743                     >       
 5744 37632 5613          JMP I   SWPIT
 5745             IFZERO RKSYS <
 5746             SWPIN,  TAD     INTRC           /GET THE TRACK TO READ IN
 5747             IFZERO RF08-40  <
 5748                     TAD     SQREQ           /FIELD TO BE SWAPPED OUT
 5749                     DEAL
 5750                     CLA     >
 5751             IFZERO RF08     <
 5752                     DXAL    >
 5753                     DMAR
 5754                     JMP I   SWPIT >
 5755             IFNZRO RKSYS <
 5756 37633 1053  SWPIN,  TAD     SQREQ           / GET FIELD TO BE SWAPPED IN
 5757 37634 1156          TAD     C0400           / READ SECTOR, INTERRUPT
 5758 37635 6746          DLDC                    / LOAD COMMAND REGISTER:
 5759                                             / FIELD IS IN BITS 6-8;
 5760                                             / INTERRUPTS ENABLED ON TRANSFER COMPLETE
 5761                                             / OF A 256-WORD READ TO DRIVE ZERO.
 5762 37636 1153          TAD     INTRC           / GET THE TRACK # TO READ FROM
 5763 37637 1114          TAD     RKSWSE          / ADD SECTOR
 5764 37640 6743          DLAG                    / LOAD ADDRESS, GO
 5765 37641 5613          JMP I   SWPIT
 5766                     >
 5767             
 5768             / FOR RK05:
 5769             / ON EACH RETURN HERE, CHECK STATUS REG (ERROR OR COMPLETION)
 5770             / ON COMPLETION, INC. SECTOR COUNT, DO NEXT SECTOR.  ON LAST SECTOR
 5771             / FINISH THE SWAP.
 5772             
 5773 37642 7643  SWPA,   SWPTR                   /RETURN ADDRESS AFTER SWAP
 5774             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 134


 5775             
 5776             IFZERO RKSYS <
 5777             SWPTR,  JMP     SWPERR          /OOPS
 5778                     TAD     FINISH          /DID WE JUST SWAP IN OR OUT?
 5779                     SMA
 5780                     JMP     SWPOK           /IN; SO WE'RE FINISHED
 5781                     CIA
 5782                     DCA     FINISH          /SAVE IT
 5783                     JMS     SWPIO           /START SWAP IN
 5784                     DISMIS                  /GO BACK TO WHAT WE WERE DOING
 5785                     >
 5786             
 5787             IFNZRO RKSYS <
 5788 37643 5266  SWPTR,  JMP     SWPERR          /OOPS
 5789 37644 1115          TAD     RKADR
 5790 37645 1156          TAD     C0400           /NEXT ADDRESS
 5791 37646 3115          DCA     RKADR
 5792 37647 1114          TAD     RKSWSE          /NEXT SECTOR
 5793 37650 7001          IAC
 5794 37651 0361          AND     C0017   
 5795 37652 7450          SNA                     /SECTOR = 16? DONE?
 5796 37653 5257          JMP     SWFIN           /YEP, FINISH THINGS UP.
 5797 37654 3114          DCA     RKSWSE          /NO - DO NEXT SECTOR
 5798 37655 4206          JMS     SWPIO           /START NEXT SECTOR TRANSFER
 5799 37656 5500          DISMIS                  /GO BACK TO WHAT WE WERE DOING
 5800             
 5801 37657 1054  SWFIN,  TAD     FINISH          /DID WE JUST SWAP IN OR OUT?    
 5802 37660 7500          SMA
 5803 37661 5272          JMP     SWPOK           /IN; SO WE'RE FINISHED
 5804 37662 7041          CIA
 5805 37663 3054          DCA     FINISH          /SAVE IT
 5806 37664 4200          JMS     SWPIR           /START SWAP IN
 5807 37665 5500          DISMIS                  /GO BACK TO WHAT WE WERE DOING          
 5808                     >
 5809             
 5810 37666 4277  SWPERR, JMS     DSERR           /GO TO COMMON ERROR ROUTINE
 5811 37667 5275          JMP     SWPBAD          /SORRY - IT'S OFFICIALLY BAD
 5812 37670 4213          JMS     SWPIT           /TRY AGAIN
 5813 37671 5335          JMP     DSERRX          /GO TO COMMON RETRY EXIT
 5814             
 5815 37672 7200  SWPOK,  CLA
 5816 37673 6742          DCLR                    /CLEAR DISK FLAGS
 5817 37674 7001          IAC                     /SWAP OK; SKIP ON RETURN
 5818 37675 1045  SWPBAD, TAD     SWPREA          /DISPATCH TO LEVEL 2 SWAP COMPLETION
 5819 37676 5355          JMP     OK              /AND EXIT
 5820             
 5821 37677 0000  DSERR,  0
 5822             IFZERO RKSYS <
 5823             IFZERO RF08 <
 5824                     STA                     /SET WC TO CAUSE IMMEDIATE OVERFLOW
 5825                     DCA     DSWC            /ONLY SAFE WAY TO STOP THIS DISK
 5826                     DSAC                    /SEE IF THE DISK IS STILL BUSY
 5827                     SKP                     /THINGS ARE QUIET OUT THERE
 5828                     DISMIS                  /WAIT A FEW MICRO-SECONDS
 5829                     DORS                    /GET THE STATUS BITS
 5830                     DCMA                    /CLEAR EVERYTHING
 5831                     DCXA                    /INCLUDING THE TRACK ADDRESS

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 135


 5832                     AND     C0004           /DO WE HAVE DRL?
 5833                     SNA >
 5834             IFZERO RF08-40 <DCMA >          /STOP DF32
 5835                     ISZ     DSERRI          /NO; SO COUNT IT AS AN ERROR
 5836                     ISZ     DSERR           /OK TO RETRY ON RETURN
 5837             IFZERO RF08 <
 5838                     SZA CLA
 5839                     TAD     SLEEPA >                /BETTER KNOCK OFF THE EAE USER
 5840                     DCA     DSGO0           /SAVE ADDRESS; IF ANY
 5841                     JMP I   DSERR           /BACK TO CALLER >
 5842             IFNZRO RKSYS <
 5843 37700 7201          CLA IAC
 5844 37701 6742          DCLR                    / RESET RK8E (AC = 1)
 5845 37702 7001          IAC
 5846 37703 6742          DCLR                    / RECAL (AC = 2) (TOO HARSH?)
 5847 37704 2364          ISZ     DSERRI          / COUNT IT AS AN ERROR
 5848 37705 2277          ISZ     DSERR           / OK TO RETRY ON RETURN
 5849 37706 3310          DCA     DSGO0           / CLEAR ADDRESS
 5850 37707 5677          JMP I   DSERR           / BACK TO CALLER        
 5851                     >

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 136


 5852             
 5853             
 5854             
 5855             /START DISC TRANSFER
 5856             /CALL   TAD ADDRESS OF PARAMETERS
 5857             /       DSGO
 5858             /       RETURN
 5859             IFZERO RKSYS <
 5860             DSGO0,  0
 5861                     DCA     DSPARM
 5862                     CLA CLL CMA RTL
 5863                     DCA     DSERRI          /SET RETRY COUNT
 5864                     JMS     DSTRYA
 5865                     JMP I   DSGO0
 5866             DSTRYA, 0
 5867                     TAD     DSRETA
 5868                     DCA I   DSWATA
 5869                     CLA CMA                 /ADDRESS OF PARA-1 FOR INDEX REGISTER
 5870                     TAD     DSPARM
 5871                     DCA     DSPAR
 5872                     DATFLD                  /CHG TO MONITOR DATA FIELD (1)
 5873                     TAD I   DSPAR           /FUNCTION
 5874                     DCA     DSRORW
 5875                     TAD I   DSPAR           /DISC EXTENSION
 5876             IFZERO RF08-40 <
 5877                     CLL RTL
 5878                     CLL RAL
 5879                     TAD I   DSPAR           /MEMORY EXTENSION
 5880                     CLL RAL
 5881                     DEAL
 5882                     CLA>
 5883             IFZERO RF08 <
 5884                     CLL RTR
 5885                     DXAL
 5886                     TAD I   DSPAR
 5887                     CLL RAL
 5888                     AND     C0070
 5889                     TAD     C0500
 5890                     DIML                    /LOAD INTERRUPT ENNABLE AND MEMORY EXTENSION
 5891             > 
 5892                     TAD I   DSPAR           /WORD COUNT
 5893                     DCA     DSWC
 5894                     TAD I   DSPAR           /MEMORY ADDRESS
 5895                     DCA     DSMA
 5896                     TAD I   DSPAR           /DISK ADDRESS
 5897                     CDF                     /BACK TO DATA FIELD 0
 5898             DSRORW, 0                       /DO THE RF OPERATION
 5899                     JMP I   DSTRYA
 5900             >
 5901             IFNZRO RKSYS <
 5902 37710 0000  DSGO0,  0
 5903 37711 3356          DCA     DSPARM
 5904 37712 7346          CLA CLL CMA RTL
 5905 37713 3364          DCA     DSERRI                  /SET RETRY COUNT
 5906 37714 4316          JMS     DSTRYA
 5907 37715 5710          JMP I   DSGO0
 5908 37716 0000  DSTRYA, 0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 137


 5909 37717 1357          TAD     DSRETA
 5910 37720 3516          DCA I   DSWATA
 5911 37721 7240          CLA     CMA
 5912 37722 1356          TAD     DSPARM
 5913 37723 6213          CDI     10                              /CHANGE TO DF/IF 1
 5914 37724 4777@         JMS     RKGO0           /GO OFF TO FIELD 1 WHERE WE HAVE SPACE, SO MUCH SPACE.  
 5915 37725 5716          JMP I   DSTRYA
 5916             >
 5917             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 138


 5918             
 5919             
 5920 37726 4277  DSERR1, JMS     DSERR           /DO COMMON ERROR ROUTINE
 5921 37727 5353          JMP     DSGBAD                  /GIVE UP
 5922             IFNZRO  RKSYS <
 5923 37730 1357          TAD     DSRETA                  / TRY AGAIN
 5924 37731 3516          DCA I   DSWATA
 5925 37732 6213          CDI 10
 5926 37733 4776@         JMS     RKREDU                  / INVOKE LAST RK8E OPERATION
 5927 37734 7200          CLA
 5928                     >
 5929             IFZERO RKSYS <
 5930                     JMS             DSTRYA >
 5931             
 5932 37735 1310  DSERRX, TAD     DSGO0           /POSSIBLY AN EAE JOB TO GO TO SLEEP
 5933 37736 5500          DISMIS
 5934             
 5935             / RETURN HERE AFTER INTERRUPT SERVICING.
 5936 37737 5326  DSRET,  JMP     DSERR1          /ERROR
 5937             IFNZRO RKSYS <
 5938                     / SUCCESS:
 5939 37740 7346          CLL CLA CMA RTL         / RESET RETRY COUNT FOR NEXT SECTOR
 5940 37741 3364          DCA     DSERRI
 5941                     / JUMP TO ROUTINE IN FIELD 1 TO TRANSFER DATA.
 5942 37742 6213          CDI     10              / CHANGE TO DF/IF 1
 5943 37743 4775@         JMS     RKRET   / RETURNS TO NEXT INSTRUCTION
 5944                                             / WHEN TRANSFER IS COMPLETE,
 5945                                             / INSTRUCTION AFTER IF MORE SECTORS
 5946                                             / ARE PENDING
 5947 37744 5351          JMP     FOK
 5948 37745 7200          CLA
 5949 37746 1357          TAD     DSRETA
 5950 37747 3516          DCA I   DSWATA          / RESTORE INTERRUPT SERVICE ADDRESS
 5951 37750 5355          JMP     OK              / STILL MORE TO DO, DO NOT
 5952                                             / WRITE DSPAR
 5953 37751 7201  FOK,    CLA IAC
 5954 37752 5353          JMP DSGBAD              / FINISH THINGS UP.
 5955                     >
 5956             IFZERO RKSYS <
 5957                     IAC
 5958                     >       
 5959 37753 6211  DSGBAD, DATFLD
 5960 37754 1412          TAD I   DSPAR
 5961             IFZERO RKSYS <
 5962             OK,     DCMA
 5963                     DISMIS                  /BACK TO MONITOR 
 5964                     >
 5965             IFNZRO RKSYS <
 5966                     / JUST DISMISS HERE, RK8E IS CLEARED EARLIER               
 5967             OK,             
 5968 37755 5500          DISMIS                  /BACK TO MONITOR
 5969                     >
 5970             
 5971 37756 0000  DSPARM, 0
 5972 37757 7737  DSRETA, DSRET
 5973 37760 0500  C0500,  500
 5974 37761 0017  C0017,  17                      /MASK FOR SECTOR BITS

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 139


 5975 37762 4400  C4400,  4400
 5976             
 5977             IFZERO RKSYS <
 5978                     *7750
 5979             DSWC,   DSMA                    /FOR LOADING INTO FIELD 0 ON INITIALIZATION
 5980             DSMA,   DSMA                    /(SINCE THE 4K TRANSFER OVERWRITES THE DATA BREAK LOCATIONS)
 5981                     >
 5982 37763 5151  SLEEPA, SLEEP
 5983 37764 0000  DSERRI, 0
 5984 37765 0000          0                       /FOR DECTAPE SERVICE
 5985 37766 0000          0                       /FOR DECTAPE SERVICE
      37775 2622
      37776 2612
      37777 2400
 5986             FIELD 4                         /FORCE TS8II INTO TRACK 4 AT BUILD TIME

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 140


 5987             
 5988             /TS8II VERSION 8.24 (01-JANUARY-75)
 5989             /
 5990             /
 5991             /
 5992             /
 5993             /COPYRIGHT (C) 1975
 5994             /DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
 5995             /
 5996             /
 5997             /THIS SOFTWARE IS FURNISHED UNDER A LICENSE FOR USE ONLY
 5998             /ON A SINGLE COMPUTER SYSTEM AND MAY BE COPIED ONLY WITH
 5999             /THE  INCLUSION  OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS
 6000             /SOFTWARE, OR ANY OTHER COPIES THEREOF,  MAY NOT BE PRO-
 6001             /VIDED OR OTHERWISE  MADE AVAILABLE TO ANY  OTHER PERSON
 6002             /EXCEPT FOR USE ON SUCH SYSTEM  AND TO ONE WHO AGREES TO
 6003             /THESE  LICENSE  TERMS.  TITLE TO AND  OWNERSHIP  OF THE
 6004             /SOFTWARE SHALL REMAIN IN DEC.
 6005             /
 6006             /THE  INFORMATION IN THIS  DOCUMENT IS SUBJECT TO CHANGE
 6007             /WITHOUT NOTICE AND SHOULD  NOT BE  CONSTRUED  AS A COM-
 6008             /MITMENT BY DIGITAL EQUIPMENT CORPORATION.
 6009             /
 6010             /DEC   ASSUMES   NO   RESPONSIBILITY   FOR  THE  USE  OR
 6011             /RELIABILITY  OF  ITS SOFTWARE ON EQUIPMENT WHICH IS NOT
 6012             /SUPPLIED BY DEC.

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 141


 6013             
 6014       0000  *0
 6015 40000 0000  ZBLOCK 10                       /IF ANY OF THESE BECOMES NON-ZERO, FIND OUT WHY!
      40001 0000
      40002 0000
      40003 0000
      40004 0000
      40005 0000
      40006 0000
      40007 0000
 6016             
 6017       0010  *10
 6018 40010 0030  K0030,  30
 6019 40011 0614  K0614,  614
 6020 40012 0500  K0500,  500
 6021 40013 0000  IX3,    0
 6022             
 6023 40014 3064  IX4,    JOBTBL                  /WAIT 2  UNQUEUER POINTER
 6024 40015 0000  A15,    0                       /DECTAPE - FOR EXTRACTING USER INFO. FROM DDB
 6025 40016 0000  A16,    0                       /BLTF1 - USER FIELD POINTER
 6026 40017 0000  A17,    0                       /BLTF1 - DATFLD POINTER
 6027             
 6028 40020 0000  DTJOB,  0
 6029 40021 0000  DTBUF,  0
 6030 40022 0000  DTST,   0
 6031 40023 0000  DTBLKP, 0
 6032 40024 0000  DTBLK,  0
 6033 40025 0000  DTCOM,  0
 6034 40026 0000  DTUCA,  0
 6035 40027 0000  DTTIME, 0
 6036 40030 0000  DTREMB, 0
 6037 40031 1206  DTGOA,  DTGO
 6038 40032 1021  DTERRA, DTERR
 6039 40033 0377  DTBUFA, ENDBUF-1
 6040 40034 7755  DTCAP,  7755
 6041 40035 5076  M2702,  -2702
 6042 40036 7577  M201,   -201
 6043 40037 0214  K0214,  214
 6044 40040 0070  K0070,  70
 6045 40041 0400  K0400,  400
 6046 40042 7400  K7400,  7400
 6047 40043 0002  K0002,  2
 6048 40044 0037  K0037,  37
 6049 40045 0005  K0005,  5
 6050 40046 0020  K0020,  20
 6051 40047 7770  K7770,  7770
 6052 40050 0377  K0377,  377
 6053 40051 0006  K0006,  6
 6054 40052 1000  K1000,  1000
 6055 40053 0600  K0600,  600
 6056 40054 0000  RKJOB,  0
 6057 40055 0000  RKCORE, 0
 6058 40056 0000  RKCOM,  0
 6059 40057 0000  RKSECT, 0
 6060 40060 0000  RKCNT,  0
 6061 40061 0000  RKBLKS, 0
 6062 40062 0000  RKTIME, 0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 142


 6063 40063 5151  SLEEPB, SLEEP
 6064 40064 1640  RKERRA, RKERR
 6065 40065 7353  DTRKHA, DTRKHG
 6066 40066 1652  WAIT2,  WAITS2
 6067 40067 1552  AWAKEN, WAKEUP
 6068 40070 2125  DTCHKA, DEVCHK

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 143


 6069             
 6070 40071 2354  QUEUE1, QUEUE0
 6071 40072 1532  BLTF1A, BLTF1
 6072 40073 3064  JOBTAB, JOBTBL
 6073             
 6074 40074 0000  INTS1,  0                       /INTERRUPT TEMPORARY STORAGE
 6075 40075 0000  INTS2,  0
 6076 40076 0000  TEMP0,  0                       /WORKING STORAGE
 6077 40077 0000  TEMP1,  0
 6078 40100 0000  TEMP2,  0
 6079 40101 0000  TEMP3,  0
 6080 40102 0000  TEMP4,  0
 6081 40103 0007  K0007,  7
 6082 40104 0010  K0010,  10
 6083 40105 0200  K0200,  200
 6084 40106 0204  K0204,  204
 6085 40107 0040  K0040,  40
 6086 40110 0004  K0004,  4
 6087 40111 6201  K6201,  6201
 6088 40112 7000  K7000,  7000
 6089 40113 7700  K7700,  7700
 6090 40114 7774  K7774,  7774
 6091 40115 0003  K0003,  3
 6092 40116 0106  L2SAP,  L2SV0+2                 /POINTS TO L2SA IN FIELD 0
 6093 40117 0000  UDF1,   0                       /SELECT USER FIELD
 6094 40120 0000          0
 6095 40121 5517          JMP I   .-2
 6096             
 6097 40122 7754  JOBCNT, -JOBMAX
 6098 40123 0151  UDFP,   UUDF
 6099 40124 1475  DTRKJA, DTRKJB
 6100             
 6101 40125 0000  F1SCH,  0
 6102       5126  EXITF1= JMP .
 6103 40126 6203  K6203,  CIF CDF
 6104 40127 1125          TAD     F1SCH
 6105 40130 7650          SNA CLA                 /ANYTHING JUST OUT OF WAIT?
 6106 40131 5535          JMP I   .+4             /NO - NORMAL LEVEL 2 EXIT
 6107 40132 3125          DCA     F1SCH           /YES - CLEAR FLAG
 6108 40133 5534          JMP I   .+1             /IF NULL JOB IS RUNNING RE-SCHEDULE
 6109 40134 2437          SCHED0
 6110 40135 1513          L2EXIT
 6111             
 6112       5136  INTRTN= JMP .
 6113 40136 6203          CIF CDF
 6114 40137 5540          JMP I   .+1
 6115 40140 0271          F1RTN                   /DISMISS INTERRUPT FROM HI-PRIORITY DEVICE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 144


 6116             
 6117             /JOB TABLE ADDRESS TO TEMP0
 6118             /CALL   TAD JOB #
 6119             /       JMS GETTBA
 6120             /       TABLE ENTRY
 6121             /       RETURN WITH ADDRESS IN TEMP0
 6122             
 6123 40141 0000  GETTBA, 0
 6124 40142 6211          DATFLD
 6125 40143 3076          DCA     TEMP0           /SAVE JOB #
 6126 40144 1541          TAD I   GETTBA          /PICK UP ARGUMENT
 6127 40145 3152          DCA     .+5
 6128 40146 1076          TAD     TEMP0           /JOB #
 6129 40147 1073          TAD     JOBTAB          /START OF JOBTBL
 6130 40150 6202          CIF
 6131 40151 4556          JMS I   GETTB1          /GETJTA
 6132 40152 0000          0
 6133 40153 3076          DCA     TEMP0           /ADDRESS TO TEMP0
 6134 40154 2141          ISZ     GETTBA
 6135 40155 5541          JMP I   GETTBA
 6136 40156 0401  GETTB1, GETJTB
 6137             
 6138             
 6139       0160          *160
 6140 40160 0160  JOB,    .                       /POINTER TO CURRENT JOB NUMBER
 6141 40161 0000  CJOBDA, 0                       /POINTER TO JOB STATUS BLOCK, CURRENT JOB
 6142 40162 7000  CORTBA, CORTBL-1
 6143 40163 3020  DEVTBA, DEVTBL
 6144 40164 0000  F1OFFJ, 0                       /MASK FOR LOGIN; MODIFIED BY THE "ON & OFF" COMMANDS (ON=0; OFF=7774)
 6145       5165  WAITF1= JMP .
 6146 40165 6203          CIF CDF
 6147 40166 5567          JMP I   WAIT1
 6148 40167 2573  WAIT1,  WSCHED
 6149             
 6150       0170          *170
 6151 40170 0010          NULINE                  /SYSTEM PARAMETERS CONVENIENT FOR SYSTAT
 6152 40171 0024          JOBMAX
 6153 40172 3020          DEVTBL
 6154 40173 0000  UPTIM2, 0                       /HIGH ORDER UPTIME IN SECONDS
 6155 40174 0000  UPTIM1, 0                       /LOW ORDER UPTIME IN SECONDS
 6156             
 6157             /DDB POINTERS FOR USE BY SI
 6158 40175 0000  F1TCNT, 0                       /DDB CHARACTER COUNT
 6159 40176 0000  F1ECNT, 0                       /DDB EMPTY COUNT
 6160 40177 0000  F1BUF,  0                       /DDB EMPTY BLOCK

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 145


 6161             
 6162       0200  *OUTREG
 6163 40200 0000          ZBLOCK SKPTBL-OUTREG
      40201 0000
      40202 0000
      40203 0000
      40204 0000
      40205 0000
      40206 0000
      40207 0000
      40210 0000
      40211 0000
      40212 0000
 6164             
 6165       6001  KSKIP=  KSF-30
 6166       6001  TSKIP=  TSF-40
 6167       0213  *SKPTBL
 6168             
 6169 40213 6031          KSF                     /K00    /SKIP IOT FOR CONSOLE KEYBOARD
 6170             IFZERO DC08A <
 6171 40214 6401          KSKIP+400               /K01    /KEYBOARD SKIP IOTS FOR PT08 AND KL8E
 6172 40215 6421          KSKIP+420               /K02
 6173 40216 6441          KSKIP+440               /K03
 6174 40217 6461          KSKIP+460       >       /K04
 6175 40220 6341          KSKIP+340               /K05; K01 IF DC08A WITH PT08'S
 6176 40221 6111          KSKIP+110               /K06; K02 IF DC08A WITH PT08'S
 6177             IFNZRO CPU-1 <
 6178 40222 6301          KSKIP+300       >       /K07; K03 IF DC08A WITH PT08'S
 6179 40223 6321          KSKIP+320               /K10; K04 IF DC08A WITH PT08'S
 6180 40224 6501          KSKIP+500               /K11; K05 IF DC08A WITH PT08'S
 6181 40225 6521          KSKIP+520               /K12; K06 IF DC08A WITH PT08'S
 6182 40226 6541          KSKIP+540               /K13; K07 IF DC08A WITH PT08'S
 6183 40227 6561          KSKIP+560               /K14; K10 IF DC08A WITH PT08'S
 6184 40230 6701          KSKIP+700               /K15
 6185 40231 6361          KSKIP+360               /K16
 6186 40232 6721          KSKIP+720               /K17
 6187 40233 6061          KSKIP+060               /K20
 6188 40234 6141          KSKIP+140               /K21
 6189 40235 6161          KSKIP+160               /K22
 6190 40236 6051          KSKIP+050               /K23
 6191             
 6192             
 6193             IFNZRO DC08A <
 6194             *SKPTBL+PT08+KL8+1
 6195                     DC8REG
 6196                     ZBLOCK DC08A    >       /DC08A ACTIVE OUTPUT REGISTERS
 6197             
 6198             
 6199       0224  IFZERO DC08A <*SKPTBL+NULINE+1
 6200 40224 2340          OUTIOT  >               /SWITCH TO OUTPUT SIDE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 146


 6201             
 6202 40225 6041          TSF                     /K00    /SKIP IOT FOR CONSOLE TELEPRINTER
 6203             IFZERO DC08A <
 6204 40226 6411          TSKIP+410               /K01    /TELEPRINTER SKIP IOTS FOR PT08 AND KL8E
 6205 40227 6431          TSKIP+430               /K02
 6206 40230 6451          TSKIP+450               /K03
 6207 40231 6471          TSKIP+470       >       /K04
 6208 40232 6351          TSKIP+350               /K05; K01 IF DC08A WITH PT08'S
 6209 40233 6121          TSKIP+120               /K06; K02 IF DC08A WITH PT08'S
 6210             IFNZRO CPU-1 <
 6211 40234 6311          TSKIP+310       >       /K07; K03 IF DC08A WITH PT08'S
 6212 40235 6331          TSKIP+330               /K10; K04 IF DC08A WITH PT08'S
 6213 40236 6511          TSKIP+510               /K11; K05 IF DC08A WITH PT08'S
 6214 40237 6531          TSKIP+530               /K12; K06 IF DC08A WITH PT08'S
 6215 40240 6551          TSKIP+550               /K13; K07 IF DC08A WITH PT08'S
 6216 40241 6571          TSKIP+570               /K14; K10 IF DC08A WITH PT08'S
 6217 40242 6711          TSKIP+710               /K15
 6218 40243 6371          TSKIP+370               /K16
 6219 40244 6731          TSKIP+730               /K17
 6220 40245 6071          TSKIP+070               /K20
 6221 40246 6151          TSKIP+150               /K21
 6222 40247 6171          TSKIP+170               /K22
 6223 40250 6651          TSKIP+650               /K23
 6224             IFNZRO DC08A <
 6225             *SKPTBL+NULINE+PT08+KL8+3
 6226                     JMPDC8                  /DC08A OUTPUT VECTOR
 6227                     JMPDC8                  /DC08A OUTPUT VECTOR
 6228                     JMPDC8                  /DC08A OUTPUT VECTOR
 6229                     JMPDC8                  /DC08A OUTPUT VECTOR
 6230                     JMPDC8                  /DC08A OUTPUT VECTOR
 6231                     JMPDC8                  /DC08A OUTPUT VECTOR
 6232                     JMPDC8                  /DC08A OUTPUT VECTOR
 6233                     JMPDC8                  /DC08A OUTPUT VECTOR
 6234                     JMPDC8                  /DC08A OUTPUT VECTOR
 6235                     JMPDC8                  /DC08A OUTPUT VECTOR
 6236                     JMPDC8                  /DC08A OUTPUT VECTOR
 6237                     JMPDC8                  /DC08A OUTPUT VECTOR
 6238                     JMPDC8                  /DC08A OUTPUT VECTOR
 6239                     JMPDC8                  /DC08A OUTPUT VECTOR
 6240                     JMPDC8                  /DC08A OUTPUT VECTOR
 6241                     JMPDC8                  /DC08A OUTPUT VECTOR
 6242                     JMPDC8                  /DC08A OUTPUT VECTOR
 6243                     JMPDC8                  /DC08A OUTPUT VECTOR
 6244                     JMPDC8                  /DC08A OUTPUT VECTOR
 6245                     JMPDC8  >               /DC08A OUTPUT VECTOR
 6246       0236  *SKPTP
 6247 40236 6021  IFNZRO PUNCH <PSF>              /PUNCH
 6248             IFZERO PUNCH <NOP>
 6249             IFNZRO LPT <LSF>                /LINE PRINTER
 6250 40237 7000  IFZERO LPT <NOP>
 6251 40240 5333          ENDIOT                  /TERMINATES LIST

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 147


 6252             
 6253       0241  *RINGIN
 6254             /ADDITIONAL FREE CORE GENERATION TABLE
 6255             /REFERENCED BY INIT AT START TIME
 6256             /       THE FOLLOWING AREAS WILL BECOME PART OF FREE CORE:
 6257             
 6258             IFZERO TC01+RK05+CDR+RKSYS <
 6259                     ENDBUF;FCE4     >
 6260             
 6261             IFNZRO TC01+RK05+CDR+RKSYS <
 6262             IFZERO TC01 <
 6263                     ENDBUF;FCE1     >
 6264             IFZERO RK05 <
 6265 40241 1600          FCB2;FCE2
      40242 1650
 6266 40243 2000          FCB4;FCE4       >
      40244 2200
 6267             IFZERO RKSYS <
 6268                     FCB6;FCE6       >
 6269             IFZERO CDR <
 6270 40245 1710          FCB3;FCE3       > >
      40246 2000
 6271             IFNZRO DC08A <
 6272             IFNZRO D689 <
 6273                     FCB5;FCE5       >
 6274             IFZERO D689 <
 6275                     FCB5;DATA1      > >
 6276 40247 0000          0                       /TO TERMINATE THE LIST
 6277             NOPUNCH
 6278 40250 0000          ZBLOCK 40000+ENDBUF-.   /KEYBOARD INPUT RING BUFFER
      40251 0000
      40252 0000
      40253 0000
      40254 0000
      40255 0000
      40256 0000
      40257 0000
      40260 0000
      40261 0000
      40262 0000
      40263 0000
      40264 0000
      40265 0000
      40266 0000
      40267 0000
      40270 0000
      40271 0000
      40272 0000
      40273 0000
      40274 0000
      40275 0000
      40276 0000
      40277 0000
      40300 0000
      40301 0000
      40302 0000
      40303 0000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 148


      40304 0000
      40305 0000
      40306 0000
      40307 0000
      40310 0000
      40311 0000
      40312 0000
      40313 0000
      40314 0000
      40315 0000
      40316 0000
      40317 0000
      40320 0000
      40321 0000
      40322 0000
      40323 0000
      40324 0000
      40325 0000
      40326 0000
      40327 0000
      40330 0000
      40331 0000
      40332 0000
      40333 0000
      40334 0000
      40335 0000
      40336 0000
      40337 0000
      40340 0000
      40341 0000
      40342 0000
      40343 0000
      40344 0000
      40345 0000
      40346 0000
      40347 0000
      40350 0000
      40351 0000
      40352 0000
      40353 0000
      40354 0000
      40355 0000
      40356 0000
      40357 0000
      40360 0000
      40361 0000
      40362 0000
      40363 0000
      40364 0000
      40365 0000
      40366 0000
      40367 0000
      40370 0000
      40371 0000
      40372 0000
      40373 0000
      40374 0000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 149


      40375 0000
      40376 0000
      40377 0000
 6279             //      ZBLOCK ENDBUF-.         /KEYBOARD INPUT RING BUFFER
 6280             ENPUNCH
 6281       0400  *ENDBUF
 6282             NOPUNCH
 6283 40400 0000          ZBLOCK 201              /DECTAPE BUFFER
      40401 0000
      40402 0000
      40403 0000
      40404 0000
      40405 0000
      40406 0000
      40407 0000
      40410 0000
      40411 0000
      40412 0000
      40413 0000
      40414 0000
      40415 0000
      40416 0000
      40417 0000
      40420 0000
      40421 0000
      40422 0000
      40423 0000
      40424 0000
      40425 0000
      40426 0000
      40427 0000
      40430 0000
      40431 0000
      40432 0000
      40433 0000
      40434 0000
      40435 0000
      40436 0000
      40437 0000
      40440 0000
      40441 0000
      40442 0000
      40443 0000
      40444 0000
      40445 0000
      40446 0000
      40447 0000
      40450 0000
      40451 0000
      40452 0000
      40453 0000
      40454 0000
      40455 0000
      40456 0000
      40457 0000
      40460 0000
      40461 0000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 150


      40462 0000
      40463 0000
      40464 0000
      40465 0000
      40466 0000
      40467 0000
      40470 0000
      40471 0000
      40472 0000
      40473 0000
      40474 0000
      40475 0000
      40476 0000
      40477 0000
      40500 0000
      40501 0000
      40502 0000
      40503 0000
      40504 0000
      40505 0000
      40506 0000
      40507 0000
      40510 0000
      40511 0000
      40512 0000
      40513 0000
      40514 0000
      40515 0000
      40516 0000
      40517 0000
      40520 0000
      40521 0000
      40522 0000
      40523 0000
      40524 0000
      40525 0000
      40526 0000
      40527 0000
      40530 0000
      40531 0000
      40532 0000
      40533 0000
      40534 0000
      40535 0000
      40536 0000
      40537 0000
      40540 0000
      40541 0000
      40542 0000
      40543 0000
      40544 0000
      40545 0000
      40546 0000
      40547 0000
      40550 0000
      40551 0000
      40552 0000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 151


      40553 0000
      40554 0000
      40555 0000
      40556 0000
      40557 0000
      40560 0000
      40561 0000
      40562 0000
      40563 0000
      40564 0000
      40565 0000
      40566 0000
      40567 0000
      40570 0000
      40571 0000
      40572 0000
      40573 0000
      40574 0000
      40575 0000
      40576 0000
      40577 0000
      40600 0000
 6284             ENPUNCH
 6285       0601  *.
 6286             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 152


 6287             
 6288             /DECTAPE LEVEL 1 ENTRY
 6289             
 6290 40601 1030  DTL11,  TAD     DTREMB          /PREVIOUS ERRORS FROM THIS TRANSFER
 6291 40602 6772          DTRB                    /"OR'ED" WITH ANY NEW ERRORS
 6292 40603 3030          DCA     DTREMB
 6293 40604 6772          DTRB                    /WERE THERE ANY ERRORS?
 6294 40605 7500          SMA
 6295 40606 5770          JMP I   DTXOR           /A-OK!
 6296 40607 0012          AND     K0500           /WHAT WAS IT?
 6297 40610 7450          SNA                     /SELECT ERROR OR TIMING ERROR
 6298 40611 5220          JMP     DTSR0           /NO - MUST BE MARK, END, OR PARITY
 6299 40612 0041          AND     K0400
 6300 40613 7640          SZA CLA                 /TIMING ERROR?
 6301 40614 5222          JMP     DTSR1           /NO - SELECT ERROR - DON'T RETRY
 6302 40615 7144          CLL CMA RAL             /AC=-2
 6303 40616 1432          TAD I   DTERRA          /TIMING ERROR WAS OUR FAULT - INTERRUPT OFF TOO LONG
 6304 40617 3432          DCA I   DTERRA          /DON'T CHARGE HIM/HER FOR THE TURN-AROUNDS
 6305 40620 2432  DTSR0,  ISZ I   DTERRA          /COUNT A TURN-AROUND
 6306 40621 5226          JMP     DTSR2           /OK - CONTINUE SEARCHING
 6307 40622 1030  DTSR1,  TAD     DTREMB          /ACCUMULATED ERROR STATUS
 6308 40623 7004          RAL
 6309 40624 7130          STL RAR                 /MAKE SURE THE ERROR BIT IS SET
 6310 40625 5323          JMP     DTSTOP          /SHUT HIM/HER DOWN
 6311 40626 6201  DTSR2,  CDF
 6312 40627 1023          TAD     DTBLKP
 6313 40630 3434          DCA I   DTCAP           /RESTORE CA TO POINT INTO WORD 2 OF HIS/HER DDB
 6314 40631 6761          DTRA                    /CURRENT STATUS
 6315 40632 0050          AND     K0377
 6316 40633 6764          DTXA                    /CLEAR GO, FUNCTION, AND INTERRUPT ENABLE
 6317 40634 1011          TAD     K0614           /SWITCH DIRECTIONS, GO, SEARCH AND ENABLE
 6318 40635 4370  DTSRCH, JMS     DTXOR           /CONTINUE SEARCHING
 6319 40636 1025  DTSR3,  TAD     DTCOM
 6320 40637 7006          RTL
 6321 40640 7006          RTL
 6322 40641 7264          STA CML RAL             /AC=-1 IF FORWARDS R/W; AC=-2 IF REVERSE R/W
 6323 40642 3370          DCA     DTDIR
 6324 40643 1423          TAD I   DTBLKP
 6325 40644 1035          TAD     M2702
 6326 40645 7620          SNL CLA                 /ARE WE AT A REASONABLE BLOCK NUMBER?
 6327 40646 5220          JMP     DTSR0           /NO -- TURN AROUND
 6328 40647 1024          TAD     DTBLK
 6329 40650 1035          TAD     M2702
 6330 40651 7620          SNL CLA                 /DOES HE WANT A REASONABLE BLOCK?
 6331 40652 5222          JMP     DTSR1           /NO -- QUIT LOOKING FOR IT
 6332 40653 6761          DTRA                    /WHICH WAY ARE WE GOING?
 6333 40654 7006          RTL
 6334 40655 7006          RTL
 6335 40656 7200          CLA                     /PRESENT DIRECTION IS IN THE LINK
 6336 40657 1024          TAD     DTBLK           /BLOCK WANTED
 6337 40660 7041          CIA
 6338 40661 1423          TAD I   DTBLKP          /BLOCK FOUND
 6339 40662 7450          SNA                     /ARE WE THERE?
 6340 40663 5304          JMP     DTSR5           /YES - SEE IF WE ARE GOING IN THE RIGHT DIRECTION
 6341 40664 2370          ISZ     DTDIR           /NO
 6342 40665 7041          CIA                     /REVERSE R/W - NEGATE AC
 6343 40666 7500          SMA

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 153


 6344 40667 5276          JMP     DTSR4           /SKIP SOME CODE - WE'RE ON THE WRONG SIDE OF THE BLOCK
 6345 40670 7430          SZL                     /L=1 MEANS WE'RE GOING THE WRONG WAY
 6346 40671 1115          TAD     K0003                   /MAKE ROOM FOR TURN-AROUND
 6347 40672 7040          CMA
 6348 40673 0047          AND     K7770
 6349 40674 7450          SNA                     /ARE WE CLOSE?
 6350 40675 4361          JMS     DTSR7           /YES - GO CHECK BUFFER STATUS
 6351 40676 0113  DTSR4,  AND     K7700           /ARE WE TOO FAR AWAY?
 6352 40677 7560          SZA SNL SMA
 6353 40700 5343          JMP     DTSR6           /PUT HIM/HER ON THE TIMER
 6354 40701 7620          SNL CLA                 /ARE WE GOING IN THE RIGHT DIRECTION?
 6355 40702 5235          JMP     DTSRCH          /CONTINUE IN THE SAME DIRECTION
 6356 40703 5220          JMP     DTSR0           /GO TURN AROUND
 6357             
 6358 40704 4361  DTSR5,  JMS     DTSR7           /CHECK ON BUFFER STATUS
 6359 40705 2370          ISZ     DTDIR
 6360 40706 7020          CML                     /CORRECT LINK FOR REVERSE R/W
 6361 40707 7420          SNL                     /ARE WE GOING IN THE RIGHT DIRECTION?
 6362 40710 5235          JMP     DTSRCH          /NO - CAUSE OVER-SHOOT FOR TURN-AROUND
 6363 40711 1036          TAD     M201
 6364 40712 6201          CDF
 6365 40713 3740          DCA I   DTWCP           /SET UP DECTAPE WORD COUNT
 6366 40714 1033          TAD     DTBUFA
 6367 40715 3434          DCA I   DTCAP           /SET UP DECTAPE CURRENT ADDRESS
 6368 40716 1025          TAD     DTCOM
 6369 40717 0107          AND     K0040           /READ OR WRITE?
 6370 40720 7110          CLL RAR
 6371 40721 1010          TAD     K0030
 6372 40722 4370          JMS     DTXOR           /CHANGE FROM SEARCH TO READ OR WRITE
 6373 40723 2021  DTSTOP, ISZ     DTBUF           /ASSIGN THE BUFFER - IF HE DOESN'T ALREADY HAVE IT
 6374 40724 0341          AND     K7701
 6375 40725 3432          DCA I   DTERRA          /SAVE STATUS B FOR HIM/HER
 6376 40726 6761          DTRA
 6377 40727 0041          AND     K0400
 6378 40730 7640          SZA CLA                 /WHICH WAY ARE WE GOING?
 6379 40731 1114          TAD     K7774
 6380 40732 1043          TAD     K0002
 6381 40733 1423          TAD I   DTBLKP          /REMEMBER WHERE WE WILL FINALLY STOP
 6382 40734 3423          DCA I   DTBLKP
 6383 40735 6761          DTRA
 6384 40736 0106          AND     K0204           /CLEAR GO & INTERRUPT ENABLE
 6385 40737 5235          JMP     DTSRCH          /TO STOP THE TAPE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 154


 6386             
 6387 40740 7754  DTWCP,  7754
 6388 40741 7701  K7701,  7701
 6389 40742 0014  K0014,  14
 6390             
 6391 40743 7012  DTSR6,  RTR                     /DIVIDE BY 100
 6392 40744 7012          RTR
 6393 40745 7012          RTR
 6394 40746 7041          CIA
 6395 40747 3021          DCA     DTBUF           /-SECONDS TO WIND ON TIMER
 6396 40750 1115          TAD     K0003
 6397 40751 1422          TAD I   DTST
 6398 40752 3370          DCA     DTDIR           /POINTS TO USER WORD 1
 6399 40753 6761          DTRA
 6400 40754 0041          AND     K0400
 6401 40755 7640          SZA CLA                 /WHICH WAY SHOULD WE SET THE BRAKES LATER?
 6402 40756 2770          ISZ I   DTDIR           /SET BIT 11 TO SHOW REVERSE
 6403 40757 1342          TAD     K0014
 6404 40760 5235          JMP     DTSRCH          /KEEP HIM/HER MOVING WITH INT. DISABLED
 6405             
 6406 40761 0000  DTSR7,  0
 6407 40762 1025          TAD     DTCOM
 6408 40763 0046          AND     K0020           /IS THIS A READ?
 6409 40764 1021          TAD     DTBUF           /OR - IS THE BUFFER LOADED FOR A WRITE?
 6410 40765 7640          SZA CLA
 6411 40766 5761          JMP I   DTSR7           /PROCEED
 6412 40767 5325          JMP     DTSTOP+2        /STOP AND WAIT FOR THE BUFFER TO BE LOADED
 6413             
 6414             DTDIR,
 6415 40770 0723  DTXOR,  DTSTOP                  /WHERE TO RETURN ON SUCCESSFUL INTERRUPT
 6416 40771 6764          DTXA                    /ZAP IN THE NEW FUNCTION
 6417 40772 6761          DTRA
 6418 40773 7012          RTR
 6419 40774 7010          RAR
 6420 40775 7630          SZL CLA                 /DID WE STOP?
 6421 40776 7066          CML CMA RTL
 6422 40777 3027          DCA     DTTIME          /LOAD THE CONTROLLER TIMER
 6423 41000 7420          SNL
 6424 41001 1203          TAD     DTL2            /WE'RE DONE - SCHEDULE LEVEL 2
 6425 41002 5136          INTRTN
 6426 41003 5743  DTL2,   DTL20

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 155


 6427             
 6428             /DECTAPE LEVEL 2 COMPLETION
 6429 41004 1021  DTL21,  TAD     DTBUF           /WHAT KIND OF COMPLETION?
 6430 41005 7450          SNA
 6431 41006 5222          JMP     DTEND4          /END OF A SEARCH - TAPE NOW IN POSITION FOR THE WRITE
 6432 41007 7710          SPA CLA
 6433 41010 5225          JMP     DTEND6          /THIS DRIVE HAS BEEN PUT ON TIMER
 6434 41011 1025          TAD     DTCOM
 6435 41012 0046          AND     K0020
 6436 41013 7450          SNA                     /WAS IT A READ OR WRITE?
 6437 41014 5217          JMP     DTEND3          /WRITE - HE'S ALL DONE
 6438 41015 4231          JMS     DTDATA          /READ - TRANSFER HIS/HER DATA BACK TO HIM/HER
 6439 41016 5126          EXITF1                  /WAIT FOR DISK TO FINISH
 6440 41017 1020  DTEND3, TAD     DTJOB
 6441 41020 4467          JMS I   AWAKEN          /TAKE HIM/HER OUT OF WAIT STATUS
 6442 41021 0000  DTERR,  0
 6443 41022 3020  DTEND4, DCA     DTJOB           /CONTROLLER IS FREE
 6444 41023 4431  DTEND5, JMS I   DTGOA           /TRY TO START A DECTAPE TRANSFER
 6445 41024 5126          EXITF1
 6446             
 6447 41025 1021  DTEND6, TAD     DTBUF
 6448 41026 3415          DCA I   A15             /SAVE -SECONDS TO WIND TAPE
 6449 41027 2422          ISZ I   DTST            /CHANGE TO DECTAPE TIMER WAIT
 6450 41030 5222          JMP     DTEND4          /FIND SOMETHING ELSE TO DO
 6451             
 6452             /MOVE 201 WORDS TO/FROM USER, FROM/TO DATFLD
 6453             /USER MAY BE IN CORE OR ON HIS/HER SWAP TRACK
 6454 41031 0000  DTDATA, 0
 6455 41032 3077          DCA     TEMP1           /SAVE READ/WRITE INDICATOR: 0=WRITE, 20=READ
 6456 41033 6202          CIF
 6457 41034 1020          TAD     DTJOB
 6458 41035 4715          JMS I   COREA           /NOW FIND OUT WHERE HE IS
 6459 41036 6637          SWAP LOCK FIP SI CJOB
 6460 41037 5256          JMP     DTDA1           /HE'S IN HIS/HER SWAP TRACK
 6461 41040 0040          AND     K0070           /SAVE HIS/HER FIELD
 6462 41041 1111          TAD     K6201
 6463 41042 3120          DCA     UDF1+1          /UDF1 IS FIXED FOR BLTF1
 6464 41043 1033          TAD     DTBUFA
 6465 41044 3017          DCA     A17             /POINTS TO DECTAPE BUFFER IN DATFLD
 6466 41045 1026          TAD     DTUCA
 6467 41046 3016          DCA     A16             /USER BUFFER POINTER
 6468 41047 1077          TAD     TEMP1
 6469 41050 7152          CLL CMA RTR
 6470 41051 7012          RTR
 6471 41052 7010          RAR
 6472 41053 4472          JMS I   BLTF1A          /L=0 FOR READ, L=1 FOR WRITE; AC=-201
 6473 41054 2231          ISZ     DTDATA          /SKIP - DATA HAS ALREADY BEEN MOVED
 6474 41055 5631          JMP I   DTDATA

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 156


 6475             
 6476 41056 7001  DTDA1,  IAC
 6477 41057 1026          TAD     DTUCA
 6478 41060 7101          CLL IAC
 6479 41061 1105          TAD     K0200
 6480 41062 7420          SNL                     /DO WE HAVE A WRAP-AROUNND SITUATION?
 6481 41063 7200          CLA                     /NO - WE CAN DO THE WHOLE THING AT ONCE
 6482 41064 1036          TAD     M201
 6483 41065 3310          DCA     DTDWC           /WC FOR DISK TRANSFER
 6484 41066 1033          TAD     DTBUFA
 6485 41067 3311          DCA     DTDCA           /CA FOR DISK TRANSFER
 6486 41070 1020          TAD     DTJOB
 6487 41071 1110          TAD     K0004
 6488 41072 7106          CLL RTL
 6489 41073 3306          DCA     DTDHI           /TRACK ADDRESS FOR DISK TRANSFER
 6490 41074 1077          TAD     TEMP1
 6491 41075 7640          SZA CLA
 6492 41076 7126          STL RTL
 6493 41077 1316          TAD     DTDMAR
 6494 41100 3305          DCA     DTDIOT          /DMAR OR DMAW FOR DISK TRANSFER
 6495 41101 7001          IAC
 6496 41102 1026          TAD     DTUCA
 6497 41103 4320          JMS     DTDGO           /START THE DISK
 6498 41104 5631          JMP I   DTDATA          /EXIT - NO SKIP - MUST WAIT FOR DISK
 6499             
 6500             /DISK PARAMETER BLOCK FOR DECTAPE HANDLER
 6501 41105 0000  DTDIOT, 0
 6502 41106 0000  DTDHI,  0
 6503 41107 0007          7
 6504 41110 0000  DTDWC,  0
 6505 41111 0000  DTDCA,  0
 6506 41112 0000  DTDLO,  0
 6507 41113 5751          DTDSK
 6508 41114 1105  DTDPAR, DTDIOT
 6509             
 6510 41115 1317  COREA,  CORSRC
 6511 41116 6603  DTDMAR, DMAR
 6512 41117 5733  DTDISK, DTDSF0
 6513             
 6514 41120 0000  DTDGO,  0
 6515 41121 3312          DCA     DTDLO           /DISK ADDRESS TO START AT
 6516 41122 1314          TAD     DTDPAR
 6517 41123 6202          CIF
 6518 41124 4717          JMS I   DTDISK          /NOW GO TO TS8 TO START OUR REQUEST
 6519 41125 5720          JMP I   DTDGO           /RETURN HERE AFTER STARTING THE DISK
 6520 41126 5335          JMP     DTDCMP          /RETURN HERE AFTER A GOOD DISK TRANSFER
 6521 41127 7410          SKP                     /RETURN HERE AFTER A BAD DISK TRANSFER
 6522 41130 5217          JMP     DTEND3          /RETURN HERE AFTER REPORTING THE DISK ERROR
 6523 41131 1020          TAD     DTJOB           /JOB IN TROUBLE
 6524 41132 6203          CIF CDF
 6525 41133 5734          JMP I   .+1             /GO REPORT THE ERROR - MAKE IT SWPRER
 6526 41134 5745          DTDEF0
 6527             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 157


 6528             
 6529 41135 1310  DTDCMP, TAD     DTDWC
 6530 41136 7041          CIA
 6531 41137 1036          TAD     M201
 6532 41140 7450          SNA                     /DO WE NEED A SECOND PASS?
 6533 41141 5353          JMP     DTDCM0          /NO - IT'S DONE
 6534 41142 3310          DCA     DTDWC
 6535 41143 1312          TAD     DTDLO           /YES - HAVE WE ALREADY DONE IT?
 6536 41144 7450          SNA
 6537 41145 5353          JMP     DTDCM0          /ALL FINISHED!
 6538 41146 7041          CIA
 6539 41147 1311          TAD     DTDCA           /UPDATE THE DISK'S C.A.
 6540 41150 3311          DCA     DTDCA
 6541 41151 4320          JMS     DTDGO           /START THE DISK AGAIN
 6542 41152 5126          EXITF1
 6543             
 6544 41153 1021  DTDCM0, TAD     DTBUF           /WAS IT A READ OR A WRITE?
 6545 41154 7640          SZA CLA
 6546 41155 5217          JMP     DTEND3          /READ - WE'RE FINISHED
 6547 41156 2021          ISZ     DTBUF           /ASSIGN THE BUFFER TO HIM/HER NOW
 6548 41157 1015          TAD     A15             /GO RESTART HIS/HER WRITE
 6549 41160 5223          JMP     DTEND5
 6550             
 6551 41161 0000  DTLOAD, 0
 6552 41162 3320          DCA     DTDGO           /SAVE THE DESIRED STATUS A
 6553 41163 6761          DTRA
 6554 41164 3231          DCA     DTDATA          /AND THE PRESENT STATUS A
 6555 41165 1320          TAD     DTDGO
 6556 41166 0231          AND     DTDATA          /WHERE WILL CARRIES BE GENERATED
 6557 41167 7041          CIA
 6558 41170 7104          CLL RAL                 /WE WANT TO CANCEL THE CARRIES
 6559 41171 1320          TAD     DTDGO           /NOW ADD THEM TOGETHER
 6560 41172 1231          TAD     DTDATA          /NOW WE HAVE THE "XOR" OF THE "PRESENT" AND THE "DESIRED" STATUS A
 6561 41173 6764          DTXA                    /"XOR" IT INTO THE CONTROLLER
 6562 41174 5761          JMP I   DTLOAD          /THE RESULT WILL BE THE DESIRED STATUS A
 6563             
 6564 41175 3014  STSI,   DCA     IX4             /SI - WANTS TO STOP A TAPE ON TIMER
 6565 41176 7144          CLL CMA RAL
 6566 41177 3077          DCA     TEMP1           /ONLY STOP ONE TAPE
 6567 41200 3100          DCA     TEMP2           /PREVENT HIM/HER FROM GOING BACK INTO DECTAPE CONTROLLER WAIT
 6568 41201 7001  K7001,  IAC
 6569 41202 4324          JMS     DTIMER          /STOP HIM/HER
 6570 41203 6222          CIF 20
 6571 41204 5605          JMP I   .+1             /BACK TO SI
 6572 41205 7270          DTSIDT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 158


 6573             
 6574             /START OR RESTART A DECTAPE READ OR WRITE FOR THE USER
 6575             
 6576 41206 0000  DTGO,   0
 6577 41207 7440          SZA                     /ARE WE RESTARTING AFTER A TIMER KILLED US?
 6578 41210 5220          JMP     DTGO1           /YES - SO WE DON'T NEED TO LOOK AT THE QUEUE
 6579 41211 1020          TAD     DTJOB
 6580 41212 7640          SZA CLA                 /IS THE CONTROLLER BUSY?
 6581 41213 5606          JMP I   DTGO            /CONTROLLER IS ALREADY BUSY
 6582 41214 3021          DCA     DTBUF           /BUFFER IS EMPTY
 6583 41215 4524          JMS I   DTRKJA          /FIND SOMEONE WAITING FOR THE CONTROLLER
 6584 41216 7777          -1
 6585 41217 5606          JMP I   DTGO            /NOTHING WAITING
 6586 41220 0047  DTGO1,  AND     K7770
 6587 41221 3015          DCA     A15
 6588 41222 1415          TAD I   A15             /PULL JOB NUMBER FROM DDB
 6589 41223 3020          DCA     DTJOB
 6590 41224 1020          TAD     DTJOB
 6591 41225 4141          JMS     GETTBA          /FIND WAIT 2
 6592 41226 0004          JOBWMK+1
 6593 41227 1076          TAD     TEMP0
 6594 41230 3022          DCA     DTST            /SAVE ITS POINTER FOR LATER
 6595 41231 2015          ISZ     A15
 6596 41232 1015          TAD     A15             /ADDRESS TO DUMP BLOCK NUMBERS INTO
 6597 41233 3023          DCA     DTBLKP
 6598 41234 2015          ISZ     A15
 6599 41235 1415          TAD I   A15             /USER WORD 1 -- UNIT, DIR, FUNC.
 6600 41236 3025          DCA     DTCOM
 6601 41237 1415          TAD I   A15             /USER WORD 2 -- BLOCK NUMBER WANTED
 6602 41240 3024          DCA     DTBLK
 6603 41241 1415          TAD I   A15             /USER WORD 3 -- USER'S C.A.
 6604 41242 3026          DCA     DTUCA
 6605 41243 1025          TAD     DTCOM           /DIRECTION FOR THIS OPERATION
 6606 41244 0041          AND     K0400
 6607 41245 7740  K7740,  SZA SMA CLA
 6608 41246 1317          TAD     DTREV
 6609 41247 1051          TAD     K0006           /AC=-5 FOR REVERSE R/W; AC=+6 FOR FORWARD R/W
 6610 41250 1423          TAD I   DTBLKP          /GET BLOCK FROM LAST TIME
 6611 41251 1046          TAD     K0020           /BIAS BY 20 TO AVOID NEG. NUMBERS AND ZERO
 6612 41252 7161          STL CIA
 6613 41253 1046          TAD     K0020
 6614 41254 1024          TAD     DTBLK           /BLOCK WE WANT
 6615 41255 7430          SZL
 6616 41256 7041          CIA                     /AC=ABSOLUTE VALUE OF DIFFERENCE
 6617 41257 0245          AND     K7740
 6618 41260 3102          DCA     TEMP4           /SAVE THAT RESULT FOR LATER
 6619 41261 1025          TAD     DTCOM
 6620 41262 0112          AND     K7000           /SAVE ONLY THE UNIT
 6621 41263 7430          SZL                     /LINK=INITIAL SEARCH DIRECTION
 6622 41264 1041          TAD     K0400           /SEARCH REVERSE INITIALLY
 6623 41265 4723          JMS I   DTLOAA          /LOAD THE CONTROLLER
 6624 41266 1025          TAD     DTCOM           /LOAD THE DECTAPE BUFFER IF:
 6625 41267 0046          AND     K0020           / ******* HE'S DOING A WRITE
 6626 41270 1102          TAD     TEMP4           / ******* THE DESIRED BLOCK IS FAIRLY CLOSE
 6627 41271 1021          TAD     DTBUF           / ******* THE BUFFER IS EMPTY
 6628 41272 7640          SZA CLA
 6629 41273 5277          JMP     DTGO2           /AT LEAST ONE OF THE ABOVE IS FALSE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 159


 6630 41274 4721          JMS I   DTGETW          /MOVE 201 WORDS FROM USER (CORE OR SWAP TRACK) TO DATFLD
 6631 41275 5315          JMP     DTGO3           /WAIT FOR THE DISK TO FINISH
 6632 41276 2021          ISZ     DTBUF           /ASSIGN THE BUFFER TO HIM/HER
 6633 41277 1320  DTGO2,  TAD     DTSR3A
 6634 41300 3722          DCA I   DTXORA          /SET UP FOR SEARCH MODE
 6635 41301 3030          DCA     DTREMB          /CLEAR ERROR ACCUMULATOR
 6636 41302 6201          CDF
 6637 41303 1023          TAD     DTBLKP
 6638 41304 3434          DCA I   DTCAP           /SET UP CA FOR THE BLOCK NUMBERS
 6639 41305 6213          CIF DATFLD              /INHIBIT INTERRUPTS
 6640 41306 1104          TAD     K0010           /ALL DATA BREAKS ARE TO DATFLD
 6641 41307 6774          DTLB
 6642 41310 1047          TAD     K7770
 6643 41311 3432          DCA I   DTERRA          /ALLOW 10 CHANGES OF DIRECTION
 6644 41312 1037          TAD     K0214
 6645 41313 6764          DTXA                    /GO, SEARCH, INT. ENABLE
 6646 41314 7146          CLL CMA RTL             /SET CONTROLLER TIMER FOR 3 SECONDS
 6647 41315 3027  DTGO3,  DCA     DTTIME
 6648 41316 5606          JMP I   DTGO
 6649             
 6650 41317 7765  DTREV,  -13
 6651 41320 0636  DTSR3A, DTSR3
 6652 41321 1031  DTGETW, DTDATA
 6653 41322 0770  DTXORA, DTXOR
 6654 41323 1161  DTLOAA, DTLOAD

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 160


 6655             
 6656 41324 0000  DTIMER, 0
 6657 41325 4524          JMS I   DTRKJA          /FIND A JOB IN DECTAPE TIMER WAIT
 6658 41326 7776          -2
 6659 41327 5361          JMP     DTIME3          /ALL DONE
 6660 41330 1045          TAD     K0005
 6661 41331 3101          DCA     TEMP3           /POINTER TO TIMER COUNT
 6662 41332 7146  DTIME1, CLL CMA RTL             /AC=-3
 6663 41333 2501          ISZ I   TEMP3           /IS HIS/HER TIMER UP?
 6664 41334 5325          JMP     DTIMER+1
 6665 41335 1101          TAD     TEMP3           /YES - JAM ON THE BRAKES
 6666 41336 3102          DCA     TEMP4           /POINT TO USER WORD 1
 6667 41337 6213          CIF DATFLD              /INHIBIT INTERRUPTS
 6668 41340 6761          DTRA                    /GET STATUS OF CURRENT UNIT
 6669 41341 0110          AND     K0004           /SAVE ENABLE
 6670 41342 7440          SZA                     /IS IT REALLY DOING SOMETHING?
 6671 41343 1105          TAD     K0200           /YES - CLEAR GO AND ENABLE
 6672 41344 6764          DTXA
 6673 41345 1502          TAD I   TEMP4
 6674 41346 0201          AND     K7001           /SAVE UNIT AND CURRENT DIRECTION
 6675 41347 1050          TAD     K0377           /MOVE THE DIRECTION BIT INTO POSITION
 6676 41350 0042          AND     K7400
 6677 41351 4723          JMS I   DTLOAA          /STOP HIM/HER!!!
 6678 41352 1047          TAD     K7770
 6679 41353 0502          AND I   TEMP4
 6680 41354 3502          DCA I   TEMP4           /CLEAR "BRAKE" BIT
 6681 41355 1100          TAD     TEMP2
 6682 41356 1476          TAD I   TEMP0
 6683 41357 3476          DCA I   TEMP0           /PUT HIM/HER BACK IN DECTAPE WAIT
 6684 41360 5332          JMP     DTIME1          /CHECK FOR OTHER DRIVES TO STOP
 6685 41361 1102  DTIME3, TAD     TEMP4
 6686 41362 7650          SNA CLA
 6687 41363 5371          JMP     DTIME4          /NOTYING STOPPED THIS TIME
 6688 41364 1027          TAD     DTTIME          /WAS ANYTHING IMPORTANT GOING ON?
 6689 41365 7640          SZA CLA
 6690 41366 1015          TAD     A15             /YES - LET'S GET BACK TO IT
 6691 41367 4431          JMS I   DTGOA           /START SOMETHING
 6692 41370 5724  DTIMEX, JMP I   DTIMER
 6693 41371 6213  DTIME4, CIF DATFLD              /INHIBIT INTERRUPTS
 6694 41372 1027          TAD     DTTIME          /IS THE CONTROLLER BUSY?
 6695 41373 7640          SZA CLA                 /NO
 6696 41374 2027          ISZ     DTTIME          /YES - BUMP CONTROLLER TIMER
 6697 41375 5724          JMP I   DTIMER
 6698 41376 6761          DTRA                    /IT'S HUNG
 6699 41377 0106          AND     K0204
 6700 41400 6764          DTXA                    /STOP THE TAPE (IF IT'S EVEN MOVING)
 6701 41401 7240          STA
 6702 41402 3432          DCA I   DTERRA          /LET HIM/HER KNOW THE TRANSFER PROBABLY DIDN'T HAPPEN
 6703 41403 7001          IAC
 6704 41404 3021          DCA     DTBUF
 6705 41405 3025          DCA     DTCOM
 6706 41406 1020          TAD     DTJOB
 6707 41407 4213          JMS     DTRKER          /REPORT THE ERROR & SCHEDULE LEVEL 2
 6708 41410 5743          DTL20
 6709 41411 5612          JMP I   .+1             /BACK THROUGH THE TIMER CODE
 6710 41412 1370          DTIMEX

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 161


 6711             
 6712       1410  FCE1=   .+1&7770
 6713 41413 0000  DTRKER, 0
 6714 41414 6203          CIF CDF
 6715 41415 4465          JMS I   DTRKHA          /REPORT THE HUNG DEVICE
 6716 41416 1613          TAD I   DTRKER          /GET THE L2 DISPATCH ADDRESS
 6717 41417 2213          ISZ     DTRKER          /BUMP PAST THE ARG.
 6718 41420 6203          CIF CDF
 6719 41421 4471          JMS I   QUEUE1          /PUT IT ON LEVEL 2 QUEUE
 6720 41422 5613          JMP I   DTRKER
 6721             
 6722 41423 3100  UUDTRK, DCA     TEMP2
 6723 41424 1516          TAD I   L2SAP           /GET USER AC
 6724 41425 3077          DCA     TEMP1
 6725 41426 7420          SNL                     /DON'T CLEAR THE AC IF IT'S AN RK05 REQUEST
 6726 41427 3516          DCA I   L2SAP           /CLEAR HIS/HER AC
 6727 41430 1523          TAD I   UDFP            /GET THE "CDF" FOR HIS/HER FIELD
 6728 41431 3120          DCA     UDF1+1
 6729 41432 4117          JMS     UDF1            /CHANGE TO USER FIELD
 6730 41433 1477          TAD I   TEMP1           /GET WORD 1 OF HIS/HER PARAMETERS
 6731 41434 7430          SZL                     /RK05?
 6732 41435 5270          JMP     URK05           /YES
 6733 41436 7006          RTL
 6734 41437 7006          RTL
 6735 41440 0103          AND     K0007           /AC=UNIT NUMBER
 6736 41441 1274  UDTXAD, TAD     DTDEVA          /INDEX INTO THE DEVICE TABLE
 6737 41442 3246          DCA     UDTDDB
 6738 41443 6211          DATFLD
 6739 41444 6202          CIF                     /FIELD 0 ROUTINE
 6740 41445 4470          JMS I   DTCHKA          /SEE IF HE OWNS THIS UNIT
 6741 41446 0000  UDTDDB, 0
 6742 41447 7240          STA
 6743 41450 1077          TAD     TEMP1
 6744 41451 3016          DCA     A16
 6745 41452 1646          TAD I   UDTDDB
 6746 41453 1115          TAD     K0003           /SET UP TO MOVE PARAMETERS
 6747 41454 3017          DCA     A17
 6748 41455 7146          CLL CMA RTL             /L=1; AC=-3
 6749 41456 4472          JMS I   BLTF1A          /MOVE 3 WORDS FROM UDF TO DATFLD
 6750 41457 1646          TAD I   UDTDDB
 6751 41460 1100          TAD     TEMP2
 6752 41461 4466          JMS I   WAIT2           /SET WAIT 2 CONDITION FOR DECTAPE OR RK05
 6753 41462 1100          TAD     TEMP2
 6754 41463 7112          CLL RTR
 6755 41464 7630          SZL CLA                 /RK05?
 6756 41465 5374          JMP     RK05GO          /YES
 6757 41466 4431          JMS I   DTGOA           /NO - TRY TO START THE DECTAPE
 6758 41467 5165          WAITF1
 6759             
 6760 41470 7110  URK05,  CLL RAR
 6761 41471 0115          AND     K0003           /RK05 UNIT #
 6762 41472 1104          TAD     K0010           /DISPLACE TO RK05 DDB'S
 6763 41473 5241          JMP     UDTXAD
 6764 41474 3047  DTDEVA, DEVTBE+5

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 162


 6765             
 6766             /SEARCH FOR A JOB WAITING FOR A "WAIT 2" CONDITION
 6767             /CALLING SEQUENCE:
 6768             /       AC=0 COMPLETE PASS; AC NON-ZERO FINISH CURRENT PASS
 6769             /       JMS     DTRKJB
 6770             /       MINUS WAIT CONDITION NUMBER
 6771             /       RETURN - NO JOBS FOUND
 6772             /       RETURN - CONTENTS OF WAIT 2 IN AC
 6773             
 6774 41475 0000  DTRKJB, 0
 6775 41476 7640          SZA CLA                 /DO WE WANT A FULL PASS?
 6776 41477 5325          JMP     DTRK2           /NO - JUST COMPLETE FROM WHERE WE LEFT OFF
 6777 41500 1122          TAD     JOBCNT
 6778 41501 3077          DCA     TEMP1           /SET COUNT FOR JOBMAX
 6779 41502 1014  DTRK1,  TAD     IX4             /CHECK POSITION OF RING POINTER
 6780 41503 1331          TAD     DTRKEN
 6781 41504 7640          SZA CLA
 6782 41505 5310          JMP     .+3
 6783 41506 1073          TAD     JOBTAB          /RESET RING POINTER
 6784 41507 3014          DCA     IX4
 6785 41510 1414          TAD I   IX4
 6786 41511 7450          SNA                     /IS THIS JOB DEFINED?
 6787 41512 5325          JMP     DTRK2           /NO
 6788 41513 1045          TAD     K0005           /POINT AT WAIT 2
 6789 41514 3076          DCA     TEMP0
 6790 41515 1476          TAD I   TEMP0
 6791 41516 0103          AND     K0007
 6792 41517 1675          TAD I   DTRKJB
 6793 41520 7640          SZA CLA                 /IS HE WAITING FOR OUR CONDITION?
 6794 41521 5325          JMP     DTRK2           /NOPE
 6795 41522 1476          TAD I   TEMP0           /PUT THE CONTENTS OF WAIT 2 IN THE AC
 6796 41523 2275          ISZ     DTRKJB          /CAUSE SKIP ON EXIT
 6797 41524 5327          JMP     DTRK3
 6798 41525 2077  DTRK2,  ISZ     TEMP1           /MORE?
 6799 41526 5302          JMP     DTRK1
 6800 41527 2275  DTRK3,  ISZ     DTRKJB          /INDEX PAST ARGUMENT ON RETURN
 6801 41530 5675          JMP I   DTRKJB
 6802             
 6803 41531 4670  DTRKEN, -CLKTBL+1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 163


 6804             
 6805             /MOVE DATA TO/FROM DATFLD FROM/TO USER CORE
 6806             /       USER'S POINTER IN "A16"
 6807             /       DATFLD POINTER IN "A17"
 6808             /CALLING SEQUENCE:
 6809             /       AC=-NUMBER OF WORDS; LINK=0 FROM DATFLD TO USER, LINK=1 FROM USER TO DATFLD
 6810             /       JMS     BLTF1
 6811             /       RETURN
 6812 41532 0000  BLTF1,  0
 6813 41533 3077          DCA     TEMP1           /SAVE NUMBER OF WORDS TO MOVE
 6814 41534 7420  BL0,    SNL                     /WHICH DIRECTION?
 6815 41535 5343          JMP     BL1
 6816 41536 4117          JMS     UDF1            /FROM USER
 6817 41537 1416          TAD I   A16
 6818 41540 6211          DATFLD                  /TO DATFLD
 6819 41541 3417          DCA I   A17
 6820 41542 5347          JMP     BL2
 6821 41543 1417  BL1,    TAD I   A17             /FROM DATFLD
 6822 41544 4117          JMS     UDF1
 6823 41545 3416          DCA I   A16             /TO USER
 6824 41546 6211          DATFLD
 6825 41547 2077  BL2,    ISZ     TEMP1           /MORE?
 6826 41550 5334          JMP     BL0             /YES
 6827 41551 5732          JMP I   BLTF1
 6828             
 6829 41552 0000  WAKEUP, 0
 6830 41553 2125          ISZ     F1SCH           /SET FLAG TO SCHEDULE THIS USER IMMEDIATELY IF POSSIBLE
 6831 41554 4141          JMS     GETTBA          /FIND STR1
 6832 41555 0001          JOBSTS+1
 6833 41556 7344          CLL STA RAL             /AC=7776
 6834 41557 0476          AND I   TEMP0           /CLEAR JSWAIT
 6835 41560 7001          IAC
 6836 41561 3476          DCA I   TEMP0           /NOW WE CAN BE SURE THAT IT IS SET
 6837 41562 2076          ISZ     TEMP0           /NOW UPDATE THE DEVICE STATUS REGISTER
 6838 41563 1752          TAD I   WAKEUP
 6839 41564 3476          DCA I   TEMP0           /THE NEW D.S.R.
 6840 41565 2076          ISZ     TEMP0
 6841 41566 2476          ISZ I   TEMP0           /TURN ON DUMMY WAIT BIT IN WAIT MASK 1
 6842 41567 2076          ISZ     TEMP0
 6843 41570 3476          DCA I   TEMP0           /TAKE HIM/HER OUT OF WAIT
 6844 41571 2352          ISZ     WAKEUP
 6845 41572 5752          JMP I   WAKEUP

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 164


 6846             
 6847       1600  FCB2=   .+7&7770
 6848 41573 2570  RKREDO, REDO0
 6849 41574 6203  RK05GO, CIF CDF
 6850 41575 1054          TAD     RKJOB           /WHO OWNS THE CONTROLLER?
 6851 41576 7640          SZA CLA
 6852 41577 5773          JMP I   RKREDO          /HE'LL HAVE TO WAIT
 6853 41600 1560          TAD I   JOB
 6854 41601 3054          DCA     RKJOB           /HE NOW OWNS THE CONTROLLER
 6855 41602 3516          DCA I   L2SAP           /ZERO AC IN CASE TRANSFER DOESN'T START
 6856 41603 6213          CIF DATFLD
 6857 41604 1054          TAD     RKJOB
 6858 41605 4141          JMS     GETTBA          /GET WAIT 2
 6859 41606 0004          JOBWMK+1
 6860 41607 7146          CLL CMA RTL             /AC=-3
 6861 41610 3240          DCA     RKERR           /3 TRIES ON ERROR
 6862 41611 3061          DCA     RKBLKS          /CLEAR SUCCESSFULL TRANSFER COUNTER
 6863 41612 4265          JMS     USRLOK          /LOCK HIM/HER IN HIS/HER FIELD
 6864 41613 3055          DCA     RKCORE          /SAVE THE CORTBL POINTER
 6865 41614 1476          TAD I   TEMP0           /POINTS TO DDB WORD 4 (-1)
 6866 41615 4651          JMS I   RKGOA           /START UP THE RK05 DISK
 6867 41616 7640          SZA CLA
 6868 41617 5223          JMP     RKL21           /DIDN'T EVEN GET OFF THE GROUND
 6869 41620 7344          CLL STA RAL
 6870 41621 3062          DCA     RKTIME          /SET TIMER FOR 2 SECONDS
 6871 41622 5165          WAITF1
 6872 41623 6001  RKL21,  ION
 6873 41624 6201          CDF
 6874 41625 7352          CLL STA RTR
 6875 41626 0455          AND I   RKCORE
 6876 41627 3455          DCA I   RKCORE          /UNLOCK HIS/HER FIELD
 6877 41630 3055          DCA     RKCORE
 6878 41631 1054          TAD     RKJOB
 6879 41632 4141          JMS     GETTBA          /FIND HIS/HER AC
 6880 41633 0013          JOBREG+2
 6881 41634 1061          TAD     RKBLKS
 6882 41635 3476          DCA I   TEMP0           /PASS NUMBER OF BLOCKS TRANSFERRED BACK TO THE USER
 6883 41636 1054          TAD     RKJOB
 6884 41637 4467  RKEND2, JMS I   AWAKEN          /TAKE HIM/HER OUT OF WAIT STATUS
 6885 41640 0000  RKERR,  0
 6886 41641 3054          DCA     RKJOB           /FREE THE CONTROLLER
 6887 41642 4524          JMS I   DTRKJA          /LOOK FOR OTHERS WAITING FOR THE CONTROLLER
 6888 41643 7775          -3
 6889 41644 5126          EXITF1                  /NOBODY ELSE WANTS IT
 6890 41645 0047          AND     K7770
 6891 41646 3013          DCA     IX3
 6892 41647 1413          TAD I   IX3             /EXTRACT THE JOB # FROM THE DDB
 6893 41650 5237          JMP     RKEND2
 6894 41651 2070  RKGOA,  RKGO
 6895       1650  FCE2=   .+1&7770

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 165


 6896             
 6897             
 6898             /ROUTINE TO SET A WAIT 2 CONDITION FOR THE CURRENT USER
 6899             /       (FOR DECTAPE, RK05, OR CARDREADER)
 6900             /       ENTER WITH DESIRED WAIT 2 STATUS IN THE AC
 6901             
 6902 41652 0000  WAITS2, 0
 6903 41653 3100          DCA     TEMP2
 6904 41654 6201          CDF
 6905 41655 1560          TAD I   JOB             /GET USER JOB NUMBER
 6906 41656 4141          JMS     GETTBA
 6907 41657 0003          JOBWMK
 6908 41660 3476          DCA I   TEMP0           /CLEAR WAIT MASK 1
 6909 41661 2076          ISZ     TEMP0
 6910 41662 1100          TAD     TEMP2           /GET WAIT NUMBER
 6911 41663 3476          DCA I   TEMP0           /NOW HE'S WAITING
 6912 41664 5652          JMP I   WAITS2
 6913             
 6914             /ROUTINE TO LOCK CURRENT USER IN HIS/HER CORE FIELD
 6915             /       RETURNS WITH CORTBL POINTER IN AC
 6916 41665 0000  USRLOK, 0
 6917 41666 6201          CDF
 6918 41667 1701          TAD I   L2SFP           /POINTER TO LEVEL 2 SAVE FIELD
 6919 41670 0103          AND     K0007           /JUST THE FIELD
 6920 41671 1162          TAD     CORTBA          /DISPLACEMENT INTO THE CORE TABLE
 6921 41672 3100          DCA     TEMP2
 6922 41673 7132          STL RTR                 /AC=2000
 6923 41674 1500          TAD I   TEMP2
 6924 41675 3500          DCA I   TEMP2           /LOCK IN CORE
 6925 41676 6211          DATFLD
 6926 41677 1100          TAD     TEMP2           /NOW RETURN WITH POINTER INTO CORE TABLE
 6927 41700 5665          JMP I   USRLOK
 6928 41701 0103  L2SFP,  L2SF
 6929             
 6930       1710  FCB3=   .+7&7770
 6931 41702 0000  CDCNT,  0
 6932 41703 0000  CDCORE, 0
 6933 41704 2417  CDTIMR, TIMCDR
 6934 41705 7152  CDL21,  CLL CMA RTR             /AC=5777
 6935 41706 0703          AND I   CDCORE
 6936 41707 3703          DCA I   CDCORE          /UNLOCK THE CORE FIELD
 6937 41710 1326          TAD     CDJOB
 6938 41711 4141          JMS     GETTBA          /FIND HIS/HER AC
 6939 41712 0013          JOBREG+2
 6940 41713 1302          TAD     CDCNT
 6941 41714 3476          DCA I   TEMP0           /PUT THE COLUMN COUNT IN HIS/HER AC
 6942 41715 1326          TAD     CDJOB
 6943 41716 4467          JMS I   AWAKEN          /TAKE HIM/HER OUT OF WAIT STATUS
 6944 41717 0000  CDBUF,  0
 6945 41720 5126          EXITF1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 166


 6946             
 6947 41721 1704  CDL11,  TAD I   CDTIMR
 6948 41722 7650          SNA CLA                 /WERE WE EXPECTING AN INTERRUPT?
 6949 41723 5333          JMP     CDIOT           /NO
 6950 41724 2302          ISZ     CDCNT           /COUNT A COLUMN
 6951 41725 2317          ISZ     CDBUF           /BUMP THE USER'S POINTER
 6952 41726 0000  CDJOB,  0                       /JOB OWNING THE CARD READER - (COVERS THE "ISZ SKIP")
 6953 41727 0000  CDREAD, .-.                     /THE PROPER READ IOT IS PLACED HERE
 6954 41730 0000  CDFLD,  .-.                     /CDF TO THE USER'S FIELD
 6955 41731 3717          DCA I   CDBUF           /STASH A COLUMN IN THE USER'S BUFFER
 6956 41732 5136          INTRTN
 6957 41733 6632  CDIOT,  RCRA                    /CLEAR UNWANTED INTERRUPT
 6958 41734 7200          CLA
 6959 41735 5136          INTRTN
 6960 41736 7104  UUCDR,  CLL RAL                 /TIMES 2
 6961 41737 1333          TAD     CDIOT           /CONSTRUCT READ IOT
 6962 41740 3327          DCA     CDREAD          /EITHER ALPHA, BINARY, OR COMPRESSED (8E ONLY)
 6963 41741 1516          TAD I   L2SAP
 6964 41742 3317          DCA     CDBUF           /SAVE THE USER'S BUFFER POINTER
 6965 41743 3516          DCA I   L2SAP           /CLEAR USER AC - IN CASE THE READER ISN'T READY
 6966 41744 1523          TAD I   UDFP
 6967 41745 3330          DCA     CDFLD           /SAVE CDF TO USER'S FIELD
 6968 41746 1560          TAD I   JOB
 6969 41747 3326          DCA     CDJOB
 6970 41750 3302          DCA     CDCNT           /ZERO COLUMN COUNT
 6971 41751 6002          IOF
 6972             IFZERO CPU&7776 < JMP .+4 >
 6973 41752 6677  IFNZRO CPU&7776 < RCTF >        /CLEAR 8E TRANSITION FLAG
 6974 41753 7001          IAC
 6975 41754 6635          RCNO                    /ENABLE CARD READER INTERRUPTS
 6976 41755 7200          CLA
 6977 41756 6672          RCSE                    /START CARD READER
 6978 41757 5370          JMP     UUCDRB          /NOT READY - PUT HIM/HER TO SLEEP BEFORE CONTINUING
 6979 41760 4265          JMS     USRLOK          /LOCK HIM/HER IN HIS/HER FIELD
 6980 41761 3303          DCA     CDCORE          /SAVE POINTER TO CORTBL
 6981 41762 1110          TAD     K0004
 6982 41763 4466          JMS I   WAIT2           /MAKE HIM/HER WAIT FOR THE CARD READER
 6983 41764 6203          CIF CDF
 6984 41765 7144          CLL CMA RAL             /AC=-2
 6985 41766 3704          DCA I   CDTIMR          /SET CARD READER TIMER
 6986 41767 5567          JMP I   WAIT1
 6987 41770 6203  UUCDRB, CIF CDF
 6988 41771 5463          JMP I   SLEEPB          /PUT HIM/HER TO SLEEP FOR A COUPLE OF SECONDS
 6989       2000  *2000
 6990       2000  FCE3=   .&7770

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 167


 6991             
 6992       2000  FCB4=   .+7&7770
 6993 42000 6745  RKL11,  DRST                    /GET CONTROLLER STATUS
 6994 42001 7104          CLL RAL                 /IGNORE THE DONE BIT
 6995 42002 7440          SZA
 6996 42003 5221          JMP     RKSR1           /ERROR!!!!!
 6997 42004 2061          ISZ     RKBLKS          /COUNT A SUCCESSFUL TRANSFER
 6998 42005 1352          TAD     RKCMD
 6999 42006 7450          SNA                     /ARE WE FINISHED?
 7000 42007 5224          JMP     RKSR2           /YES
 7001 42010 6746          DLDC                    /LOAD THE NEW COMMAND
 7002 42011 1057          TAD     RKSECT
 7003 42012 6743          DLAG                    /LOAD THE NEW SECTOR - WE'RE OFF AND RUNNING AGAIN
 7004 42013 4363          JMS     RKNXT           /SET UP FOR THE NEXT BLOCK (IF ANY)
 7005 42014 7344          CLL STA RAL
 7006 42015 3062          DCA     RKTIME          /SET CONTROLLER TIMER FOR 2 MORE SECONDS
 7007 42016 7346          CLL STA RTL
 7008 42017 3464          DCA I   RKERRA          /THREE ERRORS
 7009 42020 5136          INTRTN
 7010             
 7011 42021 2464  RKSR1,  ISZ I   RKERRA
 7012 42022 5231          JMP     RKSR4           /STILL OK TO RETRY
 7013 42023 6745          DRST
 7014 42024 3464  RKSR2,  DCA I   RKERRA          /FINAL STATUS FOR THE USER
 7015 42025 6746          DLDC                    /CLEAR CONTROLLER STATUS AND COMMAND REGISTERS
 7016 42026 3062          DCA     RKTIME
 7017 42027 1266          TAD     RKL2            /SCHEDULE LEVEL 2
 7018 42030 5136          INTRTN
 7019 42031 0265  RKSR4,  AND     K1012           /SAVE SPECIAL CASE ERROR BITS
 7020 42032 7450          SNA
 7021 42033 5256  RKSRE,  JMP     RKSR5+1         /DON'T RECAL. OR PUT CURRENT JOB TO SLEEP
 7022 42034 0104          AND     K0010
 7023 42035 7640          SZA CLA
 7024 42036 5255          JMP     RKSR5           /PUT CURRENT JOB TO SLEEP AND RE-TRY
 7025 42037 7001          IAC
 7026 42040 6742          DCLR                    /IN CASE WE HAVE SOMETHING REALLY IN TROUBLE
 7027 42041 1056          TAD     RKCOM
 7028 42042 0051          AND     K0006           /SAVE ONLY THE UNIT #
 7029 42043 1053          TAD     K0600           /ENABLE INTERRUPT ON SEEK COMPLETION
 7030 42044 6746          DLDC
 7031 42045 7126          STL RTL
 7032 42046 6742          DCLR                    /RE-CALIBRATE
 7033 42047 1233          TAD     RKSRE
 7034 42050 3200          DCA     RKL11           /CHANGE LEVEL 1
 7035 42051 7346          CLL STA RTL             /ALLOW 3 SECONDS FOR THE RE-CALIBRATE
 7036 42052 3062          DCA     RKTIME
 7037 42053 6742          DCLR
 7038 42054 5136          INTRTN

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 168


 7039             
 7040 42055 1063  RKSR5,  TAD     SLEEPB
 7041 42056 3075          DCA     INTS2
 7042 42057 7146          CLL CMA RTL             /AC=-3
 7043 42060 1013          TAD     IX3             /POINTER TO DDB WORD 4 (-1)
 7044 42061 4270          JMS     RKGO            /RE-TRY
 7045 42062 7450          SNA                     /ANYTHING BAD?
 7046 42063 1075          TAD     INTS2           /NO - HOW ABOUT PUTTING SOMEONE TO SLEEP?
 7047 42064 5136          INTRTN
 7048 42065 1012  K1012,  1012
 7049 42066 4565  RKL2,   RKL20
 7050 42067 1050  RKFLD,  -CORTBL+51
 7051 42070 0000  RKGO,   0
 7052 42071 3013          DCA     IX3             /SAVE THE DDB POINTER
 7053 42072 7001          IAC
 7054 42073 6742          DCLR                    /CLEAR THE CONTROLLER
 7055 42074 1413          TAD I   IX3             /USER WORD 1
 7056 42075 7112          CLL RTR
 7057 42076 7010          RAR
 7058 42077 3056          DCA     RKCOM           /SAVE COMMAND DIVIDED BY 10
 7059 42100 1056          TAD     RKCOM
 7060 42101 0044          AND     K0037           /PAGE COUNT
 7061 42102 7450          SNA
 7062 42103 1107          TAD     K0040           /FOR 0 OR 40 GIVE HIM/HER 40
 7063 42104 7040          CMA
 7064 42105 1061          TAD     RKBLKS
 7065 42106 1061          TAD     RKBLKS          /ADD NUMBER OF PAGES ALREADY TRANSFERRED
 7066 42107 3060          DCA     RKCNT
 7067 42110 1056          TAD     RKCOM
 7068 42111 0042          AND     K7400           /SAVE FUNCTION, DRIVE, AND HI ORDER SECTOR BIT
 7069 42112 1055          TAD     RKCORE          /POINTER TO CORTBL ENTRY
 7070 42113 1267          TAD     RKFLD           /EXTRACT FIELD NUMBER AND INSERT INTERRUPT ENABLE AND HALF BLOCK BITS
 7071 42114 7026          CML RTL                 /"RKFLD" COMPLEMENTED THE LINK
 7072 42115 7004          RAL
 7073 42116 3056          DCA     RKCOM           /SAVE THE CONSTRUCTED COMMAND REGISTER
 7074 42117 1061          TAD     RKBLKS          /NUMBER OF SECTORS ALREADY TRANSFERRED
 7075 42120 1413          TAD I   IX3
 7076 42121 3057          DCA     RKSECT          /STARTING SECTOR NUMBER FROM THE USER
 7077 42122 7430          SZL
 7078 42123 2056          ISZ     RKCOM           /BUMP HI ORDER BIT
 7079 42124 1061          TAD     RKBLKS          /NUMBER OF BLOCKS ALREADY TRANSFERRED
 7080 42125 7112          CLL RTR                 /TIMES 400
 7081 42126 7012          RTR
 7082 42127 7010          RAR
 7083 42130 1413          TAD I   IX3
 7084 42131 7001          IAC                     /WE ADD ONE SINCE THE CONTROLLER WANTS THE REAL ADDRESS
 7085 42132 6744          DLCA                    /LOAD USER'S CA INTO THE CONTROLLER
 7086 42133 4352          JMS     RKCMD           /GENERATE FIRST COMMAND
 7087 42134 6002          IOF
 7088 42135 6746          DLDC                    /LOAD CONTROLLER COMMAND REGISTER
 7089 42136 1057          TAD     RKSECT
 7090 42137 6743          DLAG                    /LOAD IN THE DESIRED SECTOR - WE ARE OFF AND RUNNING
 7091 42140 4363          JMS     RKNXT           /SET UP FOR THE NEXT SECTOR (IF ANY)
 7092 42141 1345          TAD     RKDRST
 7093 42142 3200          DCA     RKL11           /FIX FIRST WORD OF INTERRUPT SERVICE
 7094 42143 6741          DSKP                    /ARE WE TRYING TO DO SOMETHING BAD?
 7095 42144 5670          JMP I   RKGO            /NO - EVERYTHING IS PEACHY

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 169


 7096 42145 6745  RKDRST, DRST
 7097 42146 3464          DCA I   RKERRA          /SAVE ERROR STATUS - NO RE-TRIES WILL BE MADE
 7098 42147 6746          DLDC                    /CLEAR CONTROLLER STATUS AND COMMAND REGISTERS
 7099 42150 1266          TAD     RKL2            /RETURN WITH L2 DISPATCH
 7100 42151 5670          JMP I   RKGO
 7101             
 7102 42152 0000  RKCMD,  0
 7103 42153 2060          ISZ     RKCNT
 7104 42154 1060          TAD     RKCNT
 7105 42155 7700          SMA CLA                 /ANY MORE BLOCKS TO GO?
 7106 42156 5376          JMP     RKDONE          /NO - CLOSE IT OUT
 7107 42157 2060          ISZ     RKCNT           /HALF BLOCK?
 7108 42160 1113          TAD     K7700           /NO - REMOVE THE HALF BLOCK BIT FROM THE COMMAND
 7109 42161 1056          TAD     RKCOM           /GET THE COMMAND
 7110 42162 5752          JMP I   RKCMD
 7111             
 7112 42163 0000  RKNXT,  0
 7113 42164 2057          ISZ     RKSECT          /BUMP SECTOR
 7114 42165 1057          TAD     RKSECT
 7115 42166 7450          SNA
 7116 42167 2056          ISZ     RKCOM           /BUMP HI-ORDER SECTOR BIT
 7117 42170 0044          AND     K0037
 7118 42171 7640          SZA CLA                 /WILL WE SEEK ON THIS ONE?
 7119 42172 1052          TAD     K1000           /NO - DO A READ ALL OR WRITE ALL
 7120 42173 3074          DCA     INTS1
 7121 42174 4352          JMS     RKCMD           /CHECK FOR HALF BLOCK AND COMPLETION
 7122 42175 1074          TAD     INTS1
 7123 42176 3352  RKDONE, DCA     RKCMD           /SAVE THE NEW COMMAND REGISTER
 7124 42177 5763          JMP I   RKNXT
 7125             PAGE
 7126       2200  FCE4=   .&7770

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 170


 7127             
 7128             IFNZRO DC08A <
 7129             T8ASSM, 0
 7130                     AND     T83770          /THE CHARACTER ONLY
 7131                     SNA
 7132                     JMP     T8ASS1          /IGNORE NULL CHARACTERS
 7133                     CLL RTR                 /BRING THE CHARACTER INTO POSITION
 7134                     RAR
 7135                     AND     T80177
 7136                     TAD     K0200           /FORCE ON THE PARITY BIT
 7137                     CIF 00                  /STASH IT AWAY
 7138                     JMS I   T8IN1A          /THAT'S DONE IN FIELD 0
 7139                     ION
 7140             T8ASS1, CLL STA RTL             /AC=-3
 7141                     TAD     T8ASSM
 7142                     DCA     T8T             /POINTS TO THE LSW
 7143                     TAD I   T8T
 7144                     AND     T83770          /SAVE ONLY THE LINE NUMBER
 7145                     DCA I   T8T
 7146                     ISZ     T8T             /POINTS TO THE CAW
 7147                     STL RTR                 /AC=2000
 7148                     DCA I   T8T             /RESET THE FLAG BIT
 7149                     TTIR                    /BUMP THE "R" REGISTER
 7150                     JMP I   T8ASSM
 7151             T80177, 177
 7152             T83770, 3770
 7153             T8IN1A, T8IN1
 7154             T8T,    0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 171


 7155             
 7156             T8TTI,  TTI
 7157                     DC08LO^10+0             /LSW  LINE # PT08+DC08LO+1
 7158                     2000                    /CAW
 7159                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7160                     TTI
 7161                     DC08LO^10+10            /LSW  LINE # PT08+DC08LO+2
 7162                     2000                    /CAW
 7163                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7164                     TTI
 7165                     DC08LO^10+20            /LSW  LINE # PT08+DC08LO+3
 7166                     2000                    /CAW
 7167                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7168                     TTI
 7169                     DC08LO^10+30            /LSW  LINE # PT08+DC08LO+4
 7170                     2000                    /CAW
 7171                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7172                     TTI
 7173                     DC08LO^10+40            /LSW  LINE # PT08+DC08LO+5
 7174                     2000                    /CAW
 7175                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7176                     TTI
 7177                     DC08LO^10+50            /LSW  LINE # PT08+DC08LO+6
 7178                     2000                    /CAW
 7179                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7180                     TTI
 7181                     DC08LO^10+60            /LSW  LINE # PT08+DC08LO+7
 7182                     2000                    /CAW
 7183                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7184                     TTI
 7185                     DC08LO^10+70            /LSW  LINE # PT08+DC08LO+10
 7186                     2000                    /CAW
 7187                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7188                     TTI
 7189                     DC08LO^10+100           /LSW  LINE # PT08+DC08LO+11
 7190                     2000                    /CAW
 7191                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7192                     TTI
 7193                     DC08LO^10+110           /LSW  LINE # PT08+DC08LO+12
 7194                     2000                    /CAW
 7195                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7196                     TTI
 7197                     DC08LO^10+120           /LSW  LINE # PT08+DC08LO+13
 7198                     2000                    /CAW
 7199                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7200                     TTI
 7201                     DC08LO^10+130           /LSW  LINE # PT08+DC08LO+14
 7202                     2000                    /CAW
 7203                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7204                     TTI
 7205                     DC08LO^10+140           /LSW  LINE # PT08+DC08LO+15
 7206                     2000                    /CAW
 7207                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7208                     TTI
 7209                     DC08LO^10+150           /LSW  LINE # PT08+DC08LO+16
 7210                     2000                    /CAW
 7211                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 172


 7212                     TTI
 7213                     DC08LO^10+160           /LSW  LINE # PT08+DC08LO+17
 7214                     2000                    /CAW
 7215                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7216                     TTI
 7217                     DC08LO^10+170           /LSW  LINE # PT08+DC08LO+20
 7218                     2000                    /CAW
 7219                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7220                     TTI
 7221                     DC08LO^10+200           /LSW  LINE # PT08+DC08LO+21
 7222                     2000                    /CAW
 7223                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7224                     TTI
 7225                     DC08LO^10+210           /LSW  LINE # PT08+DC08LO+22
 7226                     2000                    /CAW
 7227                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7228                     TTI
 7229                     DC08LO^10+220           /LSW  LINE # PT08+DC08LO+23
 7230                     2000                    /CAW
 7231                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7232                     TTI
 7233                     DC08LO^10+230           /LSW  LINE # PT08+DC08LO+24
 7234                     2000                    /CAW
 7235                     JMS     T8ASSM          /CHARACTER FULLY ASSEMBLED
 7236             *T8TTI+DC08A+DC08A+DC08A+DC08A
 7237                     CIF 00
 7238                     JMP I   .+1             /BACK TO THE REST OF THE DC08A SERVICE
 7239                     T8OUT1
 7240             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 173


 7241             
 7242             FCB5=   .+7&7770
 7243             *2360
 7244             
 7245             FCE5=   .&7770
 7246             
 7247             DFCLS0, ZBLOCK 4
 7248             DFCNO0, ZBLOCK 4
 7249             DFL2S0, ZBLOCK 4
 7250                     -1                      /TO END TABLE
 7251             DFL2DL= .
 7252                     1-DC08LO+PT08+KL8;11-DC08LO+PT08+KL8
 7253                     21-DC08LO+PT08+KL8;31-DC08LO+PT08+KL8
 7254             
 7255             
 7256             DFRING, CTG                     /CLEAR THE GROUP COUNTER
 7257                     TAD     K7774
 7258                     DCA     TEMP0           /COUNTER FOR GROUP SEARCH
 7259             DFRNG1, RRS                     /READ RING STATUS
 7260                     SZA
 7261                     STR                     /ACKNOWLEDGE RING(S)
 7262                     CLA
 7263                     ITG                     /INCREMENT THE GROUP COUNTER
 7264                     ISZ     TEMP0           /LOOKED AT ALL LINES?
 7265                     JMP     DFRNG1          /NO, KEEP LOOKING
 7266                     STA
 7267                     IOF
 7268                     DCA I   .+2             /DATA FLD=0 HERE, I HOPE. RESET COUNTER
 7269                     EXITF1
 7270                     D6FLAG
 7271             
 7272             DFCLSI, 0
 7273             DFCNWI, 0
 7274             DFCLST, DFCLS0
 7275             DFCNOW, DFCNO0
 7276             DFCNTR, 0
 7277             DFCSET, 0
 7278                     TAD     DFCLST
 7279                     DCA     DFCLSI          /POINTER TO STATUS AT LAST INTERRUPT
 7280                     TAD     DFCNOW
 7281                     DCA     DFCNWI          /POINTER TO STATUS AT THIS INTERRUPT
 7282                     TAD     K7774
 7283                     DCA     DFCNTR          /COUNTER FOR COMPARISONNS
 7284                     CTG                     /CLEAR GROUP COUNTER
 7285                     JMP I   DFCSET

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 174


 7286             
 7287             DFCARR, JMS     DFCSET          /INITIALIZE STATUS
 7288             DFCAR1, RCS                     /READ CARRIER STATUS
 7289                     DCA I   DFCNWI          /PLACE ON TABLE
 7290                     ISZ     DFCNWI
 7291                     ITG                     /INCREMENT THE GROUP COUNTER
 7292                     ISZ     DFCNTR          /READ ALL FOUR GROUPS?
 7293                     JMP     DFCAR1          /NO, READ NEXT
 7294                     JMS     DFCSET
 7295                     TAD     DFL2ST
 7296                     DCA     DFL2SI
 7297             DFCAR2, TAD I   DFCNWI
 7298                     CMA
 7299                     AND I   DFCLSI
 7300                     SZA                     /ANY LINES CLEARED?
 7301                     JMP     DFCAR3          /YES, ACKNOWLEDGE
 7302             DFCAR5, TAD I   DFCLSI
 7303                     CMA
 7304                     AND I   DFCNWI
 7305                     SZA
 7306                     JMS     DFCAR6
 7307                     ISZ     DFCLSI
 7308                     ISZ     DFCNWI
 7309                     ISZ     DFL2SI
 7310                     ITG                     /INCREMENT THE GROUP COUNTER
 7311                     ISZ     DFCNTR          /ALL LINES CHECKED?
 7312                     JMP     DFCAR2          /NO
 7313                     JMS     DFCSET
 7314             DFCAR4, TAD I   DFCNWI          /TRANSFER THIS STATUS TABLE TO LAST
 7315                     DCA I   DFCLSI
 7316                     ISZ     DFCNWI
 7317                     ISZ     DFCLSI
 7318                     ISZ     DFCNTR
 7319                     JMP     DFCAR4
 7320                     JMP     DFL200
 7321             
 7322             DFCAR3, CTR                     /CLEAR TERMINAL READY
 7323                     JMS     DFCAR6
 7324                     JMP     DFCAR5          /LOOK AT OTHER GROUPS
 7325             
 7326             DFCAR6, 0
 7327                     DCA     TEMP4           /BIT TO SET
 7328                     TAD     TEMP4
 7329                     CMA
 7330                     AND I   DFL2SI
 7331                     TAD     TEMP4
 7332                     DCA I   DFL2SI
 7333                     JMP I   DFCAR6

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 175


 7334             
 7335             DFL200, TAD     DFL2ST          /INITIALIZE PSEUDO GROUP CTR
 7336                     DCA     DFL2SG
 7337             
 7338             DFL22,  TAD     K7770           /EIGHT PHONES
 7339                     DCA     TEMP0
 7340                     IAC
 7341                     DCA     TEMP1           /SELECT EACH LINE IN GROUP
 7342             
 7343             DFL21,  TAD I   DFL2SG
 7344                     SNA
 7345                     JMP     DFL23
 7346                     SPA
 7347                     EXITF1
 7348                     AND     TEMP1
 7349                     SZA CLA
 7350                     JMP     DFL25
 7351             
 7352             DFL26,  TAD     TEMP1
 7353                     CLL RAL
 7354                     DCA     TEMP1
 7355                     ISZ     TEMP0
 7356                     JMP     DFL21
 7357             DFL23,  DCA I   DFL2SG
 7358                     ISZ     DFL2SG
 7359                     JMP     DFL22
 7360             
 7361             DFGBLK, GETB
 7362             DFL25,  TAD     DFL2SG
 7363                     TAD     DFL2C
 7364                     DCA     TEMP2
 7365                     TAD I   TEMP2
 7366                     TAD     TEMP0
 7367                     TAD     K0010
 7368                     CLL RAL
 7369                     TAD     DFVTBA
 7370                     DCA     TEMP3
 7371                     TAD I   TEMP3
 7372                     SZA CLA
 7373                     JMP     .+5             /YES
 7374                     TAD     TEMP3
 7375                     CIF
 7376                     JMS I   DFGBLK
 7377                     JMP     DFL26
 7378                     TAD     TEMP3
 7379                     CIF CDF
 7380                     JMS I   DFUMES
 7381                     JMP     DFL26
 7382             
 7383             DFL2SG, 0
 7384             DFL2C,  DFL2DL-DFL2S0
 7385             DFVTBA= DEVTBA
 7386             DFL2SI, 0
 7387             DFL2ST, DFL2S0
 7388             DFUMES, UHLTMS
 7389                     >

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 176


 7390             
 7391       2200  *DATA1
 7392             /ROUTINE TO DECREMENT TIMERS
 7393             /THEY ARE BUMPED ONCE EACH SECOND
 7394             /THUS A USER CAN MEASURE UP TO 1 HOUR, 8 MINUTES, 15 SECONDS
 7395             
 7396 42200 0000  TIMER0, 0
 7397 42201 2323          ISZ     TIMBIG          /HAVE WE GONE THROUGH A SECOND YET?
 7398 42202 5276          JMP     F0TIMT          /NO - DID WE FINISH ALL THE TIMERS LAST TIME?
 7399 42203 1324          TAD     TICSEC          /REFRESH SECOND TIMER
 7400 42204 3323          DCA     TIMBIG
 7401             
 7402 42205 1122          TAD     JOBCNT
 7403 42206 3102          DCA     TIMET1
 7404 42207 1325          TAD     TIMTB1          /START OF CLKTBL
 7405 42210 3100          DCA     TIMET2
 7406 42211 6211  TIMER1, DATFLD
 7407 42212 1500          TAD I   TIMET2
 7408 42213 7640          SZA CLA
 7409 42214 2500          ISZ I   TIMET2
 7410 42215 5231          JMP     TIMER2
 7411 42216 1237          TAD     TIMEJM          /SET TIMER FLAG
 7412 42217 1102          TAD     TIMET1
 7413 42220 4141          JMS     GETTBA          /GET PTR TO STATUS 1
 7414 42221 0001          JOBSTS+1
 7415 42222 1076          TAD     TEMP0           /DOES THE JOB STILL EXIST?
 7416 42223 7650          SNA CLA
 7417 42224 5231          JMP     TIMER2          /NO
 7418 42225 1476          TAD I   TEMP0           /YES, SET JSTIME IN STR1
 7419 42226 7004          RAL
 7420 42227 7130          STL RAR
 7421 42230 3476          DCA I   TEMP0
 7422 42231 2100  TIMER2, ISZ     TIMET2
 7423 42232 2102          ISZ     TIMET1
 7424 42233 5211          JMP     TIMER1
 7425 42234 2174          ISZ     UPTIM1          /INDEX LOW ORDER UPTIME
 7426 42235 7410          SKP
 7427 42236 2173          ISZ     UPTIM2          /INDEX HI ORDER UPTIME
 7428 42237 0025  TIMEJM, JOBMAX+1                /NOP
 7429             IFZERO TC01 < JMP .+3 >
 7430 42240 7240  IFNZRO TC01 < STA >
 7431 42241 3100          DCA     TEMP2           /ENABLE TRANSFER BACK TO DECTAPE CONTROLLER WAIT
 7432 42242 4726          JMS I   TIMEDT          /RUN DECTAPE TIMERS
 7433 42243 5257  IFZERO RK05 < JMP F0TIMR >
 7434             IFNZRO RK05 < CIF DATFLD >      /NO INTERRUPTS
 7435 42244 1062          TAD     RKTIME
 7436 42245 7640          SZA CLA                 /ACTIVE?
 7437 42246 2062          ISZ     RKTIME          /YES, BUMP TIMER
 7438 42247 5257          JMP     F0TIMR          /ALL IS WELL
 7439 42250 7001          IAC
 7440 42251 6742          DCLR                    /STOP WHATEVER IS GOING ON WITH THE RK05
 7441 42252 7240          STA
 7442 42253 3464          DCA I   RKERRA          /SHOW THAT TRANSFER WAS TERMINATED
 7443 42254 1054          TAD     RKJOB
 7444 42255 4727          JMS I   RKHUNG          /REPORT THE ERROR
 7445 42256 4565          RKL20
 7446 42257 1200  F0TIMR, TAD     TIMER0          / VRS: Reconstructed from working binary

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 177


 7447 42260 3321          DCA     TIMIT
 7448 42261 6201          CDF
 7449 42262 6002          IOF
 7450 42263 1721          TAD I   TIMIT
 7451 42264 7640          SZA CLA
 7452 42265 2721          ISZ I   TIMIT
 7453 42266 5276          JMP     F0TIMT
 7454 42267 6001          ION
 7455 42270 2321          ISZ     TIMIT
 7456 42271 1721          TAD I   TIMIT
 7457 42272 6203          CIF CDF
 7458 42273 4471          JMS I   QUEUE1
 7459 42274 2321          ISZ     TIMIT
 7460 42275 5306          JMP     TIMOUT
 7461 42276 6001  F0TIMT, ION
 7462 42277 2321          ISZ     TIMIT
 7463 42300 2321          ISZ     TIMIT
 7464 42301 1321          TAD     TIMIT
 7465 42302 7041          CIA
 7466 42303 1322          TAD     TIME3A
 7467 42304 7740          SMA SZA CLA
 7468 42305 5261          JMP     F0TIMR+2        / VRS: End reconstruction

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 178


 7469             
 7470             /ROUTINE TO DUMP VALUE OF ONE CORE CELL INTO MQ
 7471             /RUNS AT EACH SYSTEM TICK
 7472             /TO USE, SET THE DESIRED CORE ADDRESS IN THE SWITCH REGISTER
 7473             /TO SELECT FIELDS, CLEAR SR TO 0, AND SET THE DESIRED
 7474             /FIELD IN THE LOW ORDER BITS OF THE SR.
 7475             
 7476             /THIS MEANS THAT YOU CANNOT ADDRESS LOCATIONS 0,1,2, OR 3
 7477             
 7478             /IF THIS ROUTINE IS RUNNING, THE EAE IS NOT MUCH USE
 7479             /TO USER PROGRAMS.  SORRY ABOUT THAT.
 7480             
 7481 42306 5317  TIMOUT, JMP     TIMEX           /LAS    /INSERT THE "LAS" (7604) TO ENABLE DISPLAY
 7482 42307 0114          AND     K7774           /TRYING A FIELD SELECT?
 7483 42310 7450          SNA
 7484 42311 5330          JMP     DISPL1          /YES, GO CHANGE THE FIELD
 7485 42312 7604          LAS                     /NO; WHAT WAS THAT ADDRESS AGAIN?
 7486 42313 3076          DCA     TEMP0
 7487 42314 6201  DISFLD, CDF                     /ASSUME FIELD 0 TO START
 7488 42315 1476          TAD I   TEMP0           /PICK UP CONTENTS OF SPECIFIED ADDRESS
 7489 42316 7421          MQL                     /DUMP IT IN THE MQ
 7490 42317 6203  TIMEX,  CIF CDF                 /BACK TO FIELD 0
 7491 42320 5722          JMP I   TIME3A          /RETURN
 7492             
 7493 42321 2427  TIMIT,  TIMER3
 7494 42322 2427  TIME3A, TIMER3
 7495 42323 7766  TIMBIG, -TICSPS                 /ACTIVE COUNTER
 7496 42324 7766  TICSEC, -TICSPS                 /STARTING VALUE OF TIMBIG
 7497       0102  TIMET1= TEMP4
 7498       0100  TIMET2= TEMP2
 7499 42325 3112  TIMTB1, CLKTBL+1
 7500 42326 1324  TIMEDT, DTIMER
 7501 42327 1413  RKHUNG, DTRKER
 7502             
 7503 42330 7604  DISPL1, LAS                     /WHAT WAS THAT FIELD AGAIN?
 7504 42331 7104          CLL RAL
 7505 42332 7006          RTL
 7506 42333 1111          TAD     K6201           /BUILD FIELD SELECT
 7507 42334 3314          DCA     DISFLD
 7508 42335 5313          JMP     DISFLD-1        /NOW GO LOOK
 7509             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 179


 7510             
 7511       2400  *2400
 7512       2400  FCB6=   .+7&7770
 7513             IFNZRO RKSYS <
 7514             
 7515 42400 0000  RKGO0,  0       
 7516                     / DISK ACCESSES DO NOT NEED TO START AT A SEGMENT BOUNDARY, AND
 7517                     / CAN BE OF ANY LENGTH UP TO 4KW.
 7518                     / MAP DF08/DF32 DISK EXTENSION AND ADDRESS TO RK05 TRACK / SECTOR
 7519                     / DETERMINE SECTOR TO XFER, AND DO XFER.   
 7520                     / AFTER XFER COMPLETES, IN ISR, COPY WORDS TO/FROM BUFFER,
 7521                     / TO/FROM DESTINATION USING BLT ROUTINE, FOR WRITES WRITE SECTOR DATA BACK TO DISK.
 7522                     / IF MORE WORDS NEED TO BE XFER'D, INCREMENT SECTOR, HEAD, TRACK AS
 7523                     / NECESSARY AND START ANOTHER XFER.
 7524                     / WHEN DONE, SET STATUS, CLEAR DISK REGS, ETC.
 7525                     / WHEW.
 7526             
 7527                     /AC HAS PTR TO DSPAR.
 7528                     /GRAB PARAMETERS AND TRANSLATE, STORE LOCALLY FOR REUSE DURING INTERRUPT
 7529                     /SERVICING.
 7530 42401 3016          DCA     A16                                     / STOW DSPAR IN A16 (USED BY BLTF1, WE SHOULD
 7531                                                                     / NOT CONFLICT, FINGERS CROSSED.)
 7532 42402 1416          TAD I   A16                     / FUNCTION
 7533 42403 0110          AND     K0004               / MASK BIT 9 (DIFFERENTIATES DMAR FROM DMAW)
 7534 42404 3777@         DCA     RKWRI                   / STOW COMMAND FOR NOW  
 7535 42405 1416          TAD I   A16                             / DF32 DISC EXTENSION (8-BITS) TRANSLATES DIRECTLY TO
 7536                                                                     / TRACK # BUT IS FOR SOME REASON SHIFTED LEFT
 7537                                                                     / TWO BITS IN THE PARAMETER WORD.
 7538 42406 7106          CLL RTL                                 / ALIGN WITH RK8E CYLINDER ADDRESS + SURFACE BIT
 7539                                                                     / (BITS 0-7).  THIS SHOULD NOT OVERFLOW (AS ABOVE,
 7540                                                                     / THIS IS AN 8-BIT QUANTITY NOW SHIFTED 4 BITS.)
 7541                                                                     / THIS ALSO MEANS WE DO NOT NEED TO DEAL WITH THE RK8E
 7542                                                                     / EXTENDED CYLINDER ADDRESS BIT.  
 7543 42407 3776@         DCA     RKDSKA                          / STOW FOR NOW
 7544 42410 1416          TAD I   A16                             / MEMORY FIELD (IN BITS 7-9).
 7545 42411 7104          CLL RAL                                 / MOVE TO 6-8.
 7546 42412 0040          AND     K0070 
 7547 42413 1111          TAD     K6201                           / MAKE INTO CDF 
 7548 42414 3775@         DCA     RKEMA
 7549 42415 1416          TAD I   A16                             / -WORD COUNT.  STORE FOR FUTURE REFERENCE.
 7550                                                                     / THIS WILL ALWAYS BE AT LEAST ONE WORD.
 7551 42416 3774@         DCA     RKWD
 7552 42417 1416          TAD I   A16                             / CORE ADDRESS - 1
 7553 42420 7001          IAC                     
 7554 42421 3773@         DCA     RKADDR                          / STORE; WE WILL BE MANUALLY TRANSFERRING
 7555                                                                     / DATA TO/FROM THIS ADDRESS USING BLT.
 7556             
 7557 42422 1416          TAD I   A16                             / DISK ADDRESS:
 7558                                                                     / THE ADDRESS (12 BITS) IN THE TRACK TO START
 7559                                                                     / THE TRANSFER TO/FROM 
 7560             
 7561 42423 3772@         DCA     RKOFF                           / STORE OFFSET
 7562             
 7563 42424 1016          TAD     A16                                     / COPY OUR INDEX BACK TO FIELD 0 (DSPAR)
 7564                                                                     / SO THAT THE TWO ARE IN SYNC
 7565 42425 6201          CDF     00
 7566 42426 3650          DCA I   DSPARF

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 180


 7567 42427 6211          CDF     10
 7568 42430 1772@         TAD     RKOFF
 7569 42431 0042          AND     K7400                           / MASK TOP 4 BITS SO WE DON'T TOGGLE THE LINK
 7570 42432 7112          CLL     RTR
 7571 42433 7012          RTR
 7572 42434 7012          RTR
 7573 42435 7012          RTR                                             / DIVIDE BY 256, YIELDING SECTOR # TO START THE
 7574                                                                     / TRANSFER
 7575 42436 1776@         TAD     RKDSKA
 7576 42437 3776@         DCA     RKDSKA                          / ADD TO DISK ADDRESS
 7577 42440 1772@         TAD     RKOFF
 7578 42441 0050          AND     K0377                           / MASK OFF OFFSET WITHIN SECTOR
 7579 42442 3772@         DCA     RKOFF
 7580             
 7581                     / OK - REGARDLESS OF WHETHER THIS IS ULTIMATELY
 7582                     / A READ OR A WRITE, WE ALWAYS DO A READ FIRST:  ON A WRITE WE NEED TO
 7583                     / MERGE THE CHANGED BITS INTO THE SECTOR'S DATA IN OUR BUFFER, THEN
 7584                     / WRITE BACK.
 7585 42443 1771@         TAD     K0410                           
 7586 42444 3770@         DCA     RKRW
 7587 42445 4767@         JMS     RKOP
 7588                     
 7589 42446 6203          CDI                                             / BACK TO FIELD 0
 7590 42447 5600          JMP I   RKGO0                   / DONE FOR NOW
 7591             
 7592 42450 0012  DSPARF, DSPAR                           / LOCATION OF DSPAR IN FIELD 0
 7593             
      42567 2616
      42570 2620
      42571 2746
      42572 2742
      42573 2741
      42574 2740
      42575 2737
      42576 2736
      42577 2735
 7594       2600  *2600
 7595                     / DO RK READ/WRITE TO/FROM BUFFER, DISK ADDRESS IN RKDSKA
 7596                     / CALL DORKR
 7597                     /      RK8E COMMAND WORD
 7598 42600 0000  DORKR,  0
 7599 42601 7200          CLA
 7600 42602 1343          TAD     RKBLKA                          / ADDRESS OF BUFFER IN FIELD 1
 7601 42603 6744          DLCA
 7602 42604 1600  DORKO, TAD I    DORKR           / READ COMMAND WORD
 7603 42605 6746          DLDC
 7604 42606 1336          TAD     RKDSKA                          / SECTOR / TRACK ADDRESS
 7605 42607 6743          DLAG                                    / AND GO! DO IT!
 7606 42610 2200          ISZ     DORKR
 7607 42611 5600          JMP I   DORKR
 7608             
 7609             / RE-EXECUTES THE LAST DISK COMMAND; INTENDED TO BE EXECUTED FROM
 7610             / FIELD 0 WHEN A RETRY IS REQUIRED.
 7611 42612 0000  RKREDU, 0
 7612 42613 4216          JMS RKOP                                / RE-EXECUTE
 7613 42614 6203          CDI 00                                  / BACK TO FIELD 0
 7614 42615 5612          JMP I   RKREDU

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 181


 7615                     
 7616             / ENCAPSULATES THE LAST DISK COMMAND EXECUTED
 7617 42616 0000  RKOP,   0
 7618                     / DO AN RK8E OP SPECIFIED BY RKRW
 7619 42617 4200          JMS     DORKR
 7620 42620 0000  RKRW, .-.                                       / RK8E COMMAND WORD     
 7621 42621 5616          JMP I   RKOP
 7622                     
 7623             / INVOKED FROM FIELD 0 AFTER INTERRUPT SERVICING, ON A SUCCESSFUL
 7624             / RK8E OPERATION.
 7625 42622 0000  RKRET,  0
 7626                     / SUCCESS: 
 7627                     / IF LAST TRANSFER WAS A WRITE COMPLETING A READ-MODIFY-WRITE OPERATION
 7628                     / THEN GO SELECT THE NEXT SECTOR.   
 7629                     / OTHERWISE, USE BLT TO TRANSFER DATA FROM THE READ OPERATION FIRST 
 7630 42623 7300          CLL CLA
 7631 42624 6742          DCLR
 7632 42625 1344          TAD     RKWCPL
 7633 42626 7450          SNA
 7634 42627 5233          JMP     RKRET0
 7635 42630 7200          CLA
 7636 42631 3344          DCA     RKWCPL           
 7637 42632 5306          JMP     RKRNXT                  / WRITE: CLEAR WRITE COMPLETE FLAG, DO NEXT SECTOR.     
 7638             
 7639                     / BLT: CALCULATE THE NUMBER OF WORDS TO TRANSFER; THIS IS AT MOST
 7640                     / 256 WORDS (ONE RK05 SECTOR), AT MINIMUM 1 WORD.
 7641 42633 1342  RKRET0, TAD     RKOFF
 7642 42634 7041          CMA IAC
 7643 42635 1041          TAD     K0400                   / SUBTRACT SECTOR OFFSET FROM 256 TO DETERMINE 
 7644 42636 3345          DCA     RKXWC                   / MAX TRANSFER COUNT.
 7645 42637 7100          CLL                                     / CLEAR LINK, MAY BE SET ABOVE
 7646 42640 1340          TAD     RKWD
 7647 42641 1345          TAD     RKXWC                   / ADD MAX, DID WE OVERFLOW? 
 7648 42642 7430          SZL
 7649 42643 5250          JMP     RKRET1          
 7650 42644 7300          CLL CLA                         / NO: MORE THAN MAX WORDS LEFT, COPY ONLY MAX
 7651 42645 1345          TAD     RKXWC
 7652 42646 7041          CMA IAC
 7653 42647 5252          JMP     RKRET2
 7654 42650 7300  RKRET1, CLL CLA
 7655 42651 1340          TAD     RKWD                    / FEWER THAN MAX WORDS, COPY THE REMAINDER
 7656 42652 3345  RKRET2, DCA     RKXWC
 7657 42653 1337          TAD     RKEMA                   / USER FIELD
 7658 42654 3120          DCA     UDF1+1
 7659 42655 7240          CMA     CLA
 7660 42656 1341          TAD     RKADDR                  / USER POINTER - 1
 7661 42657 3016          DCA     A16
 7662 42660 7240          CMA CLA
 7663 42661 1342          TAD     RKOFF
 7664 42662 1343          TAD     RKBLKA                  / DATFLD POINTER - 1
 7665 42663 3017          DCA     A17
 7666 42664 1335          TAD     RKWRI                   / IS THIS A WRITE?
 7667 42665 7450          SNA
 7668 42666 5271          JMP     RKRET3                  / NO
 7669 42667 7320          STL CLA                         / YES: SET LINK (FROM USER TO DATFLD FOR BLTF1)
 7670 42670 5272          JMP     RKBL
 7671 42671 7300  RKRET3, CLL CLA                 / NO: CLEAR LINK (FROM DATFLD TO USER)

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 182


 7672 42672 1345  RKBL,   TAD     RKXWC           / -WC TO AC
 7673                     / DO THE TRANSFER
 7674 42673 4777@         JMS     BLTF1
 7675                     / IF THIS WAS A READ OPERATION WE ARE DONE.
 7676                     / IF IT WAS A WRITE, WE NOW NEED TO DO A WRITE OPERATION TO COMMIT
 7677                     / THE MODIFIED BUFFER BACK TO DISK, AND WAIT FOR IT TO FINISH.
 7678 42674 7300          CLL CLA
 7679 42675 1335          TAD     RKWRI           
 7680 42676 7450          SNA
 7681 42677 5306          JMP     RKRNXT                  / THIS IS A READ, JUST GO TO NEXT SECTOR
 7682 42700 7200          CLA
 7683 42701 1347          TAD K4410                       / WRITE W/INTERRUPT FROM FIELD 1
 7684 42702 3220          DCA RKRW
 7685 42703 4216          JMS     RKOP    
 7686 42704 2344          ISZ     RKWCPL                  / SET WRITE COMPLETE FLAG
 7687 42705 5332          JMP     RKNDON                  / DONE FOR NOW.
 7688             
 7689             RKRNXT, / PROCESS NEXT SECTOR IF NECESSARY
 7690 42706 7200          CLA
 7691 42707 1345          TAD     RKXWC
 7692 42710 7041          CMA IAC
 7693 42711 1340          TAD     RKWD
 7694 42712 3340          DCA     RKWD
 7695                     / ANY MORE DATA TO TRANSFER?
 7696 42713 1340          TAD     RKWD
 7697 42714 7450          SNA
 7698 42715 5333          JMP     RKDON                   / NO: JUST RETURN.
 7699                     / YES: MOVE TO THE NEXT SECTOR
 7700                     / THIS SHOULD NOT OVERFLOW -- THE DF08 HAD AN 8-BIT EXTENDED (TRACK) ADDRESS
 7701                     / AND THE RK8E/RK05 HAS 9 BITS.  FIP SHOULD PREVENT OVERFLOW FROM DF08 
 7702                     / ADDRESS SPACE. 
 7703 42716 2336          ISZ     RKDSKA                  / THIS SHOULD NEVER OVERFLOW BUT I AM TESTING ANYWAY
 7704 42717 5321          JMP     RKRNX0                  / NO OVERFLOW
 7705 42720 7402          HLT                             / YIKES.        
 7706 42721 7200  RKRNX0, CLA                             / SECTOR OFFSET GETS RESET TO ZERO WHEN CROSSING SECTOR BOUNDARIES
 7707 42722 3342          DCA     RKOFF
 7708                     / INCREMENT CORE ADDRESS 
 7709 42723 1345          TAD     RKXWC
 7710 42724 7041          CMA     IAC
 7711 42725 1341          TAD     RKADDR                  / INCREMENT CORE ADDRESS 
 7712 42726 3341          DCA     RKADDR
 7713                     / AND START THE NEXT READ
 7714 42727 1346          TAD K0410                       / READ W/INTERRUPT INTO FIELD 1
 7715 42730 3220          DCA RKRW
 7716 42731 4216          JMS     RKOP    
 7717 42732 2222  RKNDON, ISZ RKRET               / RETURN +1, MORE TRANSFERS TO GO.
 7718             RKDON,
 7719 42733 6203          CDI     00                              / RETURN TO FIELD 0
 7720 42734 5622          JMP I   RKRET
 7721             
 7722 42735 0000  RKWRI,  0                       / 0 = READ, 1 = WRITE
 7723 42736 0000  RKDSKA, 0                       / RK05 DISK ADDRESS FOR THE TRANSFER (LOW 12 BITS)
 7724 42737 0000  RKEMA,  0                       / USER'S FIELD FOR THE TRANSFER
 7725 42740 0000  RKWD,   0                       / NEGATIVE WORD COUNT FOR THE TRANSFER
 7726 42741 0000  RKADDR, 0                       / POINTER TO THE USER'S CORE MEMORY FOR THE TRANSFER
 7727 42742 0000  RKOFF,  0                       / THE OFFSET IN THE SECTOR DATA TO COPY
 7728 42743 7300  RKBLKA, RKBLK                   / POINTER TO THE MONITOR'S RK05 SECTOR BUFFER (256 WORDS)

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 183


 7729 42744 0000  RKWCPL, 0                       / WRITE COMPLETE BIT: SET WHEN A READ-MODIFY-WRITE CYCLE
 7730                                             / IS COMPLETING THE WRITE PORTION OF THE CYCLE. 
 7731 42745 0000  RKXWC,  0                       / WORDS TRANSFERRED THIS GO-AROUND
 7732 42746 0410  K0410,  0410
 7733 42747 4410  K4410,  4410
 7734 42750 6211  K6211,  6211
 7735             
 7736       2750  FCE6=   .&7770
 7737             
 7738       3062  DEVDMB= JOBTBL-2
      42777 1532
 7739       3017  *DEVTBL-1
 7740 43017 3062          DEVDMB                  /DUMMY USED BY FIP RELEASE
 7741 43020 0000          ZBLOCK DEVTBE-DEVTBL
      43021 0000
      43022 0000
      43023 0000
      43024 0000
      43025 0000
      43026 0000
      43027 0000
      43030 0000
      43031 0000
      43032 0000
      43033 0000
      43034 0000
      43035 0000
      43036 0000
      43037 0000
      43040 0000
      43041 0000
 7742 43042 0000                          0       /WE ALLOW THE READER EVEN IF NOT CONFIGURED FOR ONE
 7743                                             /THIS ALLOWS FIELD SERVICE TO USE THEIR PMK01
 7744                     IFZERO PUNCH    <DEVDMB>
 7745 43043 0000          IFNZRO PUNCH    <0>
 7746 43044 3062                          DEVDMB
 7747 43045 3062          IFZERO LPT      <DEVDMB>
 7748                     IFNZRO LPT      <0>
 7749 43046 3062          IFZERO CDR      <DEVDMB>
 7750                     IFNZRO CDR      <0>
 7751                     IFZERO TC01     <DEVDMB
 7752                                     DEVDMB
 7753                                     DEVDMB
 7754                                     DEVDMB
 7755                                     DEVDMB
 7756                                     DEVDMB
 7757                                     DEVDMB
 7758                                     DEVDMB>
 7759 43047 0000          IFNZRO TC01     <ZBLOCK 10>
      43050 0000
      43051 0000
      43052 0000
      43053 0000
      43054 0000
      43055 0000
      43056 0000
 7760                     IFNZRO RK05     <ZBLOCK RK05>

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 184


 7761 43057 3062          IFNZRO .-JOBTBL+1 <DEVDMB>
 7762 43060 3062          IFNZRO .-JOBTBL+1 <DEVDMB>
 7763 43061 3062          IFNZRO .-JOBTBL+1 <DEVDMB>
 7764 43062 3062          IFNZRO .-JOBTBL+1 <DEVDMB>
 7765 43063 7777                          -1      /TERMINATES ASSIGNABLE DEVICE TABLE
 7766             
 7767             /JOBTBL, CLKTBL, TTYTBL, PRGTBL, & DSUTBL ARE SET UP BY INIT
 7768             
 7769       7300  *RKBLK
 7770 47300 0000          ZBLOCK 400              /MONITOR'S FIXED BLOCK FOR RK05 FILESYSTEM TRANSFERS
      47301 0000
      47302 0000
      47303 0000
      47304 0000
      47305 0000
      47306 0000
      47307 0000
      47310 0000
      47311 0000
      47312 0000
      47313 0000
      47314 0000
      47315 0000
      47316 0000
      47317 0000
      47320 0000
      47321 0000
      47322 0000
      47323 0000
      47324 0000
      47325 0000
      47326 0000
      47327 0000
      47330 0000
      47331 0000
      47332 0000
      47333 0000
      47334 0000
      47335 0000
      47336 0000
      47337 0000
      47340 0000
      47341 0000
      47342 0000
      47343 0000
      47344 0000
      47345 0000
      47346 0000
      47347 0000
      47350 0000
      47351 0000
      47352 0000
      47353 0000
      47354 0000
      47355 0000
      47356 0000
      47357 0000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 185


      47360 0000
      47361 0000
      47362 0000
      47363 0000
      47364 0000
      47365 0000
      47366 0000
      47367 0000
      47370 0000
      47371 0000
      47372 0000
      47373 0000
      47374 0000
      47375 0000
      47376 0000
      47377 0000
      47400 0000
      47401 0000
      47402 0000
      47403 0000
      47404 0000
      47405 0000
      47406 0000
      47407 0000
      47410 0000
      47411 0000
      47412 0000
      47413 0000
      47414 0000
      47415 0000
      47416 0000
      47417 0000
      47420 0000
      47421 0000
      47422 0000
      47423 0000
      47424 0000
      47425 0000
      47426 0000
      47427 0000
      47430 0000
      47431 0000
      47432 0000
      47433 0000
      47434 0000
      47435 0000
      47436 0000
      47437 0000
      47440 0000
      47441 0000
      47442 0000
      47443 0000
      47444 0000
      47445 0000
      47446 0000
      47447 0000
      47450 0000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 186


      47451 0000
      47452 0000
      47453 0000
      47454 0000
      47455 0000
      47456 0000
      47457 0000
      47460 0000
      47461 0000
      47462 0000
      47463 0000
      47464 0000
      47465 0000
      47466 0000
      47467 0000
      47470 0000
      47471 0000
      47472 0000
      47473 0000
      47474 0000
      47475 0000
      47476 0000
      47477 0000
      47500 0000
      47501 0000
      47502 0000
      47503 0000
      47504 0000
      47505 0000
      47506 0000
      47507 0000
      47510 0000
      47511 0000
      47512 0000
      47513 0000
      47514 0000
      47515 0000
      47516 0000
      47517 0000
      47520 0000
      47521 0000
      47522 0000
      47523 0000
      47524 0000
      47525 0000
      47526 0000
      47527 0000
      47530 0000
      47531 0000
      47532 0000
      47533 0000
      47534 0000
      47535 0000
      47536 0000
      47537 0000
      47540 0000
      47541 0000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 187


      47542 0000
      47543 0000
      47544 0000
      47545 0000
      47546 0000
      47547 0000
      47550 0000
      47551 0000
      47552 0000
      47553 0000
      47554 0000
      47555 0000
      47556 0000
      47557 0000
      47560 0000
      47561 0000
      47562 0000
      47563 0000
      47564 0000
      47565 0000
      47566 0000
      47567 0000
      47570 0000
      47571 0000
      47572 0000
      47573 0000
      47574 0000
      47575 0000
      47576 0000
      47577 0000
      47600 0000
      47601 0000
      47602 0000
      47603 0000
      47604 0000
      47605 0000
      47606 0000
      47607 0000
      47610 0000
      47611 0000
      47612 0000
      47613 0000
      47614 0000
      47615 0000
      47616 0000
      47617 0000
      47620 0000
      47621 0000
      47622 0000
      47623 0000
      47624 0000
      47625 0000
      47626 0000
      47627 0000
      47630 0000
      47631 0000
      47632 0000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 188


      47633 0000
      47634 0000
      47635 0000
      47636 0000
      47637 0000
      47640 0000
      47641 0000
      47642 0000
      47643 0000
      47644 0000
      47645 0000
      47646 0000
      47647 0000
      47650 0000
      47651 0000
      47652 0000
      47653 0000
      47654 0000
      47655 0000
      47656 0000
      47657 0000
      47660 0000
      47661 0000
      47662 0000
      47663 0000
      47664 0000
      47665 0000
      47666 0000
      47667 0000
      47670 0000
      47671 0000
      47672 0000
      47673 0000
      47674 0000
      47675 0000
      47676 0000
      47677 0000
 7771             
 7772       7720  *FIPBLK
 7773 47720 0000          ZBLOCK 10               /FIP'S FIXED PARAMETER BLOCK
      47721 0000
      47722 0000
      47723 0000
      47724 0000
      47725 0000
      47726 0000
      47727 0000
 7774             
 7775       7730  *WINBAS
 7776 47730 0000          ZBLOCK 50               /BASIC'S WINDOW
      47731 0000
      47732 0000
      47733 0000
      47734 0000
      47735 0000
      47736 0000
      47737 0000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB              Page 189


      47740 0000
      47741 0000
      47742 0000
      47743 0000
      47744 0000
      47745 0000
      47746 0000
      47747 0000
      47750 0000
      47751 0000
      47752 0000
      47753 0000
      47754 0000
      47755 0000
      47756 0000
      47757 0000
      47760 0000
      47761 0000
      47762 0000
      47763 0000
      47764 0000
      47765 0000
      47766 0000
      47767 0000
      47770 0000
      47771 0000
      47772 0000
      47773 0000
      47774 0000
      47775 0000
      47776 0000
      47777 0000
 7777             
 7778             

      No detected errors
