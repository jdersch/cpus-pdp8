
      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 1


    1             /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB
    2             /COPYRIGHT 1975
    3             /DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
    4             /
    5             /THIS SECTION DEFINES THE HARDWARE CONFIGURATION ON WHICH INDIVIDUAL
    6             /EDUSYSTEM 50 MONITORS ARE TO RUN.
    7             /FOR EACH STATEMENT, THE COMMENT INDICATES THE POSSIBLE RESPONSES.
    8             
    9       0002  CPU=    2       /1 IF CPU IS PDP-8; 0 IF CPU IS PDP-8/I;
   10                             /2 IF CPU IS PDP-8/E
   11             
   12       0070  CORMEM= 70      /HIGHEST DATA FIELD SELECT. FOR 12K SYSTEM,
   13                             /RESPOND 20, FOR 16K SYSTEM, RESPOND 30, ETC. (70 MAX)
   14             
   15       0000  PHONES= 0       /1 IF DC08 INCLUDES 689AG;
   16                             /0 IF IT DOES NOT OR IF TTY INTERFACING IS OTHER THAN DC08
   17             
   18       0000  EAE=    0       /20 IF PROCESSOR INCLUDES EAE; 0 IF IT DOES NOT
   19             
   20       0000  RF08=   0       /40 IF SYSTEM DISC IS DF32; 0 IF SYSTEM DISK IS RF08
   21             
   22       0000  RS08=   0       /NUMBER OF DISCS ON THE SYSTEM, WHETHER DF/DS OR RF/RS.
   23                             /RESPOND WITH 1, 2, 3, OR 4.
   24             
   25       0001  RKSYS=  1       /1 IF SYSTEM USES RK05 DRIVE 0 AS SYSTEM / SWAP
   26             
   27       0001  PUNCH=  1       /1 IF SYSTEM INCLUDES PUNCH; 0 IF IT DOES NOT
   28             
   29       0001  TC01=   1       /1 IF SYSTEM INCLUDES DECTAPE(S); 0 IF IT DOES NOT
   30             
   31       0000  RK05=   0       /NUMBER OF RK05 CARTRIDGE DISK DRIVES ON THE SYSTEM; 0 TO 4
   32             
   33       0000  CDR=    0       /1 IF SYSTEM INCLUDES CARD READER; 0 IF IT DOES NOT
   34             
   35       0000  LPT=    0       /1 IF SYSTEM INCLUDES LINE PRINTER; 0 IF NO LINE PRINTER
   36             
   37             DECIMAL /MONITOR CAPACITY FOR THIS SYSTEM
   38             
   39       0024  JOBMAX= 20      /NUMBER OF SIMULTANEOUS USERS (20 MAXIMUM)
   40             
   41             /THE FOLLOWING ENTRIES DEFINE THE NUMBER OF TERMINALS
   42             /ATTACHED TO THE SYSTEM, AND ALSO THE METHOD OF INTERFACING
   43             
   44       0001  CONTTY= 1       /WE ALWAYS HAVE A CONSOLE (K00)
   45             
   46       0000  DC08A=  0       /NUMBER OF TERMINALS INTERFACED VIA DC08A (PDP-8/I ONLY, 19 MAX.)
   47             
   48       0000  DC08LO= 0       /LOWEST HARDWARE LINE NUMBER UTILIZED ON DC08A; USUALLY 0
   49             
   50       0000  PT08=   0       /NUMBER OF TERMINALS INTERFACED VIA PT08 (PDP-8 & PDP-8/I ONLY)
   51             
   52       0010  KL8=    8       /NUMBER OF ADDITIONAL TERMINALS INTERFACED VIA KL8 (PDP-8/E ONLY, 19 MAX.)

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 2


   53             
   54             /PARAMETERS VERSION 8.24 (01-JANUARY-75)
   55             /
   56             /
   57             /
   58             /
   59             /COPYRIGHT (C) 1975
   60             /DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
   61             /
   62             /
   63             /THIS SOFTWARE IS FURNISHED UNDER A LICENSE FOR USE ONLY
   64             /ON A SINGLE COMPUTER SYSTEM AND MAY BE COPIED ONLY WITH
   65             /THE  INCLUSION  OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS
   66             /SOFTWARE, OR ANY OTHER COPIES THEREOF,  MAY NOT BE PRO-
   67             /VIDED OR OTHERWISE  MADE AVAILABLE TO ANY  OTHER PERSON
   68             /EXCEPT FOR USE ON SUCH SYSTEM  AND TO ONE WHO AGREES TO
   69             /THESE  LICENSE  TERMS.  TITLE TO AND  OWNERSHIP  OF THE
   70             /SOFTWARE SHALL REMAIN IN DEC.
   71             /
   72             /THE  INFORMATION IN THIS  DOCUMENT IS SUBJECT TO CHANGE
   73             /WITHOUT NOTICE AND SHOULD  NOT BE  CONSTRUED  AS A COM-
   74             /MITMENT BY DIGITAL EQUIPMENT CORPORATION.
   75             /
   76             /DEC   ASSUMES   NO   RESPONSIBILITY   FOR  THE  USE  OR
   77             /RELIABILITY  OF  ITS SOFTWARE ON EQUIPMENT WHICH IS NOT
   78             /SUPPLIED BY DEC.

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 3


   79             
   80             OCTAL
   81       0000  PLT=0
   82             IFNZRO CPU < IFNZRO DC08A <ILLEGAL CONFIGURATION>>
   83             IFNZRO 24-JOBMAX&4000 <ILLEGAL CONFIGURATION>
   84             IFNZRO 23-KL8-PT08&4000 <ILLEGAL CONFIGURATION>
   85             IFNZRO 24-DC08A&4000 <ILLEGAL CONFIGURATION>
   86       0000  IFZERO DC08A <D689=0>
   87             IFNZRO DC08A < IFNZRO PHONES <D689=4>
   88                     IFZERO PHONES <D689=0>>
   89       0010  NULINE=DC08A+PT08+KL8           /EVERY TERMINAL EXCEPT THE CONSOLE
   90       0005  SWDEX=5                         /DISK TRACK OF THE FIRST USER SWAP TRACK
   91       0005  STOMIN=5                        /MINIMUM # FREE STORAGE BLOCK FOR NEWJOB
   92             IFZERO RKSYS <
   93             IFZERO RF08-40 <
   94             IFZERO RS08-1 <DSKSIZ=10>
   95             IFZERO RS08-2 <DSKSIZ=20>
   96             IFZERO RS08-3 <DSKSIZ=30>
   97             IFZERO RS08-4 <DSKSIZ=40>
   98             DSKEXT=DSKSIZ-1>
   99             IFZERO RF08 <DSKSIZ=RS08^100    /# 4K DISC TRACKS
  100             DSKEXT=RS08^100+77> >
  101       0400  IFNZRO RKSYS<DSKSIZ=400         /MAX 4K DISK TRACKS SUPPORTED BY FILESYSTEM
  102       0477  DSKEXT=477>                     /NO IDEA WHAT THIS IS FOR AND IT'S NOT USED ANYWHERE...
  103             
  104       0144  CLOCKR=144                      /MILLISECONDS PER TICK
  105       1130  TICMIN=1130                     /600 TICKS PER MINUTE
  106       0322  INCLK2=0322                     /INITIAL CLOCK
  107       7400  INCLK1=7400
  108       0012  TICSPS=12                       /NUMBER OF SYSTEM TICKS PER SECOND
  109       0010  INIDEX=10                       /INIT DISC EXTENSION
  110       0030  TS8DEX=30                       /FIELD 0 DISC EXTENSION*2^3
  111       0000  ERPDEX=0                        /ERP DISC EXTENSION*4
  112       0000  ERPWC=0                         /ERP WORD COUNT
  113       0004  FIPDEX=4                        /FIP DISC EXTENSION*4
  114       0000  FIPWC=0                         /FIP WORD COUNT
  115       0000  SIDEX=ERPDEX                    /SI DISC EXTENSION*4
  116       0000  SIWC=ERPWC                      /SI WORD COUNT
  117       0002  LIBACT=2                        /LIBRARY ACCOUNT #
  118       4000  BRKINI=4000                     /INITIAL USER BREAK MASK
  119             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 4


  120             
  121             /IOT DEFINITIONS
  122             
  123             IFNZRO DC08A <                  /DC08A,DL8I IOTS
  124             TTIL=6401                       /INCREMENT LINE REGISTER
  125             TTI=6402                        /TELETYPE INPUT COMMAND
  126             TTO=6404                        /TELETYPE OUTPUT COMMAND
  127             TTCL=6411                       /CLEAR LINE REGISTER
  128             TTLL=6412                       /LOAD LINE REGISTER, CLEAR AC
  129             TTRL=6414                       /READ LINE REGISTER
  130             T1SKP=6421                      /SKIP ON CLOCK FLAG
  131             T1OFF=6422                      /TURN CLOCK OFF
  132             T1ON=6424                       /TURN CLOCK ON
  133             TTIR=6461                       /INCREMENT THE R REG.
  134             TTCR=6471                       /CLEAR THE R REG.
  135             TTLR=6472 >                     /LOAD THE R REG.
  136             /EXTENDED MEMORY
  137             
  138       6201  CDF=6201                        /CHANGE TO DATA FIELD 0
  139       6202  CIF=6202                        /CHANGE TO INSTRUCTION FIELD 0
  140       6204  CINT=6204                       /CLEAR USER IOT
  141             
  142       6214  RDF=6214                        /READ DATA FIELD
  143       6224  RIF=6224                        /READ INSTRUCTION FIELD
  144       6234  RIB=6234                        /READ INTERRUPT BUFFER
  145       6244  RMF=6244                        /RESTORE MEMORY FIELD
  146       6254  SINT=6254                       /SKIP ON USER IOT
  147       6264  CUF=6264                        /USER FLAG OFF
  148       6274  SUF=6274                        /USER FLAG ON
  149             
  150             
  151             /EAE
  152       7405  MUY=7405                        /MULTIPLY
  153       7407  DVI=7407                        /DIVIDE
  154       7411  NMI=7411                        /NORMALIZE
  155       7413  SHL=7413                        /SHIFT ARITHMETIC LEFT
  156       7415  ASR=7415                        /ARITHMETIC SHIFT RIGHT
  157       7417  LSR=7417                        /LOGICAL SHIFT RIGHT
  158       7421  MQL=7421                        /LOAD MQ
  159       7403  SCL=7403                        /STEP COUNTER LOAD FROM MEMORY
  160       7441  SCA=7441                        /STEP COUNTER TO AC
  161       7501  MQA=7501                        /MQ TO AC
  162             
  163             IFZERO CPU-2 <
  164             
  165       7451  DPSZ=7451                       /MODE B ONLY - SKIP IF AC&MQ ARE CLEAR
  166       7447  SWBA=7447                       /CHANGE MODE TO A
  167       7431  SWAB=7431                       /CHANGE MODE TO B (ALSO DOES MQL)
  168       7403  ACS=7403                        /AC(7:11) TO SC; AC CLEARED
  169       6006  SGT=6006                        /SKIP ON GT FLAG
  170                     >
  171             
  172             
  173             
  174             /LINE PRINTER IOTS
  175       6661  LSF=6661                        /SKIP ON CHAR FLAG SET
  176       6662  LCF=6662                        /CLEAR CHAR FLAG

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 5


  177       6663  LSRP=6663                       /SKIP ON NOT READY OR ON ERROR
  178       6664  LLC=6664                        /TRANSMIT CHAR TO PRINTER
  179       6665  LSP=6665                        /SET PROGRAM INTERRUPT; LP08/LE8
  180       6666  LPC=6666                        /TRANSMIT CHAR &CLEAR FLAG
  181       6667  LCP=6667                        /CLEAR PROGRAM INTERRUPT
  182       6665  LIE=6665                        /AC11 TO INTERRUPT ENABLE; LS08/LS8E
  183             
  184             /CTY
  185             
  186       6044  TPC=6044                        /LOAD TELEPRINTER AND PRINT
  187             
  188             /DISC (DF32)
  189             
  190       6601  DCMA=6601                       /CLEAR
  191       6603  DMAR=6603                       /READ
  192       6605  DMAW=6605                       /WRITE
  193       6611  DCEA=6611                       /CLEAR DISC EXTENDED ADDRESS
  194       6615  DEAL=6615                       /LOAD EXTENDED ADDRESS
  195       6621  DFSE=6621                       /SKIP ON ERROR
  196       6622  DFSC=6622                       /SKIP ON COMPLETION
  197       6616  DEAC=6616                       /READ EXTENDED ADDRESSES
  198             
  199             /DISC (RF08)
  200             
  201       6612  DSAC=6612
  202       6614  DORS=6614
  203       6615  DIML=6615
  204       6616  DIMA=6616
  205       6641  DCXA=6641
  206       6643  DXAL=6643
  207             
  208             /CARD READER IOT'S
  209       6631  RCSF=6631
  210       6632  RCRA=6632
  211       6634  RCRB=6634
  212       6635  RCNO=6635                       /8E ONLY
  213       6636  RCRC=6636                       /8E ONLY
  214       6637  RCNI=6637                       /8E ONLY
  215       6671  RCSD=6671
  216       6672  RCSE=6672
  217       6674  RCRD=6674
  218       6675  RCSI=6675                       /8E ONLY
  219       6677  RCTF=6677                       /8E ONLY
  220             
  221             /RK05 IOT'S
  222             
  223             IFZERO PHONES<
  224       6741  DSKP=   6741
  225       6742  DCLR=   6742
  226       6743  DLAG=   6743
  227       6744  DLCA=   6744
  228       6745  DRST=   6745
  229       6746  DLDC=   6746
  230       6747  DMAINT= 6747 >
  231             IFNZRO PHONES <
  232             DSKP=   6751
  233             DCLR=   6752

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 6


  234             DLAG=   6753
  235             DLCA=   6754
  236             DRST=   6755
  237             DLDC=   6756
  238             DMAINT= 6757 >
  239             
  240             /DECTAPE
  241             
  242       6761  DTRA=6761
  243       6762  DTCA=6762
  244       6764  DTXA=6764
  245       6771  DTSF=6771
  246       6772  DTRB=6772
  247       6774  DTLB=6774
  248             
  249             
  250             IFZERO CPU <
  251             /KW8I           REAL TIME CLOCK
  252             
  253             CECI=6137                       /CLEAR AND ENABLE CLOCK AND INTERRUPT
  254             CSCF=6133                       /SKIP AND CLEAR FLAG IF FLAG
  255             >
  256             IFZERO CPU-1 <
  257             CECI=6315                       /CLOCK ENABLE
  258             CSCF=6301                       /SKIP ON CLOCK FLAG
  259             CCF=6302                        /CLEAR CLOCK FLAG, CLEAR ENABLE AND CLEAR BUFFER
  260             CLB=6304 >                      /LOAD BUFFER FROM AC
  261             
  262             IFZERO CPU-2 <
  263       6131  CECI=6131                       /CLOCK ENABLE
  264       6133  CSCF=6133                       /SKIP AND CLEAR FLAG IF FLAG
  265             
  266             /POWER FAIL IOT
  267             
  268       6102  SPL=6102                        /SKIP IF POWER LOW
  269             
  270             / 8/E PROCESSOR IOT
  271       6003  SRQ=6003                        /SKIP ON INTERRUPT REQUEST
  272       6004  GTF=6004                        /LINK TO AC0, GT FLAG TO AC1
  273       6005  RTF=6005                        /AC0 TO LINK, AC1 TO GT FLAG
  274       6007  CAF=6007 >                      /CLEAR ALL FLAGS
  275             
  276             IFZERO CPU-4 <
  277             CLLE=6135                       /AC11 TO INTERRUPT ENABLE FOR CLOCK
  278             CLCL=6136                       /CLEAR CLOCK FLAG
  279             CLSK=6137                       /SKIP ON CLOCK FLAG
  280             SPL=6102                        /SKIP POWER LOW
  281             CAL=6133 >                      /CLEAR AC LOW FLAG
  282             
  283                     IFNZRO DC08A <
  284             
  285             /689AG
  286             SRF=6701                        /SKIP IF RING FLAG
  287             SCF=6711                        /SKIP IF CARRIER FLAG
  288             DFCRF=6742                      /CLEAR RING FLAG
  289             CTG=6721                        /CLEAR GROUP COUNTER
  290             RRS=6702                        /READ RING STATUS

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 7


  291             ITG=6731                        /INCREMENT GROUP COUNTER
  292             STR=6722                        /SET TERMINAL READY
  293             EDF=6704                        /ENABLE DATAPHONE FEATURES
  294             DDF=6714                        /DISABLE DATAPHONE FEATURES
  295             CTR=6724                        /CLEAR TERMINAL FLAG
  296             CCF=6741                        /CLEAR CARRIER FLAG
  297             RCS=6712                        /READ CARRIER STATUS
  298                     >

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 8


  299             
  300             
  301             /FIP IOTS (IN ABBREVIATED FORM)
  302             
  303       0006  SEGS=0006                       /RETURN NUMBER OF FREE SEGMENTS ON DISK
  304       0040  ASD=0040                        /ASSIGN
  305       0042  REL=0042                        /RELEASE
  306       0200  REN=0200                        /RENAME
  307       0201  OPEN=0201                       /OPEN
  308       0202  CLOS=0202                       /CLOSE
  309       6603  RFILE=6603                      /READ FILE
  310       0204  PROT=0204                       /PROTECT
  311       6605  WFILE=6605                      /WRITE FILE
  312       0210  CRF=0210                        /CREATE
  313       0211  EXT=0211                        /EXTEND
  314       0212  RED=0212                        /REDUCE
  315       6613  FINF=6613                       /FILE INFORMATION
  316       0214  LIN=0214                        /LOGIN
  317       0215  LOUT=0215                       /LOGOUT
  318       6616  WHO=6616                        /WHO
  319             /DEVICE DATA BLOCK
  320             
  321       0000  DDBSTS=0                        /WORD 1,  STATUS AND UNIT NUMBER
  322       2000          DXON=2000               /XOFF SENT FLAG
  323       1000          DSI=1000                /DESTINATION IS S.I. FLAG
  324       0400          DFULL=400               /KEYBOARD BUFFER IS FULL
  325       0200          DUPL=200                /CONSOLE IN DUPLEX MODE
  326       0100          SICOM=100               /COMMAND WAITING
  327       0040          DECHO=40                /CAUSE SI TO RE-ECHO CURRENT INPUT BUFFER
  328             
  329                                             /DEVICE UNIT NUMBER IS IN BITS 6-11
  330             
  331       0001  DDBJN=1                         /WORD 2, JOB NUMBER IN 7-11
  332       0002  DDBBRK=2                        /BREAK MASK
  333       0003  DDBTIM=3                        /TIME THAT DEVICE WAS ASSIGNED
  334       0004  DDBINP=4                        /BUFFER FILL POINTER
  335       0005  DDBINC=5                        /BUFFER TOTAL COUNT
  336       0006  DDBOUC=6                        /BUFFER EMPTY COUNT
  337       0007  DDBOUP=7                        /BUFFER EMPTY POINTER

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB                Page 9


  338             
  339             /JOB DATA AREA
  340             
  341       0000  JOBSTS=0                        /STATUS
  342                                             /STR0
  343       4000          JSRUN=4000              /RUN BIT
  344       2000          JSEREN=2000             /USER ERROR ENABLE
  345       1000          JCOMBD=1000             /LAST TIME THE JOB RAN AS COMPUTE BOUND
  346       0400          JSPEEK=400              /ALLOW "PEEK" AND "LOGOUT" IOT'S
  347       0200          JSACC=200               /JOB LOGGED IN UNDER PRIVILEGED ACCOUNT (1,2 OR 3)
  348       0100          JSIOT=100               /NON-RESIDENT IOT
  349       0040          JSIOTC=40               /COPY IOT RESULT TO USER
  350       0020          JSEXON=20               /EXECUTE ONLY
  351       0010          JSINER=10               /INHIBIT ERROR REPORT FROM SI. (UNTIL NEXT COMMAND)
  352                                             /BITS 9-11 ARE SYSTEM ERROR CODE
  353       0001          UUOERF=1                /IOT ERROR
  354       0002          SWPRER=2                /SWAP READ ERROR
  355       0003          SWPWER=3                /SWAP WRITE ERROR
  356       0005          DSKERR=5                /DISC ERROR
  357       0006          HUNGDV=6                /HUNG DEVICE
  358             
  359                                             /STR1
  360       4000          JSTIME=4000             /TIME IS UP
  361       2000          JSF0=2000               /FILE 0 NOT BUSY
  362       1000          JSF1=1000               /FILE 1 IS NOT BUSY
  363       0400          JSF2=400                /FILE 2 IS NOT BUSY
  364       0200          JSF3=200                /FILE 3 IS NOT BUSY
  365       0100          JSDEL=100               /KEYBOARD DELIMITER SEEN
  366       0040          JSLPT=40                /LINE PRINTER BUFFER IN USE BUT NOT FULL
  367       0020          JSTEL=20                /TELEPRINTER OUTPUT BUFFER IN USE BUT NOT FULL
  368       0010          JSPTR=10                /CHARACTERS IN READER BUFFER
  369       0004          JSPTP=4                 /PUNCH BUFFER IN USE BUT IS NOT FULL
  370       0002          JSERR=2                 /SYSTEM ERROR DETECTED
  371       0001          JSWAIT=1                /JOB NOT IN WAIT STATE
  372             
  373             
  374       0002  JOBSTB=2                        /DEVICE STATUS REGISTER (FOR RK05 DECTAPE AND CARD READER)
  375       0003  JOBWMK=3                        /WAIT MASK
  376       0005  JOBSRA=5                        /JOB RESTART ADDRESS
  377       0006  JOBERR=6                        /JOB ERROR RESTART ADDRESS
  378       0007  JOBLNK=7                        /IOT LINKAGE
  379       0010  JOBSWR=10                       /SWITCH REGISTER
  380       0011  JOBREG=11                       /PC LINK AC
  381       0014  JOBEAE=14                       /MQ MODE GT SC
  382       0016  JOBACC=16                       /ACCOUNT NUMBER
  383       0017  JOBF0=17                        /POINTER TO FILE 0 CONTROL
  384       0020  JOBF1=20                        /POINTER TO FILE 1 CONTROL
  385       0021  JOBF2=21                        /POINTER TO FILE 2 CONTROL
  386       0022  JOBF3=22                        /POINTER TO FILE 3 CONTROL
  387       0023  JOBRTM=23                       /LOW ORDER RUN TIME
  388       0024  JOBRTH=24                       /HI ORDER RUN TIME

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 10


  389             
  390             /FILE CONTROL BLOCK - POINTED TO BY JOBFX, X=0,1,2,3
  391             
  392       0000  FILWPT=0                        /POINTER TO FILE RETRIEVAL WINDOW
  393       0001  FILSCT=1                        /SEGMENT NUMBER OF FIRST WINDOW ENTRY
  394       0002  FILPRO=2                        /FILE PROTECTION - BIT 9
  395       0003  FILPAR=3                        /POINTER TO RFILE OR WFILE PARAMETER BLOCK
  396       0004  FILDA=4                         /DISC ADDRESS OF RFILE OR WFILE
  397       0006  FILWC=6                         /-WORD COUNT OF RFILE OR WFILE
  398       0007  FILRES=7                        /POINTER TO FILPIF IN USER AREA
  399             
  400             /FILE RETRIEVAL WINDOW
  401             /WORD 0:        UFD LINK TO NEXT GROUP OF 7 SEGMENT POINTERS
  402             /WORDS 1-7:     SEVEN SEGMENT ADDRESSES
  403             
  404             /RFILE OR WFILE PARAMETER BLOCK - POINTED AT BY FILPAR
  405             
  406       0000  FILPFN=0                        /FUNCTION; 0603 OR 0605
  407       0001  FILPDX=1                        /DISC EXTENSION
  408       0002  FILPIF=2                        /INTERNAL FILE # (BITS 10-11) AND FIELD # (BITS 7-9)
  409       0003  FILPWC=3                        /-WORD COUNT FOR THIS TRANSFER
  410       0004  FILPCA=4                        /CORE ADDRESS FOR THIS TRANSFER
  411       0005  FILPDA=5                        /DISC ADDRESS
  412       0006  FILPRA=6                        /EXEC RETURN ADDRESS FOR THIS TRANSFER
  413       0007  FILPCT=7                        /POINTER TO FILE CONTROL BLOCK
  414             
  415             
  416             /CORE TABLE CONTROL FLAGS
  417             
  418       4000  SWAP=4000                       /SWAP REQUEST
  419       2000  LOCK=2000                       /LOCK IN CORE
  420       1000  NOTRUN=1000                     /HAS NOT BEEN SCHEDULED TO RUN
  421       0400  FIP=400                         /FILE PHANTOM
  422       0200  SI=200                          /SYSTEM INTERPRETER
  423       0140  NOHOLD=140                      /INHIBIT "NOTRUN" STATUS AFTER FOUR CONSECUTIVE FILE TRANSFERS
  424       0037  CJOB=37                         /BITS 7-11 CONTAIN THE JOB #
  425             
  426             
  427             
  428             /FIP TABLE DEFINITIONS
  429             
  430       0530  SATSIZ=530
  431       6000  JTABLE=6000
  432       6025  ENTABL=JTABLE+JOBMAX+1
  433       6265  UTABLE=ENTABL+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX
  434       6525  RTABLE=UTABLE+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX+JOBMAX
  435             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 11


  436             
  437             /TABLES
  438       7001  CORTBL=7001                     /CORE ASSIGNMENT TABLE
  439       7010  L2QTB=CORTBL+7
  440       0000  IFZERO DC08A    <DCSIZE=0>
  441             IFNZRO DC08A    <DCSIZE=400>    /SIZE OF FIELD 1 DC08A CODE PLUS 689AG CODE
  442             
  443       0200  OUTREG=200                      /ACTIVE OUTPUT REGISTERS (TTY'S, LPT & PTP)
  444       0213  SKPTBL=OUTREG+NULINE+3          /START OF IOT SKIP TABLE
  445       0236  SKPTP=SKPTBL+NULINE+NULINE+3    /POSITION OF PUNCH SKIP IN SKIP TABLE
  446       0241  RINGIN=SKPTP+3                  /KEYBOARD INPUT RING BUFFER
  447       0400  ENDBUF=OUTREG+200               /END OF KEYBOARD INPUT BUFFER
  448       0057  INPUTS=ENDBUF-RINGIN%2          /NUMBER OF POSSIBLE ENTRIES IN THE KEYBOARD RING BUFFER
  449             
  450       6211  DATFLD=CDF 10                   /MONITOR DATA FIELD SELECT
  451             
  452             IFZERO EAE-20   <MQREG=1>
  453       0001  IFZERO EAE      <IFNZRO CPU&7776 <MQREG=1>
  454                              IFZERO CPU&7776 <MQREG=0>>
  455             IFNZRO OUTREG&1 <YOU GOOFED>
  456             /SUPER CRITICAL LOCATIONS
  457             /THESE LOCATIONS ARE USED TO LINK TS8, TS8II, FIP, SI AND INIT.
  458             
  459             /IT MAY BE NECESSARY TO ADJUST THEM ACCORDINGLY
  460             
  461             /DEFINED IN TS8:
  462             
  463       2573  WSCHED=2573                     /ADDRESS FOR WAIT
  464       0401  GETJTB=401                      /GETJTA
  465       1317  CORSRC=1317                     /SEARCH CORE TABLE
  466       5171  OVERLA=5171                     /FILE STUFF
  467       0574  READFI=574                      /MORE FILE STUFF
  468       0132  CONDBA=132                      /DEVTBL POINTER USED BY "PRINT" ETC.
  469       0611  RETB=611                        /RETURN A BLOCK TO FREE CORE
  470       1405  GETB=1405                       /GET A BLOCK OF FREE CORE
  471       1447  GETDB0=1447                     /GET A DDB
  472       0051  CLK1=51                         /LOW ORDER DAYTIME CLOCK
  473       0050  CLK2=50                         /HIGH ORDER DAYTIME CLOCK
  474       0166  DATE=166                        /12 BIT DATE WORD
  475       0031  TTCHAR=31                       /SAVE REG. FOR CONSOLE CHARACTERS
  476       3201  KBD00=3201                      /PROCESS KEYBOARD INPUT
  477       1205  PRINT0=1205                     /TYPE OUT A CHARACTER
  478       0562  OVRLA1=562                      /MORE FILE STUFF
  479       0605  RUNFI=605                       /SI FILE TRANSFER INITIALIZER
  480       0103  L2SF=103                        /LEVEL 2 SAVED MODE AND FIELD
  481       6572  SICLR=6572                      /SI CLEAR LINKED BUFFER
  482       2421  TIMSI=2421                      /TIMER FOR SI "COMWAT"
  483       1702  SIWAIT=1702                     /NUMBER OF SI COMMANDS BEING WAITED ON
  484       2423  TIMFIP=2423                     /TIMER FOR FIPLOCK
  485       2724  FIPLOK=2724                     /CORTBL STATUS CHECK FOR FORCE OUT
  486       0322  CLKINI=322                      /CONVERT HARDWARE CLOCK TO SYSTEM-TICKS (100MS)
  487       1602  BLT0=1602                       /BLOCK TRANSFER FROM CORE TO CORE
  488       3213  KBDSQ=3213                      /ADDRESS OF JMS TO ^S/^Q CODE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 12


  489             
  490             
  491             /DEFINED IN TS8II:
  492             
  493       0175  F1TCNT=175                      /SI DDB CHARACTER COUNT
  494       0176  F1ECNT=176                      /SI DDB EMPTY COUNT
  495       0177  F1BUF=177                       /SI DDB EMPTY BLOCK POINTER
  496       0020  DTJOB=20                        /JOB OWNING THE DECTAPE CONTROLLER
  497       0054  RKJOB=54                        /JOB OWNING RK05 CONTROLLER
  498       1175  DTSI=1175                       /SI TERMINATE A DECTAPE ON TIMER
  499       2200  DATA1=2200+DCSIZE
  500       3020  DEVTBL=DATA1+140+460            /TODO: MOVE 460 TO CONSTANT FOR RKSYS
  501       3042  DEVTBE=DEVTBL+NULINE+NULINE+2
  502       3064  JOBTBL=DEVTBE+22
  503       3111  CLKTBL=JOBTBL+JOBMAX+1
  504       3136  TTYTBL=CLKTBL+JOBMAX+1
  505       3163  PRGTBL=TTYTBL+JOBMAX+1
  506       3250  DSUTBL=PRGTBL+JOBMAX+JOBMAX+JOBMAX-7
  507       7300  RKBLK=7300                      /FIXED BLOCK FOR RK05 FILESYSTEM TRANSFERS
  508       7720  FIPBLK=7720                     /FIXED BLOCK FOR FIP IO
  509       7730  WINBAS=7730                     /ADDRESS OF THE BASIC WINDOW
  510       2420  OUTDIF=-OUTREG^2+DEVTBL         /FOR LINKING BETWEEN OUTREG AND DEVTBL
  511       0164  F1OFFJ=164                      /FOR OFF /ON COMMANDS USED BY SI
  512             IFNZRO DEVTBL&1 <YOU GOOFED>
  513             
  514             /DEFINED IN SI
  515             
  516       7270  DTSIDT=7270                     /RETURNED FROM STOPPING A DECTAPE ON TIMER
  517       7600  VERBRK=7600                     /START OF INSTALLATION DEFINED LOGIN MESSAGE
  518             /FIP VERSION 8.24 (01-JANUARY-75)
  519             /
  520             /
  521             /
  522             /
  523             /COPYRIGHT (C) 1975
  524             /DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
  525             /
  526             /
  527             /THIS SOFTWARE IS FURNISHED UNDER A LICENSE FOR USE ONLY
  528             /ON A SINGLE COMPUTER SYSTEM AND MAY BE COPIED ONLY WITH
  529             /THE  INCLUSION  OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS
  530             /SOFTWARE, OR ANY OTHER COPIES THEREOF,  MAY NOT BE PRO-
  531             /VIDED OR OTHERWISE  MADE AVAILABLE TO ANY  OTHER PERSON
  532             /EXCEPT FOR USE ON SUCH SYSTEM  AND TO ONE WHO AGREES TO
  533             /THESE  LICENSE  TERMS.  TITLE TO AND  OWNERSHIP  OF THE
  534             /SOFTWARE SHALL REMAIN IN DEC.
  535             /
  536             /THE  INFORMATION IN THIS  DOCUMENT IS SUBJECT TO CHANGE
  537             /WITHOUT NOTICE AND SHOULD  NOT BE  CONSTRUED  AS A COM-
  538             /MITMENT BY DIGITAL EQUIPMENT CORPORATION.
  539             /
  540             /DEC   ASSUMES   NO   RESPONSIBILITY   FOR  THE  USE  OR
  541             /RELIABILITY  OF  ITS SOFTWARE ON EQUIPMENT WHICH IS NOT
  542             /SUPPLIED BY DEC.

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 13


  543             
  544             /FIP HANDLES ALL NON-RESIDENT FILE IOT'S
  545             
  546             /RUNS IN AN UPPER FIELD IN PLACE OF USER IT IS SERVING
  547             
  548             /RUNS IN EXEC MODE
  549             
  550             FIELD 1                         /FIP LOADS ONTO DISK TRACK 1
  551             
  552       0000  *0
  553 10000 5401          JMP I   .+1
  554 10001 0200          FIP0
  555 10002 4133  LNS01,  LNS0
  556 10003 2316  RETBK1, RETBKS
  557 10004 3514  LNK01,  LNK0
  558 10005 2223  ZDS1,   DS1                     /
  559             
  560       0010  *10
  561 10010 0000  INDEX,  0                       /ONLY REGISTER AVAILABLE IN FIP FOR INDEXING
  562 10011 5400  P5400,  5400
  563 10012 2000  P2000,  2000
  564 10013 0077  P0077,  0077
  565 10014 0007  P0007,  7
  566             FIDEXP,                         /TO REPLACE FIDEXP, FIPDEX WHERE FIPDEX=4
  567 10015 0004  P0004,  4
  568             FIPFLD,                         /FIELD WE ARE RUNNING IN
  569 10016 0020  C0020,  20
  570             C002,
  571 10017 0002  FILPRP, FILPRO
  572             
  573             
  574       0155  FIPDAT= 155                     /DATA REFERENCED BY FIP
  575       0155  *FIPDAT
  576             
  577 10155 0155  FIPJOB, .
  578 10156 0400  C0400,  400
  579       0156  SEGSIZ= C0400                   /# WORDS PER SEGMENT
  580 10157 0031  FIBASE, SWDEX+JOBMAX            /BASE ADDRESS OF ALLOCATABLE DISC STORAGE
  581 10160 0160  JOB,    .                       /# OF CURRENT JOB
  582 10161 0161  JOBDAT, .                       /ADDRESS OF CURRENT JOB DATA LIST. MUST RESIDE IN DATA FIELD.
  583             P7000,
  584 10162 7000  CORTBA, CORTBL-1                /CORE ALLOCATION TABLE
  585 10163 3020  DEVTBA, DEVTBL                  /DEVICE TABLE
  586 10164 3042  DEVEND, DEVTBE                  /START OF ASSIGNABLE DEVICE TABLE
  587 10165 0165  DSBUSY, .                       /DISC BUSY COUNT
  588             
  589             /THE DATE IS KEPT AS A 12 BIT NUMBER IN THE FORMAT
  590             /DATE=((YEAR-1974)*12+(MONTH-1))*31+DAY-1
  591             
  592 10166 0166  DATE,   .

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 14


  593             
  594 10167 1602  BLTA,   BLT0                    /BLOCK TRANSFER
  595       4567  BLT=    JMS I BLTA
  596 10170 1317  CORSRA, CORSRC
  597       4570  CORE=   JMS I CORSRA
  598 10171 1405  GETBA,  GETB
  599       4571  GETBLK= JMS I GETBA
  600 10172 1447  GETDBA, GETDB0                  /GET A DATA BLOCK
  601       4572  GETDDB= JMS I GETDBA
  602 10173 1205  PRINTA, PRINT0                  /TYPE OUT A CHARACTER
  603       4573  PRINT=  JMS I PRINTA
  604 10174 0401  GETJT0, GETJTB                  /GET JOB DATA TABLE ADDRESS
  605       4574  GETJTA= JMS I GETJT0
  606 10175 0611  RETBA,  RETB                    /RETURN BLOCK TO FREE STORAGE
  607       4575  RETBLK= JMS I RETBA
  608 10176 2573  WAITA,  WSCHED
  609       5576  WAIT=   JMP I WAITA
  610 10177 3064  DEVOVR, JOBTBL                  /END OF DEVICE TABLE; START OF JOB TABLE
  611             
  612       0020  *20
  613 10020 0000  FIUSAC, 0                       /SAVED USER AC
  614 10021 0000  FIJOB,  0                       /JOB NUMBER FILE PHANTOM IS REPRESENTING
  615 10022 0000  FIOPTR, 0                       /POINTER TO FIELD 0 IOT
  616 10023 0000  GDRETP, 0                       /RETRIEVAL POINTER, SET BY GD0 ROUTINE
  617 10024 0000  WNDREM, 0                       /REMAINDER FROM DIVISION BY 7
  618 10025 0000  BUFSTA, 0                       /BUFFER STATUS, 7777 IF FULL
  619 10026 0001  BUFMOD, 1                       /BUFFER MODIFIED IF =0; UNCHANGED IF =1
  620 10027 0000  SATSTA, 0                       /SATSTATUS, 7777 IF CHANGED THIS RUN
  621 10030 0000  TABSTA, 0                       /TABLE STATUS, 7777 IF CHANGED THIS RUN
  622             
  623             /POINTERS TO FILE PHANTOM'S INTERNAL TABLES
  624             
  625 10031 6000  JOBTAB, JTABLE                  /TABLE OF PROJ,PROG NUMBERS FOR ALL ACTIVE JOBS
  626             ENTEND,                         /END OF ENTRY TABLE
  627 10032 6265  UFDTBL, UTABLE                  /TABLE OF ALL ACCESSED UFD'S
  628             UFDEND,                         /TOP OF UFD TABLE
  629 10033 6525  RETTBL, RTABLE                  /TABLE OF RETRIEVAL INFORMATION FOR ALL ACCESSED UUFD'S
  630 10034 6015  ENTTBL, ENTABL-10               /TABLE REFLECTING STATE OF ALL POSSIBLE FILE NUMBERS
  631 10035 5400  BUFFER, 5400                    /BUFFER FOR DIRECTORY MANIPULATIONS
  632 10036 7250  SATBOT, -SATSIZ                 /BOTTOM OF STORAGE ALLOCATION TABLE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 15


  633             
  634             /SUBROUTINE POINTERS
  635             
  636 10037 5045  DE01,   DE0                     /GET A DIRECTORY ENTRY
  637 10040 2200  DS01,   DS0                     /DIRECTORY SEARCH
  638 10041 2600  GE01,   GE0                     /GET A DIRECTORY WORD INTO CORE
  639 10042 0334  GD01,   GD0                     /GET A FILE DIRECTORY ENTRY INTO CORE
  640 10043 2171  WRT1,   WR1                     /MAKE SURE THE BUFFER IS EMPTY
  641 10044 3444  DTE01,  DTE0
  642 10045 2520  FIO01,  FIPIO                   /COMMON DISC I/O ROUTINE
  643 10046 2400  SATL1,  SATLOK                  /GET A FREE SEGMENT FROM SAT
  644 10047 3020  TF01,   TF0                     /FREE AN ENTRY ON UFD TABLE
  645 10050 3043  UC01,   UC0                     /USER-OWNER FILE CHECK
  646 10051 3200  UFO01,  UFO0                    /OPEN A UFD
  647 10052 3307  UTS01,  UTS0                    /SEARCH UFD TABLE FOR PROJ,PROG NUMBER
  648 10053 0621  CL01,   CL0                     /CLOSE A FILE
  649 10054 2656  WND201, WND20                   /DIVIDE BY SEVEN
  650 10055 3400  FIEXIT, FIX0                    /EXIT ROUTINE
  651 10056 4061  BLDP1,  BLDP                    /BUILD A POINTER TO ENTTBL
  652 10057 0667  ENR01,  ENR0
  653 10060 4200  REL01,  REL00
  654 10061 0367  WR01,   WR0
  655 10062 2151  GTBLO1, GTBLOK
  656 10063 0357  EBLD0,  EBLD
  657 10064 0765  JBLD0,  JBLD
  658 10065 4570  FIX401, FIX40
  659 10066 0352  IFN01,  IFN0
  660 10067 2144  LGI201, LGI20                   /-1 TO USER AC
  661       4470  FGETJT= JMS I   .
  662 10070 3526          FGETJ0
  663 10071 2263  DIRBAD, BADDIR
  664             
  665             /CONSTANTS
  666             
  667 10072 0006  C0006,  6
  668 10073 0200  C0200,  200
  669 10074 0037  P0037,  37
  670 10075 0003  P0003,  3
  671 10076 6000  P6000,  6000
  672 10077 0777  P0777,  777
  673 10100 6605  C0605,  6605
  674 10101 0005  C0005,  5
  675 10102 6603  C0603,  6603
  676 10103 7774  C7774,  -4
  677 10104 4400  C4400,  4400
  678 10105 7771  C7771,  7771
  679 10106 7770  P7770,  7770

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 16


  680             
  681       6221  CFLD=   CDF 20                  /FIP IS ALWAYS IN FIELD 2
  682             EXQ1,
  683 10107 0000  UTPRNU, 0                       /USED BY UTS0 ROUTINE TO HAVE THE PTR TO UFD TABLE WHILE SEARCHING
  684 10110 0000  CFH,    0                       /THIS LOCATION IS USED FOR TEMP STORAGE BY MANY ROUTINES
  685 10111 2075  ACC01,  ACT01                   /SEE IF CALLING USER IS ACCOUNT 1
  686 10112 4643  BASCO1, BASCO0                  /SEE IF THE FILE IS BASIC
  687 10113 0000  BASSWT, 0                       /SWITCH FOR BASIC
  688 10114 0010  C0010,  10
  689 10115 7700  C7700,  7700
  690 10116 7730  BASWIN, WINBAS                  /FIELD 1 ADDRESS OF BASIC WINDOW
  691 10117 4716  BAS1A,  BAS0                    /CREATES A BASIC WINDOW
  692 10120 0000  SEGLIM, 0
  693             REWNDC,
  694 10121 0000  REL6,   0
  695             
  696             
  697             
  698 10122 0000  FIOSTK, 0                       /STACK HOLDING IOT LINKAGE
  699 10123 0000          0
  700 10124 0000          0
  701 10125 0000          0
  702 10126 0000          0
  703 10127 0000          0
  704 10130 0000          0
  705 10131 0000          0
  706             
  707 10132 0000  FLPARB, 0                       /TABLE FOR READ OR WRITE PARAMETER CONSTRUCTION
  708 10133 0000          0
  709 10134 0000          0
  710 10135 0000          0
  711 10136 0000          0
  712 10137 0000          0
  713 10140 5171          OVERLA
  714 10141 0000          0
  715             
  716             /ROUTINE TO RELEASE FREE BLOCK, (IF ANY), IF IT IS
  717             /NECESSARY TO ABORT FIP FOR SOME REASON.
  718 10142 1122  RETURN, TAD     FIOSTK          /GET THE IOT THAT BROUGHT US HERE
  719 10143 7040          CMA                     /IS THERE A PARAMETER BLOCK?
  720 10144 0154          AND     C4010
  721 10145 7640          SZA CLA
  722 10146 5455          JMP I   FIEXIT          /NONE, OK TO EXIT
  723 10147 6211          DATFLD
  724 10150 1422          TAD I   FIOPTR          /GET THE BLOCK
  725 10151 4403          JMS I   RETBK1          /RETURN IT SO IT WON'T BE LOST FOREVER
  726 10152 7200          CLA
  727 10153 5455          JMP I   FIEXIT          /NOW IT'S OK TO LEAVE
  728             
  729 10154 4010  C4010,  4010                    /MASK FOR FINF AND WHO

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 17


  730             
  731             /FILE PHANTOM START
  732             /FIP'S FIRST JOB IS TO PICK UP THE IOT WHICH IT IS TO PERFORM
  733             /AND THE PARAMETERS WHICH GO ALONG WITH IT (IF ANY). THESE
  734             /ARE MOVED INTO AN 8-WORD BLOCK CALLED 'FIOSTK.' THE FIRST REG-
  735             /ISTER IN THIS BLOCK CONTAINS THE IOT, PARAMETERS FOLLOW
  736       0200  *200
  737             
  738 10200 7301  FIP0,   CLL CLA IAC
  739 10201 3026          DCA     BUFMOD          /MARK BUFFER AS NOT MODIFIED
  740 10202 3027          DCA     SATSTA          /CLEAR SAT STATUS
  741 10203 3030          DCA     TABSTA          /CLEAR TABLE STATUS
  742 10204 1025          TAD     BUFSTA          /IS THERE VALID DATA IN THE BUFFER?
  743 10205 7640          SZA CLA
  744 10206 7001          IAC                     /YES; RE-CALCULATE DISK PARAMETERS IF NEEDED
  745 10207 3025          DCA     BUFSTA
  746 10210 6201          6201                    /CDF FIELD ZERO
  747 10211 1560          TAD I   JOB             /GLOBAL TO "JOB"
  748 10212 0074          AND     P0037
  749 10213 3021          DCA     FIJOB           /SAVE IT
  750 10214 6221          CFLD
  751 10215 4470          FGETJT                  /SAVE USER AC
  752 10216 0013          JOBREG+2
  753 10217 3020          DCA     FIUSAC          /ADDRESS OF USER'S AC
  754 10220 4470          FGETJT
  755 10221 0007          JOBLNK                  /IOT REQUEST WORD
  756 10222 3022          DCA     FIOPTR          /POINTER TO IOT LINKAGE
  757 10223 6211          DATFLD
  758 10224 1420          TAD I   FIUSAC
  759 10225 3020          DCA     FIUSAC          /USER'S AC
  760 10226 1422          TAD I   FIOPTR          /PICK UP LINKAGE
  761 10227 0333          AND     IC7400          /IS IT AN IOT? (IF IT IS, JOBLNK WILL HAVE BITS 0-3 CLEARED)
  762 10230 7650          SNA CLA
  763 10231 5302          JMP     FIP2            /IS AN IOT, SO GO MOVE IT INTO FIOSTK (AC IS PARAMETER)
  764 10232 1422          TAD I   FIOPTR          /IS A POINTER, PICK UP LINKAGE
  765 10233 3240          DCA     FIP6            /POINTER TO LINKAGE TABLE
  766 10234 6221          CFLD
  767 10235 6202          6202                    /CIF FIELD 0
  768 10236 4567          BLT                     /MOVE IOT PARAMETERS INTO FIOSTK
  769 10237 6211          DATFLD
  770 10240 0000  FIP6,   0
  771 10241 6221          6221                    /CDF THIS FIELD
  772 10242 0122          FIOSTK                  /IOT LINKAGE BUFFER
  773 10243 7770          -10
  774 10244 1122          TAD     FIOSTK
  775 10245 7710          SPA CLA                 /WILL THE IOT PARAMETER BLOCK BE NEEDED TO RETURN PARS?
  776 10246 5255          JMP     FIP4            /YES, SO DON'T RETURN IT
  777 10247 1240          TAD     FIP6
  778 10250 4403          JMS I   RETBK1          /RETURN THE IOT PARAMETER BLOCK TO FREE CORE
  779 10251 7300          CLA CLL
  780 10252 6211          DATFLD
  781 10253 3422          DCA I   FIOPTR          /CLEAR JOBLNK TO AVOID CONFUSION LATER
  782 10254 6221          CFLD

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 18


  783             
  784             /COMES HERE WHEN IOT AND ITS PARAMETERS ARE COMFORTABLY
  785             /NESTLED IN FIOSTK
  786 10255 1307  FIP4,   TAD     IOTABL
  787 10256 3332          DCA     FITPTR          /TABLE POINTER
  788 10257 2332  FIP5,   ISZ     FITPTR          /PICK UP IOT FROM TABLE
  789 10260 1732          TAD I   FITPTR
  790 10261 7450          SNA                     /END OF TABLE?
  791 10262 5467          JMP I   LGI201          /DON'T KNOW WHAT TO DO SO PASS BACK AN ERROR AT LEAST
  792 10263 7041          CIA                     /NO
  793 10264 1122          TAD     FIOSTK          /IOT FROM USER
  794 10265 7640          SZA CLA                 /DISPATCH?
  795 10266 5257          JMP     FIP5            /NO
  796 10267 1307          TAD     IOTABL          /YES, FIND PROPER POINTER
  797 10270 7041          CIA
  798 10271 1332          TAD     FITPTR
  799 10272 1331          TAD     IODSPA
  800 10273 3332          DCA     FITPTR
  801 10274 1732          TAD I   FITPTR          /PICK UP DISPATCH ADDRESS
  802 10275 3332          DCA     FITPTR
  803 10276 1122          TAD     FIOSTK          /IS THIS AN IOT WHICH DOES REQUIRE PARAMETERS TO BE
  804                                             /RETURNED IN AN IOT PARAMETER BLOCK?
  805 10277 7700          SMA CLA                 /...IF SO, USER AC CONTAINS A PTR TO WHERE THEY WILL GO
  806 10300 3020          DCA     FIUSAC          /CLEAR USER AC
  807 10301 5732          JMP I   FITPTR          /DISPATCH
  808             
  809             /COMES HERE FOR A "SHORT" IOT. SAVED AC IS ONLY PARAMETER
  810             /PUT IT IN FIOSTK+1
  811 10302 1422  FIP2,   TAD I   FIOPTR          /PICK UP IOT
  812 10303 3122          DCA     FIOSTK          /PLACE ON STACK
  813 10304 1020          TAD     FIUSAC          /USER ACCUMULATOR
  814 10305 3123          DCA     FIOSTK+1        /SIMULATE LINKAGE
  815 10306 5253          JMP     FIP4-2

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 19


  816             
  817 10307 0307  IOTABL, .                       /TABLE OF USER FILE IOT'S
  818 10310 0040          ASD                     /ASSIGN A DEVICE
  819 10311 0042          REL                     /RELEASE A DEVICE
  820 10312 0200          REN                     /RENAME A FILE
  821 10313 0201          OPEN                    /OPEN A FILE
  822 10314 0202          CLOS                    /CLOSE A FILE
  823 10315 6603          RFILE                   /FILE READ (WINDOW MOVE)
  824 10316 0204          PROT                    /FILE PROTECTION
  825 10317 6605          WFILE                   /FILE WRITE (WINDOW MOVE)
  826 10320 0210          CRF                     /CREATE A FILE
  827 10321 0211          EXT                     /EXTEND A FILE
  828 10322 0212          RED                     /REDUCE A FILE
  829 10323 6613          FINF                    /FILE INFORMATION
  830 10324 0214          LIN                     /LOGIN
  831 10325 0215          LOUT                    /LOGOUT
  832 10326 6616          WHO                     /RETURN PASSWORD
  833 10327 0006          SEGS                    /RETURN # OF DISK SEGMENTS AVAILABLE
  834 10330 0000          0
  835             
  836 10331 1156  IODSPA, IODISP-1
  837 10332 0000  FITPTR, 0
  838 10333 7400  IC7400, 7400

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 20


  839             
  840             /ROUTINE TO GET A DIRECTORY ENTRY INTO CORE
  841             
  842             /CALLING SEQUENCE:
  843             /       TAD (INTERNAL FILE NUMBER)
  844             /       JMS GD0
  845             /       RETURN (BUFFER POINTER IN AC, 0=ERROR)
  846             
  847 10334 0000  GD0,    0
  848 10335 4463          JMS I   EBLD0
  849 10336 3351          DCA     GDUFDP
  850 10337 1751          TAD I   GDUFDP          /RELATIVE POSITION IN UFD TABLE
  851 10340 4456          JMS I   BLDP1
  852 10341 3023          DCA     GDRETP          /POINTER TO UFD RETRIEVAL INFORMATION
  853 10342 2351          ISZ     GDUFDP
  854 10343 1751          TAD I   GDUFDP          /PICK UP ENTRY ADDRESS WITHIN UFD
  855 10344 3347          DCA     GD1
  856 10345 1023          TAD     GDRETP
  857 10346 4441          JMS I   GE01            /GET ENTRY INTO CORE
  858 10347 0000  GD1,    0
  859 10350 5734          JMP I   GD0
  860 10351 0000  GDUFDP, 0
  861             
  862 10352 0000  IFN0,   0
  863 10353 1123          TAD     FIOSTK+1
  864 10354 0075          AND     P0003
  865 10355 3123          DCA     FIOSTK+1
  866 10356 5752          JMP I   IFN0
  867             
  868 10357 0000  EBLD,   0
  869 10360 3110          DCA     CFH
  870 10361 1021          TAD     FIJOB
  871 10362 7106          CLL RTL
  872 10363 1110          TAD     CFH
  873 10364 7004          RAL
  874 10365 1034          TAD     ENTTBL
  875 10366 5757          JMP I   EBLD
  876             
  877 10367 0000  WR0,    0                       /WRITE OUT THE CONTENTS OF THE BUFFER
  878 10370 1100          TAD     C0605           /WRITE IOT
  879 10371 3132          DCA     FLPARB          /I/O PARAMETER BLOCK
  880 10372 4445          JMS I   FIO01           /PERFORM THE WRITE
  881 10373 7402          HLT                     /ERROR ON WRITE, TOO BAD
  882 10374 7201          CLA IAC
  883 10375 3026          DCA     BUFMOD          /SET NOT-MODIFIED STATUS
  884 10376 5767          JMP I   WR0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 21


  885             
  886             /ROUTINE TO OPEN A FILE
  887             
  888 10377 4512  OPN0,   JMS I   BASCO1          /IF BASIC SET BASSWT TO -1
  889 10400 3342          DCA     OPENTT          /PTR TO ENTTBL
  890 10401 4464          JMS I   JBLD0           /PROJ PROG # OF THIS JOB IN AC
  891 10402 3262          DCA     PRJPRO          /SAVE PROJ, PROG #
  892 10403 1124          TAD     FIOSTK+2
  893 10404 7450          SNA                     /IF HE OWNS THE FILE THEN FIOSTK+2 IS 0
  894 10405 5234          JMP     OPNOWN          /YES, HE DOES
  895 10406 7041          CIA
  896 10407 1262          TAD     PRJPRO          /IF HE HAS MENTIONED THE PROJ, PROG #
  897 10410 7650          SNA CLA                 /CHECK IF HE IS THE OWNER
  898 10411 5234          JMP     OPNOWN
  899 10412 7240          STA
  900 10413 1124          TAD     FIOSTK+2        /TRYING TO OPEN ACCOUNT 1 FILE?
  901 10414 7640          SZA CLA
  902 10415 5223          JMP     .+6             /NO, OK
  903 10416 1125          TAD     FIOSTK+3        /WHOSE UFD?
  904 10417 7041          CIA
  905 10420 1262          TAD     PRJPRO          /HIS/HER OWN?
  906 10421 7640          SZA CLA
  907 10422 5351          JMP     OPN3            /NO, TELL HIM/HER FILE NOT FOUND
  908 10423 1124          TAD     FIOSTK+2
  909 10424 0115          AND     C7700           /TAKE OUT JUST THE PROJ # OF THE FILE
  910 10425 7041          CIA
  911 10426 1262          TAD     PRJPRO          /DOES IT AGREE WITH JOB'S PROJ #?
  912 10427 0115          AND     C7700
  913 10430 7650          SNA CLA
  914 10431 1075          TAD     P0003           /4 IN AC SAME PROJ #
  915 10432 7101          CLL IAC                 /1 IN AC DIFF PROJ #
  916 10433 5237          JMP     .+4
  917 10434 1262  OPNOWN, TAD     PRJPRO
  918 10435 3124          DCA     FIOSTK+2
  919 10436 1114          TAD     C0010           /10 IN AC IF HE OWNS THE FILE
  920 10437 3262          DCA     PRJPRO          /STORE PROTECTIVE BITS FOR READ CASE
  921 10440 1124          TAD     FIOSTK+2        /PICK UP THE PROJ PROG # OF THE FILE
  922 10441 4452          JMS I   UTS01           /SEARCH OPEN UFD TABLE  RETURN WITH PTR IN AC
  923 10442 5371          JMP     OPN6            /UFD NOT OPEN, GO OPEN IT
  924 10443 3742  OPN2,   DCA I   OPENTT          /SAVE ITS RELATIVE PTR IN ENTTBL
  925 10444 1742          TAD I   OPENTT          /GET RELATIVE ADDRESS OF UFD TBL
  926 10445 4456          JMS I   BLDP1           /BUILD A PTR TO RETTBL ENTRY
  927 10446 3124          DCA     FIOSTK+2        /SAVE IT
  928 10447 4440          JMS I   DS01            /3 WORD SEARCH
  929 10450 0124          FIOSTK+2
  930 10451 5351          JMP     OPN3            /NO SUCH FILE
  931 10452 1014          TAD     P0007           /PTR TO RETRIEVAL ENTRY IN BUFFER
  932 10453 3274          DCA     OPBUFP
  933 10454 2342          ISZ     OPENTT
  934 10455 1405          TAD I   ZDS1            /GET THIS FILE'S DIRECTORY ADDRESS
  935 10456 3742          DCA I   OPENTT          /SAVE IN SECOND WORD OF ENTTBL ENTRY
  936 10457 7146          CLL CMA RTL             /-3 IN AC
  937 10460 1274          TAD     OPBUFP          /PTR TO PROTECTION BIT
  938 10461 4776          JMS I   OPN11A          /CHECK PROTECTION OF THE FILE
  939 10462 0000  PRJPRO, 0
  940 10463 1674          TAD I   OPBUFP          /ADD POINTER TO FIRST RETRIEVAL WINDOW AND
  941 10464 3262          DCA     PRJPRO          /SAVE WITH PROTECTION BIT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 22


  942 10465 1375          TAD     OPNFI0          /JOB STATUS WORD FILE FOR FILE 0
  943 10466 1123          TAD     FIOSTK+1
  944 10467 3277          DCA     OPACSC          /FOR LINKING A BLOCK
  945 10470 1674          TAD I   OPBUFP          /GET RETRIEVAL WINDOW
  946 10471 3274          DCA     OPBUFP          /SAVE IT
  947 10472 1124          TAD     FIOSTK+2
  948 10473 4441          JMS I   GE01            /GET RETRIEVAL WINDOW IN CORE
  949 10474 0000  OPBUFP, 0
  950 10475 3342          DCA     OPENTT          /SAVE THE BUFFER ADDRESS
  951 10476 4470          FGETJT                  /GET THE ADDRESS OF JOB STATUS FOR THIS FILE
  952 10477 0000  OPACSC, 0
  953 10500 3277          DCA     OPACSC          /SAVE POINTER
  954 10501 1277          TAD     OPACSC
  955 10502 4462          JMS I   GTBLO1          /GET A BLOCK LINKED FOR FILE CONTROL
  956 10503 5354          JMP     OPNOT           /NO FREE CORE; CAN'T OPEN THEN
  957 10504 3274          DCA     OPBUFP          /SAVE IT TO BUILD THE FILE CONTROL BLOCK
  958 10505 2113          ISZ     BASSWT
  959 10506 5332          JMP     OPN123
  960 10507 1516          TAD I   BASWIN          /IS BASIC WINDOW ALREADY SET UP?
  961 10510 7001          IAC
  962 10511 7650          SNA CLA                 /YES THEN HAS -1
  963 10512 5315          JMP     OPRET1          /BASIC WINDOW ALREADY LOADED
  964 10513 1342          TAD     OPENTT          /BUFFER ADDRESS OF THE WINDOW
  965 10514 4517          JMS I   BAS1A           /CREATE BASIC WINDOW
  966 10515 1116  OPRET1, TAD     BASWIN          /PUT BASIC WINDOW POINTER IN CONTROL BLOCK
  967 10516 3674          DCA I   OPBUFP
  968 10517 6221  OPRET,  CFLD
  969 10520 7240          CLA CMA                 /ACCESS COUNT IN UFDTBL
  970 10521 1507          TAD I   UTPRNU          /INCREASE BY -1
  971 10522 3507          DCA I   UTPRNU
  972 10523 6211          DATFLD
  973 10524 2274          ISZ     OPBUFP
  974 10525 2274          ISZ     OPBUFP          /POINTS TO PROTECTION BIT
  975 10526 1262          TAD     PRJPRO
  976 10527 3674          DCA I   OPBUFP          /PUT IN THE WRITE PROT BIT CREATED BEFOREHAND
  977 10530 5731          JMP I   .+1             /EXIT AND WRITE OUT TABLES
  978 10531 3165          TABOUT
  979             
  980 10532 1274  OPN123, TAD     OPBUFP          /LINK A BLOCK
  981 10533 4462          JMS I   GTBLO1
  982 10534 5363          JMP     OPN4            /NO FREE CORE, CAN'T OPEN
  983 10535 3344          DCA     OPENTU
  984 10536 6221          CFLD
  985 10537 6202          CIF
  986 10540 4567          BLT
  987 10541 6221          CFLD                    /SOURCE
  988 10542 0000  OPENTT, 0
  989 10543 6211          DATFLD
  990 10544 0000  OPENTU, 0
  991 10545 7770          -10
  992 10546 5317          JMP     OPRET

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 23


  993             
  994 10547 7450  OPN5,   SNA                     /DID THE ACCOUNT EXIST?
  995 10550 5354          JMP     OPNOT           /YES; LACK OF ROOM IN UFDTBL
  996 10551 7332  OPN3,   STL CLA RTR             /NOT FOUND ERROR
  997 10552 1012  OPNPRE, TAD     P2000           /PROTECTED
  998 10553 1012          TAD     P2000
  999 10554 7130  OPNOT,  CLL CML RAR             /NOT OPEN, LACK OF SYSTEM RESOURCES
 1000 10555 3020          DCA     FIUSAC
 1001 10556 1123          TAD     FIOSTK+1
 1002 10557 4463          JMS I   EBLD0           /BE SURE TO REMOVE ALL THE POINTERS PUT IN BY OPEN
 1003 10560 3342          DCA     OPENTT
 1004 10561 3742          DCA I   OPENTT
 1005 10562 5455          JMP I   FIEXIT
 1006             
 1007 10563 1677  OPN4,   TAD I   OPACSC          /CONTROL BLOCK ADDR
 1008 10564 4403          JMS I   RETBK1          /RETURN IT
 1009 10565 6211          DATFLD
 1010 10566 3677          DCA I   OPACSC          /CLEAR POINTER FROM JOB BLOCKS
 1011 10567 6221          CFLD
 1012 10570 5354          JMP     OPNOT           /TELL HIM/HER WE COULDN'T OPEN
 1013             
 1014 10571 1124  OPN6,   TAD     FIOSTK+2        /PICK UP PROJ PROG #
 1015 10572 4451          JMS I   UFO01           /OPEN UFD
 1016 10573 5347          JMP     OPN5            /NO LUCK, ERROR
 1017 10574 5243          JMP     OPN2            /OPENED RELATIVE POSITION IN AC
 1018             
 1019             
 1020 10575 0017  OPNFI0, JOBF0
 1021 10576 4523  OPN11A, OPN11

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 24


 1022             
 1023             
 1024             /ROUTINE TO CLOSE A FILE
 1025             
 1026       0600  *600
 1027             
 1028 10600 3217  CLS0,   DCA     CLSIFN          /INTERNAL FILE NUMBER
 1029 10601 1103          TAD     C7774
 1030 10602 3220          DCA     CLCNTR          /COUNTER FOR BIT SCAN
 1031 10603 1123  CLS1,   TAD     FIOSTK+1        /PICK UP BIT PATTERN
 1032 10604 7004          RAL
 1033 10605 3123          DCA     FIOSTK+1
 1034 10606 7430          SZL
 1035 10607 5214          JMP     CLS3
 1036 10610 2217  CLS2,   ISZ     CLSIFN          /NEXT FILE NUMBER
 1037 10611 2220          ISZ     CLCNTR          /DONE ALL FOUR?
 1038 10612 5203          JMP     CLS1            /NO, KEEP AT IT
 1039 10613 5455          JMP I   FIEXIT          /THROUGH
 1040 10614 1217  CLS3,   TAD     CLSIFN          /PICK UP INTERNAL FILE NUMBER
 1041 10615 4221          JMS     CL0             /CLOSE THE FILE
 1042 10616 5210          JMP     CLS2            /LOOK FOR MORE
 1043             
 1044 10617 0000  CLSIFN, 0
 1045 10620 0000  CLCNTR, 0
 1046             
 1047             /ROUTINE TO DO ACTUAL FILE CLOSE
 1048 10621 0000  CL0,    0
 1049 10622 4463          JMS I   EBLD0
 1050 10623 3265          DCA     CLENTP
 1051 10624 1110          TAD     CFH
 1052 10625 4404          JMS I   LNK01           /RETURNS WITH PTR TO FILE CONTROL BLOCK FROM JOB STATUS BLOCK
 1053 10626 7450          SNA
 1054 10627 5261          JMP     CL3             /FILE WAS NOT OPEN
 1055 10630 3264          DCA     CLPARP          /SAVE IT
 1056 10631 3510          DCA I   CFH             /CLEAR POINTER TO FILE CONTROL BLOCK --- INDICATES FILE CLOSED
 1057 10632 6221          CFLD                    /SET DATA FIELD TO THIS FIELD
 1058 10633 1264          TAD     CLPARP          /POINTER TO PARAMETER BLOCK
 1059 10634 4663          JMS I   CLOBA           /PROPERLY CLOSE TESTING FOR BASIC
 1060 10635 3340          DCA     CLO3            /SWITCH SET TO -1 IF BASIC FILE
 1061 10636 7340          CLA CMA CLL
 1062 10637 1665          TAD I   CLENTP          /RELATIVE POINTER TO UFD RETRIEVAL TABLE
 1063 10640 7106          CLL RTL
 1064 10641 7001          IAC
 1065 10642 1032          TAD     UFDTBL
 1066 10643 3266          DCA     CLUFDP          /POINTER TO ACCESS COUNTER
 1067 10644 3665          DCA I   CLENTP          /CLEAR PTR IN ENTTBL TO INDICATE FILE IS CLOSED
 1068 10645 7240          CLA CMA
 1069 10646 3030          DCA     TABSTA          /SET TABLE STATUS TO WRITE OUT
 1070 10647 2666          ISZ I   CLUFDP          /REMOVE THIS JOB FROM ACCESS COUNT IN UFDTBL
 1071 10650 5621          JMP I   CL0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 25


 1072             
 1073             /THIS WAS THE ONLY GUY USING THIS UFD, SO CLOSE IT OUT
 1074 10651 2340          ISZ     CLO3            /IS IT BASIC FILE BEING CLOSED?
 1075 10652 5256          JMP     CL11            /NO, PROCEED FURTHER
 1076 10653 6211          DATFLD                  /YES, JUST ZERO ONE LOC IN FIELD 1
 1077 10654 3516          DCA I   BASWIN
 1078 10655 6221          CFLD
 1079 10656 7240  CL11,   CLA CMA                 /NO ONE IS NOW ACCESSING THIS UFD
 1080 10657 1266          TAD     CLUFDP
 1081 10660 4447          JMS I   TF01            /FREE A TABLE ENTRY
 1082 10661 6221  CL3,    CFLD
 1083 10662 5621          JMP I   CL0
 1084             
 1085 10663 4701  CLOBA,  CLOBAS
 1086 10664 0000  CLPARP, 0
 1087 10665 0000  CLENTP, 0
 1088 10666 0000  CLUFDP, 0
 1089             
 1090             /SKIPS IF NO OTHER USER IS ACCESSING THIS FILE
 1091 10667 0000  ENR0,   0
 1092 10670 1123          TAD     FIOSTK+1
 1093 10671 4463          JMS I   EBLD0
 1094 10672 3300          DCA     ENR1            /PTR INTO ENTTBL
 1095 10673 2300          ISZ     ENR1
 1096 10674 1700          TAD I   ENR1            /GET ADDR IN ENTTBL
 1097 10675 3300          DCA     ENR1
 1098 10676 1023          TAD     GDRETP          /RTABLE
 1099 10677 4704          JMS I   ENS01           /HOW MANY PEOPLE HAVE THIS FILE OPEN?
 1100 10700 0000  ENR1,   0
 1101 10701 7410          SKP                     /FOUND THE SAME FILE OPEN
 1102 10702 2267          ISZ     ENR0            /...ONLY ONE WHO HAS IT OPEN
 1103 10703 5667          JMP I   ENR0
 1104             
 1105 10704 2330  ENS01,  ENS0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 26


 1106             
 1107             /CHANGE THE PROTECTION OF A FILE
 1108             
 1109 10705 1123  PRT0,   TAD     FIOSTK+1        /PICK UP INTERNAL FILE NUMBER
 1110 10706 7012          RTR
 1111 10707 7012          RTR
 1112 10710 7010          RAR
 1113 10711 0075          AND     P0003           /AND OFF PROTECTION BITS
 1114 10712 3340          DCA     PRIFNU          /INTERNAL FILE NUMBER
 1115 10713 1340          TAD     PRIFNU
 1116 10714 4450          JMS I   UC01            /CHECK TO SEE IF USER IS OWNER
 1117 10715 5333          JMP     PRT1            /ERROR RETURN, USER IS NOT OWNER
 1118 10716 4511          JMS I   ACC01           /IS HE UNDER ACCOUNT 1?
 1119 10717 5334          JMP     PRT1+1          /YES; ERROR - HE MUST USE #RENAME#
 1120 10720 1340          TAD     PRIFNU
 1121 10721 4442          JMS I   GD01            /GET THIS DIRECTORY ENTRY INTO CORE
 1122 10722 7450          SNA
 1123 10723 5471          JMP I   DIRBAD          /**************DEBUG*************
 1124 10724 1015          TAD     P0004
 1125 10725 3341          DCA     PRENTP          /POINTER TO PROTECTION BITS OF THIS FILE
 1126 10726 1342          TAD     C7637
 1127 10727 0123          AND     FIOSTK+1        /PICK UP NEW PROTECTION BITS
 1128 10730 3741          DCA I   PRENTP          /RESTORE
 1129 10731 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1130 10732 5455          JMP I   FIEXIT
 1131             
 1132 10733 7640  PRT1,   SZA CLA                 /ERROR
 1133 10734 7130          CLL CML RAR
 1134 10735 7130          CLL CML RAR
 1135 10736 3020          DCA     FIUSAC
 1136 10737 5455          JMP I   FIEXIT
 1137             
 1138             CLO3,
 1139 10740 0000  PRIFNU, 0
 1140 10741 0000  PRENTP, 0
 1141 10742 7637  C7637,  7637

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 27


 1142             
 1143             
 1144 10743 4464  WHO0,   JMS I   JBLD0
 1145 10744 3365          DCA     PAS1
 1146 10745 7040          CMA                     /ONE WORD SEARCH
 1147 10746 4440          JMS I   DS01            /SEARCH THE MFD FOR THIS ACC'T #
 1148 10747 0764          PAS0
 1149 10750 5471          JMP I   DIRBAD          /************DEBUG ONLY***********
 1150 10751 3365          DCA     PAS1
 1151 10752 1765          TAD I   PAS1            /GET ACC'T # FROM UFD FILE NAME BLOCK
 1152 10753 2365          ISZ     PAS1
 1153 10754 3123          DCA     FIOSTK+1        /STORE ACC'T #
 1154 10755 1765          TAD I   PAS1
 1155 10756 2365          ISZ     PAS1
 1156 10757 3124          DCA     FIOSTK+2        /STORE FIRST TWO CHRS OF PASSWORD
 1157 10760 1765          TAD I   PAS1
 1158 10761 3125          DCA     FIOSTK+3        /STORE LAST TWO CHARS OF PASSWORD
 1159 10762 5763          JMP I   PAINF5          /GO STORE THIS INFORMATION FOR RETURN TO MONITOR
 1160             
 1161 10763 2035  PAINF5, INF5
 1162 10764 6525  PAS0,   RTABLE
 1163             PAS1,
 1164 10765 0000  JBLD,   0
 1165 10766 1021          TAD     FIJOB
 1166 10767 1031          TAD     JOBTAB
 1167 10770 6221          CFLD
 1168 10771 3110          DCA     CFH
 1169 10772 1510          TAD I   CFH
 1170 10773 5765          JMP I   JBLD

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 28


 1171             
 1172             /ROUTINE TO MOVE THE RETRIEVAL WINDOW IN FIELD ZERO
 1173       1000  *1000
 1174             
 1175 11000 1124  WND0,   TAD     FIOSTK+2        /PICK UP INTERNAL FILE NUMBER
 1176 11001 0075          AND     P0003           /AND OFF FIELD BITS
 1177 11002 4463          JMS I   EBLD0
 1178 11003 3350          DCA     WNENTP          /POINTER TO RETRIEVAL INFORMATION POINTER
 1179 11004 1750          TAD I   WNENTP
 1180 11005 4456          JMS I   BLDP1           /GENERATE ABSOLUTE PTR INTO RETTBL
 1181 11006 3351          DCA     WNRETP          /RETRIEVAL POINTER
 1182 11007 1131          TAD     FIOSTK+7
 1183 11010 3347          DCA     WNFCBP          /PTR TO THIS FILE'S FILE CONTROL BLOCK
 1184 11011 1127          TAD     FIOSTK+5
 1185 11012 3334          DCA     WND5            /LOW ORDER DISK ADDRESS
 1186 11013 3352          DCA     WNDCNT          /GET INTO CORE
 1187 11014 1354          TAD     WNDCCT          /INITIALIZE COUNT
 1188 11015 3337          DCA     WNDSCT
 1189 11016 1356          TAD     C0177
 1190 11017 0123          AND     FIOSTK+1        /GET HIGH ORDER FILE ADDRESS
 1191 11020 3301          DCA     WNDIRP
 1192 11021 1156          TAD     SEGSIZ          /GET RID OF ADDRESS WITHIN SEGMENT
 1193 11022 7141          CLL CIA
 1194 11023 0334          AND     WND5
 1195 11024 7004          RAL
 1196 11025 1301          TAD     WNDIRP          /NOW HAVE FILE SEGMENT #; NEED TO SHIFT IT
 1197 11026 7410          SKP
 1198 11027 7004          RAL
 1199 11030 2337          ISZ     WNDSCT          /SHIFT SEGCCT TIMES?
 1200 11031 5227          JMP     .-2
 1201 11032 3353          DCA     WNSEGC
 1202 11033 6211          DATFLD                  /WNSEGC NOW HAS SEGMENT NUMBER TO GET
 1203 11034 1747          TAD I   WNFCBP          /PICK UP FIELD 0 WINDOW POINTER
 1204 11035 3303          DCA     WNDPTR          /PNTS TO FILE RETRIEVAL WINDOW FOR THIS FILE
 1205 11036 2347          ISZ     WNFCBP
 1206 11037 1747          TAD I   WNFCBP          /PICK UP NUMBER OF CURRENT SEGMENT IN WINDOW
 1207 11040 3355          DCA     WNCURS          /CURRENT SEGMENT IN WINDOW
 1208 11041 1353          TAD     WNSEGC          /SEGMENT TO GET
 1209 11042 4454          JMS I   WND201          /DIVIDE BY 7 (IGNORE REMAINDER)
 1210 11043 4337          JMS     WND30           /MULTIPLY BY 7
 1211 11044 3353          DCA     WNSEGC          /FIRST SEGMENT IN PROPER WINDOW
 1212 11045 7240          CLA CMA
 1213 11046 1703          TAD I   WNDPTR          /GET FIRST WORD OF FILE RETRIEVAL WINDOW
 1214 11047 7650          SNA CLA                 /=7777?
 1215 11050 5321          JMP     WND6            /INVALID WINDOW POINTER
 1216 11051 1355          TAD     WNCURS          /CURRENT SEGMENT AT TOP OF CURRENT CORE WINDOW
 1217 11052 7041          CIA

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 29


 1218             
 1219             /NOW SEE IF THE SEGMENT BEING SOUGHT IS ONE WHICH FOLLOWS
 1220             /THOSE WHICH ARE PRESENTLY IN THE CORE WINDOW. IF THE
 1221             /SOUGHT BLOCK DOES FOLLOW THE PRESENT ONE, WE CAN LOOK
 1222             /THROUGH THE RETRIEVAL INFORMATION BLOCKS STARTING AT THE ONE
 1223             /NOW IN CORE. OTHERWISE, WE MUST START AT THE VERY BEGINNING
 1224             /OF THE LIST OF FILE RETRIEVAL INFORMATION BLOCKS
 1225 11053 1353          TAD     WNSEGC
 1226 11054 7550          SPA SNA
 1227 11055 5321          JMP     WND6            /PREVIOUS BLOCK, SO MUST START AT BEGINNING OF STRING
 1228 11056 4454          JMS I   WND201          /DIVIDE BY 7
 1229 11057 7041          CIA
 1230 11060 3352          DCA     WNDCNT          /MOVE FORWARD THIS MANY WINDOWS
 1231 11061 1303          TAD     WNDPTR
 1232 11062 3301  WND10,  DCA     WNDIRP
 1233 11063 1701          TAD I   WNDIRP          /PICK UP ADDRESS OF NEXT WINDOW
 1234 11064 6221          CFLD                    /CHANGE TO CURRENT FIELD
 1235 11065 7450          SNA
 1236 11066 5276          JMP     WND13           /END OF STRING
 1237 11067 3272          DCA     WND11
 1238 11070 1351          TAD     WNRETP          /POINTER TO UFD RETRIEVAL INFORMATION
 1239 11071 4441          JMS I   GE01            /GET ENTRY INTO CORE
 1240 11072 0000  WND11,  0
 1241 11073 2352          ISZ     WNDCNT          /HAVE WE MOVED AHEAD ENOUGH BLOCKS?
 1242 11074 5262          JMP     WND10           /NOT PROPER WINDOW, KEEP LOOKING
 1243 11075 3301          DCA     WNDIRP
 1244 11076 6202  WND13,  6202                    /CIF FIELD 0
 1245 11077 4567          BLT
 1246 11100 6221          6221                    /SOURCE FIELD (ALWAYS 2)
 1247 11101 0000  WNDIRP, 0                       /SOURCE
 1248 11102 6211          DATFLD                  /DESTINATION FIELD
 1249 11103 0000  WNDPTR, 0                       /DESTINATION
 1250 11104 7770          -10                     /WORD COUNT
 1251 11105 1352          TAD     WNDCNT          /CORRECT FOR WINDOWS THAT WEREN'T THERE
 1252 11106 4337          JMS     WND30           /MULTIPLY BY 7
 1253 11107 1353          TAD     WNSEGC          /SEGMENT NUMBER OF FIRST IN WINDOW
 1254 11110 6211          DATFLD
 1255 11111 3747          DCA I   WNFCBP          /FILE CONTROL BLOCK POINTER
 1256 11112 2347          ISZ     WNFCBP          /POINT AT PROTECTION WORD IN CONTROL BLOCK
 1257 11113 1747          TAD I   WNFCBP          /GET CURRENT STATUS
 1258 11114 0014          AND     P0007           /SAVE ONLY STATUS BITS
 1259 11115 1272          TAD     WND11           /ADD IN POINTER TO CURRENT RETRIEVAL WINDOW
 1260 11116 3747          DCA I   WNFCBP          /AND SAVE
 1261 11117 5720          JMP I   .+1             /GO SET #JSIOTC# BEFORE EXITING
 1262 11120 2050          INF6
 1263             
 1264 11121 6221  WND6,   CFLD                    /CHANGE TO CURRENT FIELD
 1265 11122 7300          CLA CLL
 1266 11123 1353          TAD     WNSEGC          /SEGMENT TO GET INTO IN CORE WINDOW
 1267 11124 4454          JMS I   WND201          /DIVIDE BY 7
 1268 11125 7040          CMA
 1269 11126 3352          DCA     WNDCNT          /WINDOW NUMBER TO GET INTO CORE
 1270 11127 2350          ISZ     WNENTP
 1271 11130 1750          TAD I   WNENTP          /UFD ENTRY ADDRESS OF OPEN FILE
 1272 11131 3334          DCA     WND5
 1273 11132 1351          TAD     WNRETP          /RETRIEVAL INFORMATION POINTER
 1274 11133 4441          JMS I   GE01            /GET ENTRY INTO CORE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 30


 1275 11134 0000  WND5,   0
 1276 11135 1014          TAD     P0007
 1277 11136 5262          JMP     WND10
 1278             
 1279             /ROUTINE TO MULTIPLY A NUMBER BY 7
 1280             
 1281             WNDSCT,
 1282 11137 0000  WND30,  0
 1283 11140 3110          DCA     CFH
 1284 11141 1110          TAD     CFH
 1285 11142 7104          CLL RAL
 1286 11143 1110          TAD     CFH
 1287 11144 7104          CLL RAL
 1288 11145 1110          TAD     CFH
 1289 11146 5737          JMP I   WND30
 1290             
 1291 11147 0000  WNFCBP, 0
 1292 11150 0000  WNENTP, 0
 1293 11151 0000  WNRETP, 0
 1294 11152 0000  WNDCNT, 0
 1295 11153 0000  WNSEGC, 0
 1296 11154 7773  WNDCCT, 7773
 1297 11155 0000  WNCURS, 0
 1298 11156 0177  C0177,  177
 1299             
 1300             
 1301             IODISP,
 1302 11157 3600          ASD1
 1303 11160 2747          REL1
 1304 11161 4000          REN0
 1305 11162 0377          OPN0
 1306 11163 0600          CLS0
 1307 11164 1000          WND0
 1308 11165 0705          PRT0
 1309 11166 1000          WND0
 1310 11167 1200          CRF0
 1311 11170 1400          EXT0
 1312 11171 1600          RED0
 1313 11172 2000          INF0
 1314 11173 2103          LGI0
 1315 11174 3065          LGO0
 1316 11175 0743          WHO0
 1317 11176 4041          SEGS0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 31


 1318             
 1319       1200  *1200
 1320             
 1321             /ROUTINE TO CREATE A NEW FILE
 1322             
 1323 11200 1123  CRF0,   TAD     FIOSTK+1
 1324 11201 7650          SNA CLA
 1325 11202 5356          JMP     CRF30
 1326 11203 4464          JMS I   JBLD0
 1327 11204 4452          JMS I   UTS01           /SEARCH THE UFD TABLE
 1328 11205 5471          JMP I   DIRBAD          /***************DEBUG**************
 1329 11206 4456          JMS I   BLDP1           /BUILD A PTR TO RETTBL
 1330 11207 3122          DCA     FIOSTK          /MAKE A LINKAGE FOR DIRECTORY SEARCH
 1331 11210 4511          JMS I   ACC01           /IS IT ACCOUNT 1?
 1332 11211 7040          CMA                     /YES; MAKE IT A ONE WORD SEARCH
 1333 11212 4440          JMS I   DS01            /SEARCH THE DIRECTORY FOR THIS NAME
 1334 11213 0122          FIOSTK                  /POINTER TO SEARCH PARAMETERS
 1335 11214 5240          JMP     CRF2            /COULD NOT FIND THIS NAME, CONTINUE
 1336 11215 3376          DCA     CRBUFP          /FOUND A FILE OF THIS NAME IN UFD. PTR INTO CRBUFP
 1337 11216 4511          JMS I   ACC01           /SEE IF THIS IS ACCOUNT 1
 1338 11217 5356          JMP     CRF30           /CAN'T DELETE UFD'S AS THOUGH THEY ARE FILES
 1339 11220 1405          TAD I   ZDS1            /POINTER TO "DS1"=ADDR WITHIN UFD WHERE THIS FILE NAME'S BLOCK IS
 1340 11221 3224          DCA     CRF11           /UFD ADDRESS OF DIRECTORY ENTRY
 1341 11222 1122          TAD     FIOSTK
 1342 11223 4772          JMS I   CRENS           /SEARCH ENT TABLE FOR ACCESSES TO THIS FILE
 1343 11224 0000  CRF11,  0                       /UFD ADDR OF DIRECTORY ENTRY
 1344 11225 5357          JMP     CRF10           /ERROR, FILE IS OPEN
 1345             /COMES HERE IF A FILE BY THIS NAME ALREADY EXISTS, BUT NO ONE HAS OPENED IT
 1346 11226 1224          TAD     CRF11
 1347 11227 3771          DCA I   CRGD11          /GD1
 1348 11230 1122          TAD     FIOSTK
 1349 11231 3023          DCA     GDRETP
 1350 11232 1376          TAD     CRBUFP          /PTR TO WHERE IN CORE BUFFER THE UFD BLOCK FOR THIS FILE IS
 1351 11233 4773          JMS I   SAVCRA          /DELETE THE EXISTING FILE OF THIS NAME
 1352 11234 4440          JMS I   DS01            /SEARCH THE UFD FOR AN EXISTING FILE OF THE SAME NAME
 1353 11235 0122          FIOSTK
 1354 11236 7410          SKP                     /NONE THERE, SO OKAY TO CREATE ONE
 1355 11237 5471          JMP I   DIRBAD          /**************DEBUG ONLY**********

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 32


 1356             
 1357             /NOW ALL SET TO CREATE THE FILE. TO DO THIS, WE NEED TWO BLOCKS OF
 1358             /THE UFD -- ONE FOR A NAME BLOCK AND THE SECOND FOR A FILE RETRIEVAL INFORMATION
 1359             /BLOCK. THESE BLOCKS ARE OBTAINED BY TWO CALLS TO DE0. AFTER THE FIRST,
 1360             /A DUMMY 7777 IS PUT IN THE FOUND BLOCK TO PREVENT THE SECOND CALL
 1361             /TO DE0 FROM FINDING THE SAME BLOCK. IF BOTH BLOCKS CANNOT BE OBTAINED,
 1362             /THE CREATE CANNOT BE EXECUTED.
 1363 11240 3324  CRF2,   DCA     CRLINK          /ADDR OF LINK WORD OF LAST ENTRY IN UFD CHAIN
 1364 11241 2107          ISZ     UTPRNU          /POINTS AT LOGIN DISK QUOTA
 1365 11242 1507          TAD I   UTPRNU          /-SEGMENTS ALLOWED WHILE LOGGED IN
 1366 11243 1120          TAD     SEGLIM          /PLUS NUMBER OF SEGMENTS FOUND WHILE SEARCHING HIS/HER DIRECTORY
 1367 11244 2107          ISZ     UTPRNU          /POINT AT HOLD REG FOR SEGMENT COUNT
 1368 11245 7700          SMA CLA                 /IS HE ALLOWED ONE MORE?
 1369 11246 5351          JMP     CRF1            /NO; TELL HIM/HER DIRECTORY FULL
 1370 11247 1122          TAD     FIOSTK          /POINTER TO RETRIEVAL INFORMATION
 1371 11250 4437          JMS I   DE01            /FIND AN EMPTY DIRECTORY ENTRY
 1372 11251 5351          JMP     CRF1            /ERROR, NO AVAILABLE ENTRIES
 1373 11252 3365          DCA     CRF4            /ADDRESS OF THIS ENTRY
 1374 11253 4362          JMS     CRF40           /GET THIS ENTRY INTO CORE
 1375 11254 7240          CLA CMA
 1376 11255 3776          DCA I   CRBUFP          /SIMULATE A USED ENTRY
 1377 11256 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1378 11257 1122          TAD     FIOSTK
 1379 11260 4437          JMS I   DE01            /FIND ANOTHER ENTRY
 1380 11261 5346          JMP     CRF51           /ERROR
 1381 11262 3265          DCA     CRF3
 1382 11263 1122          TAD     FIOSTK
 1383 11264 4441          JMS I   GE01            /MAKE SURE SECOND ENTRY IS IN CORE
 1384 11265 0000  CRF3,   0
 1385 11266 3010          DCA     INDEX
 1386 11267 4446          JMS I   SATL1           /FIND A FREE SEGMENT IN THE SAT
 1387 11270 7450          SNA
 1388 11271 5343          JMP     CRF20           /COULD NOT FIND A FREE SEGMENT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 33


 1389             
 1390             /AT THIS POINT, WE HAVE A DISC SEGMENT AND TWO BLOCKS FROM THE
 1391             /UFD. THIS IS ALL THAT IS NEEDED, SO GO AHEAD AND EXECUTE THE CREATE
 1392 11272 3224          DCA     CRF11           /SAVE SEGMENT NUMBER
 1393 11273 1224          TAD     CRF11
 1394 11274 3410          DCA I   INDEX           /PUT IT IN THE FIRST BLOCK OF RETRIEVAL
 1395 11275 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1396 11276 4362          JMS     CRF40           /GET FIRST FOUND ENTRY INTO CORE
 1397 11277 1123          TAD     FIOSTK+1        /TRANSFER FILE NAME INTO DIRECTORY ENTRY
 1398 11300 3776          DCA I   CRBUFP
 1399 11301 1376          TAD     CRBUFP          /MOVE POINTER TO AUTO-INDEX
 1400 11302 3010          DCA     INDEX
 1401 11303 1124          TAD     FIOSTK+2
 1402 11304 3410          DCA I   INDEX
 1403 11305 1125          TAD     FIOSTK+3
 1404 11306 3410          DCA I   INDEX
 1405 11307 3410          DCA I   INDEX           /ZERO LINK (THIS IS THE LAST FILE)
 1406 11310 1370          TAD     CRPROT          /PICK UP PROTECTION BITS
 1407 11311 3410          DCA I   INDEX           /STORE INITIAL PROTECTION CODE
 1408 11312 4775          JMS I   CRFUFA          /GO SEE IF WE'RE CREATING A NEW ACCOUNT
 1409 11313 6201          CDF                     /CDF FIELD 0
 1410 11314 1566          TAD I   DATE            /GLOBAL TO DATE
 1411 11315 6221          CFLD                    /CHANGE TO CURRENT FIELD
 1412 11316 3410  CRFUFR, DCA I   INDEX           /STORE DATE OF CREATION
 1413 11317 1265          TAD     CRF3            /POINTER TO RETRIEVAL
 1414 11320 3410          DCA I   INDEX           /SET UP PTR TO RETRIEVAL INFORMATION
 1415 11321 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1416 11322 1122          TAD     FIOSTK          /GET LAST ENTRY ON STRING INTO CORE
 1417 11323 4441          JMS I   GE01
 1418 11324 0000  CRLINK, 0
 1419 11325 3376          DCA     CRBUFP          /PTR TO WHERE THE PRESENT LAST ENTRY IS
 1420 11326 1365          TAD     CRF4
 1421 11327 3776          DCA I   CRBUFP
 1422 11330 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1423 11331 4511          JMS I   ACC01           /IS HE CREATING A NEW UFD?
 1424 11332 5340          JMP     CRFUFZ          /YES
 1425 11333 7001          IAC
 1426 11334 1120  CRFSEG, TAD     SEGLIM          /STORE SEGMENT COUNT IN THE UFDTBL
 1427 11335 3507          DCA I   UTPRNU
 1428 11336 5737          JMP I   .+1             /REMEMBER TO WRITE OUT THE TABLES
 1429 11337 3165          TABOUT
 1430             
 1431 11340 1224  CRFUFZ, TAD     CRF11
 1432 11341 4774          JMS I   SCL01           /WRITE OUT DIRECTORY BLOCK & CLEAR NEW UFD BLBOCK
 1433 11342 5455          JMP I   FIEXIT          /DON'T MODIFY THE MFD'S ENTRY IN THE UFDTBL

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 34


 1434             
 1435 11343 7132  CRF20,  STL RTR                 /DISK FULL
 1436 11344 7132          STL RTR
 1437 11345 3020          DCA     FIUSAC          /SAVE PARTIAL ERROR CODE
 1438 11346 4362  CRF51,  JMS     CRF40           /GET FIRST ENTRY BACK AGAIN
 1439 11347 3776          DCA I   CRBUFP          /ZERO OUT THE -1 WE PUT THERE
 1440 11350 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1441 11351 7332  CRF1,   CLA CLL CML RTR
 1442 11352 7130          CLL CML RAR
 1443 11353 1020          TAD     FIUSAC          /GET PARTIAL ERROR CODE
 1444 11354 3020          DCA     FIUSAC          /SAVE ERROR CODE; EITHER DISK FULL OR DIRECTORY FULL
 1445 11355 5334          JMP     CRFSEG          /GO SAVE SEGMENT COUNT ANYWAY
 1446 11356 7332  CRF30,  CLA CLL CML RTR
 1447 11357 1104  CRF10,  TAD     C4400
 1448 11360 3020          DCA     FIUSAC          /SAVE ERROR CODE; EITHER FILE IN USE OR BAD FILE NAME
 1449 11361 5455          JMP I   FIEXIT
 1450             
 1451 11362 0000  CRF40,  0
 1452 11363 1122          TAD     FIOSTK
 1453 11364 4441          JMS I   GE01
 1454 11365 0000  CRF4,   0
 1455 11366 3376          DCA     CRBUFP
 1456 11367 5762          JMP I   CRF40
 1457             
 1458             
 1459 11370 0012  CRPROT, 12
 1460 11371 0347  CRGD11, GD1
 1461 11372 2330  CRENS,  ENS0
 1462 11373 3540  SAVCRA, SAVCRE
 1463 11374 1755  SCL01,  SCL0
 1464 11375 3556  CRFUFA, CRFUFD
 1465 11376 0000  CRBUFP, 0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 35


 1466             
 1467             /ROUTINE TO EXTEND A FILE
 1468             
 1469       1400  *1400
 1470             
 1471 11400 4331  EXT0,   JMS     EXT1            /MAKE SURE IT'S OKAY TO EXTEND THIS FILE
 1472 11401 1014          TAD     P0007           /...EXT1 RETURNS WITH PTR TO NAME BLOCK FOR THIS FILE
 1473 11402 3325          DCA     EXBUFP          /SAVE POINTER TO RETRIEVAL CHAIN
 1474 11403 4722          JMS I   EXTQUA          /CHECK THE DISK QUOTA FOR THIS USER
 1475             /NOW TRACE THROUGH TO LAST RETRIEVAL INFORMATION BLOCK FOR THIS FILE
 1476 11404 1725  EXT4,   TAD I   EXBUFP
 1477 11405 7450          SNA                     /END OF CHAIN?
 1478 11406 5214          JMP     EXT3            /YES
 1479 11407 3326          DCA     EXWNDP          /WINDOW POINTER
 1480 11410 1326          TAD     EXWNDP
 1481 11411 4306          JMS     EXGE0           /GET WINDOW INTO CORE
 1482 11412 3325          DCA     EXBUFP          /SAVE POINTER TO NEXT RETRIEVAL WINDOW
 1483 11413 5204          JMP     EXT4            /KEEP LOOKING FOR END
 1484             
 1485 11414 1105  EXT3,   TAD     C7771
 1486 11415 3331          DCA     EXT1            /7 SEGS PER WINDOW
 1487 11416 2325  EXT5,   ISZ     EXBUFP
 1488 11417 1725          TAD I   EXBUFP          /PICK UP ENTRY IN WINDOW
 1489 11420 7650          SNA CLA                 /IS IT THE FIRST FREE?
 1490 11421 5302          JMP     EXT7            /YES, FIND A SEGMENT
 1491 11422 2331          ISZ     EXT1            /END OF WINDOW?
 1492 11423 5216          JMP     EXT5            /NO, KEEP LOOKING
 1493 11424 1023  EXT9,   TAD     GDRETP          /RETRIEVAL POINTER
 1494 11425 4437          JMS I   DE01            /FIND AN EMPTY ENTRY
 1495 11426 5261          JMP     EXT20           /PARTIALLY SATISFIED
 1496 11427 3330          DCA     EXNFRE          /FREE SEGMENT ADDRESS
 1497 11430 1326          TAD     EXWNDP          /CURRENT WINDOW POINTER
 1498 11431 4306          JMS     EXGE0           /GET IT INTO CORE
 1499 11432 3325          DCA     EXBUFP
 1500 11433 4446          JMS I   SATL1           /GET A FREE DISK SEGMENT FOR THE NEXT WINDOW
 1501 11434 7450          SNA
 1502 11435 5261          JMP     EXT20           /THERE ARE NONE; AVOID LINKING TO NEXT WINDOW
 1503 11436 3324          DCA     EXPROP          /SAVE UNTIL WINDOWS ARE LINKED UP
 1504 11437 1330          TAD     EXNFRE          /NEXT FREE WINDOW
 1505 11440 3725          DCA I   EXBUFP          /LINK IT ONTO CHAIN
 1506 11441 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1507 11442 1330          TAD     EXNFRE
 1508 11443 3326          DCA     EXWNDP          /UPDATE CURRENT WINDOW POINTER
 1509 11444 1326          TAD     EXWNDP
 1510 11445 4306          JMS     EXGE0           /GET NEW WINDOW INTO CORE
 1511 11446 7001          IAC
 1512 11447 3325          DCA     EXBUFP          /POINTER TO FIRST ENTRY OF NEW WINDOW
 1513 11450 1105          TAD     C7771           /ALLOW 7 ENTRIES IN NEW WINDOW
 1514 11451 3331          DCA     EXT1
 1515 11452 1324          TAD     EXPROP          /GET DISK SEGMENT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 36


 1516             
 1517 11453 3725  EXT12,  DCA I   EXBUFP          /STORE SEGMENT IN RETRIEVAL WINDOW
 1518 11454 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1519 11455 2507          ISZ I   EXQ1            /INCREMENT TOTAL COUNT IN UFDTBL
 1520 11456 2325          ISZ     EXBUFP          /INCR WINDOW POINTER
 1521 11457 2327          ISZ     EXSEGC          /HAVE WE EXTENDED FAR ENOUGH?
 1522 11460 5277          JMP     EXT6            /NO
 1523 11461 1327  EXT20,  TAD     EXSEGC
 1524 11462 7041          CIA
 1525 11463 3020          DCA     FIUSAC          /NUMBER OF SEGMENTS WE FAILED TO FIND
 1526 11464 1123          TAD     FIOSTK+1        /REQUEST IS SATISFIED
 1527 11465 4442          JMS I   GD01            /GET DIRECTORY ENTRY INTO CORE
 1528 11466 1101          TAD     C0005
 1529 11467 3325          DCA     EXBUFP          /POINTER TO SEGMENT COUNT
 1530 11470 1124          TAD     FIOSTK+2        /NUMBER OF WORDS TO BE ADDED
 1531 11471 1725          TAD I   EXBUFP          /NUMBER ALREADY IN FILE
 1532 11472 1327          TAD     EXSEGC          /MINUS NUMBER WE FAILED TO GET
 1533 11473 3725          DCA I   EXBUFP          /UPDATE ENTRY
 1534 11474 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1535 11475 5676          JMP I   .+1             /EXIT AND WRITE OUT TABLES
 1536 11476 3165          TABOUT
 1537             
 1538 11477 2331  EXT6,   ISZ     EXT1            /END OF CURRENT WINDOW?
 1539 11500 7410          SKP                     /NOT YET
 1540 11501 5224          JMP     EXT9            /YES, TRY LINKING TO ANOTHER
 1541 11502 4446  EXT7,   JMS I   SATL1           /GET A FREE SEGMENT FROM SAT
 1542 11503 7450          SNA
 1543 11504 5261          JMP     EXT20           /PARTIALLY SATISFIED
 1544 11505 5253          JMP     EXT12           /SAVE NEW SEGMENT
 1545 11506 0000  EXGE0,  0                       /GET WORD OF THIS UFD INTO CORE
 1546 11507 3312          DCA     EXGE1
 1547 11510 1023          TAD     GDRETP
 1548 11511 4441          JMS I   GE01
 1549 11512 0000  EXGE1,  0
 1550 11513 5706          JMP I   EXGE0
 1551             
 1552 11514 1104  EXT30,  TAD     C4400
 1553 11515 5320          JMP     EXT10+2
 1554             
 1555 11516 7130  EXT10,  CLL CML RAR
 1556 11517 7130          CLL CML RAR
 1557 11520 3020          DCA     FIUSAC
 1558 11521 5455          JMP I   FIEXIT
 1559             
 1560 11522 5242  EXTQUA, EXTQU0
 1561 11523 0000  EXFCBP, 0
 1562 11524 0000  EXPROP, 0
 1563 11525 0000  EXBUFP, 0
 1564 11526 0000  EXWNDP, 0
 1565 11527 0000  EXSEGC, 0
 1566 11530 0000  EXNFRE, 0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 37


 1567             
 1568             /ROUTINE TO SET UP TO ALTER A FILE (BY EITHER EXTENDING IT OR
 1569             /REDUCING IT). CHECK PROTECTION CODE TO SEE IF THIS IS ALLOWED. MAKE SURE
 1570             /NO ONE ELSE HAS THIS FILE OPEN. JMP TO ERROR EXIT ON EITHER OF THESE CON-
 1571             /DITIONS. IF ALL IS OKAY. RETURN WITH PTR TO UFD NAME BLOCK ENTRY
 1572 11531 0000  EXT1,   0
 1573 11532 4466          JMS I   IFN01           /MASK OFF BITS 0-9 OF FIOSTK+1
 1574 11533 1123          TAD     FIOSTK+1        /INTERNAL FILE NUMBER
 1575 11534 4404          JMS I   LNK01           /GET PTR TO APPROPRIATE FILE CONTROL BLOCK
 1576 11535 7450          SNA
 1577 11536 5317          JMP     EXT10+1         /ERROR, FILE NOT OPEN
 1578 11537 3323          DCA     EXFCBP          /FILE CONTROL BLOCK POINTER
 1579 11540 4511          JMS I   ACC01           /AS HE UNDER ACCOUNT1?
 1580 11541 5353          JMP     EXT2            /YES; SKIP PROTECTION CHECK
 1581 11542 1017          TAD     FILPRP          /GLOBAL TO "FILPRO"
 1582 11543 1323          TAD     EXFCBP
 1583 11544 3324          DCA     EXPROP          /POINTER TO PROTECTION BIT
 1584 11545 6211          DATFLD                  /CDF FIELD 1
 1585 11546 1724          TAD I   EXPROP          /PICK UP PROTECTION BIT
 1586 11547 6221          CFLD                    /CHANGE TO CURRENT FIELD
 1587 11550 0015          AND     P0004           /STRAIN OFF ANY EXTRANEOUS BITS
 1588 11551 7640          SZA CLA
 1589 11552 5316          JMP     EXT10           /WRITE PROTECTED
 1590 11553 1123  EXT2,   TAD     FIOSTK+1        /INTERNAL FILE NUMBER
 1591 11554 4442          JMS I   GD01            /GET DIRECTORY ENTRY INTO CORE
 1592 11555 3121          DCA     REL6            /POINTS TO WHERE UFD NAME BLOCK IS IN CORE
 1593 11556 4457          JMS I   ENR01           /IS THIS THE ONLY USER WHO HAS THIS FILE OPEN?
 1594 11557 5314          JMP     EXT30           /NO, SO ABORT AND RETURN ERROR CODE
 1595 11560 1124          TAD     FIOSTK+2        /ARE ANY SEGMENTS INVOLVED?
 1596 11561 7450          SNA
 1597 11562 5455          JMP I   FIEXIT          /NO, NOTHING TO DO THEN
 1598 11563 7041          CIA
 1599 11564 3327          DCA     EXSEGC          /SAVE NEGATIVE COUNT
 1600 11565 6211          DATFLD
 1601 11566 1723          TAD I   EXFCBP          /GET POINTER TO CURRENT WINDOW
 1602 11567 3324          DCA     EXPROP
 1603 11570 7001          IAC
 1604 11571 3724          DCA I   EXPROP          /INVALIDATE THE WINDOW
 1605 11572 6221          CFLD
 1606 11573 1121          TAD     REL6
 1607 11574 5731          JMP I   EXT1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 38


 1608             
 1609             /ROUTINE TO REDUCE A FILE
 1610             
 1611       1600  *1600
 1612             
 1613 11600 4647  RED0,   JMS I   EXT11           /MAKE SURE IT'S OKAY TO REDUCE THIS FILE
 1614 11601 3253          DCA     REBUFP          /...IF OKAY, RETURNS WITH PTR TO FILE NAME BLOCK
 1615 11602 4511          JMS I   ACC01           /IS HE UNDER ACCOUNT 1?
 1616 11603 4652          JMS I   REDUFD          /SEE IF HE'S REDUCING A UFD
 1617 11604 1253          TAD     REBUFP
 1618 11605 1101          TAD     C0005
 1619 11606 3375          DCA     RELINK          /NOW POINTS TO NUMBER OF SEGMENTS PRESENTLY IN FILE
 1620 11607 1124          TAD     FIOSTK+2        /SEGMENTS TO BE REMOVED
 1621 11610 7510          SPA                     /IS IT NEGATIVE?
 1622 11611 5216          JMP     RED5            /YES; DELETE THE ENTIRE FILE
 1623 11612 7041          CIA
 1624 11613 1775          TAD I   RELINK
 1625 11614 7540          SMA SZA                 /DELETE THE FILE?
 1626 11615 5224          JMP     RED6            /NO, REDUCE IT
 1627 11616 7300  RED5,   CLA CLL                 /YES, WIPE IT OUT AND CLOSE
 1628 11617 1253          TAD     REBUFP
 1629 11620 4254          JMS     RED1            /WIPE OUT THE FILE NAME BLOCK FROM THE UFD
 1630 11621 1123          TAD     FIOSTK+1        /INTERNAL FILE NUMBER
 1631 11622 4453          JMS I   CL01            /CLOSE THIS FILE SINCE IT NO LONGER EXISTS
 1632 11623 5455          JMP I   FIEXIT
 1633 11624 3775  RED6,   DCA I   RELINK          /UPDATE SEGMENT COUNT
 1634 11625 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1635 11626 1775          TAD I   RELINK
 1636 11627 3110          DCA     CFH
 1637 11630 2375          ISZ     RELINK
 1638 11631 2375          ISZ     RELINK
 1639 11632 1775          TAD I   RELINK
 1640 11633 3375          DCA     RELINK          /POINTER TO FIRST WINDOW ON CHAIN
 1641 11634 1110          TAD     CFH
 1642 11635 4240          JMS     RED40           /WIPE OUT REST OF FILE
 1643 11636 5455          JMP I   FIEXIT
 1644             
 1645 11637 0347  REDGD1, GD1
 1646             
 1647 11640 0000  RED40,  0
 1648 11641 4454          JMS I   WND201          /DIVIDE BY 7
 1649 11642 7040          CMA
 1650 11643 3121          DCA     REWNDC          /NUMBER OF WHOLE WINDOWS WHICH ARE TO REMAIN
 1651 11644 1375          TAD     RELINK          /GET POINTER TO FIRST RETRIEVAL WINDOW
 1652 11645 4651          JMS I   RED302          /ROUTINE TO DO ACTUAL REDUCTION
 1653 11646 5640          JMP I   RED40
 1654             
 1655 11647 1531  EXT11,  EXT1
 1656 11650 4071  LINK01, LINK0
 1657 11651 3652  RED302, RED30
 1658 11652 5334  REDUFD, REDUF0
 1659 11653 0000  REBUFP, 0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 39


 1660             
 1661             /ROUTINE TO DELETE A FILE
 1662             
 1663             UFBUFP,
 1664 11654 0000  RED1,   0
 1665 11655 3253          DCA     REBUFP          /PTR TO THE UFD ENTRY FOR THE FILE
 1666 11656 1253          TAD     REBUFP
 1667 11657 1075          TAD     P0003
 1668 11660 3375          DCA     RELINK          /LINK TO NEXT FILE NAME IN THIS UFD
 1669 11661 1775          TAD I   RELINK
 1670 11662 3303          DCA     RED3
 1671 11663 1637          TAD I   REDGD1          /UFD ADDR OF THIS DIRECTORY ENTRY
 1672 11664 3302          DCA     RED4
 1673 11665 1253          TAD     REBUFP
 1674 11666 1014          TAD     P0007
 1675 11667 3375          DCA     RELINK          /NOW POINTS TO A RETRIEVAL BLOCK FOR THIS FILE
 1676 11670 1775          TAD I   RELINK
 1677 11671 3375          DCA     RELINK
 1678 11672 3653  RED2,   DCA I   REBUFP          /CLEAR OUT FIRST WORD OF ENTRY
 1679 11673 2253          ISZ     REBUFP
 1680 11674 1253          TAD     REBUFP
 1681 11675 0014          AND     P0007
 1682 11676 7640          SZA CLA                 /END OF CURRENT WINDOW?
 1683 11677 5272          JMP     RED2            /NO, KEEP CLEARING
 1684 11700 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1685 11701 4650          JMS I   LINK01
 1686 11702 0000  RED4,   0                       /UFD ADDR OF THIS DIRECTORY ENTRY
 1687 11703 0000  RED3,   0                       /UFD ADDR OF DIRECTORY ENTRY WHICH IS NEXT IN THE CHAIN
 1688 11704 4240          JMS     RED40           /GO WIPE OUT ACTUAL FILE
 1689 11705 5654          JMP I   RED1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 40


 1690             
 1691             /ROUTINE TO EXTEND A UFD
 1692             
 1693             /CALLING SEQUENCE:
 1694             /       TAD (RETRIEVAL POINTER)
 1695             /       JMS UFD0
 1696             /       ERROR RETURN
 1697             /       NORMAL RETURN
 1698             
 1699 11706 0000  UFD0,   0
 1700 11707 3375          DCA     UFRETP          /RETRIEVAL POINTER
 1701 11710 1105          TAD     C7771
 1702 11711 3110          DCA     CFH             /COUNTER FOR OVERSIZE UFD
 1703             /NOW SCAN DOWN THE UFD'S FILE RETRIEVAL BLOCK
 1704 11712 1775  UFD2,   TAD I   UFRETP
 1705 11713 7650          SNA CLA
 1706 11714 5321          JMP     UFD1            /FOUND THE END OF THE LIST OF SEGMENT NUMBERS
 1707 11715 2375          ISZ     UFRETP          /POINT TO NEXT SEGMENT NUMBER
 1708 11716 2110          ISZ     CFH             /UFD ALREADY MAXIMUM SIZE?
 1709 11717 5312          JMP     UFD2            /NO, LOOK AT NEXT WORD
 1710 11720 5706          JMP I   UFD0            /YES, ERROR RETURN
 1711             
 1712             /COMES HERE WHEN IT HAS FOUND THE END OF THE RETRIEVAL BLOCK'S LIST OF SEGMENTS
 1713 11721 4446  UFD1,   JMS I   SATL1           /GET A FREE SEGMENT FROM SAT
 1714 11722 7450          SNA
 1715 11723 5706          JMP I   UFD0            /NO MORE FREE SEGMENTS
 1716 11724 3775          DCA I   UFRETP          /ADD TO RETRIEVAL INFORMATION
 1717 11725 1375          TAD     UFRETP
 1718 11726 4753          JMS I   ENS31           /CONVERT ABS RETTBL PTR TO A RELATIVE ENTRY NUMBER
 1719 11727 7106          CLL RTL                 /...TIMES FOUR
 1720 11730 1032          TAD     UFDTBL          /...PLUS BASE ADDR OF UFDTBL
 1721 11731 3110          DCA     CFH             /POINTER TO PROJ,PROG NUMBER OF FILE OWNER
 1722 11732 1510          TAD I   CFH             /PICK UP PROJ,PROG NUMBER
 1723 11733 4754          JMS I   UFO61           /GO GET THE RETRIEVAL INFO FOR THIS GUY'S UFD INTO CORE
 1724 11734 5471          JMP I   DIRBAD          /*************DEBUG ONLY***********
 1725 11735 3254          DCA     UFBUFP          /PTR TO RETRIEVAL INFORMATION
 1726 11736 2254          ISZ     UFBUFP
 1727 11737 1654          TAD I   UFBUFP
 1728 11740 7640          SZA CLA                 /SCAN TO END OF LIST OF SEGMENT NUMBERS
 1729 11741 5336          JMP     .-3
 1730 11742 1775          TAD I   UFRETP          /GET NUMBER OF NEW SEGMENT
 1731 11743 3654          DCA I   UFBUFP          /PUT IT IN RETRIEVAL BLOCK LIST
 1732 11744 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1733 11745 7240          STA
 1734 11746 3030          DCA     TABSTA          /SET TABLE STATUS TO CHANGE
 1735 11747 1775          TAD I   UFRETP          /NEW SEGMENT NUMBER
 1736 11750 4355          JMS     SCL0            /ZERO OUT THE NEW SEGMENT
 1737 11751 2306          ISZ     UFD0            /SET UP NORMAL RETURN
 1738 11752 5706          JMP I   UFD0
 1739             
 1740 11753 3567  ENS31,  ENS3
 1741 11754 3260  UFO61,  UFO6

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 41


 1742             
 1743             /ROUTINE TO ZERO OUT A DISC SEGMENT
 1744             /IT ZEROES THE CORE BUFFER THEN EXECUTES A CALL
 1745             /TO RD301 (THE ACTUAL READ NEVER HAPPENS).
 1746             /THUS, THE SYSTEM THINKS THAT THE SEGMENT BEING
 1747             /CLEARED IS ACTUALLY IN CORE. IT WILL BE WRITTEN OUT LATER.
 1748 11755 0000  SCL0,   0
 1749 11756 3375          DCA     UFRETP          /SEGMENT NUMBER
 1750 11757 4443          JMS I   WRT1            /MAKE SURE THE BUFFER IS EMPTY
 1751 11760 1377          TAD     P7400
 1752 11761 3110          DCA     CFH             /SET UP COUNTER FOR CLEARING SEGMENT
 1753 11762 1035          TAD     BUFFER
 1754 11763 3254          DCA     UFBUFP
 1755 11764 3654  UFD3,   DCA I   UFBUFP          /START TO CLEAR BUFFER AREA
 1756 11765 2254          ISZ     UFBUFP
 1757 11766 2110          ISZ     CFH
 1758 11767 5364          JMP     UFD3
 1759 11770 7240          STA
 1760 11771 1375          TAD     UFRETP          /SEGMENT NUMBER
 1761 11772 4776          JMS I   SCL11           /NOW FAKE A READ
 1762 11773 3026          DCA     BUFMOD          /SCHEDULE WRITE
 1763 11774 5755          JMP I   SCL0
 1764             RELINK,
 1765 11775 0000  UFRETP, 0
 1766 11776 3372  SCL11,  SCL1
 1767 11777 7400  P7400,  7400

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 42


 1768             
 1769             
 1770             /ROUTINE TO PROVIDE FILE INFORMATION
 1771             
 1772       2000  *2000
 1773             
 1774 12000 4466  INF0,   JMS I   IFN01           /GET INTERNAL FILE NUMBER IN FIOSTK+1
 1775 12001 1123          TAD     FIOSTK+1        /INTERNAL FILE NUMBER
 1776 12002 4463          JMS I   EBLD0
 1777 12003 3110          DCA     CFH             /RELATIVE POINTER TO UFD RETRIEVAL INFORMATION
 1778 12004 1510          TAD I   CFH             /GET PTR TO RETTBL OUT OF ENTTBL
 1779 12005 7450          SNA                     /DOES IT EXIST?
 1780 12006 5267          JMP     INF1            /NO, SO FILE IS NOT OPEN
 1781 12007 7041          CIA
 1782 12010 7146          CLL CMA RTL             /SUBTRACT ONE; MULTIPLY BY FOUR
 1783 12011 1032          TAD     UFDTBL
 1784 12012 3271          DCA     INUFDP          /POINTER TO USER PROJ,PROG NUMBER
 1785 12013 1671          TAD I   INUFDP
 1786 12014 3124          DCA     FIOSTK+2        /SET UP LINKAGE FOR GD0
 1787 12015 1123          TAD     FIOSTK+1        /INTERNAL FILE NUMBER
 1788 12016 4442          JMS I   GD01            /GET DIRECTORY ENTRY FOR THIS FILE INTO CORE
 1789 12017 7041          CIA
 1790 12020 7040          CMA
 1791 12021 3010          DCA     INDEX           /SET UP INDEX REGISTER FOR TRANSFER
 1792 12022 1410          TAD I   INDEX           /OF NAME AND OTHER DIRECTORY INFORMATION
 1793 12023 3125          DCA     FIOSTK+3
 1794 12024 1410          TAD I   INDEX
 1795 12025 3126          DCA     FIOSTK+4
 1796 12026 1410          TAD I   INDEX
 1797 12027 3127          DCA     FIOSTK+5
 1798 12030 2010          ISZ     INDEX
 1799 12031 1410          TAD I   INDEX
 1800 12032 3130          DCA     FIOSTK+6
 1801 12033 1410          TAD I   INDEX
 1802 12034 3131          DCA     FIOSTK+7
 1803 12035 6211  INF5,   DATFLD
 1804 12036 1422          TAD I   FIOPTR          /PICK UP JOBLNK WORD FROM JOB STATUS BLOCK
 1805 12037 3246          DCA     INF4            /DESTINATION IN FIELD 0
 1806 12040 6221          CFLD                    /CHANGE TO PRESENT FIELD
 1807 12041 6202          6202                    /CIF FIELD 0
 1808 12042 4567          BLT                     /MOVE FIOSTK INFORMATION INTO IOT PARAMETER BLOCK
 1809 12043 6221          6221                    /SOURCE FIELD
 1810 12044 0122          FIOSTK                  /SOURCE
 1811 12045 6211          DATFLD                  /DESTINATION FIELD
 1812 12046 0000  INF4,   0                       /DESTINATION
 1813 12047 7770          -10                     /WORD COUNT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 43


 1814             
 1815 12050 6201  INF6,   CDF
 1816 12051 1673          TAD I   OURFLD
 1817 12052 0073          AND     C0200
 1818 12053 7640          SZA CLA
 1819 12054 5455          JMP I   FIEXIT          /WE WERE CALLED BY SI - DON'T SET JSIOTC OR WE'LL GAG
 1820 12055 6211          DATFLD
 1821 12056 1561          TAD I   JOBDAT          /GLOBAL TO "JOBDAT"
 1822 12057 7001          IAC
 1823 12060 3272          DCA     INSPTR          /NOW POINTS TO STATUS WORD
 1824 12061 1274          TAD     INIOTC          /JSIOTC
 1825 12062 7040          CMA
 1826 12063 0672          AND I   INSPTR          /SET JSIOTC TO INDICATE THAT FIP
 1827 12064 1274          TAD     INIOTC          /...IS RETURNING INFORMATION IN THE IOT PAR. BLOCK
 1828 12065 3672          DCA I   INSPTR
 1829 12066 5455          JMP I   FIEXIT          /EXIT
 1830             
 1831 12067 3124  INF1,   DCA     FIOSTK+2
 1832 12070 5235          JMP     INF5
 1833             
 1834 12071 0000  INUFDP, 0
 1835 12072 0000  INSPTR, 0
 1836 12073 7002  OURFLD, CORTBL+1
 1837 12074 0040  INIOTC, 40
 1838             
 1839             
 1840             /ROUTINE TO SKIP IF CALLING USER IS NOT SYSTEM MANAGER
 1841 12075 0000  ACT01,  0
 1842 12076 4464          JMS I   JBLD0           /GET PPN
 1843 12077 7110          CLL RAR
 1844 12100 7640          SZA CLA                 /IS IN ACCOUNT 1?
 1845 12101 2275          ISZ     ACT01           /NO; SKIP ON RETURN
 1846 12102 5675          JMP I   ACT01

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 44


 1847             
 1848             /LOGIN ROUTINE
 1849             
 1850 12103 1033  LGI0,   TAD     RETTBL          /MFD RETRIEVAL IS IN ENTRY 0
 1851 12104 3123          DCA     FIOSTK+1        /SET UP PTR TO RETRIEVAL INFORMATION CONTAINED IN RETTBL
 1852 12105 1124          TAD     FIOSTK+2        /ACCOUNT #0
 1853 12106 7650          SNA CLA
 1854 12107 5344          JMP     LGI20           /UNAUTHORIZED ACCOUNT
 1855 12110 4440          JMS I   DS01            /SEARCH THE MFD (AC=0 TO INDICATE 3-WORD SEARCH)
 1856 12111 0123          FIOSTK+1                /ADDR OF PTR TO RETRIEVAL INFORMATION OF DIRECTORY TO BE SEARCHED
 1857 12112 5344          JMP     LGI20           /COULD NOT FIND ENTRY IN MFD
 1858 12113 3350          DCA     LGMFDP          /OK TO LOG IN - POINTER TO DIRECTORY ENTRY IS IN ACC.
 1859 12114 1124          TAD     FIOSTK+2        /PROJ,PROG NUMBER
 1860 12115 4452          JMS I   UTS01           /SEARCH THE UFD TABLE
 1861 12116 7410          SKP                     /THIS PROJ,PROG NUMBER NOT THERE
 1862 12117 5323          JMP     LGI1            /UFD ALREADY ON TABLE - RETURNS WITH ITS RELATIVE POSITION IN TABLE
 1863 12120 1124          TAD     FIOSTK+2        /PROJ,PROG NUMBER
 1864 12121 4451          JMS I   UFO01           /OPEN THE UFD - I.E. MAKE AN ENTRY IN UFDTBL, RETTBL
 1865 12122 5344          JMP     LGI20           /COULD NOT FIND ROOM ON TABLE
 1866             
 1867 12123 7240  LGI1,   CLA CMA
 1868 12124 1507          TAD I   UTPRNU
 1869 12125 3507          DCA I   UTPRNU          /ACCOUNT FOR NEW ENTRY IN ACCESS COUNT
 1870             
 1871             /COMES HERE WHEN THE UFDTBL & RETTBL HAVE BEEN UPDATED
 1872             /TO INCLUDE THIS LOGIN
 1873             
 1874 12126 4470          FGETJT
 1875 12127 0000          JOBSTS
 1876 12130 3351          DCA     LGI3            /ADDRESS OF STR0
 1877 12131 1124          TAD     FIOSTK+2        /ACCOUNT NUMBER?
 1878 12132 0103          AND     C7774           /IS IT LESS THAN 4?
 1879 12133 7650          SNA CLA
 1880 12134 1073          TAD     C0200           /YES - SET ACCOUNT PRIVILEGE BIT
 1881 12135 6211          DATFLD
 1882 12136 3751          DCA I   LGI3            /AND SAVE IT
 1883 12137 4464          JMS I   JBLD0
 1884 12140 7200          CLA
 1885 12141 1124          TAD     FIOSTK+2        /PROJ,PROG NUMBER
 1886 12142 5743          JMP I   .+1
 1887 12143 4603          RESET
 1888             
 1889 12144 6221  LGI20,  CFLD
 1890 12145 7240          CLA CMA                 /COULD NOT LOGIN - RETURN WITH 7777
 1891 12146 3020          DCA     FIUSAC          /INDICATE INABILITY TO LOG IN
 1892 12147 5455          JMP I   FIEXIT
 1893             
 1894 12150 0000  LGMFDP, 0
 1895             
 1896             LGI3,
 1897 12151 0000  GTBLOK, 0                       / VRS: reconstructed from working TSS-8
 1898 12152 3350          DCA     LGMFDP
 1899 12153 6221          CFLD
 1900 12154 1350          TAD     LGMFDP
 1901 12155 6202          CIF 0
 1902 12156 4571          GETBLK
 1903 12157 5751          JMP I   GTBLOK

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 45


 1904 12160 6211          DATFLD
 1905 12161 1750          TAD I   LGMFDP
 1906 12162 2351          ISZ     GTBLOK
 1907 12163 5751          JMP I   GTBLOK
 1908 12164 7640  REN1,   SZA CLA
 1909 12165 7130          CLL CML RAR
 1910 12166 7130          CLL CML RAR
 1911 12167 3020          DCA     FIUSAC
 1912 12170 5455          JMP I   55
 1913 12171 0000  WR1,    0
 1914 12172 1025          TAD     BUFSTA
 1915 12173 1026          TAD     BUFMOD
 1916 12174 7710          SPA CLA
 1917 12175 4461          JMS I   WR01
 1918 12176 5771          JMP I   WR1             / VRS: End reconstruction
 1919             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 46


 1920             
 1921             /DIRECTORY SEARCH
 1922             
 1923             /CALLING SEQUENCE:
 1924             /       CLA OR CIA (3 OR 1 WORD SEARCH)
 1925             /       JMS DS0
 1926             /       POINTER-----------------RETRIEVAL STACK POINTER
 1927             /       RETURN IF NOT FOUND     NA
 1928             /       GOOD RETURN             ME
 1929             /       (POINTER IN AC)         XX
 1930             
 1931       2200  *2200
 1932 12200 0000  DS0,    0
 1933 12201 7650          SNA CLA                 /SKIP IF ONE WORD SEARCH
 1934 12202 7126          CLL CML RTL             /THREE WORD COMPARE
 1935 12203 7040          CMA
 1936 12204 3310          DCA     DSWDNR          /MINUS NUMBER OF WORDS TO COMPARE
 1937 12205 1600          TAD I   DS0             /PICK UP POINTER TO RETRIEVAL INFORMATION
 1938 12206 3311          DCA     DSRETS
 1939 12207 2200          ISZ     DS0
 1940 12210 1315          TAD     DSM160          /SET UP COUNTER ON # ENTRIES CHECKED
 1941 12211 3323          DCA     DSKCNT
 1942 12212 1711          TAD I   DSRETS          /GET RETRIEVAL POINTER
 1943 12213 7041          CIA
 1944 12214 1033          TAD     RETTBL
 1945 12215 7650          SNA CLA
 1946 12216 7240          STA                     /INHIBIT SEGMENT COUNTING OF THE MFD
 1947 12217 3120          DCA     SEGLIM          /ZERO SEGMENT COUNTER
 1948 12220 3223  DS2,    DCA     DS1
 1949 12221 1711          TAD I   DSRETS          /GET PTR TO RETRIEVAL INFORMATION BLOCK
 1950 12222 4441          JMS I   GE01            /GET THE ENTRY INTO CORE
 1951 12223 0000  DS1,    0                       /WORD NUMBER -- I.E. THE ADDR WITHIN THE DIRECTORY
 1952 12224 7450          SNA
 1953 12225 5263          JMP     BADDIR          /FOULED-UP DIRECTORY!
 1954 12226 3312          DCA     DSENTP          /STORE POINTER TO ENTRY
 1955 12227 1101          TAD     C0005
 1956 12230 1312          TAD     DSENTP
 1957 12231 3330          DCA     DSCNTR          /POINTS TO SEGMENT COUNT
 1958 12232 1120          TAD     SEGLIM          /THE TOTAL FOR THIS UFD
 1959 12233 7510          SPA                     /IS IT A UFD?
 1960 12234 5300          JMP     DS4             /NO; SEE IF WE SHOULD RESET THE MFD
 1961 12235 1730          TAD I   DSCNTR          /ADD THIS FILE'S COUNT
 1962 12236 3120          DCA     SEGLIM          /SAVE NEW TOTAL
 1963 12237 1310  DS3,    TAD     DSWDNR          /NUMBER OF WORDS TO COMPARE
 1964 12240 3330          DCA     DSCNTR
 1965 12241 1311          TAD     DSRETS
 1966 12242 3313          DCA     DSOBJT          /POINTER TO OBJECT NAME
 1967 12243 1312          TAD     DSENTP
 1968 12244 3314          DCA     DSENT           /POINTER TO NAME IN BUFFER
 1969 12245 1714  DSCOM2, TAD I   DSENT
 1970 12246 2314          ISZ     DSENT
 1971 12247 7041          CIA
 1972 12250 2313          ISZ     DSOBJT
 1973 12251 1713          TAD I   DSOBJT
 1974 12252 7640          SZA CLA
 1975 12253 5261          JMP     DSCOM1          /NOT FOUND
 1976 12254 2330          ISZ     DSCNTR

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 47


 1977 12255 5245          JMP     DSCOM2          /LOOK AT NEXT WORD OF NAME
 1978 12256 2200          ISZ     DS0             /FOUND THE ENTRY
 1979 12257 1312          TAD     DSENTP          /PICK UP POINTER
 1980 12260 5600          JMP I   DS0             /RETURN
 1981             /THIS ENTRY IS NOT THE ONE WE'RE LOOKING FOR, SO WE MUST
 1982             /GO LOOK AT THE NEXT ONE.  IN THIS ENTRY IS A RELATIVE PTR TO THE NEXT ONE
 1983             /GET IT.
 1984 12261 2323  DSCOM1, ISZ     DSKCNT          /BAD DIRECTORY?
 1985 12262 5267          JMP     DSCOM3          /IT ISN'T BAD AT THIS POINT
 1986 12263 3316  BADDIR, DCA     RESFLG          /CLEAR AC AND RESET FLAG
 1987 12264 1011          TAD     P5400           /YES, INDICATE BAD DIRECTORY AND GET OUT
 1988 12265 3020          DCA     FIUSAC          /ONCE AGAIN, GOODNESS TRIUMPHS OVER EVIL
 1989 12266 5142          JMP     RETURN          /GO CLEAN UP BEFORE ABORTING
 1990 12267 1075  DSCOM3, TAD     P0003           /CREATE POINTER TO NEXT ENTRY
 1991 12270 1312          TAD     DSENTP
 1992 12271 3330          DCA     DSCNTR
 1993 12272 1730          TAD I   DSCNTR
 1994 12273 7440          SZA                     /IS THIS THE END OF THE DIRECTORY CHAIN?
 1995 12274 5220          JMP     DS2             /NO, SO CONTINUE SEARCH
 1996 12275 1075          TAD     P0003
 1997 12276 1223          TAD     DS1
 1998 12277 5600          JMP I   DS0
 1999 12300 1316  DS4,    TAD     RESFLG          /SHOULD WE RESET?
 2000 12301 7640          SZA CLA
 2001 12302 5237          JMP     DS3             /NO
 2002 12303 3730          DCA I   DSCNTR          /CLEAR CPU TIME ACCUMULATOR
 2003 12304 2330          ISZ     DSCNTR
 2004 12305 3730          DCA I   DSCNTR          /CLEAR DEVICE TIME ACCUMULATOR
 2005 12306 3026          DCA     BUFMOD          /REMEMBER TO WRITE IT BACK
 2006 12307 5237          JMP     DS3
 2007 12310 0000  DSWDNR, 0
 2008             ENRETP,
 2009 12311 0000  DSRETS, 0
 2010             ENADDR,
 2011 12312 0000  DSENTP, 0
 2012 12313 0000  DSOBJT, 0
 2013 12314 0000  DSENT,  0
 2014 12315 7617  DSM160, -161                    /-MAXIMUM # FILES USER CAN OWN (+2)
 2015             /RETURN A BLOCK OF FREE CORE
 2016             RESFLG,
 2017 12316 0000  RETBKS, 0
 2018 12317 6221          CFLD
 2019 12320 6202          CIF
 2020 12321 4575          RETBLK
 2021 12322 5716          JMP I   RETBKS
 2022             /RETURN A LINKED LIST OF FREE BLOCKS
 2023             ENTPTR,
 2024             DSKCNT,
 2025 12323 0000  RETBLS, 0
 2026 12324 7450          SNA
 2027 12325 5723          JMP I   RETBLS
 2028 12326 4316          JMS     RETBKS
 2029 12327 5324          JMP     .-3

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 48


 2030             
 2031             /SEARCH ENTTBL FOR OPENINGS TO FILE
 2032             /CALLING SEQUENCE:
 2033             /       TAD (RETRIEVAL POINTER)
 2034             /       JMS ENS0
 2035             /       UFD ADDRESS OF DIRECTORY ENTRY
 2036             /       RETURN - FOUND AN ACCESS
 2037             /       RETURN - FOUND NO ACCESS
 2038             
 2039             DSCNTR,
 2040 12330 0000  ENS0,   0
 2041 12331 4775          JMS I   ENS30
 2042 12332 3311          DCA     ENRETP          /RELATIVE POINTER
 2043 12333 1730          TAD I   ENS0            /GET FILE DIRECTORY ADDRESS
 2044 12334 7041          CIA
 2045 12335 3312          DCA     ENADDR
 2046 12336 2330          ISZ     ENS0            /SKIP PAST ARG
 2047 12337 1034          TAD     ENTTBL
 2048 12340 3323          DCA     ENTPTR
 2049 12341 1311  ENS2,   TAD     ENRETP
 2050 12342 7040          CMA
 2051 12343 1723          TAD I   ENTPTR
 2052 12344 2323          ISZ     ENTPTR
 2053 12345 7640          SZA CLA
 2054 12346 5365          JMP     ENS1            /DIFFERENT UFD ACCESS
 2055 12347 1723          TAD I   ENTPTR          /SAME UFD, SAME FILE?
 2056 12350 1312          TAD     ENADDR
 2057 12351 7640          SZA CLA
 2058 12352 5365          JMP     ENS1            /DIFFERENT FILE
 2059 12353 1122          TAD     FIOSTK          /WHICH IOT BROUGHT US HERE?
 2060 12354 1376          TAD     ENSCRF          /IF IT'S "CRF" ONE MATCH IS ENOUGH
 2061 12355 7650          SNA CLA
 2062 12356 5730          JMP I   ENS0            /IT WAS; GET OUT
 2063 12357 1123          TAD     FIOSTK+1        /FOUND A SIMILAR ENTRY
 2064 12360 4463          JMS I   EBLD0           /SEE IF WE FOUND THE ENTRY FOR
 2065 12361 7040          CMA                     /THE GUY WHO CAUSED THE CALL TO
 2066 12362 1323          TAD     ENTPTR          /ENS0; IF IT IS, IGNORE THIS MATCH
 2067 12363 7640          SZA CLA
 2068 12364 5730          JMP I   ENS0            /FOUND A SIMILAR ENTRY; DIFFERENT ENTTBL ENTRY
 2069 12365 2323  ENS1,   ISZ     ENTPTR
 2070 12366 1323          TAD     ENTPTR
 2071 12367 7041          CIA
 2072 12370 1032          TAD     ENTEND          /END OF ENT TABLE
 2073 12371 7640          SZA CLA
 2074 12372 5341          JMP     ENS2            /KEEP LOOKING
 2075 12373 2330          ISZ     ENS0            /SKIP ON RETURN
 2076 12374 5730          JMP I   ENS0
 2077 12375 3567  ENS30,  ENS3
 2078 12376 7570  ENSCRF, -CRF

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 49


 2079             
 2080             /ROUTINE TO LOOK IN THE SAT FOR A FREE SEGMENT
 2081             
 2082             /CALLING SEQUENCE:
 2083             /       JMS SATLOK
 2084             /       RETURN (SEGMENT NUMBER IN AC, 0=NONE AVAILABLE)
 2085       2400  *2400
 2086 12400 0000  SATLOK, 0
 2087 12401 7344          CLA CMA CLL RAL         /7776
 2088 12402 3261          DCA     SATMSK          /MAKE TWO PASSES OF THE TABLE
 2089 12403 1657          TAD I   SATCNT          /# OF AVAILABLE DISC SEGMENTS
 2090 12404 7450          SNA                     /ARE THERE ANY?
 2091 12405 5600          JMP I   SATLOK          /NO, SO FORGET IT
 2092 12406 7041          CIA
 2093 12407 7040          CMA
 2094 12410 3657          DCA I   SATCNT          /DECREMENT SATCNT
 2095 12411 3260          DCA     SATCT2
 2096 12412 7240          CLA CMA
 2097 12413 3027          DCA     SATSTA          /SET SAT STATUS TO WRITE OUT
 2098             /LOOK FOR A WORD IN SAT TABLE WITH A ZERO BIT IN IT
 2099 12414 1656  SAT1,   TAD I   SATPNT          /GET A WORD FROM SAT TABLE
 2100 12415 7040          CMA
 2101 12416 7640          SZA CLA                 /ARE ALL BITS SET TO ONE?
 2102 12417 5231          JMP     SAT2            /NO, SO WE'VE FOUND A SEGMENT
 2103 12420 2256          ISZ     SATPNT          /WAS THIS THE LAST WORD IN THE SAT TABLE?
 2104 12421 5214          JMP     SAT1            /NO, SO KEEP LOOKING
 2105 12422 1230          TAD     SAT5            /START LOOKING FROM THE BEGINNING
 2106 12423 3256          DCA     SATPNT          /PTR INTO SAT TABLE
 2107 12424 2261          ISZ     SATMSK
 2108 12425 5214          JMP     SAT1            /MAKE 1 MORE PASS
 2109 12426 3657          DCA I   SATCNT          /SOMETHING WRONG.. BETTER AVOID L2Q OVERFLOW
 2110                                             /BY SAYING NO SEGMENTS AVAILABLE
 2111 12427 5600          JMP I   SATLOK
 2112 12430 7252  SAT5,   -SATSIZ+2
 2113             
 2114             /WE FOUND A SAT WORD WITH A ZERO BIT. NOW FIND THAT BIT.
 2115 12431 7130  SAT2,   CLL CML RAR             /4000 INTO ACC.
 2116 12432 3261          DCA     SATMSK
 2117 12433 2260          ISZ     SATCT2
 2118 12434 1656          TAD I   SATPNT          /GET WORD FROM SAT TABLE
 2119 12435 0261          AND     SATMSK          /IS THE BIT CORRESPONDING TO THE ONE IN SATMSK SET?
 2120 12436 7450          SNA
 2121 12437 5242          JMP     SAT3            /NO, SO WE FOUND THE ZERO BIT
 2122 12440 7010          RAR                     /MOVE MASK BIT ONE TO THE RIGHT
 2123 12441 5232          JMP     SAT2+1          /...AND LOOK AT THE NEXT BIT
 2124             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 50


 2125             
 2126             /FOUND THE BIT WITHIN THE WORD - SATCNT INDICATES WHICH ONE IT IS
 2127 12442 1261  SAT3,   TAD     SATMSK
 2128 12443 1656          TAD I   SATPNT
 2129 12444 3656          DCA I   SATPNT          /SET THE BIT IN SATTBL TO INDICATE THAT THIS SEGMENT IS NOW ALLOCATED
 2130 12445 1256          TAD     SATPNT
 2131 12446 1375          TAD     C0526
 2132 12447 3261          DCA     SATMSK
 2133             /NOW CALCULATE THE NUMBER OF THE DISC SEGMENT
 2134             /WHICH CORRESPONDS TO THIS BIT IN THE SAT TABLE
 2135 12450 1261          TAD     SATMSK
 2136 12451 7104          CLL RAL
 2137 12452 1261          TAD     SATMSK
 2138 12453 7006          RTL
 2139 12454 1260          TAD     SATCT2
 2140 12455 5600          JMP I   SATLOK          /EXIT WITH DISC SEGMENT NUMBER IN AC
 2141             
 2142             
 2143 12456 7252  SATPNT, -SATSIZ+2
 2144 12457 7251  SATCNT, -SATSIZ+1
 2145             SATEMP,
 2146 12460 0000  SATCT2, 0
 2147 12461 0000  SATMSK, 0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 51


 2148             
 2149             /ROUTINE TO RELEASE A SEGMENT IN SAT
 2150             
 2151             /CALLING SEQUENCE:
 2152             /       TAD (SEGMENT NUMBER)
 2153             /       JMS SATREL
 2154             
 2155             /DIVIDE SEGMENT NUMBER BY 14 (12 DECIMAL)
 2156             /QUOTIENT INDICATES WHICH WORD IN SAT TABLE CORRESPONDS
 2157             /TO THIS DISC SEGMENT. REMAINDER INDICATES WHICH BIT IN
 2158             /THAT WORD.
 2159 12462 0000  SATREL, 0
 2160 12463 1012          TAD     P2000           /SUBTRACT 14 X 400
 2161 12464 7430          SZL                     /WAS THE SEGMENT THAT BIG?
 2162 12465 5270          JMP     .+3             /YES
 2163 12466 1076          TAD     P6000           /NO, ADD 14 X 400
 2164 12467 7100          CLL                     /UN-DO THE LINK
 2165 12470 7004          RAL                     /SHIFT OUT A BIT OF THE QUOTIENT
 2166 12471 2110          ISZ     CFH
 2167 12472 5263          JMP     SATREL+1        /MORE TO DO YET
 2168 12473 3256          DCA     SATPNT          /REMAINDER IN LINK THRU AC2; QUOTIENT IN AC3 THRU AC11
 2169 12474 1256          TAD     SATPNT
 2170 12475 0162          AND     P7000
 2171 12476 7006          RTL
 2172 12477 7006          RTL
 2173 12500 7040          CMA                     /NEGATE THE REMAINDER
 2174 12501 3260          DCA     SATEMP
 2175 12502 1256          TAD     SATPNT
 2176 12503 0077          AND     P0777           /JUST THE QUOTIENT THIS TIME
 2177 12504 1230          TAD     SAT5
 2178 12505 3256          DCA     SATPNT
 2179 12506 7140          CLL CMA
 2180 12507 7010          RAR
 2181 12510 2260          ISZ     SATEMP          /SET UP A MASK CORRESPONDING TO PROPER BIT
 2182 12511 5307          JMP     .-2
 2183 12512 0656          AND I   SATPNT          /CLEAR SAT TABLE BIT; SEGMENT IS NOW AVAILABLE
 2184 12513 3656          DCA I   SATPNT
 2185 12514 2657          ISZ I   SATCNT          /UPDATE THE AVAILABLE SEGMENTS COUNT
 2186 12515 7340          CLL STA
 2187 12516 3027          DCA     SATSTA          /REMEMBER WE CHANGED THE SAT TABLE
 2188 12517 5662          JMP I   SATREL

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 52


 2189             
 2190             /ACTUAL I/O ROUTINE
 2191             /SET UP ALL I/O PARAMETERS IN #FLPARB#, AND JMS FIPIO
 2192             
 2193 12520 0000  FIPIO,  0
 2194 12521 1016          TAD     FIPFLD
 2195 12522 7010          RAR
 2196 12523 3134          DCA     FLPARB+2        /='S FIELD WE'RE IN TIMES 4
 2197 12524 6201          CDF
 2198 12525 1560          TAD I   JOB
 2199 12526 0156          AND     C0400           /FIP OR SI CORTBL BIT ON?
 2200 12527 7650          SNA CLA
 2201 12530 5333          JMP     .+3             /SI
 2202 12531 1021          TAD     FIJOB
 2203 12532 3555          DCA I   FIPJOB          /FIP - KEEP HIGH PRIORITY ON THE SCHEDULER
 2204 12533 1374          TAD     FIRETP          /POINTER TO FIORET
 2205 12534 3001          DCA     1               /RETURN ADDRESS - SET TO RETURN BELOW WHEN FIP IS RESTARTED
 2206 12535 1346          TAD     FIO3            /GET FIPBLK
 2207 12536 6211          DATFLD
 2208 12537 3773          DCA I   FIUTBA
 2209 12540 6221          CFLD
 2210 12541 6202          CIF 00
 2211 12542 4567          BLT                     /MOVE DISC TRANSFER PARAMETERS INTO FREE BLOCK LINKED TO DSUTBL
 2212 12543 6221          CFLD                    /FIP ALWAYS IN FIELD 2
 2213 12544 0132          FLPARB                  /PARAMETER BLOCK
 2214 12545 6211          DATFLD                  /DESTINATION FIELD
 2215 12546 7720  FIO3,   FIPBLK                  /DESTINATION
 2216 12547 7770          -10                     /WORD COUNT
 2217 12550 6203          CDF CIF 00
 2218 12551 2565          ISZ I   DSBUSY          /GLOBAL TO "DSBUSY"
 2219 12552 5576          WAIT                    /DISK BUSY
 2220 12553 5776          JMP I   OVER            /GO TO FIELD 0 TO INITIATE THE TRANSFER
 2221             
 2222             /MONITOR RETURNS CONTROL HERE AFTER COMPLETING THE TRANSFER
 2223 12554 7200  FIORET, CLA                     /RETURNS FROM DISC I/O COME HERE
 2224 12555 1073          TAD     C0200           /RESET THE FIP STARTING ADDRESS
 2225 12556 3001          DCA     1               /... TO 0200
 2226 12557 4470          FGETJT
 2227 12560 0000          JOBSTS
 2228 12561 6211          DATFLD
 2229 12562 3372          DCA     FIPTR1
 2230 12563 1772          TAD I   FIPTR1          /PICK UP #JOBSTS#
 2231 12564 6221          CFLD                    /CHANGE TO CURRENT FIELD
 2232 12565 1075          TAD     P0003
 2233 12566 0014          AND     P0007           /CHECK ERROR BITS
 2234 12567 7640          SZA CLA
 2235 12570 2320          ISZ     FIPIO           /NO DISC TRANSFER ERROR
 2236 12571 5720          JMP I   FIPIO           /EXIT WITHOUT SKIPPING TO INDICATE DISC TRANSFER ERROR
 2237             
 2238 12572 0000  FIPTR1, 0
 2239 12573 3260  FIUTBA, DSUTBL+4+4
 2240 12574 2554  FIRETP, FIORET
 2241 12575 0526  C0526,  0526
 2242 12576 0562  OVER,   OVRLA1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 53


 2243             
 2244             /ROUTINE TO GET A DIRECTORY WORD INTO CORE
 2245             /CALLING SEQUENCE:
 2246             /       TAD (POINTER TO RETRIEVAL INFORMATION)
 2247             /       JMS GE0
 2248             /       WORD NUMBER
 2249             /       RETURN (BUFFER POINTER IN AC. 0 IF NON-EXISTENT)
 2250             
 2251       2600  *2600
 2252             
 2253 12600 0000  GE0,    0
 2254 12601 3251          DCA     GERETP          /STORE RETRIEVAL INFORMATION POINTER
 2255 12602 1600          TAD I   GE0
 2256 12603 7104          CLL RAL
 2257 12604 7006          RTL
 2258 12605 7006          RTL
 2259 12606 0014          AND     P0007
 2260 12607 1251          TAD     GERETP
 2261 12610 3251          DCA     GERETP
 2262 12611 1651          TAD I   GERETP
 2263 12612 7450          SNA
 2264 12613 5247          JMP     GE3
 2265 12614 7041          CIA
 2266 12615 7040          CMA
 2267 12616 3252          DCA     RDTEMP
 2268             /FILE READ ROUTINE, CHECKS TO SEE IF BUFFER IS FULL.
 2269             /IF SO, IS IT THE SEGMENT WE ARE TRYING TO READ?
 2270             /IF YES, LEAVE. IF NO, WRITE OUT THE BUFFER
 2271             /BEFORE READING THE PROPER SEGMENT.
 2272 12617 1253          TAD     RDCURR          /MAY THE DESIRED SEGMENT ALREADY BE IN THE BUFFER
 2273 12620 7041          CIA
 2274 12621 1252          TAD     RDTEMP
 2275 12622 7650          SNA CLA
 2276 12623 1025          TAD     BUFSTA          /PROBABLY; IS THE DATA STILL VALID?
 2277 12624 7510          SPA
 2278 12625 5242          JMP     RD3             /YES
 2279 12626 7450          SNA                     /MAYBE
 2280 12627 4443          JMS I   WRT1            /WRONG SEGMENT, SO WRITE IT OUT (IF MODIFIED)
 2281 12630 3025          DCA     BUFSTA          /SAVE BUFFER STATUS
 2282 12631 1252          TAD     RDTEMP
 2283 12632 4273          JMS     RD30            /SET UP PARAMETERS FOR A READ OPERATION
 2284 12633 1025          TAD     BUFSTA          /WAS THE CORRECT DATA IN THE BUFFER AFTER ALL?
 2285 12634 7640          SZA CLA
 2286 12635 5242          JMP     RD3             /YES; ONLY NEEDED TO SET THE DISK PARAMETERS
 2287 12636 4445          JMS I   FIO01           /PERFORM THE READ
 2288 12637 5471          JMP I   DIRBAD          /ERROR ON READ
 2289 12640 7001          IAC
 2290 12641 3026          DCA     BUFMOD          /NEW DATA AS YET UNCHANGED
 2291 12642 7240  RD3,    CLA CMA
 2292 12643 3025          DCA     BUFSTA          /SET BUFFER STATUS TO FULL
 2293 12644 1255          TAD     C0377
 2294 12645 0600          AND I   GE0             /ADDRESS WITHIN SEGMENT
 2295 12646 1035          TAD     BUFFER          /CREATE A POINTER
 2296 12647 2200  GE3,    ISZ     GE0
 2297 12650 5600          JMP I   GE0             /RETURN

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 54


 2298             
 2299 12651 0000  GERETP, 0
 2300 12652 0000  RDTEMP, 0
 2301 12653 0000  RDCURR, 0
 2302 12654 7400  K7400,  7400
 2303 12655 0377  C0377,  0377
 2304             
 2305             
 2306             
 2307             /ROUTINE TO DIVIDE A NUMBER BY 7
 2308             /REMAINDER IS LEFT IN WNDREM, PAGE 0
 2309             
 2310 12656 0000  WND20,  0
 2311 12657 3024          DCA     WNDREM
 2312 12660 3110          DCA     CFH
 2313 12661 1024          TAD     WNDREM
 2314 12662 1105  WND24,  TAD     C7771
 2315 12663 7510          SPA
 2316 12664 5267          JMP     WND21
 2317 12665 2110          ISZ     CFH
 2318 12666 5262          JMP     WND24
 2319 12667 1014  WND21,  TAD     P0007
 2320 12670 3024          DCA     WNDREM
 2321 12671 1110          TAD     CFH
 2322 12672 5656          JMP I   WND20
 2323             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 55


 2324             
 2325             /ROUTINE TO SET UP FOR A READ.
 2326             /ENTER WITH SEGMENT NUMBER. THIS IS CONVERTED TO
 2327             /A PHYSICAL DISC ADDRESS.
 2328 12673 0000  RD30,   0
 2329 12674 3253          DCA     RDCURR          /SAVE SEGMENT NUMBER
 2330 12675 1253          TAD     RDCURR
 2331 12676 7112          CLL RTR
 2332 12677 7012          RTR
 2333 12700 3252          DCA     RDTEMP
 2334 12701 1252          TAD     RDTEMP
 2335 12702 7010          RAR
 2336 12703 0254          AND     K7400
 2337 12704 3137          DCA     FLPARB+5
 2338 12705 1252          TAD     RDTEMP
 2339 12706 0255          AND     C0377
 2340 12707 1157          TAD     FIBASE
 2341 12710 7106          CLL RTL
 2342 12711 3133          DCA     FLPARB+1
 2343 12712 6221          CFLD                    /CHANGE TO CURRENT FIELD
 2344 12713 1254          TAD     K7400
 2345 12714 3135          DCA     FLPARB+3        /WORD COUNT (ONE BUFFER)
 2346 12715 7240          CLA CMA
 2347 12716 1035          TAD     BUFFER
 2348 12717 3136          DCA     FLPARB+4        /CORE ADDRESS
 2349 12720 1102          TAD     C0603           /READ IOT
 2350 12721 3132          DCA     FLPARB
 2351 12722 5673          JMP I   RD30

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 56


 2352             
 2353       0156  FIPFIP= C0400
 2354             
 2355             
 2356 12723 3364  FIX301, FIX30
 2357 12724 5600  C5600,  5600
 2358 12725 0000  USENAM, 0                       /CALLED ONLY ONCE BY RE-NAME ROUTINE
 2359 12726 1123          TAD     FIOSTK+1        /TO SEE IF THE NEW NAME EXISTS IN DIRECTORY
 2360 12727 3122          DCA     FIOSTK
 2361 12730 4464          JMS I   JBLD0
 2362 12731 4452          JMS I   UTS01
 2363 12732 5471          JMP I   DIRBAD
 2364 12733 4456          JMS I   BLDP1
 2365 12734 3123          DCA     FIOSTK+1
 2366 12735 4440          JMS I   DS01
 2367 12736 0123          FIOSTK+1
 2368 12737 2325          ISZ     USENAM          /NO FILE OF THIS NAME FOUND - OK TO RENAME
 2369 12740 7200          CLA
 2370 12741 5725          JMP I   USENAM
 2371             
 2372 12742 1315  NUCOR,  CORSRC-2
 2373 12743 7437  C7437,  SWAP LOCK NOTRUN FIP CJOB
 2374 12744 7754  JOBMX,  -JOBMAX
 2375 12745 2724  FIPLOC, FIPLOK
 2376 12746 2423  FIPTIM, TIMFIP
 2377             
 2378 12747 1123  REL1,   TAD     FIOSTK+1        /RELEASE A DEVICE
 2379 12750 7510          SPA                     /DON'T LET THE USER RELEASE CONSOLES
 2380 12751 4460          JMS I   REL01
 2381 12752 7200          CLA
 2382 12753 5455          JMP I   FIEXIT
 2383             
 2384             
 2385 12754 1422  FIX50,  TAD I   FIOPTR
 2386 12755 0156          AND     FIPFIP          /GLOBAL TO "FIP"
 2387 12756 7650          SNA CLA                 /IF FIP BIT IS NOT SET, FIP WAS CALLED BY SI
 2388 12757 5723          JMP I   FIX301          /GET THE SYSTEM INTERPRETER BACK INTO CORE
 2389 12760 1324          TAD     C5600
 2390 12761 0422          AND I   FIOPTR
 2391 12762 3422          DCA I   FIOPTR          /CLEAR OUT THE LOCK BIT
 2392 12763 1344          TAD     JOBMX
 2393 12764 3110          DCA     CFH             /SAVE COUNT OF JOBS TO SCAN
 2394 12765 7126          STL RTL
 2395 12766 1742          TAD I   NUCOR
 2396 12767 7500          SMA
 2397 12770 5374          JMP     FIX51
 2398 12771 3746          DCA I   FIPTIM
 2399 12772 1343          TAD     C7437
 2400 12773 3745          DCA I   FIPLOC
 2401 12774 7200  FIX51,  CLA
 2402 12775 6211          DATFLD
 2403 12776 1021          TAD     FIJOB
 2404 12777 1177          TAD     DEVOVR
 2405 13000 3010          DCA     INDEX

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 57


 2406             
 2407 13001 1010  FIX50L, TAD     INDEX
 2408 13002 1216          TAD     JEND
 2409 13003 7640          SZA CLA
 2410 13004 5207          JMP     .+3
 2411 13005 1177          TAD     DEVOVR
 2412 13006 3010          DCA     INDEX
 2413 13007 1410          TAD I   INDEX
 2414 13010 7440          SZA
 2415 13011 4617          JMS I   FIX5CK
 2416 13012 2110          ISZ     CFH
 2417 13013 5201          JMP     FIX50L
 2418 13014 5615          JMP I   .+1
 2419 13015 4371          FIXOUT
 2420 13016 4670  JEND,   -JOBTBL-JOBMAX
 2421 13017 4357  FIX5CK, FIXSCH
 2422             /ROUTINE TO FREE AN ENTRY ON THE UFD TABLE AND RETTBL
 2423             
 2424             /CALLING SEQUENCE:
 2425             /       TAD (POSITION ON UFDTBL)
 2426             /       JMS TF0
 2427             /       RETURN
 2428             
 2429             
 2430 13020 0000  TF0,    0
 2431 13021 3241          DCA     TFUFDP          /POSITION ON TABLE
 2432 13022 3641          DCA I   TFUFDP          /CLEAR OWNER'S PROJ,PROG NUMBER
 2433 13023 1032          TAD     UFDTBL          /BEGINNING OF TABLE
 2434 13024 7041          CIA
 2435 13025 1241          TAD     TFUFDP
 2436 13026 7112          CLL RTR                 /RELATIVE POSITION ON TABLE
 2437 13027 7001          IAC
 2438 13030 4456          JMS I   BLDP1           /BUILD A PTR TO RETTBL
 2439 13031 3241          DCA     TFUFDP          /POINTER TO RETRIEVAL INFORMATION
 2440 13032 1106          TAD     P7770           /8 WORDS PER ENTRY
 2441 13033 3242          DCA     TFCNTR
 2442 13034 3641  TF1,    DCA I   TFUFDP          /ZERO OUT THE ENTRY
 2443 13035 2241          ISZ     TFUFDP
 2444 13036 2242          ISZ     TFCNTR
 2445 13037 5234          JMP     TF1
 2446 13040 5620          JMP I   TF0
 2447             
 2448 13041 0000  TFUFDP, 0
 2449 13042 0000  TFCNTR, 0
 2450             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 58


 2451             
 2452             /ROUTINE TO CHECK WHETHER THE FILE A USER
 2453             /IS ATTEMPTING TO ACCESS IS HIS/HERS OR SOMEONE ELSE'S.
 2454             
 2455             /CALLING SEQUENCE:
 2456             /       TAD (INTERNAL FILE NUMBER)
 2457             /       JMS UC0
 2458             /       ERROR RETURN (AC=0 IF FILE NOT OPEN)
 2459             /       NORMAL RETURN
 2460             
 2461 13043 0000  UC0,    0
 2462 13044 4463          JMS I   EBLD0
 2463 13045 3263          DCA     UCENTP
 2464 13046 1663          TAD I   UCENTP          /PICK UP ENTRY FOR THIS FILE OF THIS USER'S
 2465 13047 7450          SNA
 2466 13050 5643          JMP I   UC0             /FILE NOT OPEN
 2467 13051 7041          CIA
 2468 13052 7146          CLL CMA RTL             /SUBTRACT ONE; MULTIPLY BY FOUR
 2469 13053 1032          TAD     UFDTBL
 2470 13054 3264          DCA     UCUFDP          /POINTER TO OPEN UFD TABLE
 2471 13055 4464          JMS I   JBLD0
 2472 13056 7041          CIA
 2473 13057 1664          TAD I   UCUFDP
 2474 13060 7450          SNA                     /SKIP IF DIFFERENT
 2475 13061 2243          ISZ     UC0             /CORRECT RETURN
 2476 13062 5643          JMP I   UC0
 2477             
 2478 13063 0000  UCENTP, 0
 2479 13064 0000  UCUFDP, 0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 59


 2480             
 2481             /LOGOUT ROUTINE
 2482             
 2483 13065 4511  LGO0,   JMS I   ACC01           /IS IT FROM ACCOUNT 1?
 2484 13066 1123          TAD     FIOSTK+1        /YES; SEE IF HE WANTS TO RESET
 2485 13067 1021          TAD     FIJOB           /SEE IF HIS/HER AC=JOB
 2486 13070 7650          SNA CLA
 2487 13071 5776          JMP I   LGRESA          /GO CLEAR EVERYBODY'S CPU & DEVICE TIME ACCUMULATORS
 2488 13072 1123          TAD     FIOSTK+1        /DID HE SET HIS/HER AC= TO HIS/HER JOB #?
 2489 13073 7041          CIA
 2490 13074 1021          TAD     FIJOB
 2491 13075 7640          SZA CLA
 2492 13076 5774          JMP I   LGO1A           /NO; SO SEE IF HE WANTS COUNT OF USERS UNDER HIS/HER ACCOUNT
 2493 13077 4402          JMS I   LNS01           /RELEASE ALL HIS/HER DEVICES
 2494 13100 5303          JMP     .+3
 2495 13101 4460          JMS I   REL01
 2496 13102 5277          JMP     .-3             /KEEP GOING
 2497 13103 4453          JMS I   CL01            /CLOSE FILE 0
 2498 13104 7001          IAC
 2499 13105 4453          JMS I   CL01            /CLOSE FILE 1
 2500 13106 7126          CLL CML RTL
 2501 13107 4453          JMS I   CL01            /CLOSE FILE 2
 2502 13110 1075          TAD     P0003
 2503 13111 4453          JMS I   CL01            /CLOSE FILE 3
 2504 13112 4464          JMS I   JBLD0
 2505 13113 3372          DCA     LOSRRI+1        /DELIVER TO CALLING SEQUENCE FOR SEARCH
 2506 13114 1110          TAD     CFH
 2507 13115 3370          DCA     LOJOBP
 2508 13116 7240          CLA CMA
 2509 13117 4440          JMS I   DS01            /FIND MFD ENTRY; 1 WORD SEARCH
 2510 13120 3171          LOSRRI
 2511 13121 5471          JMP I   DIRBAD          /************DEBUG ONLY***********
 2512 13122 1072          TAD     C0006
 2513 13123 3372          DCA     LOSRRI+1        /POINTER TO CP TIME COUNTER
 2514 13124 4470          FGETJT
 2515 13125 0023          JOBRTM                  /JOB RUN TIME IN STATUS
 2516 13126 3130          DCA     FIOSTK+6        /INTS TO LOW ORDER RUN TIME
 2517 13127 6211          DATFLD
 2518 13130 1530          TAD I   FIOSTK+6
 2519 13131 7012          RTR
 2520 13132 7012          RTR
 2521 13133 7012          RTR                     /USE ONLY HIGH ORDER OF LOW ORDER RUN TIME
 2522 13134 0013          AND     P0077
 2523 13135 3131          DCA     FIOSTK+7
 2524 13136 2130          ISZ     FIOSTK+6
 2525 13137 1530          TAD I   FIOSTK+6
 2526 13140 6221          CFLD                    /BACK TO THIS FIELD
 2527 13141 0013          AND     P0077
 2528 13142 7106          CLL RTL
 2529 13143 7006          RTL
 2530 13144 7006          RTL
 2531 13145 1131          TAD     FIOSTK+7
 2532 13146 1772          TAD I   LOSRRI+1
 2533 13147 3772          DCA I   LOSRRI+1        /LOW ORDER TIME UPDATE
 2534 13150 3026          DCA     BUFMOD          /SCHEDULE WRITE
 2535 13151 1770          TAD I   LOJOBP          /PICK UP PROJ,PROG NUMBER
 2536 13152 4452          JMS I   UTS01           /SEARCH UFD TABLE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 60


 2537 13153 5361          JMP     LGO2            /OOPS!! MIGHT AS WELL TRY TO LEAVE GRACEFULLY
 2538 13154 2507          ISZ I   UTPRNU          /REMOVE THIS JOB FROM ACCESS COUNT
 2539 13155 5361          JMP     LGO2
 2540 13156 7240          CLA CMA                 /LAST USER ACCESSING THIS UFD
 2541 13157 1107          TAD     UTPRNU
 2542 13160 4447          JMS I   TF01            /FREE THE UFD TABLE ENTRY
 2543 13161 7200  LGO2,   CLA
 2544 13162 3770          DCA I   LOJOBP          /REMOVE USER FROM JOB TABLE
 2545 13163 1373          TAD     LGO4A           /KLUDGE FIEXIT TO RETURN TO LGO4
 2546 13164 3775          DCA I   LGKLUJ
 2547 13165 7240  TABOUT, CLA CMA
 2548 13166 3030          DCA     TABSTA          /FORCE TABLES OUT
 2549 13167 5455          JMP I   FIEXIT
 2550 13170 0000  LOJOBP, 0
 2551             
 2552 13171 6525  LOSRRI, RTABLE
 2553 13172 0000          0
 2554 13173 4436  LGO4A,  LGO4
 2555 13174 4472  LGO1A,  LGO1
 2556 13175 3442  LGKLUJ, FIX500
 2557 13176 5172  LGRESA, LGRES0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 61


 2558             
 2559             /ROUTINE TO OPEN A UFD
 2560             
 2561             /CALLING SEQUENCE:
 2562             /       TAD (PROJ,PROG NUMBER)
 2563             /       JMS UFO0
 2564             /       ERROR RETURN (AC=0 IF TABLES FULL; OTHERWISE UFD NOT FOUND)
 2565             /       NORMAL RETURN (POSITION ON TABLE IN AC)
 2566             
 2567       3200  *3200
 2568             
 2569 13200 0000  UFO0,   0
 2570 13201 4260          JMS     UFO6            /GO GET THE RETR. INFO FOR THIS GUY'S UFD INTO CORE
 2571 13202 5600          JMP I   UFO0            /COULDN'T GET IT
 2572 13203 3257          DCA     UOBUFP          /POINTER TO RETRIEVAL INFORMATION
 2573 13204 1032          TAD     UFDTBL
 2574 13205 7001          IAC
 2575 13206 3107          DCA     UOUFDP          /UFD TABLE POINTER
 2576             /SEARCH FOR A FREE SLOT IN UFDTBL
 2577 13207 1507  UFO3,   TAD I   UOUFDP
 2578 13210 7650          SNA CLA
 2579 13211 5223          JMP     UFO2            /FOUND A FREE SLOT ON THE TABLE
 2580 13212 1107          TAD     UOUFDP          /THIS SLOT IS OCCUPIED
 2581 13213 1015          TAD     P0004
 2582 13214 3107          DCA     UOUFDP          /NEXT POSITION (ACCES COUNT ENTRY)
 2583 13215 1033          TAD     UFDEND          /ARE WE AT THE END OF THE TABLE
 2584 13216 7040          CMA
 2585 13217 1107          TAD     UOUFDP
 2586 13220 7650          SNA CLA                 /HAVE WE SEARCHED THE WHOLE TABLE?
 2587 13221 5600          JMP I   UFO0            /NO ROOM ON TABLE
 2588 13222 5207          JMP     UFO3            /LOOK AT NEXT SLOT
 2589             
 2590             /COMES HERE WITH UOUFDP POINTING TO A FREE SLOT IN UFDTBL
 2591 13223 7344  UFO2,   CLL STA RAL             /AC=-2
 2592 13224 1107          TAD     UOUFDP          /BACK UP THE POINTER
 2593 13225 3010          DCA     INDEX
 2594 13226 1255          TAD     UFORET+1
 2595 13227 4656          JMS I   UFQUOA          /LOAD THE UFD TABLE
 2596 13230 7240          STA
 2597 13231 1032          TAD     UFDTBL
 2598 13232 7041          CIA
 2599 13233 1010          TAD     INDEX
 2600 13234 7112          CLL RTR
 2601 13235 3260          DCA     UFO6            /RELATIVE POSITION ON TABLE
 2602 13236 1260          TAD     UFO6
 2603 13237 4456          JMS I   BLDP1           /GENERATE A PTR INTO RETTBL
 2604 13240 3254          DCA     UFORET          /RETRIEVAL POINTER
 2605 13241 1105          TAD     C7771
 2606 13242 3110          DCA     CFH             /COUNTER FOR TRANSFER TO TABLE

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 62


 2607             
 2608             /NOW MOVE RETRIEVAL INFORMATION FOR THIS GUY'S
 2609             /UFD INTO RETTBL
 2610 13243 2257  UFO4,   ISZ     UOBUFP
 2611 13244 1657          TAD I   UOBUFP
 2612 13245 3654          DCA I   UFORET
 2613 13246 2254          ISZ     UFORET
 2614 13247 2110          ISZ     CFH             /ENTIRE RETRIEVAL BLOCK TRANSFERRED?
 2615 13250 5243          JMP     UFO4            /NO, KEEP IT UP
 2616 13251 2200          ISZ     UFO0            /YES, PREPARE FOR NORMAL RETURN
 2617 13252 1260          TAD     UFO6            /PICK UP RELATIVE POSITION
 2618 13253 5600          JMP I   UFO0
 2619             
 2620 13254 0000  UFORET, 0
 2621 13255 0000          0
 2622 13256 4116  UFQUOA, UFQUOT
 2623       0107  UOUFDP= UTPRNU
 2624 13257 0000  UOBUFP, 0
 2625             
 2626             
 2627 13260 0000  UFO6,   0
 2628 13261 3255          DCA     UFORET+1        /SET UP CALLING SEQUENCE FOR MFD SEARCH
 2629 13262 1033          TAD     RETTBL
 2630 13263 3254          DCA     UFORET
 2631 13264 7040          CMA
 2632 13265 4440          JMS I   DS01            /ONE WORD MASTER FILE DIRECTORY SEARCH FOR PROJ,PROG MATCH
 2633 13266 3254          UFORET
 2634 13267 5660          JMP I   UFO6            /COULD NOT FIND UFD ENTRY
 2635 13270 1015          TAD     P0004           /POINT AT DISK QUOTA WORD
 2636 13271 3254          DCA     UFORET
 2637 13272 1654          TAD I   UFORET
 2638 13273 0013          AND     P0077           /SAVE ONLY LOGIN QUOTA
 2639 13274 3120          DCA     SEGLIM          /SAVE FOR LATER
 2640 13275 1075          TAD     P0003
 2641 13276 1254          TAD     UFORET
 2642 13277 3254          DCA     UFORET          /POINTER TO UFD RETRIEVAL INFORMATION
 2643 13300 1654          TAD I   UFORET
 2644 13301 3304          DCA     UFO1
 2645 13302 1033          TAD     RETTBL          /POINTER TO RET. INFO OF FILE BEING SEARCHED (IN THIS CASE, THE MFD)
 2646 13303 4441          JMS I   GE01            /GET RETRIEVAL INFORMATION INTO CORE
 2647 13304 0000  UFO1,   0
 2648 13305 2260          ISZ     UFO6
 2649 13306 5660          JMP I   UFO6

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 63


 2650             
 2651             /ROUTINE TO SEARCH UFD TABLE FOR PROJ,PROG NUMBER
 2652             
 2653             /CALLING SEQUENCE:
 2654             /       TAD (PROJ,PROG NUMBER)
 2655             /       JMS UTS0
 2656             /       NOT FOUND RETURN
 2657             /       NORMAL RETURN (RETRIEVAL POSITION IN AC)
 2658             
 2659 13307 0000  UTS0,   0
 2660 13310 3341          DCA     UTPR1           /PROJ,PROG NUMBER
 2661 13311 1032          TAD     UFDTBL          /PTR TO HEAD OF UFDTBL
 2662 13312 3107          DCA     UTUPTR
 2663 13313 1033  UTS1,   TAD     UFDEND          /END OF UFD TABLE
 2664 13314 7041          CIA
 2665 13315 1107          TAD     UTUPTR
 2666 13316 7650          SNA CLA
 2667 13317 5707          JMP I   UTS0            /COULD NOT FIND PROJ,PROG NUMBER ON TABLE
 2668 13320 1507          TAD I   UTUPTR
 2669 13321 7041          CIA
 2670 13322 1341          TAD     UTPR1
 2671 13323 7650          SNA CLA
 2672 13324 5331          JMP     UTS3            /FOUND ENTRY, GET POINTER
 2673 13325 1107          TAD     UTUPTR          /STEP UP ONE SLOT
 2674 13326 1015          TAD     P0004
 2675 13327 3107          DCA     UTUPTR
 2676 13330 5313          JMP     UTS1            /LOOK IN THE NEXT ENTRY
 2677 13331 1032  UTS3,   TAD     UFDTBL
 2678 13332 7041          CIA
 2679 13333 1107          TAD     UTUPTR
 2680 13334 7112          CLL RTR                 /RELATIVE POSITION ON TABLE
 2681 13335 7001          IAC                     /THE RELATIVE POSITION
 2682 13336 2107          ISZ     UTPRNU          /UTPRNU POINTS TO ACCESS COUNT OF THIS PROJ, PROG #
 2683 13337 2307          ISZ     UTS0
 2684 13340 5707          JMP I   UTS0
 2685             
 2686             DVT1,
 2687 13341 0000  UTPR1,  0
 2688       0107  UTUPTR= UTPRNU

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 64


 2689             
 2690 13342 0000  DVT0,   0                       /COMPUTE DEVICE TIME AT RELEASE
 2691 13343 3341          DCA     DVT1            /ELAPSED DEVICE TIME
 2692 13344 4464          JMS I   JBLD0
 2693 13345 3363          DCA     DVT3            /PROJ,PROG NUMBER OF CURRENT USER
 2694 13346 7240          CLA CMA
 2695 13347 4440          JMS I   DS01            /SEARCH MFD FOR PROJ,PROG NUMBER
 2696 13350 3362          DVT4
 2697 13351 5471          JMP I   DIRBAD          /***********DEBUG ONLY***********
 2698 13352 1101          TAD     C0005
 2699 13353 3110          DCA     CFH             /POINTER TO DEVICE TIME WORD
 2700 13354 1341          TAD     DVT1
 2701 13355 1510          TAD I   CFH             /UPDATE USER'S CUMULATIVE DEVICE TIME
 2702 13356 3510          DCA I   CFH
 2703 13357 3026          DCA     BUFMOD          /SCHEDULE WRITE
 2704 13360 6211          DATFLD
 2705 13361 5742          JMP I   DVT0
 2706             
 2707 13362 6525  DVT4,   RTABLE
 2708 13363 0000  DVT3,   0
 2709             
 2710             
 2711             
 2712             /COMES HERE IF FIP WAS CALLED BY S.I.
 2713             /READ S.I. BACK IN AND RETURN TO IT
 2714 13364 6221  FIX30,  CFLD                    /CHANGE TO CURRENT FIELD
 2715 13365 1102          TAD     C0603
 2716 13366 3132          DCA     FLPARB          /SET UP READ IOT
 2717 13367 3133          DCA     FLPARB+1        /SI IS ON TRACK 0 OF THE DISC
 2718 13370 4465          JMS I   FIX401
 2719 13371 4445          JMS I   FIO01           /RETURN WILL BE TO SI
 2720             
 2721             
 2722 13372 0000  SCL1,   0
 2723 13373 4777          JMS I   RD301           /SET UP DISK PARAMETERS
 2724 13374 7240          STA
 2725 13375 3025          DCA     BUFSTA          /FUDGE TO APPEAR THAT READ WAS DONE
 2726 13376 5772          JMP I   SCL1
 2727             
 2728 13377 2673  RD301,  RD30

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 65


 2729             
 2730             /EXIT ROUTINE
 2731             /COMES HERE WHEN FIP HAS COMPLETED ITS TASK
 2732             /FIRST, SEE IF ANY INTERNAL FILES HAVE BEEN CHANGED
 2733             /THOSE THAT HAVE CHANGED MUST BE WRITTEN BACK OUT TO DISC
 2734       3400  *3400
 2735             /*** ANY DATA FIELD IS OK AT THIS POINT!!
 2736             
 2737 13400 4443  FIX0,   JMS I   WRT1            /MAKE SURE THE BUFFER IS EMPTY
 2738 13401 2030          ISZ     TABSTA          /CHECK TABLE STATUS
 2739 13402 5205          JMP     FIX1            /NOTHING CHANGED IN TABLES
 2740 13403 1031          TAD     JOBTAB          /BOTTOM OF TABLE AREA
 2741 13404 5210          JMP     FIX2            /SAVE TABLES BEFORE EXIT
 2742             
 2743 13405 2027  FIX1,   ISZ     SATSTA          /CHECK SAT STATUS
 2744 13406 5217          JMP     FIX20           /NOTHING TO BE SAVED, EXIT
 2745 13407 1036          TAD     SATBOT          /BOTTOM OF SAT
 2746 13410 4465  FIX2,   JMS I   FIX401
 2747 13411 1015          TAD     FIDEXP          /GLOBAL TI "FIPDEX"
 2748 13412 3133          DCA     FLPARB+1        /MEMORY FIELD
 2749 13413 1100          TAD     C0605
 2750 13414 3132          DCA     FLPARB          /WRITE IOT
 2751 13415 4445          JMS I   FIO01           /PERFORM THE WRITE
 2752 13416 7402          HLT                     /ERROR ON WRITE, FATAL
 2753             
 2754             /ALL DISC TABLES ARE NOW UP TO DATE (*** ANY DATA FIELD IS OK AT THIS POINT!!)
 2755 13417 4470  FIX20,  FGETJT
 2756 13420 0000          JOBSTS
 2757 13421 3022          DCA     FIOPTR
 2758 13422 6211          DATFLD
 2759 13423 1422          TAD I   FIOPTR
 2760 13424 0243          AND     FISIOT
 2761 13425 3422          DCA I   FIOPTR
 2762 13426 6221          CFLD
 2763 13427 4470          FGETJT                  /RESTORE USER AC
 2764 13430 0013          JOBREG+2
 2765 13431 3022          DCA     FIOPTR          /ADDRESS OF USER'S AC
 2766 13432 1020          TAD     FIUSAC
 2767 13433 6211          DATFLD
 2768 13434 3422          DCA I   FIOPTR
 2769 13435 6201          CDF
 2770 13436 1017          TAD     C002            /FIP ALWAYS RUNS IN FIELD 2 SO ADD 2 TO CORTBL
 2771 13437 1162          TAD     CORTBA          /GLOBAL TO "CORTBL"
 2772 13440 3022          DCA     FIOPTR          /POINTS TO THIS FIELD'S ENTRY IN CORTBL
 2773 13441 5642          JMP I   .+1
 2774 13442 2754  FIX500, FIX50
 2775             
 2776 13443 7677  FISIOT, -JSIOT-1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 66


 2777             
 2778             /ROUTINE TO DETERMINE IF A DEVICE IS ASSIGNED TO THIS JOB
 2779             
 2780             /CALLING SEQUENCE:
 2781             /       TAD (DEVICE NUMBER)
 2782             /       JMS DTE0
 2783             /       0       (SET BY DTE0 TO POINT TO ENTRY IN DEVTBL)
 2784             /       RETURN (DEVICE NOT ASSIGNED TO THIS JOB)
 2785             /       RETURN (DEVICE ASSIGNED)
 2786             
 2787 13444 0000  DTE0,   0
 2788 13445 7510          SPA
 2789 13446 5306          JMP     DTE10           /NON-TTY DEVICE
 2790 13447 1302          TAD     NULNM1          /CHECK FOR VALID TTY NUMBER
 2791 13450 7500          SMA
 2792 13451 5276          JMP     DTE6            /INVALID TTY NUMBER
 2793 13452 7104          CLL RAL                 /TWO WORDS PER TTY
 2794 13453 1164  DTE4,   TAD     DEVEND          /FIND LOCATION IN DEVTBL
 2795 13454 6221  DTE5,   CFLD
 2796 13455 3644          DCA I   DTE0            /RETURN ARGUMENT
 2797 13456 1644          TAD I   DTE0
 2798 13457 2244          ISZ     DTE0
 2799 13460 3301          DCA     DTE2
 2800 13461 6211          DATFLD
 2801 13462 1701          TAD I   DTE2            /GET POINTER TO DDB
 2802 13463 7450          SNA                     /IS THERE ONE?
 2803 13464 5644          JMP I   DTE0            /NO, RETURN
 2804 13465 3301          DCA     DTE2            /YES
 2805 13466 2301          ISZ     DTE2
 2806 13467 1701          TAD I   DTE2            /GET JOB NUMBER
 2807 13470 7041          CIA
 2808 13471 1021          TAD     FIJOB           /NUMBER OF CURRENT JOB
 2809 13472 0074          AND     P0037
 2810 13473 7650          SNA CLA                 /DOES DEVICE BELONG TO THIS JOB?
 2811 13474 2244          ISZ     DTE0            /YES
 2812 13475 5644          JMP I   DTE0            /RETURN
 2813 13476 7240  DTE6,   STA
 2814 13477 1163          TAD     DEVTBA          /POINT TO DUMMY DEVTBL ENTRY
 2815 13500 5254          JMP     DTE5
 2816             
 2817             
 2818 13501 0000  DTE2,   0
 2819 13502 7767  NULNM1, -NULINE-1
 2820 13503 3777  P3777,  3777
 2821 13504 7756  NUDEVM, DEVTBE-JOBTBL
 2822 13505 0022  NUDEV,  JOBTBL-DEVTBE
 2823             
 2824 13506 0303  DTE10,  AND     P3777
 2825 13507 1304          TAD     NUDEVM          /CHECK DEVICE NUMBER FOR VALIDITY
 2826 13510 7500          SMA
 2827 13511 5276          JMP     DTE6            /INVALID DEVICE NUMBER
 2828 13512 1305          TAD     NUDEV           /GET DEVICE NUMBER BACK
 2829 13513 5253          JMP     DTE4            /GO FINISH UP

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 67


 2830             
 2831 13514 0000  LNK0,   0                       /GET FILE LINKAGE
 2832 13515 1325          TAD     LNKF
 2833 13516 3320          DCA     LNK1
 2834 13517 4470          FGETJT
 2835 13520 0000  LNK1,   0
 2836 13521 3110          DCA     CFH
 2837 13522 6211          DATFLD
 2838 13523 1510          TAD I   CFH             /PTR TO FILE CONTROL BLOCK
 2839 13524 5714          JMP I   LNK0
 2840 13525 0017  LNKF,   JOBF0
 2841             SAV1,
 2842 13526 0000  FGETJ0, 0
 2843 13527 6221          CFLD
 2844 13530 1726          TAD I   FGETJ0
 2845 13531 3335          DCA     .+4
 2846 13532 1161          TAD     JOBDAT
 2847 13533 6202          CIF
 2848 13534 4574          GETJTA
 2849 13535 0000          0
 2850 13536 2326          ISZ     FGETJ0
 2851 13537 5726          JMP I   FGETJ0
 2852 13540 0000  SAVCRE, 0
 2853 13541 3326          DCA     SAV1
 2854 13542 1326          TAD     SAV1            /FILE ADDR
 2855 13543 1015          TAD     P0004           /PTR TO PROTECTION BITS IN FILE
 2856 13544 3356          DCA     SAV2
 2857 13545 1756          TAD I   SAV2            /GET THE PROTECTION BITS
 2858 13546 0016          AND     C0020           /IS IT WRITE PROTECTED AGAINST THE OWNER?
 2859 13547 7640          SZA CLA
 2860 13550 5755          JMP I   EXT10A          /YES, RETURN WITH PROT. VIOLATION MESSAGE
 2861 13551 1326          TAD     SAV1            /NO, REDUCE THE FILE TO 0 SEGS
 2862 13552 4754          JMS I   RED11           /GO DO REDUCTION
 2863 13553 5740          JMP I   SAVCRE          /RETURN
 2864 13554 1654  RED11,  RED1
 2865 13555 1516  EXT10A, EXT10
 2866             SAV2,
 2867 13556 0000  CRFUFD, 0
 2868 13557 4511          JMS I   ACC01           /IS THIS ACCOUNT 1?
 2869 13560 5364          JMP     CRFUF1          /YES
 2870 13561 7001          IAC
 2871 13562 3410          DCA I   INDEX           /FILE SIZE INITIALLY 1
 2872 13563 5756          JMP I   CRFUFD          /BACK FOR THE DATE
 2873 13564 3410  CRFUF1, DCA I   INDEX           /ZERO CPU TIME
 2874 13565 5766          JMP I   .+1             /GO ZERO DEVICE TIME ALSO
 2875 13566 1316          CRFUFR
 2876             /CONVERT AN ABSOLUTE PTR INTO RETTBL TO A RELATIVE ENTRY NUMBER
 2877 13567 0000  ENS3,   0
 2878 13570 7041          CIA
 2879 13571 1033          TAD     RETTBL          /REL. PTR TO ADDRESS WITHIN RETTBL
 2880 13572 7041          CIA
 2881 13573 0106          AND     P7770           /ANY POINTER WITHIN THE BLOCK IS OK
 2882 13574 7112          CLL RTR
 2883 13575 7010          RAR                     /DIVIDE BY 8
 2884 13576 5767          JMP I   ENS3

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 68


 2885             
 2886             /ROUTINE TO ASSIGN A DEVICE
 2887             
 2888       3600  *3600
 2889 13600 1123  ASD1,   TAD     FIOSTK+1
 2890 13601 7500          SMA                     /TTY?
 2891 13602 5467          JMP I   LGI201          /DON'T LET HIM/HER ASSIGN TTY'S! RETURN WITH AC=7777
 2892 13603 4444          JMS I   DTE01           /IS THIS DEVICE ASSIGNED TO THIS JOB?
 2893 13604 0000  ASD2,   0                       /SET BY DTE01 TO POINT TO PROPER ENTRY IN DEVTBL
 2894 13605 7410          SKP
 2895 13606 5241          JMP     ASD4            /YES
 2896 13607 1604          TAD I   ASD2            /GET DDB ADDRESS FOR THIS DEVICE
 2897 13610 7440          SZA                     /ZERO?
 2898 13611 5232          JMP     ASD11           /NO, SO SOMEONE HAS IT
 2899             /COMES HERE IF OKAY TO MAKE THIS ASSIGNMENT
 2900 13612 6221          CFLD                    /CHANGE TO CURRENT FIELD
 2901 13613 1204          TAD     ASD2
 2902 13614 6202          6202                    /CIF FIELD 0
 2903 13615 4572          GETDDB                  /GET A BLOCK FROM THE FREE LIST AND LINK IT INTO DEVTBL
 2904 13616 5467          JMP I   LGI201          /NO BLOCK.. REDO IN CASE OF USER OTHERWISE ERROR RETURN FOR SI
 2905 13617 6211          DATFLD
 2906 13620 1604          TAD I   ASD2                    /PICK DDB ADDRESS FROM DEVTBL
 2907 13621 3110          DCA     CFH             /SAVE IT
 2908 13622 1123          TAD     FIOSTK+1
 2909 13623 0074          AND     P0037           /CLEAR BIT 0
 2910 13624 3510          DCA I   CFH             /SET TO REFLECT THE DEVICE NUMBER
 2911 13625 2110          ISZ     CFH
 2912 13626 1021          TAD     FIJOB
 2913 13627 3510          DCA I   CFH             /PLUG IN THE JOB NUMBER
 2914 13630 6221  ASD7,   CFLD
 2915 13631 5455          JMP I   FIEXIT
 2916             
 2917             /COMES HERE IF ONE JOB ATTEMPTS TO ASSIGN AN ALREADY ASSIGNED DEVICE
 2918 13632 7001  ASD11,  IAC
 2919 13633 3110          DCA     CFH
 2920 13634 1510          TAD I   CFH
 2921 13635 7450          SNA
 2922 13636 7040          CMA
 2923 13637 3020          DCA     FIUSAC          /DELIVER TO USER'S AC
 2924 13640 5230          JMP     ASD7            /EXIT
 2925             
 2926 13641 1123  ASD4,   TAD     FIOSTK+1
 2927 13642 7104          CLL RAL
 2928 13643 7640          SZA CLA                 /PTR?
 2929 13644 5230          JMP     ASD7            /NO
 2930 13645 1604          TAD I   ASD2
 2931 13646 6202          CIF 00
 2932 13647 4651          JMS I   ASDCLR          /CLEAR THE READER BUFFER
 2933 13650 5230          JMP     ASD7
 2934 13651 6572  ASDCLR, SICLR

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 69


 2935             
 2936             /ROUTINE TO PERFORM ACTUAL REDUCTION
 2937             
 2938             /CALLING SEQUENCE:
 2939             /       TAD (NUMBER OF SEGMENTS TO REMAIN)
 2940             /       JMS RED30
 2941             /       RETRIEVAL CHAIN POINTER
 2942             /       UFD RETRIEVAL POINTER
 2943             /       RETURN
 2944             
 2945             
 2946             /FIRST TRACE THRU THE LINKED LIST OF FILE INFORMATION
 2947             /RETRIEVAL BBLOCKS UNTIL WE GET TO THE ONE IN WHICH THE
 2948             /NEW LAST SEGMENT IS
 2949 13652 0000  RED30,  0
 2950 13653 3256          DCA     RED31           /LINKAGE TO RETRIEVAL CHAIN
 2951 13654 1023          TAD     GDRETP          /PICK UP RETRIEVAL POINTER
 2952 13655 4441          JMS I   GE01            /GET THIS WORD INTO CORE
 2953 13656 0000  RED31,  0
 2954 13657 3371          DCA     REBUFF
 2955 13660 1771          TAD I   REBUFF          /PICK UP LINK TO NEXT
 2956 13661 3256          DCA     RED31           /SAVE LINK
 2957 13662 1024          TAD     WNDREM          /DELETING ENTIRE WINDOW?
 2958 13663 7650          SNA CLA
 2959 13664 5332          JMP     RED36           /YES, REMOVE LINK TO LAST WINDOW AS WELL
 2960 13665 2121  RED37,  ISZ     REWNDC          /AT END OF CHAIN?
 2961 13666 5254          JMP     RED30+2         /NO, KEEP SAVING
 2962 13667 3771          DCA I   REBUFF          /YES, TERMINATE IT
 2963             /FOUND RETRIEVAL BLOCK IN WHICH TO CHOP OFF
 2964             /THE LIST OF SEGMENTS.
 2965             /START DELETING THE SEGMENT NUMBERS AND RETURNING
 2966             /THE ACTUAL DISC SEGMENTS TO THE POOL
 2967 13670 1024          TAD     WNDREM
 2968 13671 7001          IAC                     /GET POINTER TO FIRST SEGMENT TO BE DELETED
 2969 13672 1371          TAD     REBUFF
 2970 13673 3371          DCA     REBUFF          /POINTER TO FIRST SEGMENT TO REMOVE
 2971 13674 3120          DCA     SEGLIM          /CLEAR SEGMENT COUNTER
 2972 13675 1024          TAD     WNDREM          /NUMBER OF SEGMENTS TO LEAVE IN RET. WINDOW
 2973 13676 1105  RED32,  TAD     C7771           /7 SEGMENTS PER RETRIEVAL WINDOW
 2974 13677 3121          DCA     REWNDC          /SAVE COUNT
 2975 13700 3026          DCA     BUFMOD          /REMEMBER TO WRITE OUT THE BUFFER
 2976 13701 1367  RED33,  TAD     REDM9
 2977 13702 3110          DCA     CFH             /SET COUNT FOR SATREL DIVIDE
 2978 13703 7360          STL STA
 2979 13704 1771          TAD I   REBUFF          /PICK UP THE SEGMENT NUMBER
 2980 13705 7430          SZL                     /IS IT A REAL SEGMENT
 2981 13706 5341          JMP     RED38           /NO; END OF WINDOW, END OF FILE
 2982 13707 4770          JMS I   SATREA          /RELEASE IT ON SAT
 2983 13710 3771          DCA I   REBUFF          /CLEAR THE CCELL
 2984 13711 2120          ISZ     SEGLIM          /COUNT SEGMENT
 2985 13712 2371          ISZ     REBUFF
 2986 13713 2121          ISZ     REWNDC          /END OF CURRENT RETRIEVAL WINDOW?
 2987 13714 5301          JMP     RED33           /NO, CONTINUE
 2988 13715 1256          TAD     RED31           /YES, MOVE TO NEXT
 2989 13716 7450          SNA                     /END OF CHAIN?
 2990 13717 5346          JMP     RED39           /YES, EXIT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 70


 2991             
 2992 13720 3323  RED34,  DCA     RED35           /NO
 2993 13721 1023          TAD     GDRETP
 2994 13722 4441          JMS I   GE01            /GET NEXT WINDOW
 2995 13723 0000  RED35,  0
 2996 13724 3371          DCA     REBUFF
 2997 13725 1771          TAD I   REBUFF
 2998 13726 3256          DCA     RED31           /SET UP LINK TO NEXT
 2999 13727 3771          DCA I   REBUFF          /CLEAR FIRST WORD OF WINDOW
 3000 13730 2371          ISZ     REBUFF
 3001 13731 5276          JMP     RED32           /KEEP WIPING OUT
 3002             
 3003 13732 7326  RED36,  STL CLA RTL             /ARE WE TWO WINDOWS FROM THE END YET?
 3004 13733 1121          TAD     REWNDC
 3005 13734 7640          SZA CLA
 3006 13735 5265          JMP     RED37           /NOT EXACTLY
 3007 13736 3771          DCA I   REBUFF          /YES, CLEAR LINK TO NOW EMPTY WINDOW
 3008 13737 3026          DCA     BUFMOD          /SCHEDULE WRITE
 3009 13740 5265          JMP     RED37
 3010             
 3011 13741 7200  RED38,  CLA
 3012 13742 3771          DCA I   REBUFF          /CLEAR TO END OF WINDOW
 3013 13743 2371          ISZ     REBUFF
 3014 13744 2121          ISZ     REWNDC          /ARE WE THERE YET?
 3015 13745 5341          JMP     RED38           /NO
 3016 13746 1023  RED39,  TAD     GDRETP          /GET RETRIEVAL POINTER
 3017 13747 4766          JMS I   ENS32           /CONVERT IT INTO A RELATIVE ENTRY NUMBER
 3018 13750 7126          STL RTL                 /TIMES 4 PLUS 2
 3019 13751 7001          IAC
 3020 13752 1032          TAD     UFDTBL          /POINTS TO WORD3 OF UFDTBL ENTRY
 3021 13753 3371          DCA     REBUFF
 3022 13754 1771          TAD I   REBUFF          /HAS HIS/HER SEGMENT COUNT BEEN SET UP YET?
 3023 13755 7650          SNA CLA
 3024 13756 5652          JMP I   RED30           /NO; SO JUST EXIT
 3025 13757 1120          TAD     SEGLIM          /NUMBER OF SEGMENTS WE REMOVED FROM THIS FILE
 3026 13760 7041          CIA
 3027 13761 1771          TAD I   REBUFF          /SUBTRACT FROM THOSE THAT WE KNEW ABOUT
 3028 13762 3771          DCA I   REBUFF          /UPDATE UFDTBL ENTRY
 3029 13763 7240          STA
 3030 13764 3030          DCA     TABSTA          /REMEMBER TO WRITE OUT THE TABLES
 3031 13765 5652          JMP I   RED30           /EXIT
 3032             
 3033 13766 3567  ENS32,  ENS3
 3034 13767 7767  REDM9,  -11
 3035 13770 2462  SATREA, SATREL
 3036 13771 0000  REBUFF, 0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 71


 3037             
 3038       4000  *4000
 3039             /RENAME ROUTINE
 3040             
 3041 14000 4511  REN0,   JMS I   ACC01           /IS IT ACCOUNT 1?
 3042 14001 5246          JMP     PASSQU          /YES; GO CHANGE PASSWORD AND DISK QUOTA
 3043 14002 4466          JMS I   IFN01
 3044 14003 1123          TAD     FIOSTK+1        /PICK UP INTERNAL FILE NUMBER
 3045 14004 4450          JMS I   UC01            /USER-OWNER CHECK
 3046 14005 5636          JMP I   REN1A           /USER NOT OWNER, ERROR
 3047 14006 4637          JMS I   FILNAM          /CHECK IF THIS NEW NAME IS IN DIRECTORY
 3048 14007 5640          JMP I   BADNAM          /YES, DON'T RENAME
 3049 14010 1122          TAD     FIOSTK          /PICK UP INTERNAL FILE NUMBER NOW SHIFTED TO FIOSTK
 3050 14011 4442          JMS I   GD01            /GET THIS DIRECTORY ENTRY INTO CORE
 3051 14012 3261          DCA     REENTP          /POINTER TO DIRECTORY ENTRY
 3052 14013 1261          TAD     REENTP
 3053 14014 1015          TAD     P0004
 3054 14015 3313          DCA     REPRTP          /POINTER TO PROTECTION BITS
 3055 14016 1713          TAD I   REPRTP          /PICK UP PROTECTION BITS
 3056 14017 0016          AND     C0020           /WRITE PROTECTED AGAINST OWNER?
 3057 14020 7440          SZA
 3058 14021 5636          JMP I   REN1A           /YES, ERROR
 3059 14022 1124          TAD     FIOSTK+2        /TRANSFER NEW NAME TO DIRECTORY
 3060 14023 7450          SNA                     /IS IT A NULL NAME?
 3061 14024 5640          JMP I   BADNAM          /YES, DON'T RENAME
 3062 14025 3661          DCA I   REENTP
 3063 14026 2261          ISZ     REENTP
 3064 14027 1125          TAD     FIOSTK+3
 3065 14030 3661          DCA I   REENTP
 3066 14031 2261          ISZ     REENTP
 3067 14032 1126          TAD     FIOSTK+4
 3068 14033 3661          DCA I   REENTP
 3069 14034 3026          DCA     BUFMOD          /SCHEDULE WRITE
 3070 14035 5455          JMP I   FIEXIT          /EXIT FROM FILE PHANTOM
 3071 14036 2164  REN1A,  REN1
 3072 14037 2725  FILNAM, USENAM
 3073 14040 1356  BADNAM, CRF30
 3074 14041 1644  SEGS0,  TAD I   SEGCNT
 3075 14042 3020          DCA     FIUSAC
 3076 14043 5455          JMP I   FIEXIT
 3077 14044 7251  SEGCNT, -SATSIZ+1
 3078 14045 7002  SIFLD,  CORTBL+1
 3079             
 3080 14046 6201  PASSQU, CDF 00
 3081 14047 1645          TAD I   SIFLD           /IS THIS REQUEST FROM SI?
 3082 14050 0073          AND     C0200
 3083 14051 6221          CFLD
 3084 14052 7440          SZA
 3085 14053 5636          JMP I   REN1A
 3086 14054 1123          TAD     FIOSTK+1        /OR IS HE TRYING ACCOUNT 0?
 3087 14055 7450          SNA
 3088 14056 5640          JMP I   BADNAM          /YES; ERROR
 3089 14057 5660          JMP I   .+1
 3090 14060 4777          PASQU0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 72


 3091             
 3092             /BUILD A RETRIEVAL POINTER GIVEN RELATIVE POSITION ON RETTBL
 3093             
 3094             /CALLING SEQUENCE:
 3095             /       TAD (RELATIVE POSITION)
 3096             /       JMS BLDP
 3097             /       RETURN (POINTER IN AC)
 3098             
 3099             REENTP,
 3100 14061 0000  BLDP,   0
 3101 14062 3110          DCA     CFH
 3102 14063 7240          CLA CMA
 3103 14064 1110          TAD     CFH
 3104 14065 7104          CLL RAL
 3105 14066 7006          RTL
 3106 14067 1033          TAD     RETTBL
 3107 14070 5661          JMP I   BLDP
 3108             /JMS I LINK01
 3109             /MISSING SEGMENT ADD
 3110             /REPLACEMENT
 3111             
 3112 14071 0000  LINK0,  0
 3113 14072 3275          DCA     LINK1
 3114 14073 1023          TAD     GDRETP
 3115 14074 4441          JMS I   GE01
 3116 14075 0000  LINK1,  0                       /GET A DIRECTORY WORD INTO CORE
 3117 14076 1075          TAD     P0003
 3118 14077 3313          DCA     LINK2
 3119 14100 1713          TAD I   LINK2
 3120 14101 7041          CIA
 3121 14102 1671          TAD I   LINK0
 3122 14103 7640          SZA CLA                 /SEARCH THROUGH UFD UNTIL WE FIND ENTRY BEING SOUGHT
 3123 14104 5314          JMP     LINK3
 3124 14105 2271          ISZ     LINK0
 3125 14106 1671          TAD I   LINK0           /TAKE A BLOCK OUT OF THE CHAIN
 3126 14107 3713          DCA I   LINK2
 3127 14110 3026          DCA     BUFMOD          /SCHEDULE WRITE
 3128 14111 2271          ISZ     LINK0
 3129 14112 5671          JMP I   LINK0
 3130             
 3131             REPRTP,
 3132 14113 0000  LINK2,  0
 3133             
 3134 14114 1713  LINK3,  TAD I   LINK2
 3135 14115 5272          JMP     LINK0+1

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 73


 3136             
 3137             /ROUTINE TO SET UP A UFDTBL ENTRY AS FOLLOWS:
 3138             /WORD 0:        PROJECT, PROGRAMMER NUMBER
 3139             /WORD 1:        -ACCESS COUNT
 3140             /WORD 2:        -DISK SEGMENT QUOTA (LOGIN)
 3141             /WORD 3:        ACTUAL NUMBER OF SEGMENTS OWNED.
 3142             /(WORDS 1 AND 3 ARE INITIALLY SET TO 0.)
 3143             /WORD 3 IS LOADED BY "CREATE," OR BY "EXTEND" IF IT HAS NOT PREVIOUSLY
 3144             /BEEN LOADED. "CREATE" & "EXTEND" ALWAYS MODIFY WORD 3, "REDUCE" ONLY
 3145             /MODIFIES WORD 3 IF IT IS NON-ZERO.
 3146             
 3147 14116 0000  UFQUOT, 0
 3148 14117 3410          DCA I   INDEX           /SAVE PROJECT, PROGRAMMER NUMBER
 3149 14120 3410          DCA I   INDEX           /ZERO ACCESSES SO FAR
 3150 14121 1120          TAD     SEGLIM          /LOGGED IN QUOTA
 3151 14122 7104          CLL RAL                 /TIMES 2
 3152 14123 1120          TAD     SEGLIM          /THREE
 3153 14124 7004          RAL                     /SIX
 3154 14125 7006          RTL                     /TWENTY FOUR
 3155 14126 1120          TAD     SEGLIM          /TWENTY FIVE
 3156 14127 7041          CIA                     /NEGATE
 3157 14130 3410          DCA I   INDEX           /SAVE LOGGED-IN SEGMENT QUOTA
 3158 14131 3410          DCA I   INDEX           /NO KNOWN SEGMENTS AS OF YET
 3159 14132 5716          JMP I   UFQUOT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 74


 3160             
 3161             /ROUTINE TO GET THE NUMBER OF A DEVICE ATTACHED TO THIS JOB
 3162             
 3163             /CALLING SEQUENCE:
 3164             /       JMS LNS0
 3165             /       RETURN IF NONE AVAILABLE
 3166             /       NORMAL RETURN (DEVICE NUMBER IN AC)
 3167             
 3168 14133 0000  LNS0,   0
 3169 14134 1163          TAD     DEVTBA          /GLOBAL TO #DEVTBL#
 3170 14135 3110          DCA     CFH
 3171 14136 6211          DATFLD                  /CDF FIELD 0
 3172 14137 1510  LNS4,   TAD I   CFH             /PICK UP POINTER TO DDB
 3173 14140 7450          SNA
 3174 14141 5352          JMP     LNS2            /DEVICE UNASSIGNED
 3175 14142 7001          IAC
 3176 14143 3376          DCA     LNS3            /POINTER TO SECOOND WORD OF DDB
 3177 14144 1776          TAD I   LNS3
 3178 14145 0074          AND     P0037           /PICK OFF THE JOB NUMBER OF OWNER
 3179 14146 7041          CIA
 3180 14147 1021          TAD     FIJOB           /NUMBER OF CURRENT JOB
 3181 14150 7650          SNA CLA
 3182 14151 5362          JMP     LNS5            /THIS DEVICE IS OURS
 3183 14152 2110  LNS2,   ISZ     CFH
 3184 14153 1110          TAD     CFH
 3185 14154 7040          CMA
 3186 14155 1177          TAD     DEVOVR          /GLOBAL TO "JOBTBL"
 3187 14156 7640          SZA CLA
 3188 14157 5337          JMP     LNS4            /CONTINUE LOOKING DOWN TABLE
 3189 14160 6221  LNS7,   CFLD                    /MAKE SURE WE ARE IN THIS FIELD
 3190 14161 5733          JMP I   LNS0            /FOUND NOW DEVICES
 3191             
 3192 14162 1164  LNS5,   TAD     DEVEND
 3193 14163 7041          CIA
 3194 14164 1110          TAD     CFH
 3195 14165 2333          ISZ     LNS0
 3196 14166 7500          SMA
 3197 14167 5373          JMP     LNS6
 3198 14170 1375          TAD     LNS10
 3199 14171 7110          CLL RAR
 3200 14172 5360          JMP     LNS7
 3201             
 3202 14173 1377  LNS6,   TAD     C4000
 3203 14174 5360          JMP     LNS7
 3204             
 3205 14175 0022  LNS10,  DEVTBE-DEVTBL
 3206 14176 0000  LNS3,   0
 3207 14177 4000  C4000,  4000

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 75


 3208             
 3209             /ROUTINE TO RELEASE A DEVICE
 3210             
 3211       4200  *4200
 3212             
 3213 14200 0000  REL00,  0
 3214 14201 4444          JMS I   DTE01           /IS THIS DEVICE ASSIGNED TO THIS USER?
 3215 14202 0000  REL5,   0                       /SET BY DTE0 TO POINT TO DEVTBL ENTRY FOR THIS DEVICE
 3216 14203 5336          JMP     REL13           /NO, SO DON'T RELEASE IT
 3217 14204 1602          TAD I   REL5
 3218 14205 3121          DCA     REL6            /SAVE ADDRESS OF DDB FOR LATER
 3219 14206 1121          TAD     REL6
 3220 14207 1075          TAD     P0003           /POSITION OF TIME IN DDB
 3221 14210 3350          DCA     REL2
 3222 14211 1750          TAD I   REL2            /GET TIME ASSIGNED
 3223 14212 7041          CIA
 3224 14213 3350          DCA     REL2            /-TIME ASSIGNED
 3225 14214 6201          CDF
 3226 14215 1752          TAD I   RELCK1          /GET TIME NOW
 3227 14216 7006          RTL
 3228 14217 7006          RTL
 3229 14220 0014          AND     P0007           /JUST SIGNIFICANT PART OF LOW ORDER TIME
 3230 14221 3351          DCA     REL3
 3231 14222 1753          TAD I   RELCK2
 3232 14223 6211          DATFLD
 3233 14224 7006          RTL
 3234 14225 7004          RAL
 3235 14226 0106          AND     P7770           /JUST INSIGNIFICANT PART OF HI ORDER
 3236 14227 1351          TAD     REL3            /TIME AT RELEASE
 3237 14230 7100          CLL
 3238 14231 1350          TAD     REL2            /-TIME AT ASSIGNMENT
 3239 14232 3350          DCA     REL2            /TIME WE OWNED IT
 3240 14233 1350          TAD     REL2
 3241 14234 7420          SNL                     /GONE THRU MIDNITE WHILE ASSIGNED?
 3242 14235 1354          TAD     RELCON          /YES, FUDGE TO PROPER VALUE
 3243 14236 7440          SZA
 3244 14237 4747          JMS I   DVT01           /RECORD TIME SINCE WE USED A MEASURABLE AMOUNT
 3245 14240 7120          STL
 3246 14241 1202          TAD     REL5
 3247 14242 1346          TAD     RELCDR          /IS IT A CARD READER OR DECTAPE OR RK05?
 3248 14243 7510          SPA
 3249 14244 7010          RAR                     /NO - IS IT A KEYBOARD OR THE PTR?
 3250 14245 7420          SNL
 3251 14246 5315          JMP     REL11           /EITHER KEYBOARD, PTR, CDR, DTA, OR RK05
 3252 14247 1345          TAD     RELREG          /EITHER PTP OR LPT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 76


 3253             
 3254 14250 3121  REL8,   DCA     REL6            /ENTER HERE FROM REL12 FOR TELEPRINTER
 3255 14251 7240          STA
 3256 14252 1602          TAD I   REL5
 3257 14253 3010          DCA     INDEX           /POINT TO WORD 0 OF DDB (AUTOINDEXED)
 3258 14254 1410          TAD I   INDEX           /CHECK STATUS IF TELEPRINTER
 3259 14255 7710          SPA CLA
 3260 14256 5270          JMP     REL4            /HE'S IN THE ^S CONDITION - FLUSH HIM/HER OUT
 3261 14257 3410          DCA I   INDEX           /CLEAR THE JOB NUMBER
 3262 14260 2010          ISZ     INDEX
 3263 14261 2010          ISZ     INDEX
 3264 14262 1410          TAD I   INDEX           /CHECK FILL POINTER
 3265 14263 7640          SZA CLA
 3266 14264 5301          JMP     REL9            /STILL BUSY - LET "CONOUT" RELEASE IT
 3267 14265 1121          TAD     REL6
 3268 14266 7640          SZA CLA                 /ASSIGNABLE DEVICE?
 3269 14267 5303          JMP     REL7            /YES
 3270 14270 1602  REL4,   TAD I   REL5
 3271 14271 6202          CIF 00
 3272 14272 4755          JMS I   RELTBL          /MAKE SURE THE BUFFER IS CLEAR
 3273 14273 6211          DATFLD
 3274 14274 1602          TAD I   REL5            /RELEASE THE DDB
 3275 14275 4403          JMS I   RETBK1
 3276 14276 7200          CLA
 3277 14277 6211          DATFLD
 3278 14300 3602          DCA I   REL5
 3279 14301 6221  REL9,   CFLD
 3280 14302 5600          JMP I   REL00
 3281 14303 6222  REL7,   CIF 20                  /INHIBIT INTERRUPTS
 3282 14304 1521          TAD I   REL6
 3283 14305 7104          CLL RAL
 3284 14306 7450          SNA
 3285 14307 5270          JMP     REL4
 3286 14310 7510          SPA
 3287 14311 7120          STL
 3288 14312 7010          RAR
 3289 14313 3521          DCA I   REL6
 3290 14314 5301          JMP     REL9

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 77


 3291             
 3292 14315 7700  REL11,  SMA CLA                 /IS IT A KEYBOARD OR THE PTR?
 3293 14316 5322          JMP     REL12           /NO
 3294 14317 1121          TAD     REL6
 3295 14320 6202          CIF 00
 3296 14321 4755          JMS I   RELTBL          /FLUSH OUT THE BUFFER
 3297 14322 1121  REL12,  TAD     REL6
 3298 14323 4403          JMS I   RETBK1          /RELEASE THE DDB
 3299 14324 7200          CLA
 3300 14325 6211          DATFLD
 3301 14326 3602          DCA I   REL5            /REMOVE FROM DEVTBL
 3302 14327 1164          TAD     DEVEND
 3303 14330 7041          CIA
 3304 14331 1202          TAD     REL5
 3305 14332 7700          SMA CLA
 3306 14333 5301          JMP     REL9
 3307 14334 2202          ISZ     REL5
 3308 14335 5250          JMP     REL8
 3309             
 3310 14336 6201  REL13,  CDF
 3311 14337 1560          TAD I   JOB
 3312 14340 0073          AND     C0200
 3313 14341 6221          CFLD
 3314 14342 7640          SZA CLA                 /CALLED BY SI??
 3315 14343 5467          JMP I   LGI201          /YES, INDICATE ERROR WITH AC=-1
 3316 14344 5600          JMP I   REL00           /NO, UUO CALL
 3317 14345 0213  RELREG, OUTREG+NULINE+3
 3318 14346 4732  RELCDR, -DEVTBE-4
 3319 14347 3342  DVT01,  DVT0
 3320 14350 0000  REL2,   0
 3321 14351 0000  REL3,   0
 3322 14352 0051  RELCK1, CLK1
 3323 14353 0050  RELCK2, CLK2
 3324 14354 3227  RELCON, 3227                    /FUDGE FOR MIDNIGHT OVERFLOW
 3325 14355 6572  RELTBL, SICLR
 3326 14356 0100  P0100,  100
 3327 14357 0000  FIXSCH, 0
 3328 14360 7001          IAC
 3329 14361 3202          DCA     REL5
 3330 14362 1602          TAD I   REL5
 3331 14363 0356          AND     P0100
 3332 14364 7650          SNA CLA
 3333 14365 5757          JMP I   FIXSCH
 3334 14366 1177          TAD     DEVOVR
 3335 14367 7041          CIA
 3336 14370 1010          TAD     INDEX
 3337 14371 6203  FIXOUT, CIF CDF
 3338 14372 3555          DCA I   FIPJOB
 3339 14373 5576          WAIT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 78


 3340             
 3341 14374 0215  EXCEED, 215;212;"[;" ;" ;" ;" ;" ;" ;" ;"E;"X;"C;"E;"E;"D;"I;"N;"G
      14375 0212
      14376 0333
      14377 0240
      14400 0240
      14401 0240
      14402 0240
      14403 0240
      14404 0240
      14405 0240
      14406 0305
      14407 0330
      14410 0303
      14411 0305
      14412 0305
      14413 0304
      14414 0311
      14415 0316
      14416 0307
 3342 14417 0240          " ;"D;"I;"S;"K;" ;"Q;"U;"O;"T;"A;"];215;212;0
      14420 0304
      14421 0311
      14422 0323
      14423 0313
      14424 0240
      14425 0321
      14426 0325
      14427 0317
      14430 0324
      14431 0301
      14432 0335
      14433 0215
      14434 0212
      14435 0000
 3343             /COMPLETION OF LOGOUT ROUTINE
 3344             /REMOVES JOB FROM PERMANENT MONITOR TABLES
 3345             /MUST BE DONE LAST, SINCE WE NEED THE JOB STATUS BLOCKS
 3346             /TO INDICATE ANY ERRORS IN THE FIP I/O
 3347             
 3348 14436 1267  LGO4,   TAD     LGO500          /RESTORE THE FIP EXIT
 3349 14437 6221          CFLD
 3350 14440 3671          DCA I   LGOFIX
 3351 14441 1021          TAD     FIJOB           /SEE IF HE OWNS ANY CORE FIELDS
 3352 14442 6202          CIF
 3353 14443 4570          CORE                    /SEARCH CORE TABLE FOR HIM/HER
 3354 14444 0637          FIP SI CJOB
 3355 14445 5253          JMP     LGO5            /NO; NOTHING TO RELEASE
 3356 14446 0014          AND     P0007           /YES; RELEASE THE FIELD
 3357 14447 1162          TAD     CORTBA
 3358 14450 3110          DCA     CFH             /POINTS TO ENTRY IN CORTBL
 3359 14451 6201          CDF
 3360 14452 3510          DCA I   CFH             /ZERO THE ENTRY
 3361 14453 1021  LGO5,   TAD     FIJOB           /RETURN STATUS BLOCKS
 3362 14454 1177          TAD     DEVOVR          /START OF JOB TABLE (END OF DEVTBL)
 3363 14455 3370          DCA     LGO6            /POINTS TO JOB TABLE ENTRY
 3364 14456 6211          DATFLD

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 79


 3365 14457 1770          TAD I   LGO6            /GET ADDRESS OF JOB STATUS
 3366 14460 4670          JMS I   LGOBLS          /RETURN STATUS
 3367 14461 6211          DATFLD
 3368 14462 3561          DCA I   JOBDAT          /CLEAR JOBDAT
 3369 14463 3770          DCA I   LGO6            /CLEAR POINTER IN JOBTABLE
 3370 14464 6201          CDF
 3371 14465 3560          DCA I   JOB             /CLEAR JOB (SO SAVJOB WON'T SAVE US)
 3372 14466 5667          JMP I   .+1             /AND NOW GO DO FIX50
 3373 14467 2754  LGO500, FIX50
 3374 14470 2323  LGOBLS, RETBLS
 3375 14471 3442  LGOFIX, FIX500
 3376 14472 1123  LGO1,   TAD     FIOSTK+1        /LOGOUT WITH AC=0?
 3377 14473 7640          SZA CLA
 3378 14474 5467          JMP I   LGI201          /NO, SO IT'S AN ERROR
 3379 14475 1021          TAD     FIJOB
 3380 14476 1031          TAD     JOBTAB
 3381 14477 3110          DCA     CFH             /GET HIS/HER PROJ-PROG #
 3382 14500 1510          TAD I   CFH
 3383 14501 7041          CIA
 3384 14502 3124          DCA     FIOSTK+2        /SAVE HIS/HER #
 3385 14503 1031          TAD     JOBTAB
 3386 14504 3010          DCA     INDEX           /INITIALIZE TO START OF TABLES
 3387 14505 1322          TAD     LGOMAX          /-JOBMAX
 3388 14506 3125          DCA     FIOSTK+3        /COUNT OF JOBS TO CHECK
 3389 14507 3126          DCA     FIOSTK+4        /COUNT OF MATCHES
 3390 14510 1410          TAD I   INDEX
 3391 14511 1124          TAD     FIOSTK+2        /COMPARE
 3392 14512 7650          SNA CLA
 3393 14513 2126          ISZ     FIOSTK+4        /EXACT MATCH - INDEX COUNT
 3394 14514 2125          ISZ     FIOSTK+3        /DONE?
 3395 14515 5310          JMP     .-5             /NO
 3396 14516 7240          STA                     /YES - RETURN # OF MATCHES -1
 3397 14517 1126          TAD     FIOSTK+4
 3398 14520 3020          DCA     FIUSAC
 3399 14521 5455          JMP I   FIEXIT          /AND AWAY
 3400             
 3401 14522 7754  LGOMAX, -JOBMAX

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 80


 3402             
 3403 14523 0000  OPN11,  0
 3404 14524 3352          DCA     OPN13
 3405 14525 1124          TAD     FIOSTK+2        /GET RETRIEVAL POINTER OF UFD BEING ACCESSED
 3406 14526 7041          CIA
 3407 14527 1033          TAD     RETTBL          /IS IT THE MFD?
 3408 14530 7650          SNA CLA
 3409 14531 5363          JMP     OPN14           /MFD OR UFD, READ OK/WRITE NEVER OK
 3410 14532 4511          JMS I   ACC01           /IS HE THE SYSTEM MANAGER?
 3411 14533 5344          JMP     OPN12           /YES; SKIP PROTECTION CHECK
 3412 14534 1723          TAD I   OPN11           /GET PROPER TEST BITS
 3413 14535 0014          AND     P0007           /JUST TEST FOR READ PROTECTION FIRST
 3414 14536 0752          AND I   OPN13           /COMPARE AGAINST FILE'S PROTECTION WORD
 3415 14537 7640          SZA CLA
 3416 14540 5767          JMP I   OPNPRA          /PROTECTION ERROR
 3417 14541 1723          TAD I   OPN11           /READ OK, GET TEST BITS FOR WRITE
 3418 14542 7104          CLL RAL                 /CHECK FOR WRITE PROTECTION
 3419 14543 0752          AND I   OPN13
 3420 14544 7040  OPN12,  CMA
 3421 14545 3370          DCA     LGO6            /-1 IF OK TO WRITE
 3422 14546 1405          TAD I   ZDS1            /SOME MORE CONDITIONS TO TEST
 3423 14547 3352          DCA     OPN13
 3424 14550 1124          TAD     FIOSTK+2
 3425 14551 4766          JMS I   OPN16           /IS HE THE ONLY PERSON TO OPEN THE FILE?
 3426 14552 0000  OPN13,  0
 3427 14553 5363          JMP     OPN14           /NO
 3428 14554 1113          TAD     BASSWT
 3429 14555 7041          CIA
 3430 14556 6211          DATFLD
 3431 14557 7440          SZA
 3432 14560 3516          DCA I   BASWIN          /MAKE SURE THE BASIC WINDOW GETS LOADED
 3433 14561 6221          CFLD
 3434 14562 2370          ISZ     LGO6            /IS HE ALLOWED TO MODIFY IT?
 3435 14563 1015  OPN14,  TAD     P0004           /NO, SO WRITE PROTECT BIT IS ON
 3436 14564 2323          ISZ     OPN11           /SKIP ON RETURN
 3437 14565 5723          JMP I   OPN11
 3438 14566 2330  OPN16,  ENS0
 3439 14567 0552  OPNPRA, OPNPRE
 3440             
 3441             
 3442             LGO6,
 3443 14570 0000  FIX40,  0
 3444 14571 3135          DCA     FLPARB+3
 3445 14572 1135          TAD     FLPARB+3
 3446 14573 3137          DCA     FLPARB+5
 3447 14574 7240          CLA CMA
 3448 14575 1137          TAD     FLPARB+5
 3449 14576 3136          DCA     FLPARB+4
 3450 14577 5770          JMP I   FIX40

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 81


 3451             
 3452       4600  *4600
 3453 14600 3136  TTYTBA, TTYTBL
 3454 14601 0051  CLK1A,  CLK1
 3455 14602 0050  CLK2A,  CLK2
 3456 14603 3510  RESET,  DCA I   CFH
 3457 14604 4470          FGETJT
 3458 14605 0016          JOBACC
 3459 14606 3371          DCA     ADDR
 3460 14607 6211          DATFLD
 3461 14610 1124          TAD     FIOSTK+2
 3462 14611 3771          DCA I   ADDR            /PLUG HIS/HER ACCOUNT # INTO HIS JOB STATUS BLOCKS
 3463 14612 1021          TAD     FIJOB           /GET JOB #
 3464 14613 1200          TAD     TTYTBA
 3465 14614 3371          DCA     ADDR
 3466 14615 1771          TAD I   ADDR            /GET LINE #
 3467 14616 7104          CLL RAL
 3468 14617 1163          TAD     DEVTBA          /FIND THE DDB
 3469 14620 3371          DCA     ADDR
 3470 14621 1075          TAD     P0003
 3471 14622 1771          TAD I   ADDR
 3472 14623 3371          DCA     ADDR
 3473 14624 6201          CDF
 3474 14625 1601          TAD I   CLK1A
 3475 14626 7006          RTL
 3476 14627 7006          RTL
 3477 14630 0014          AND     P0007
 3478 14631 3110          DCA     CFH
 3479 14632 1602          TAD I   CLK2A
 3480 14633 7006          RTL
 3481 14634 7004          RAL
 3482 14635 0106          AND     P7770
 3483 14636 1110          TAD     CFH
 3484 14637 6211          DATFLD                  /NOW RESET THE
 3485 14640 3771          DCA I   ADDR            /ASSIGN TIME
 3486 14641 5642          JMP I   .+1             /THEN EXIT
 3487 14642 3165          TABOUT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 82


 3488             
 3489 14643 0000  BASCO0, 0
 3490 14644 4466          JMS I   IFN01           /JUST RETURN INTERNAL FILE # IN FIOSTK+1
 3491 14645 1123          TAD     FIOSTK+1
 3492 14646 4453          JMS I   CL01            /CLOSE ANY FILE THAT IS OPEN
 3493 14647 1125          TAD     FIOSTK+3        /MAY BE
 3494 14650 7450          SNA                     /IS IT A NULL FILE NAME?
 3495 14651 5675          JMP I   OPN3A           /YES, ERROR RETURN
 3496 14652 1276          TAD     OPN3A+1         /COMPARE BA
 3497 14653 7640          SZA CLA
 3498 14654 5271          JMP     BASSET          /NO MATCH
 3499 14655 1124          TAD     FIOSTK+2        /IS ACCT # 2?
 3500 14656 7450          SNA
 3501 14657 4464          JMS I   JBLD0           /WHAT'S HIS/HER ACCOUNT?
 3502 14660 7112          CLL RTR
 3503 14661 7650          SNA CLA
 3504 14662 1126          TAD     FIOSTK+4        /COMPARE SI
 3505 14663 1277          TAD     OPN3A+2
 3506 14664 7650          SNA CLA
 3507 14665 1127          TAD     FIOSTK+5
 3508 14666 1300          TAD     OPN3A+3         /COMPARE C
 3509 14667 7650          SNA CLA
 3510 14670 7040          CMA                     /IF BASIC, BASSWT=-1
 3511 14671 3113  BASSET, DCA     BASSWT          /IF NOT, BASSWT=0
 3512 14672 1123          TAD     FIOSTK+1
 3513 14673 4463          JMS I   EBLD0           /GET PTR TO ENTTBL WORD 1 RELATIVE PTR WORD 2 ADDRESS IN UFD
 3514 14674 5643          JMP I   BASCO0          /RETURN
 3515 14675 0551  OPN3A,  OPN3
 3516 14676 3537          -4241           /-BA
 3517 14677 1427          -6351           /-SI
 3518 14700 3500          -4300           /-C 
 3519             
 3520 14701 0000  CLOBAS, 0
 3521 14702 4403          JMS I   RETBK1
 3522 14703 3373          DCA     BAS3
 3523 14704 1373          TAD     BAS3
 3524 14705 7041          CIA
 3525 14706 1116          TAD     BASWIN
 3526 14707 7650          SNA CLA
 3527 14710 5314          JMP     CLOBA1
 3528 14711 1373          TAD     BAS3
 3529 14712 4403          JMS I   RETBK1
 3530 14713 7610          CLA SKP
 3531 14714 7240  CLOBA1, CLA CMA
 3532 14715 5701          JMP I   CLOBAS

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 83


 3533             
 3534 14716 0000  BAS0,   0
 3535 14717 3347          DCA     BAS1            /SAVE BUFFER ADDRESS OF RETRIEVAL WINDOW
 3536 14720 1116          TAD     BASWIN          /BASIC WINDOW ADDRESS
 3537 14721 3371          DCA     ADDR            /GET BUFFER ADDRESS READY
 3538 14722 1347  BAS5,   TAD     BAS1            /
 3539 14723 3372          DCA     BAS2
 3540 14724 1105          TAD     C7771
 3541 14725 3373          DCA     BAS3            /COUNT OF 7 SEGS PER WINDOW
 3542 14726 2372  BAS4,   ISZ     BAS2
 3543 14727 6221          CFLD
 3544 14730 1772          TAD I   BAS2            /PICK UP THE SEG #
 3545 14731 2371          ISZ     ADDR
 3546 14732 7450          SNA
 3547 14733 5352          JMP     BAS6
 3548 14734 6211          DATFLD
 3549 14735 3771          DCA I   ADDR            /SAVE IT IN WINDOW
 3550 14736 2373          ISZ     BAS3            /COUNT
 3551 14737 5326          JMP     BAS4            /STILL IN SAME BLOCK
 3552 14740 6221          CFLD
 3553 14741 1747          TAD I   BAS1            /CHANGE THE BLOCK
 3554 14742 7450          SNA
 3555 14743 5352          JMP     BAS6            /NO MORE SEGMENTS
 3556 14744 3347          DCA     BAS1
 3557 14745 1124          TAD     FIOSTK+2        /GET THIS BLOCK OF UFD IN BUFFER
 3558 14746 4441          JMS I   GE01
 3559 14747 0000  BAS1,   0
 3560 14750 3347          DCA     BAS1            /SAVE THE BUFFER ADDRESS CONTAINING THE NEEDED BLOCK
 3561 14751 5322          JMP     BAS5            /CONTINUE
 3562 14752 7450  BAS6,   SNA
 3563 14753 1747          TAD I   BAS1
 3564 14754 7640          SZA CLA
 3565 14755 5774          JMP I   BAS123          /BASIC MUST BE 39 SEGMENTS OR LESS TO USE SPECIAL WINDOW
 3566 14756 1371          TAD     ADDR
 3567 14757 7700          SMA CLA
 3568 14760 5365          JMP     .+5
 3569 14761 6211          DATFLD
 3570 14762 3771          DCA I   ADDR
 3571 14763 2371          ISZ     ADDR
 3572 14764 5362          JMP     .-2
 3573 14765 6211          DATFLD
 3574 14766 7240          CLA CMA
 3575 14767 3516          DCA I   BASWIN          /-1 IN FIRST WORD TO MARK BASIC WINDOW
 3576 14770 5716          JMP I   BAS0
 3577 14771 0000  ADDR,   0
 3578 14772 0000  BAS2,   0
 3579 14773 0000  BAS3,   0
 3580 14774 0532  BAS123, OPN123

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 84


 3581             
 3582             /ROUTINE TO LET SYSTEM MANAGER CHANGE PASSWORDS AND DISK QUOTAS
 3583             
 3584 14775 6525  UFDNAM, RTABLE
 3585 14776 0000          0
 3586             
 3587 14777 3376  PASQU0, DCA     UFDNAM+1        /SAVE ACCOUNT NUMBER TO SEARCH FOR
 3588 15000 7040          CMA
 3589 15001 4440          JMS I   DS01            /SEARCH MFD FOR THIS ACCOUNT
 3590 15002 4775          UFDNAM
 3591 15003 5242          JMP     PASNOT          /ACCOUNT NOT FOUND IN MFD
 3592 15004 3010          DCA     INDEX           /SAVE POINTER TO OLD PASSWORD
 3593 15005 1124          TAD     FIOSTK+2        /FIRST TWO CHARACTERS OF NEW PASSWORD
 3594 15006 3410          DCA I   INDEX           /SAVE IN MFD NAME BLOCK
 3595 15007 1125          TAD     FIOSTK+3        /SECOND TWO CHARACTERS OF NEW PASSWORD
 3596 15010 3410          DCA I   INDEX           /SAVE IN MFD
 3597 15011 2010          ISZ     INDEX           /SKIP PAST LINK TO NEXT UFD
 3598 15012 1126          TAD     FIOSTK+4        /GET NEW DISK QUOTA
 3599 15013 3410          DCA I   INDEX           /SAVE NEW QUOTA
 3600 15014 3026          DCA     BUFMOD          /REMEMBER TO WRITE OUT THE MFD SEGMENT
 3601 15015 1123          TAD     FIOSTK+1        /SEE IF THIS ACCOUNT IS CURRENTLY IN THE UFDTBL
 3602 15016 4452          JMS I   UTS01
 3603 15017 5455          JMP I   FIEXIT          /NOT THERE
 3604 15020 2107          ISZ     UTPRNU          /POINTS TO -QUOTA ENTRY
 3605 15021 7240          STA
 3606 15022 1123          TAD     FIOSTK+1        /IS IT THE QUOTA FOR THE "GRACE SPACE"?
 3607 15023 7650          SNA CLA
 3608 15024 5235          JMP     PASQU1          /YES
 3609 15025 1126          TAD     FIOSTK+4        /TRIM OFF THE LOGOUT PORTION OF THE QUOTA
 3610 15026 0013          AND     P0077
 3611 15027 3126          DCA     FIOSTK+4
 3612 15030 1126          TAD     FIOSTK+4
 3613 15031 7104          CLL RAL                 /MULTIPLY BY TWO
 3614 15032 1126          TAD     FIOSTK+4        /THREE
 3615 15033 7004          RAL                     /SIX
 3616 15034 7006          RTL                     /TWENTY FOUR
 3617 15035 1126  PASQU1, TAD     FIOSTK+4        /TWENTY FIVE; OR ACTUAL COUNT IF FOR "GRACE SPACE"
 3618 15036 7041          CIA                     /NEGATE THE RESULT
 3619 15037 3507          DCA I   UTPRNU          /SAVE AWAY IN THE UFDTBL
 3620 15040 5641          JMP I   .+1
 3621 15041 3165          TABOUT
 3622             
 3623 15042 1162  PASNOT, TAD     P7000           /RETURN FILE NOT FOUND
 3624 15043 3020          DCA     FIUSAC
 3625 15044 5455          JMP I   FIEXIT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 85


 3626             
 3627             /SUBROUTINE TO FIND AN EMPTY DIRECTORY ENTRY
 3628             
 3629             /CALLING SEQUENCE:
 3630             /       TAD (POINTER TO UFD RETRIEVAL INFORMATION)
 3631             /       JMS DE0
 3632             /       BAD RETURN (COULD NOT FIND A FREE ENTRY)
 3633             /       NORMAL RETURN (POINTER TO ENTRY IN AC)
 3634             
 3635 15045 0000  DE0,    0
 3636 15046 3334          DCA     DERETP          /SAVE RETRIEVAL PTR
 3637 15047 3300          DCA     DE2             /ZERO THE ADDRESS IN UFD
 3638 15050 1025          TAD     BUFSTA          /IS THERE A SEGMENT IN THE BUFFER?
 3639 15051 7700          SMA CLA
 3640 15052 5273          JMP     DE7             /NO, SO START FROM THE BEGINNING
 3641 15053 1736          TAD I   GERETA          /GET THE SEGMENT IN CORE
 3642 15054 7040          CMA
 3643 15055 3337          DCA     NSEGCR
 3644 15056 1334          TAD     DERETP          /GET RETRIEVAL PTR FOR INCREMENT
 3645 15057 3335          DCA     UFDPTR
 3646 15060 1735  DE5,    TAD I   UFDPTR
 3647 15061 7450          SNA                     /IS THERE A SEGMENT?
 3648 15062 5273          JMP     DE7             /NO, START FROM 0 LOC IN UFD
 3649 15063 1337          TAD     NSEGCR          /YES, DOES IT AGREE WITH THE SEGMENT IN CORE?
 3650 15064 7650          SNA CLA
 3651 15065 5275          JMP     DE6             /YES, START SEARCHING AT THIS POINT
 3652 15066 1300          TAD     DE2             /NO, INCREMENT THE ADDR
 3653 15067 1156          TAD     C0400
 3654 15070 3300          DCA     DE2
 3655 15071 2335          ISZ     UFDPTR          /POINT TO NEXT SEGMENT IN RETRIEVAL BLOCK
 3656 15072 5260          JMP     DE5             /GO BACK
 3657 15073 3300  DE7,    DCA     DE2             /INDICATE THAT SEARCH IS FROM WORD 0
 3658 15074 7240          STA
 3659 15075 3733  DE6,    DCA I   UFD01           /SAVE SECOND PASS FLAG
 3660 15076 1334  DE1,    TAD     DERETP
 3661 15077 4441          JMS I   GE01            /GET ENTRY INTO CORE
 3662 15100 0000  DE2,    0
 3663 15101 7450          SNA                     /SKIP IF ENTRY EXISTS
 3664 15102 5324          JMP     DE4             /DID NOT EXIST, EXTEND UFD
 3665 15103 3332          DCA     DEBUFP
 3666 15104 1732          TAD I   DEBUFP          /FIRST WORD OF ENTRY
 3667 15105 7640          SZA CLA
 3668 15106 5320          JMP     DE3             /NOT EMPTY, LOOK AT NEXT ENTRY
 3669 15107 2332          ISZ     DEBUFP          /ZERO COULD MEAN END OF STRING OF RETRIEVAL INFORMATION BLOCKS
 3670 15110 1732          TAD I   DEBUFP          /LOOK AT SECOND WORD OF ENTRY
 3671 15111 7640          SZA CLA                 /IF ZERO, EMPTY ENTRY
 3672 15112 5320          JMP     DE3             /NOT EMPTY, KEEP LOOKING
 3673 15113 1300          TAD     DE2             /PICK UP ENTRY POINTER
 3674 15114 7450          SNA                     /ENTRY 0 NEVER AVAILABLE
 3675 15115 5320          JMP     DE3
 3676 15116 2245          ISZ     DE0             /POINT TO NORMAL RETURN
 3677 15117 5645          JMP I   DE0

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 86


 3678             
 3679 15120 1114  DE3,    TAD     C0010           /INCREMENT TO NEXT ENTRY
 3680 15121 1300          TAD     DE2
 3681 15122 3300          DCA     DE2             /SAVE NEXT ENTRY INDEX
 3682 15123 5276          JMP     DE1             /LOOK AT NEXT ONE
 3683             
 3684 15124 2733  DE4,    ISZ I   UFD01           /HAVE WE TRIED FROM THE BEGINNING YET?
 3685 15125 5273          JMP     DE7             /NO, WELL TRY IT THEN...
 3686 15126 1334          TAD     DERETP
 3687 15127 4733          JMS I   UFD01           /TRY EXTENDING THE UFD
 3688 15130 5645          JMP I   DE0             /TOO BAD, CAN'T EXTEND UFD
 3689 15131 5276          JMP     DE1             /NOW WE HAVE PLENTY OF ROOM
 3690 15132 0000  DEBUFP, 0
 3691 15133 1706  UFD01,  UFD0
 3692 15134 0000  DERETP, 0
 3693 15135 0000  UFDPTR, 0
 3694 15136 2653  GERETA, RDCURR
 3695 15137 0000  NSEGCR, 0
 3696             
 3697             /ROUTINE TO OUTPUT QUOTA EXCEEDED MESSAGE
 3698 15140 0000  EXTEL0, 0
 3699 15141 6211          DATFLD
 3700 15142 1021          TAD     FIJOB           /CURRENT JOB NUMBER
 3701 15143 1366          TAD     TTYTAB          /POINTS AT POSITION IN TTYTBL
 3702 15144 3245          DCA     DE0
 3703 15145 1645          TAD I   DE0             /GET CONSOLE NUMBER FOR THIS JOB
 3704 15146 7124          STL RAL                 /TIMES 2 PLUS 1
 3705 15147 1163          TAD     DEVTBA          /INDEX TO OUTPUT DDB
 3706 15150 6201          CDF
 3707 15151 3767          DCA I   CONDVA          /STORE FOR FIELD 0 PRINT ROUTINE
 3708 15152 6221          CFLD
 3709 15153 1370          TAD     EXTMES          /GET MESSAGE POINTER
 3710 15154 3010          DCA     INDEX
 3711 15155 1410  EXTEL1, TAD I   INDEX           /GET CHARACTER OF THE MESSAGE
 3712 15156 7450          SNA                     /ANY LEFT?
 3713 15157 5740          JMP I   EXTEL0          /NO; SO GO EXTEND
 3714 15160 6203          CIF CDF 00
 3715 15161 3771          DCA I   FICHAR          /STORE FOR PRINT OUT ROUTINE
 3716 15162 6221          CFLD
 3717 15163 4573          PRINT                   /SEND MESSAGE #[EXCEEDING DISK QUOTA]#
 3718 15164 5740          JMP I   EXTEL0          /RAN OUT OF SPACE IN THE OUTPUT BUFFER (TOO BAD!)
 3719 15165 5355          JMP     EXTEL1          /BACK FOR NEXT CHARACTER
 3720             
 3721 15166 3136  TTYTAB, TTYTBL
 3722 15167 0132  CONDVA, CONDBA
 3723 15170 4373  EXTMES, EXCEED-1
 3724 15171 0031  FICHAR, TTCHAR

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 87


 3725             
 3726             /ROUTINE TO CLEAR ALL CPU AND DEVICE TIME ACCUMULATORS IN THE MFD
 3727             /THIS IS USED BY THE #RESET# FUNCTION IN THE CUSP #CAT#
 3728 15172 7201  LGRES0, CLA IAC                 /SET RESET FLAG IN DIRECTORY SEARCH ROUTINE
 3729 15173 3403          DCA I   RETBK1
 3730 15174 1003          TAD     RETBK1
 3731 15175 3107          DCA     EXQ1            /SET POINTER SO FLAG WILL CLEAR ON COMPLETION
 3732 15176 1033          TAD     RETTBL
 3733 15177 3023          DCA     GDRETP          /SET RETRIEVAL POINTER
 3734 15200 4203          JMS     LOQUO           /GO DO THE RESET
 3735 15201 7040          CMA                     /SHOULD RETURN A ZERO IN AC
 3736 15202 5240          JMP     EXTQU1
 3737             
 3738             /ROUTINE TO COUNT TOTAL SEGMENTS OWNED BY A UFD AND
 3739             /SAVE THE RESULT IN WORD 3 OF THE UFDTBL ENTRY FOR THE RESPECTIVE UFD
 3740             /CALL:
 3741             /       EXQ1 POINTS TO WORD 3 OF CORRECT UFDTBL ENTRY
 3742             /       JMS     LOQUO
 3743             /       RETURN (ENTRY 3 LOADED, TOTAL ALSO IN AC)
 3744             
 3745             EXQ3,
 3746 15203 0000  LOQUO,  0
 3747 15204 3024          DCA     WNDREM          /FUDGE A FILE NAME BEGINNING WITH TWO SPACES
 3748 15205 4440          JMS I   DS01            /SEARCH DIRECTORY TO DETERMINE SEGMENT COUNT
 3749 15206 0023          GDRETP                  /(HOPE NO ONE SCRAMBLES LOC. 23-26 ON PAGE 0!!)
 3750 15207 7610          CLA SKP                 /GOOD - COULDN'T FIND SUCH A FILE
 3751 15210 5471          JMP I   DIRBAD          /FOUND IT! OOPS!
 3752 15211 1120          TAD     SEGLIM          /GET THE TOTAL FROM THE DIRECTORY SEARCH
 3753 15212 3507          DCA I   EXQ1            /SAVE IN UFDTBL
 3754 15213 1123          TAD     FIOSTK+1        /INTERNAL FILE NUMBER?
 3755 15214 7500          SMA                     /IF THIS IS NOT A "RESET" WE MUST RELOAD
 3756 15215 4442          JMS I   GD01            /THE CORRECT DIRECTORY SEGMENT
 3757 15216 3121          DCA     REL6            /SAVE POINTER TO NAME BLOCK
 3758 15217 1120          TAD     SEGLIM          /RETURN WITH CURRENT TOTAL
 3759 15220 5603          JMP I   LOQUO
 3760             
 3761             
 3762 15221 7200  EXTQU8, CLA                     /WE'VE BEEN HERE BEFORE FOR THIS GUY
 3763 15222 6221          CFLD
 3764 15223 1334          TAD     EXQ2            /WILL THIS EXTEND CARRY
 3765 15224 1507          TAD I   EXQ1            /THIS FILE ACROSS THE QUOTA BOUNDARY AGAIN?
 3766 15225 7740          SMA SZA CLA             /(I.E. HAS HE REDUCED SINCE LAST EXTEND?)
 3767 15226 5235          JMP     EXTQU9          /NO; HE'S STILL ABOVE QUOTA, EXTEND QUIETLY
 3768 15227 1374  EXTQU6, TAD     EXFILE          /ADDRESS WITHIN MESSAGE TO STORE FILE NAME
 3769 15230 3010          DCA     INDEX
 3770 15231 4316          JMS     EXTNAM          /CHAR 1 & 2 OF FILE NAME
 3771 15232 4316          JMS     EXTNAM          /CHAR 3 & 4 OF FILE NAME
 3772 15233 4316          JMS     EXTNAM          /CHAR 5 & 6 OF FILE NAME
 3773 15234 4775          JMS I   EXTELL          /NOTIFY USER THAT QUOTA IS BEING EXCEEDED
 3774 15235 7200  EXTQU9, CLA
 3775 15236 5642          JMP I   EXTQU0          /EXIT TO EXTEND FILE AS REQUESTED
 3776             
 3777 15237 1124  EXTQU5, TAD     FIOSTK+2        /NUMBER OF SEGMENTS HE WON'T GET
 3778 15240 3020  EXTQU1, DCA     FIUSAC          /PASS RESULT BACK TO THE USER
 3779 15241 5455          JMP I   FIEXIT

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 88


 3780             
 3781             /ROUTINE TO CHECK LOGIN QUOTA BEFORE EXTENDING A FILE
 3782             
 3783 15242 0000  EXTQU0, 0
 3784 15243 1023          TAD     GDRETP          /COMPARE RETRIEVAL POINTER
 3785 15244 7041          CIA
 3786 15245 1033          TAD     RETTBL          /AGAINST THE MFD'S ENTRY
 3787 15246 7650          SNA CLA                 /IS IT FROM THE SYSTEM MANAGER?
 3788 15247 5771          JMP I   VIOLAT          /GET OUT QUICK, BEFORE HE DESTROYS THE SYSTEM
 3789 15250 1124          TAD     FIOSTK+2        /NUMBER OF SEGMENTS TO BE ADDED
 3790 15251 7510          SPA                     /IS HE BEING REASONABLE?
 3791 15252 5240          JMP     EXTQU1          /NO - HE DESERVES TO FAIL!
 3792 15253 7141          CLL CIA
 3793 15254 1773          TAD I   SATSEG          /ARE THERE THAT MANY SEGMENTS LEFT ON THE SYSTEM?
 3794 15255 7620          SNL CLA
 3795 15256 5237          JMP     EXTQU5          /NO; SO DON'T GIVE ANY
 3796 15257 1023          TAD     GDRETP          /RETRIEVAL POINTER
 3797 15260 4772          JMS I   ENS33           /CONVERT TO RELATIVE ENTRY NUMBER
 3798 15261 7126          STL RTL                 /TIMES FOUR PLUS TWO
 3799 15262 1032          TAD     UFDTBL          /POINTS AT -LOGIN QUOTA
 3800 15263 3107          DCA     EXQ1            /SAVE POINTER
 3801 15264 1507          TAD I   EXQ1            /GET NEGATIVE QUOTA
 3802 15265 3334          DCA     EXQ2            /AND SAVE
 3803 15266 2107          ISZ     EXQ1            /POINTS AT CURRENTLY OWNED COUNT
 3804 15267 1507          TAD I   EXQ1            /GET HIS/HER PRESENT TOTAL
 3805 15270 7450          SNA                     /HAS THE COUNT BEEN SET UP YET?
 3806 15271 4203          JMS     LOQUO           /NO; GO FIGURE IT OUT
 3807 15272 1124          TAD     FIOSTK+2        /ADD THE NUMBER HE WANTS
 3808 15273 1334          TAD     EXQ2            /AND SUBTRACT FROM QUOTA
 3809 15274 7550          SPA SNA                 /WILL THIS EXCEED THE QUOTA FOR THIS ACCOUNT?
 3810 15275 5235          JMP     EXTQU9          /NO; GO EXTEND
 3811 15276 1777          TAD I   GRACE           /WILL IT GO BEYOND THE #GRACE SPACE#?
 3812 15277 7740          SMA SZA CLA
 3813 15300 5237          JMP     EXTQU5          /YES; DON'T BOTHER EXTENDING
 3814 15301 1123          TAD     FIOSTK+1        /SEE IF THIS FILE IS ALREADY IN THE GRACE AREA
 3815 15302 4404          JMS I   LNK01           /GET POINTER TO FILE CONTROL BLOCK
 3816 15303 1017          TAD     FILPRP          /POINT TO STATUS WORD
 3817 15304 3203          DCA     EXQ3
 3818 15305 6211          DATFLD
 3819 15306 1603          TAD I   EXQ3            /GET CURRENT STATUS FOR THIS FILE
 3820 15307 7010          RAR
 3821 15310 7430          SZL                     /IS THIS FILE IN THE GRACE AREA?
 3822 15311 5221          JMP     EXTQU8          /MAYBE; SEE IF HE'S REENTERING
 3823 15312 7124          STL RAL                 /SET GRACE BIT
 3824 15313 3603          DCA I   EXQ3
 3825 15314 6221          CFLD
 3826 15315 5227          JMP     EXTQU6          /SEND MESSAGE, THEN GO EXTEND

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 89


 3827             
 3828             /ROUTINE TO PLANT FILE NAME INTO "EXCEEDING QUOTA" MESSAGE
 3829             
 3830 15316 0000  EXTNAM, 0
 3831 15317 1521          TAD I   REL6            /GET PART OF FILE NAME
 3832 15320 7012          RTR
 3833 15321 7012          RTR
 3834 15322 7012          RTR
 3835 15323 0013          AND     P0077           /SAVE LEFT BYTE
 3836 15324 1376          TAD     P0240           /CONVERT TO ASCII
 3837 15325 3410          DCA I   INDEX           /STORE IN THE MESSAGE AREA
 3838 15326 1521          TAD I   REL6            /NOW FOR THE RIGHT BYTE
 3839 15327 0013          AND     P0077
 3840 15330 1376          TAD     P0240           /CONVERT TO ASCII
 3841 15331 3410          DCA I   INDEX           /SAVE RIGHT BYTE
 3842 15332 2121          ISZ     REL6            /POINT TO NEXT CHARACTER
 3843 15333 5716          JMP I   EXTNAM
 3844             
 3845             /ROUTINE TO CHECK FOR THE SAFE REDUCTION OF A UFD
 3846             /TWO CONDITIONS MUST BE MET:
 3847             /       THE ACCOUNT CANNOT BE IN USE TO ANYONE
 3848             /       THE ACCOUNT MUST HAVE AN EMPTY DIRECTORY
 3849             
 3850             EXQ2,
 3851 15334 0000  REDUF0, 0
 3852 15335 1023          TAD     GDRETP          /GET RETRIEVAL POINTER
 3853 15336 7041          CIA
 3854 15337 1033          TAD     RETTBL          /IS HE TRYING TO REDUCE A UFD?
 3855 15340 7640          SZA CLA
 3856 15341 5734          JMP I   REDUF0          /NO; LET HIM/HER REDUCE NORMAL FILES
 3857 15342 1521          TAD I   REL6            /GET THE ACCOUNT NUMBER OF THE UFD IN QUESTION
 3858 15343 4452          JMS I   UTS01           /LOOK IT UP IN THE UFD TABLE
 3859 15344 5350          JMP     REDUF1          /NOT THERE - GOOD
 3860 15345 7200          CLA
 3861 15346 1104          TAD     C4400           /TELL HIM "FILE IN USE"
 3862 15347 5240          JMP     EXTQU1
 3863 15350 1521  REDUF1, TAD I   REL6            /GET THE ACCOUNT NUMBER OF THE UFD TO BE DELETED
 3864 15351 4451          JMS I   UFO01           /LOAD ITS RETRIEVAL WINDOW INTO RTABLE
 3865 15352 5237          JMP     EXTQU5          /COULDN'T; PAS HIS/HER OWN AC BACK AS AN ERROR INDICATION
 3866 15353 4456          JMS I   BLDP1           /MAKE A RETRIEVAL POINTER
 3867 15354 3023          DCA     GDRETP          /SAVE IT FOR THE SEARCH
 3868 15355 2107          ISZ     EXQ1            /POSITION UFDTBL POINTER FOR THIS ACCOUNT
 3869 15356 2107          ISZ     EXQ1            /TO POINT TO THE SEGMENT ACCUMULATOR
 3870 15357 4203          JMS     LOQUO           /SEE IF THIS UFD STILL CONTAINS FILES
 3871 15360 7346          CLL STA RTL             /AC=-3
 3872 15361 1107          TAD     EXQ1            /POSITION WE'VE BEEN ASSIGNED ON UFDTBL
 3873 15362 4447          JMS I   TF01            /FREE THE POSITION
 3874 15363 1507          TAD I   EXQ1            /DID HE OWN ANY SEGMENTS?
 3875 15364 7640          SZA CLA
 3876 15365 5771          JMP I   VIOLAT          /STILL SOME FILES IN THERE!
 3877 15366 7240          STA
 3878 15367 3124          DCA     FIOSTK+2        /FORCE HIM/HER TO COMPLETELY DELETE THIS UFD
 3879 15370 5734          JMP I   REDUF0
 3880             

      /EDUSYSTEM 50 MONITOR FOR MELROSE HIGH SCHOOL #495AB               Page 90


 3881             
 3882 15371 0734  VIOLAT, PRT1+1
 3883 15372 3567  ENS33,  ENS3
 3884 15373 7251  SATSEG, -SATSIZ+1
 3885 15374 4376  EXFILE, EXCEED+2
 3886 15375 5140  EXTELL, EXTEL0
 3887 15376 0240  P0240,  240
 3888 15377 6267  GRACE,  UTABLE+2
 3889             

      No detected errors
